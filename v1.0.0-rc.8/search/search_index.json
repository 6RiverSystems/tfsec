{"config": {"indexing": "full", "lang": ["en"], "min_search_length": 3, "prebuild_index": false, "separator": "[\\s\\-]+"}, "docs": [{"location": "", "text": "tfsec is a static analysis security scanner for your Terraform code. Designed to run locally and in your CI pipelines, developer-friendly output and fully documented checks mean detection and remediation can take place as quickly and efficiently as possible tfsec takes a developer-first approach to scanning your Terraform templates; using static analysis and deep integration with the official HCL parser it ensures thatsecurity issues can be detected before your infrastructure changes take effect. Demo: Misconfiguration Detection tfsec is an Aqua Security open source project. Learn about our open source work and portfolio here . Contact us about any matter by opening a GitHub Discussion here", "title": "HOME"}, {"location": "checks/aws/api-gateway/enable-access-logging/", "text": "API Gateway stages for V1 and V2 should have access logging enabled Default Severity: medium Explanation API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for API Gateway stages Insecure Example The following example will fail the aws-api-gateway-enable-access-logging check. resource \"aws_apigatewayv2_stage\" \"bad_example\" { api_id = aws_apigatewayv2_api.example.id name = \"example-stage\" } resource \"aws_apigatewayv2_stage\" \"bad_example\" { deployment_id = aws_api_gateway_deployment.example.id rest_api_id = aws_api_gateway_rest_api.example.id stage_name = \"example\" } Secure Example The following example will pass the aws-api-gateway-enable-access-logging check. resource \"aws_apigatewayv2_stage\" \"good_example\" { api_id = aws_apigatewayv2_api.example.id name = \"example-stage\" access_log_settings { destination_arn = \"arn:aws:logs:region:0123456789:log-group:access_logging\" format = \"json\" } } resource \"aws_api_gateway_stage\" \"good_example\" { deployment_id = aws_api_gateway_deployment.example.id rest_api_id = aws_api_gateway_rest_api.example.id stage_name = \"example\" access_log_settings { destination_arn = \"arn:aws:logs:region:0123456789:log-group:access_logging\" format = \"json\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/apigatewayv2_stage#access_log_settings https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-logging.html", "title": "enable-access-logging"}, {"location": "checks/aws/api-gateway/enable-access-logging/#api-gateway-stages-for-v1-and-v2-should-have-access-logging-enabled", "text": "", "title": "API Gateway stages for V1 and V2 should have access logging enabled"}, {"location": "checks/aws/api-gateway/enable-access-logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/api-gateway/enable-access-logging/#explanation", "text": "API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages.", "title": "Explanation"}, {"location": "checks/aws/api-gateway/enable-access-logging/#possible-impact", "text": "Logging provides vital information about access and usage", "title": "Possible Impact"}, {"location": "checks/aws/api-gateway/enable-access-logging/#suggested-resolution", "text": "Enable logging for API Gateway stages", "title": "Suggested Resolution"}, {"location": "checks/aws/api-gateway/enable-access-logging/#insecure-example", "text": "The following example will fail the aws-api-gateway-enable-access-logging check. resource \"aws_apigatewayv2_stage\" \"bad_example\" { api_id = aws_apigatewayv2_api.example.id name = \"example-stage\" } resource \"aws_apigatewayv2_stage\" \"bad_example\" { deployment_id = aws_api_gateway_deployment.example.id rest_api_id = aws_api_gateway_rest_api.example.id stage_name = \"example\" }", "title": "Insecure Example"}, {"location": "checks/aws/api-gateway/enable-access-logging/#secure-example", "text": "The following example will pass the aws-api-gateway-enable-access-logging check. resource \"aws_apigatewayv2_stage\" \"good_example\" { api_id = aws_apigatewayv2_api.example.id name = \"example-stage\" access_log_settings { destination_arn = \"arn:aws:logs:region:0123456789:log-group:access_logging\" format = \"json\" } } resource \"aws_api_gateway_stage\" \"good_example\" { deployment_id = aws_api_gateway_deployment.example.id rest_api_id = aws_api_gateway_rest_api.example.id stage_name = \"example\" access_log_settings { destination_arn = \"arn:aws:logs:region:0123456789:log-group:access_logging\" format = \"json\" } }", "title": "Secure Example"}, {"location": "checks/aws/api-gateway/enable-access-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/apigatewayv2_stage#access_log_settings https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-logging.html", "title": "Links"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/", "text": "API Gateway must have cache enabled Default Severity: medium Explanation Method cache encryption ensures that any sensitive data in the cache is not vulnerable to compromise in the event of interception Possible Impact Data stored in the cache that is unencrypted may be vulnerable to compromise Suggested Resolution Enable cache encryption Insecure Example The following example will fail the aws-api-gateway-enable-cache-encryption check. resource \"aws_api_gateway_rest_api\" \"example\" { } resource \"aws_api_gateway_stage\" \"example\" { rest_api_id = aws_api_gateway_rest_api.example.id } resource \"aws_api_gateway_method_settings\" \"bad_example\" { rest_api_id = aws_api_gateway_rest_api.example.id stage_name = aws_api_gateway_stage.example.stage_name method_path = \"path1/GET\" settings { metrics_enabled = true logging_level = \"INFO\" cache_data_encrypted = false } } Secure Example The following example will pass the aws-api-gateway-enable-cache-encryption check. resource \"aws_api_gateway_rest_api\" \"example\" { } resource \"aws_api_gateway_stage\" \"example\" { } resource \"aws_api_gateway_method_settings\" \"good_example\" { rest_api_id = aws_api_gateway_rest_api.example.id stage_name = aws_api_gateway_stage.example.stage_name method_path = \"path1/GET\" settings { metrics_enabled = true logging_level = \"INFO\" cache_data_encrypted = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method_settings#cache_data_encrypted", "title": "enable-cache-encryption"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/#api-gateway-must-have-cache-enabled", "text": "", "title": "API Gateway must have cache enabled"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/#explanation", "text": "Method cache encryption ensures that any sensitive data in the cache is not vulnerable to compromise in the event of interception", "title": "Explanation"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/#possible-impact", "text": "Data stored in the cache that is unencrypted may be vulnerable to compromise", "title": "Possible Impact"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/#suggested-resolution", "text": "Enable cache encryption", "title": "Suggested Resolution"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/#insecure-example", "text": "The following example will fail the aws-api-gateway-enable-cache-encryption check. resource \"aws_api_gateway_rest_api\" \"example\" { } resource \"aws_api_gateway_stage\" \"example\" { rest_api_id = aws_api_gateway_rest_api.example.id } resource \"aws_api_gateway_method_settings\" \"bad_example\" { rest_api_id = aws_api_gateway_rest_api.example.id stage_name = aws_api_gateway_stage.example.stage_name method_path = \"path1/GET\" settings { metrics_enabled = true logging_level = \"INFO\" cache_data_encrypted = false } }", "title": "Insecure Example"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/#secure-example", "text": "The following example will pass the aws-api-gateway-enable-cache-encryption check. resource \"aws_api_gateway_rest_api\" \"example\" { } resource \"aws_api_gateway_stage\" \"example\" { } resource \"aws_api_gateway_method_settings\" \"good_example\" { rest_api_id = aws_api_gateway_rest_api.example.id stage_name = aws_api_gateway_stage.example.stage_name method_path = \"path1/GET\" settings { metrics_enabled = true logging_level = \"INFO\" cache_data_encrypted = true } }", "title": "Secure Example"}, {"location": "checks/aws/api-gateway/enable-cache-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method_settings#cache_data_encrypted", "title": "Links"}, {"location": "checks/aws/api-gateway/enable-tracing/", "text": "API Gateway must have X-Ray tracing enabled Default Severity: low Explanation X-Ray tracing enables end-to-end debugging and analysis of all API Gateway HTTP requests. Possible Impact Without full tracing enabled it is difficult to trace the flow of logs Suggested Resolution Enable tracing Insecure Example The following example will fail the aws-api-gateway-enable-tracing check. resource \"aws_api_gateway_rest_api\" \"test\" { } resource \"aws_api_gateway_stage\" \"bad_example\" { stage_name = \"prod\" rest_api_id = aws_api_gateway_rest_api.test.id deployment_id = aws_api_gateway_deployment.test.id xray_tracing_enabled = false } Secure Example The following example will pass the aws-api-gateway-enable-tracing check. resource \"aws_api_gateway_rest_api\" \"test\" { } resource \"aws_api_gateway_stage\" \"good_example\" { stage_name = \"prod\" rest_api_id = aws_api_gateway_rest_api.test.id deployment_id = aws_api_gateway_deployment.test.id xray_tracing_enabled = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage#xray_tracing_enabled", "title": "enable-tracing"}, {"location": "checks/aws/api-gateway/enable-tracing/#api-gateway-must-have-x-ray-tracing-enabled", "text": "", "title": "API Gateway must have X-Ray tracing enabled"}, {"location": "checks/aws/api-gateway/enable-tracing/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/api-gateway/enable-tracing/#explanation", "text": "X-Ray tracing enables end-to-end debugging and analysis of all API Gateway HTTP requests.", "title": "Explanation"}, {"location": "checks/aws/api-gateway/enable-tracing/#possible-impact", "text": "Without full tracing enabled it is difficult to trace the flow of logs", "title": "Possible Impact"}, {"location": "checks/aws/api-gateway/enable-tracing/#suggested-resolution", "text": "Enable tracing", "title": "Suggested Resolution"}, {"location": "checks/aws/api-gateway/enable-tracing/#insecure-example", "text": "The following example will fail the aws-api-gateway-enable-tracing check. resource \"aws_api_gateway_rest_api\" \"test\" { } resource \"aws_api_gateway_stage\" \"bad_example\" { stage_name = \"prod\" rest_api_id = aws_api_gateway_rest_api.test.id deployment_id = aws_api_gateway_deployment.test.id xray_tracing_enabled = false }", "title": "Insecure Example"}, {"location": "checks/aws/api-gateway/enable-tracing/#secure-example", "text": "The following example will pass the aws-api-gateway-enable-tracing check. resource \"aws_api_gateway_rest_api\" \"test\" { } resource \"aws_api_gateway_stage\" \"good_example\" { stage_name = \"prod\" rest_api_id = aws_api_gateway_rest_api.test.id deployment_id = aws_api_gateway_deployment.test.id xray_tracing_enabled = true }", "title": "Secure Example"}, {"location": "checks/aws/api-gateway/enable-tracing/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage#xray_tracing_enabled", "title": "Links"}, {"location": "checks/aws/api-gateway/no-public-access/", "text": "No unauthorized access to API Gateway methods Default Severity: low Explanation API Gateway methods should generally be protected by authorization or api key. OPTION verb calls can be used without authorization Possible Impact API gateway methods can be accessed without authorization. Suggested Resolution Use and authorization method or require API Key Insecure Example The following example will fail the aws-api-gateway-no-public-access check. resource \"aws_api_gateway_rest_api\" \"MyDemoAPI\" { } resource \"aws_api_gateway_method\" \"bad_example\" { rest_api_id = aws_api_gateway_rest_api.MyDemoAPI.id resource_id = aws_api_gateway_resource.MyDemoResource.id http_method = \"GET\" authorization = \"NONE\" } Secure Example The following example will pass the aws-api-gateway-no-public-access check. resource \"aws_api_gateway_rest_api\" \"MyDemoAPI\" { } resource \"aws_api_gateway_method\" \"good_example\" { rest_api_id = aws_api_gateway_rest_api.MyDemoAPI.id resource_id = aws_api_gateway_resource.MyDemoResource.id http_method = \"GET\" authorization = \"AWS_IAM\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method#authorization", "title": "no-public-access"}, {"location": "checks/aws/api-gateway/no-public-access/#no-unauthorized-access-to-api-gateway-methods", "text": "", "title": "No unauthorized access to API Gateway methods"}, {"location": "checks/aws/api-gateway/no-public-access/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/api-gateway/no-public-access/#explanation", "text": "API Gateway methods should generally be protected by authorization or api key. OPTION verb calls can be used without authorization", "title": "Explanation"}, {"location": "checks/aws/api-gateway/no-public-access/#possible-impact", "text": "API gateway methods can be accessed without authorization.", "title": "Possible Impact"}, {"location": "checks/aws/api-gateway/no-public-access/#suggested-resolution", "text": "Use and authorization method or require API Key", "title": "Suggested Resolution"}, {"location": "checks/aws/api-gateway/no-public-access/#insecure-example", "text": "The following example will fail the aws-api-gateway-no-public-access check. resource \"aws_api_gateway_rest_api\" \"MyDemoAPI\" { } resource \"aws_api_gateway_method\" \"bad_example\" { rest_api_id = aws_api_gateway_rest_api.MyDemoAPI.id resource_id = aws_api_gateway_resource.MyDemoResource.id http_method = \"GET\" authorization = \"NONE\" }", "title": "Insecure Example"}, {"location": "checks/aws/api-gateway/no-public-access/#secure-example", "text": "The following example will pass the aws-api-gateway-no-public-access check. resource \"aws_api_gateway_rest_api\" \"MyDemoAPI\" { } resource \"aws_api_gateway_method\" \"good_example\" { rest_api_id = aws_api_gateway_rest_api.MyDemoAPI.id resource_id = aws_api_gateway_resource.MyDemoResource.id http_method = \"GET\" authorization = \"AWS_IAM\" }", "title": "Secure Example"}, {"location": "checks/aws/api-gateway/no-public-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_method#authorization", "title": "Links"}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/", "text": "API Gateway domain name uses outdated SSL/TLS protocols. Default Severity: high Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the aws-api-gateway-use-secure-tls-policy check. resource \"aws_api_gateway_domain_name\" \"bad_example\" { security_policy = \"TLS_1_0\" } Secure Example The following example will pass the aws-api-gateway-use-secure-tls-policy check. resource \"aws_api_gateway_domain_name\" \"good_example\" { security_policy = \"TLS_1_2\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_domain_name#security_policy https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-custom-domain-tls-version.html", "title": "use-secure-tls-policy"}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/#api-gateway-domain-name-uses-outdated-ssltls-protocols", "text": "", "title": "API Gateway domain name uses outdated SSL/TLS protocols."}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/#explanation", "text": "You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.", "title": "Explanation"}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/#possible-impact", "text": "Outdated SSL policies increase exposure to known vulnerabilities", "title": "Possible Impact"}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/#suggested-resolution", "text": "Use the most modern TLS/SSL policies available", "title": "Suggested Resolution"}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/#insecure-example", "text": "The following example will fail the aws-api-gateway-use-secure-tls-policy check. resource \"aws_api_gateway_domain_name\" \"bad_example\" { security_policy = \"TLS_1_0\" }", "title": "Insecure Example"}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/#secure-example", "text": "The following example will pass the aws-api-gateway-use-secure-tls-policy check. resource \"aws_api_gateway_domain_name\" \"good_example\" { security_policy = \"TLS_1_2\" }", "title": "Secure Example"}, {"location": "checks/aws/api-gateway/use-secure-tls-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_domain_name#security_policy https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-custom-domain-tls-version.html", "title": "Links"}, {"location": "checks/aws/athena/enable-at-rest-encryption/", "text": "Athena databases and workgroup configurations are created unencrypted at rest by default, they should be encrypted Default Severity: high Explanation Athena databases and workspace result sets should be encrypted at rests. These databases and query sets are generally derived from data in S3 buckets and should have the same level of at rest protection. Possible Impact Data can be read if the Athena Database is compromised Suggested Resolution Enable encryption at rest for Athena databases and workgroup configurations Insecure Example The following example will fail the aws-athena-enable-at-rest-encryption check. resource \"aws_athena_database\" \"bad_example\" { name = \"database_name\" bucket = aws_s3_bucket.hoge.bucket } resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" } } } Secure Example The following example will pass the aws-athena-enable-at-rest-encryption check. resource \"aws_athena_database\" \"good_example\" { name = \"database_name\" bucket = aws_s3_bucket.hoge.bucket encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } resource \"aws_athena_workgroup\" \"good_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#encryption_configuration https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_database#encryption_configuration https://docs.aws.amazon.com/athena/latest/ug/encryption.html", "title": "enable-at-rest-encryption"}, {"location": "checks/aws/athena/enable-at-rest-encryption/#athena-databases-and-workgroup-configurations-are-created-unencrypted-at-rest-by-default-they-should-be-encrypted", "text": "", "title": "Athena databases and workgroup configurations are created unencrypted at rest by default, they should be encrypted"}, {"location": "checks/aws/athena/enable-at-rest-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/athena/enable-at-rest-encryption/#explanation", "text": "Athena databases and workspace result sets should be encrypted at rests. These databases and query sets are generally derived from data in S3 buckets and should have the same level of at rest protection.", "title": "Explanation"}, {"location": "checks/aws/athena/enable-at-rest-encryption/#possible-impact", "text": "Data can be read if the Athena Database is compromised", "title": "Possible Impact"}, {"location": "checks/aws/athena/enable-at-rest-encryption/#suggested-resolution", "text": "Enable encryption at rest for Athena databases and workgroup configurations", "title": "Suggested Resolution"}, {"location": "checks/aws/athena/enable-at-rest-encryption/#insecure-example", "text": "The following example will fail the aws-athena-enable-at-rest-encryption check. resource \"aws_athena_database\" \"bad_example\" { name = \"database_name\" bucket = aws_s3_bucket.hoge.bucket } resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" } } }", "title": "Insecure Example"}, {"location": "checks/aws/athena/enable-at-rest-encryption/#secure-example", "text": "The following example will pass the aws-athena-enable-at-rest-encryption check. resource \"aws_athena_database\" \"good_example\" { name = \"database_name\" bucket = aws_s3_bucket.hoge.bucket encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } resource \"aws_athena_workgroup\" \"good_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } }", "title": "Secure Example"}, {"location": "checks/aws/athena/enable-at-rest-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#encryption_configuration https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_database#encryption_configuration https://docs.aws.amazon.com/athena/latest/ug/encryption.html", "title": "Links"}, {"location": "checks/aws/athena/no-encryption-override/", "text": "Athena workgroups should enforce configuration to prevent client disabling encryption Default Severity: high Explanation Athena workgroup configuration should be enforced to prevent client side changes to disable encryption settings. Possible Impact Clients can ignore encryption requirements Suggested Resolution Enforce the configuration to prevent client overrides Insecure Example The following example will fail the aws-athena-no-encryption-override check. resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" configuration { enforce_workgroup_configuration = false publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } } resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" } Secure Example The following example will pass the aws-athena-no-encryption-override check. resource \"aws_athena_workgroup\" \"good_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#configuration https://docs.aws.amazon.com/athena/latest/ug/manage-queries-control-costs-with-workgroups.html", "title": "no-encryption-override"}, {"location": "checks/aws/athena/no-encryption-override/#athena-workgroups-should-enforce-configuration-to-prevent-client-disabling-encryption", "text": "", "title": "Athena workgroups should enforce configuration to prevent client disabling encryption"}, {"location": "checks/aws/athena/no-encryption-override/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/athena/no-encryption-override/#explanation", "text": "Athena workgroup configuration should be enforced to prevent client side changes to disable encryption settings.", "title": "Explanation"}, {"location": "checks/aws/athena/no-encryption-override/#possible-impact", "text": "Clients can ignore encryption requirements", "title": "Possible Impact"}, {"location": "checks/aws/athena/no-encryption-override/#suggested-resolution", "text": "Enforce the configuration to prevent client overrides", "title": "Suggested Resolution"}, {"location": "checks/aws/athena/no-encryption-override/#insecure-example", "text": "The following example will fail the aws-athena-no-encryption-override check. resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" configuration { enforce_workgroup_configuration = false publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } } resource \"aws_athena_workgroup\" \"bad_example\" { name = \"example\" }", "title": "Insecure Example"}, {"location": "checks/aws/athena/no-encryption-override/#secure-example", "text": "The following example will pass the aws-athena-no-encryption-override check. resource \"aws_athena_workgroup\" \"good_example\" { name = \"example\" configuration { enforce_workgroup_configuration = true publish_cloudwatch_metrics_enabled = true result_configuration { output_location = \"s3://${aws_s3_bucket.example.bucket}/output/\" encryption_configuration { encryption_option = \"SSE_KMS\" kms_key_arn = aws_kms_key.example.arn } } } }", "title": "Secure Example"}, {"location": "checks/aws/athena/no-encryption-override/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/athena_workgroup#configuration https://docs.aws.amazon.com/athena/latest/ug/manage-queries-control-costs-with-workgroups.html", "title": "Links"}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/", "text": "Launch configuration with unencrypted block device. Default Severity: high Explanation Block devices should be encrypted to ensure sensitive data is held securely at rest. Possible Impact The block device could be compromised and read from Suggested Resolution Turn on encryption for all block devices Insecure Example The following example will fail the aws-autoscaling-enable-at-rest-encryption check. resource \"aws_launch_configuration\" \"bad_example\" { root_block_device { encrypted = false } } Secure Example The following example will pass the aws-autoscaling-enable-at-rest-encryption check. resource \"aws_launch_configuration\" \"good_example\" { root_block_device { encrypted = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#ebs-ephemeral-and-root-block-devices https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html", "title": "enable-at-rest-encryption"}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/#launch-configuration-with-unencrypted-block-device", "text": "", "title": "Launch configuration with unencrypted block device."}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/#explanation", "text": "Block devices should be encrypted to ensure sensitive data is held securely at rest.", "title": "Explanation"}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/#possible-impact", "text": "The block device could be compromised and read from", "title": "Possible Impact"}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/#suggested-resolution", "text": "Turn on encryption for all block devices", "title": "Suggested Resolution"}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/#insecure-example", "text": "The following example will fail the aws-autoscaling-enable-at-rest-encryption check. resource \"aws_launch_configuration\" \"bad_example\" { root_block_device { encrypted = false } }", "title": "Insecure Example"}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/#secure-example", "text": "The following example will pass the aws-autoscaling-enable-at-rest-encryption check. resource \"aws_launch_configuration\" \"good_example\" { root_block_device { encrypted = true } }", "title": "Secure Example"}, {"location": "checks/aws/autoscaling/enable-at-rest-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#ebs-ephemeral-and-root-block-devices https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html", "title": "Links"}, {"location": "checks/aws/autoscaling/no-public-ip/", "text": "Launch configuration should not have a public IP address. Default Severity: high Explanation You should limit the provision of public IP addresses for resources. Resources should not be exposed on the public internet, but should have access limited to consumers required for the function of your application. Possible Impact The instance or configuration is publicly accessible Suggested Resolution Set the instance to not be publicly accessible Insecure Example The following example will fail the aws-autoscaling-no-public-ip check. resource \"aws_launch_configuration\" \"bad_example\" { associate_public_ip_address = true } Secure Example The following example will pass the aws-autoscaling-no-public-ip check. resource \"aws_launch_configuration\" \"good_example\" { associate_public_ip_address = false } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#associate_public_ip_address https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#associate_public_ip_address https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html", "title": "no-public-ip"}, {"location": "checks/aws/autoscaling/no-public-ip/#launch-configuration-should-not-have-a-public-ip-address", "text": "", "title": "Launch configuration should not have a public IP address."}, {"location": "checks/aws/autoscaling/no-public-ip/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/autoscaling/no-public-ip/#explanation", "text": "You should limit the provision of public IP addresses for resources. Resources should not be exposed on the public internet, but should have access limited to consumers required for the function of your application.", "title": "Explanation"}, {"location": "checks/aws/autoscaling/no-public-ip/#possible-impact", "text": "The instance or configuration is publicly accessible", "title": "Possible Impact"}, {"location": "checks/aws/autoscaling/no-public-ip/#suggested-resolution", "text": "Set the instance to not be publicly accessible", "title": "Suggested Resolution"}, {"location": "checks/aws/autoscaling/no-public-ip/#insecure-example", "text": "The following example will fail the aws-autoscaling-no-public-ip check. resource \"aws_launch_configuration\" \"bad_example\" { associate_public_ip_address = true }", "title": "Insecure Example"}, {"location": "checks/aws/autoscaling/no-public-ip/#secure-example", "text": "The following example will pass the aws-autoscaling-no-public-ip check. resource \"aws_launch_configuration\" \"good_example\" { associate_public_ip_address = false }", "title": "Secure Example"}, {"location": "checks/aws/autoscaling/no-public-ip/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#associate_public_ip_address https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#associate_public_ip_address https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html", "title": "Links"}, {"location": "checks/aws/autoscaling/no-sensitive-info/", "text": "Ensure all data stored in the launch configuration EBS is securely encrypted Default Severity: high Explanation When creating Launch Configurations, user data can be used for the initial configuration of the instance. User data must not contain any sensitive data. Possible Impact Sensitive credentials in user data can be leaked Suggested Resolution Don't use sensitive data in user data Insecure Example The following example will fail the aws-autoscaling-no-sensitive-info check. resource \"aws_launch_configuration\" \"as_conf\" { name = \"web_config\" image_id = data.aws_ami.ubuntu.id instance_type = \"t2.micro\" user_data = << EOF export DATABASE_PASSWORD=\\\"SomeSortOfPassword\\\" EOF } export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF } Secure Example The following example will pass the aws-autoscaling-no-sensitive-info check. resource \"aws_launch_configuration\" \"as_conf\" { name = \"web_config\" image_id = data.aws_ami.ubuntu.id instance_type = \"t2.micro\" user_data = << EOF export GREETING=\"Hello there\" EOF } export GREETING = \"Hello there\" EOF } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#user_data,user_data_base64", "title": "Ensure all data stored in the launch configuration EBS is securely encrypted"}, {"location": "checks/aws/autoscaling/no-sensitive-info/#ensure-all-data-stored-in-the-launch-configuration-ebs-is-securely-encrypted", "text": "", "title": "Ensure all data stored in the launch configuration EBS is securely encrypted"}, {"location": "checks/aws/autoscaling/no-sensitive-info/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/autoscaling/no-sensitive-info/#explanation", "text": "When creating Launch Configurations, user data can be used for the initial configuration of the instance. User data must not contain any sensitive data.", "title": "Explanation"}, {"location": "checks/aws/autoscaling/no-sensitive-info/#possible-impact", "text": "Sensitive credentials in user data can be leaked", "title": "Possible Impact"}, {"location": "checks/aws/autoscaling/no-sensitive-info/#suggested-resolution", "text": "Don't use sensitive data in user data", "title": "Suggested Resolution"}, {"location": "checks/aws/autoscaling/no-sensitive-info/#insecure-example", "text": "The following example will fail the aws-autoscaling-no-sensitive-info check. resource \"aws_launch_configuration\" \"as_conf\" { name = \"web_config\" image_id = data.aws_ami.ubuntu.id instance_type = \"t2.micro\" user_data = << EOF export DATABASE_PASSWORD=\\\"SomeSortOfPassword\\\" EOF } export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF }", "title": "Insecure Example"}, {"location": "checks/aws/autoscaling/no-sensitive-info/#secure-example", "text": "The following example will pass the aws-autoscaling-no-sensitive-info check. resource \"aws_launch_configuration\" \"as_conf\" { name = \"web_config\" image_id = data.aws_ami.ubuntu.id instance_type = \"t2.micro\" user_data = << EOF export GREETING=\"Hello there\" EOF } export GREETING = \"Hello there\" EOF }", "title": "Secure Example"}, {"location": "checks/aws/autoscaling/no-sensitive-info/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration#user_data,user_data_base64", "title": "Links"}, {"location": "checks/aws/cloudfront/enable-logging/", "text": "Cloudfront distribution should have Access Logging configured Default Severity: medium Explanation You should configure CloudFront Access Logging to create log files that contain detailed information about every user request that CloudFront receives Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for CloudFront distributions Insecure Example The following example will fail the aws-cloudfront-enable-logging check. resource \"aws_cloudfront_distribution\" \"bad_example\" { // other config // no logging_config } Secure Example The following example will pass the aws-cloudfront-enable-logging check. resource \"aws_cloudfront_distribution\" \"good_example\" { // other config logging_config { include_cookies = false bucket = \"mylogs.s3.amazonaws.com\" prefix = \"myprefix\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#logging_config https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html", "title": "enable-logging"}, {"location": "checks/aws/cloudfront/enable-logging/#cloudfront-distribution-should-have-access-logging-configured", "text": "", "title": "Cloudfront distribution should have Access Logging configured"}, {"location": "checks/aws/cloudfront/enable-logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/cloudfront/enable-logging/#explanation", "text": "You should configure CloudFront Access Logging to create log files that contain detailed information about every user request that CloudFront receives", "title": "Explanation"}, {"location": "checks/aws/cloudfront/enable-logging/#possible-impact", "text": "Logging provides vital information about access and usage", "title": "Possible Impact"}, {"location": "checks/aws/cloudfront/enable-logging/#suggested-resolution", "text": "Enable logging for CloudFront distributions", "title": "Suggested Resolution"}, {"location": "checks/aws/cloudfront/enable-logging/#insecure-example", "text": "The following example will fail the aws-cloudfront-enable-logging check. resource \"aws_cloudfront_distribution\" \"bad_example\" { // other config // no logging_config }", "title": "Insecure Example"}, {"location": "checks/aws/cloudfront/enable-logging/#secure-example", "text": "The following example will pass the aws-cloudfront-enable-logging check. resource \"aws_cloudfront_distribution\" \"good_example\" { // other config logging_config { include_cookies = false bucket = \"mylogs.s3.amazonaws.com\" prefix = \"myprefix\" } }", "title": "Secure Example"}, {"location": "checks/aws/cloudfront/enable-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#logging_config https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html", "title": "Links"}, {"location": "checks/aws/cloudfront/enable-waf/", "text": "CloudFront distribution does not have a WAF in front. Default Severity: high Explanation You should configure a Web Application Firewall in front of your CloudFront distribution. This will mitigate many types of attacks on your web application. Possible Impact Complex web application attacks can more easily be performed without a WAF Suggested Resolution Enable WAF for the CloudFront distribution Insecure Example The following example will fail the aws-cloudfront-enable-waf check. resource \"aws_cloudfront_distribution\" \"bad_example\" { origin_group { origin_id = \"groupS3\" failover_criteria { status_codes = [ 403 , 404 , 500 , 502 ] } member { origin_id = \"primaryS3\" } } origin { domain_name = aws_s3_bucket.primary.bucket_regional_domain_name origin_id = \"primaryS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } origin { domain_name = aws_s3_bucket.failover.bucket_regional_domain_name origin_id = \"failoverS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } default_cache_behavior { target_origin_id = \"groupS3\" } } Secure Example The following example will pass the aws-cloudfront-enable-waf check. resource \"aws_cloudfront_distribution\" \"good_example\" { origin { domain_name = aws_s3_bucket.primary.bucket_regional_domain_name origin_id = \"primaryS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } origin { domain_name = aws_s3_bucket.failover.bucket_regional_domain_name origin_id = \"failoverS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } default_cache_behavior { target_origin_id = \"groupS3\" } web_acl_id = \"waf_id\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#web_acl_id https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html", "title": "enable-waf"}, {"location": "checks/aws/cloudfront/enable-waf/#cloudfront-distribution-does-not-have-a-waf-in-front", "text": "", "title": "CloudFront distribution does not have a WAF in front."}, {"location": "checks/aws/cloudfront/enable-waf/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/cloudfront/enable-waf/#explanation", "text": "You should configure a Web Application Firewall in front of your CloudFront distribution. This will mitigate many types of attacks on your web application.", "title": "Explanation"}, {"location": "checks/aws/cloudfront/enable-waf/#possible-impact", "text": "Complex web application attacks can more easily be performed without a WAF", "title": "Possible Impact"}, {"location": "checks/aws/cloudfront/enable-waf/#suggested-resolution", "text": "Enable WAF for the CloudFront distribution", "title": "Suggested Resolution"}, {"location": "checks/aws/cloudfront/enable-waf/#insecure-example", "text": "The following example will fail the aws-cloudfront-enable-waf check. resource \"aws_cloudfront_distribution\" \"bad_example\" { origin_group { origin_id = \"groupS3\" failover_criteria { status_codes = [ 403 , 404 , 500 , 502 ] } member { origin_id = \"primaryS3\" } } origin { domain_name = aws_s3_bucket.primary.bucket_regional_domain_name origin_id = \"primaryS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } origin { domain_name = aws_s3_bucket.failover.bucket_regional_domain_name origin_id = \"failoverS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } default_cache_behavior { target_origin_id = \"groupS3\" } }", "title": "Insecure Example"}, {"location": "checks/aws/cloudfront/enable-waf/#secure-example", "text": "The following example will pass the aws-cloudfront-enable-waf check. resource \"aws_cloudfront_distribution\" \"good_example\" { origin { domain_name = aws_s3_bucket.primary.bucket_regional_domain_name origin_id = \"primaryS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } origin { domain_name = aws_s3_bucket.failover.bucket_regional_domain_name origin_id = \"failoverS3\" s3_origin_config { origin_access_identity = aws_cloudfront_origin_access_identity.default.cloudfront_access_identity_path } } default_cache_behavior { target_origin_id = \"groupS3\" } web_acl_id = \"waf_id\" }", "title": "Secure Example"}, {"location": "checks/aws/cloudfront/enable-waf/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#web_acl_id https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html", "title": "Links"}, {"location": "checks/aws/cloudfront/enforce-https/", "text": "CloudFront distribution allows unencrypted (HTTP) communications. Default Severity: critical Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact CloudFront is available through an unencrypted connection Suggested Resolution Only allow HTTPS for CloudFront distribution communication Insecure Example The following example will fail the aws-cloudfront-enforce-https check. resource \"aws_cloudfront_distribution\" \"bad_example\" { default_cache_behavior { viewer_protocol_policy = \"allow-all\" } } Secure Example The following example will pass the aws-cloudfront-enforce-https check. resource \"aws_cloudfront_distribution\" \"good_example\" { default_cache_behavior { viewer_protocol_policy = \"redirect-to-https\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#viewer_protocol_policy https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-cloudfront-to-s3-origin.html", "title": "enforce-https"}, {"location": "checks/aws/cloudfront/enforce-https/#cloudfront-distribution-allows-unencrypted-http-communications", "text": "", "title": "CloudFront distribution allows unencrypted (HTTP) communications."}, {"location": "checks/aws/cloudfront/enforce-https/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/cloudfront/enforce-https/#explanation", "text": "Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.", "title": "Explanation"}, {"location": "checks/aws/cloudfront/enforce-https/#possible-impact", "text": "CloudFront is available through an unencrypted connection", "title": "Possible Impact"}, {"location": "checks/aws/cloudfront/enforce-https/#suggested-resolution", "text": "Only allow HTTPS for CloudFront distribution communication", "title": "Suggested Resolution"}, {"location": "checks/aws/cloudfront/enforce-https/#insecure-example", "text": "The following example will fail the aws-cloudfront-enforce-https check. resource \"aws_cloudfront_distribution\" \"bad_example\" { default_cache_behavior { viewer_protocol_policy = \"allow-all\" } }", "title": "Insecure Example"}, {"location": "checks/aws/cloudfront/enforce-https/#secure-example", "text": "The following example will pass the aws-cloudfront-enforce-https check. resource \"aws_cloudfront_distribution\" \"good_example\" { default_cache_behavior { viewer_protocol_policy = \"redirect-to-https\" } }", "title": "Secure Example"}, {"location": "checks/aws/cloudfront/enforce-https/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#viewer_protocol_policy https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-cloudfront-to-s3-origin.html", "title": "Links"}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/", "text": "CloudFront distribution uses outdated SSL/TLS protocols. Default Severity: high Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the aws-cloudfront-use-secure-tls-policy check. resource \"aws_cloudfront_distribution\" \"bad_example\" { viewer_certificate { cloudfront_default_certificate = true minimum_protocol_version = \"TLSv1.0\" } } Secure Example The following example will pass the aws-cloudfront-use-secure-tls-policy check. resource \"aws_cloudfront_distribution\" \"good_example\" { viewer_certificate { cloudfront_default_certificate = true minimum_protocol_version = \"TLSv1.2_2021\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#minimum_protocol_version https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html", "title": "use-secure-tls-policy"}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/#cloudfront-distribution-uses-outdated-ssltls-protocols", "text": "", "title": "CloudFront distribution uses outdated SSL/TLS protocols."}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/#explanation", "text": "You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.", "title": "Explanation"}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/#possible-impact", "text": "Outdated SSL policies increase exposure to known vulnerabilities", "title": "Possible Impact"}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/#suggested-resolution", "text": "Use the most modern TLS/SSL policies available", "title": "Suggested Resolution"}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/#insecure-example", "text": "The following example will fail the aws-cloudfront-use-secure-tls-policy check. resource \"aws_cloudfront_distribution\" \"bad_example\" { viewer_certificate { cloudfront_default_certificate = true minimum_protocol_version = \"TLSv1.0\" } }", "title": "Insecure Example"}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/#secure-example", "text": "The following example will pass the aws-cloudfront-use-secure-tls-policy check. resource \"aws_cloudfront_distribution\" \"good_example\" { viewer_certificate { cloudfront_default_certificate = true minimum_protocol_version = \"TLSv1.2_2021\" } }", "title": "Secure Example"}, {"location": "checks/aws/cloudfront/use-secure-tls-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#minimum_protocol_version https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html", "title": "Links"}, {"location": "checks/aws/cloudtrail/enable-all-regions/", "text": "Cloudtrail should be enabled in all regions regardless of where your AWS resources are generally homed Default Severity: medium Explanation When creating Cloudtrail in the AWS Management Console the trail is configured by default to be multi-region, this isn't the case with the Terraform resource. Cloudtrail should cover the full AWS account to ensure you can track changes in regions you are not actively operting in. Possible Impact Activity could be happening in your account in a different region Suggested Resolution Enable Cloudtrail in all regions Insecure Example The following example will fail the aws-cloudtrail-enable-all-regions check. resource \"aws_cloudtrail\" \"bad_example\" { event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Secure Example The following example will pass the aws-cloudtrail-enable-all-regions check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#is_multi_region_trail https://docs.aws.amazon.com/awscloudtrail/latest/userguide/receive-cloudtrail-log-files-from-multiple-regions.html", "title": "enable-all-regions"}, {"location": "checks/aws/cloudtrail/enable-all-regions/#cloudtrail-should-be-enabled-in-all-regions-regardless-of-where-your-aws-resources-are-generally-homed", "text": "", "title": "Cloudtrail should be enabled in all regions regardless of where your AWS resources are generally homed"}, {"location": "checks/aws/cloudtrail/enable-all-regions/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/cloudtrail/enable-all-regions/#explanation", "text": "When creating Cloudtrail in the AWS Management Console the trail is configured by default to be multi-region, this isn't the case with the Terraform resource. Cloudtrail should cover the full AWS account to ensure you can track changes in regions you are not actively operting in.", "title": "Explanation"}, {"location": "checks/aws/cloudtrail/enable-all-regions/#possible-impact", "text": "Activity could be happening in your account in a different region", "title": "Possible Impact"}, {"location": "checks/aws/cloudtrail/enable-all-regions/#suggested-resolution", "text": "Enable Cloudtrail in all regions", "title": "Suggested Resolution"}, {"location": "checks/aws/cloudtrail/enable-all-regions/#insecure-example", "text": "The following example will fail the aws-cloudtrail-enable-all-regions check. resource \"aws_cloudtrail\" \"bad_example\" { event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }", "title": "Insecure Example"}, {"location": "checks/aws/cloudtrail/enable-all-regions/#secure-example", "text": "The following example will pass the aws-cloudtrail-enable-all-regions check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }", "title": "Secure Example"}, {"location": "checks/aws/cloudtrail/enable-all-regions/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#is_multi_region_trail https://docs.aws.amazon.com/awscloudtrail/latest/userguide/receive-cloudtrail-log-files-from-multiple-regions.html", "title": "Links"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/", "text": "Cloudtrail should be encrypted at rest to secure access to sensitive trail data Default Severity: high Explanation Cloudtrail logs should be encrypted at rest to secure the sensitive data. Cloudtrail logs record all activity that occurs in the the account through API calls and would be one of the first places to look when reacting to a breach. Possible Impact Data can be freely read if compromised Suggested Resolution Enable encryption at rest Insecure Example The following example will fail the aws-cloudtrail-enable-at-rest-encryption check. resource \"aws_cloudtrail\" \"bad_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Secure Example The following example will pass the aws-cloudtrail-enable-at-rest-encryption check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true enable_log_file_validation = true kms_key_id = var.kms_id event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#kms_key_id https://docs.aws.amazon.com/awscloudtrail/latest/userguide/encrypting-cloudtrail-log-files-with-aws-kms.html", "title": "enable-at-rest-encryption"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/#cloudtrail-should-be-encrypted-at-rest-to-secure-access-to-sensitive-trail-data", "text": "", "title": "Cloudtrail should be encrypted at rest to secure access to sensitive trail data"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/#explanation", "text": "Cloudtrail logs should be encrypted at rest to secure the sensitive data. Cloudtrail logs record all activity that occurs in the the account through API calls and would be one of the first places to look when reacting to a breach.", "title": "Explanation"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/#possible-impact", "text": "Data can be freely read if compromised", "title": "Possible Impact"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/#suggested-resolution", "text": "Enable encryption at rest", "title": "Suggested Resolution"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/#insecure-example", "text": "The following example will fail the aws-cloudtrail-enable-at-rest-encryption check. resource \"aws_cloudtrail\" \"bad_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }", "title": "Insecure Example"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/#secure-example", "text": "The following example will pass the aws-cloudtrail-enable-at-rest-encryption check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true enable_log_file_validation = true kms_key_id = var.kms_id event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }", "title": "Secure Example"}, {"location": "checks/aws/cloudtrail/enable-at-rest-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#kms_key_id https://docs.aws.amazon.com/awscloudtrail/latest/userguide/encrypting-cloudtrail-log-files-with-aws-kms.html", "title": "Links"}, {"location": "checks/aws/cloudtrail/enable-log-validation/", "text": "Cloudtrail log validation should be enabled to prevent tampering of log data Default Severity: high Explanation Log validation should be activated on Cloudtrail logs to prevent the tampering of the underlying data in the S3 bucket. It is feasible that a rogue actor compromising an AWS account might want to modify the log data to remove trace of their actions. Possible Impact Illicit activity could be removed from the logs Suggested Resolution Turn on log validation for Cloudtrail Insecure Example The following example will fail the aws-cloudtrail-enable-log-validation check. resource \"aws_cloudtrail\" \"bad_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Secure Example The following example will pass the aws-cloudtrail-enable-log-validation check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true enable_log_file_validation = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#enable_log_file_validation https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html", "title": "enable-log-validation"}, {"location": "checks/aws/cloudtrail/enable-log-validation/#cloudtrail-log-validation-should-be-enabled-to-prevent-tampering-of-log-data", "text": "", "title": "Cloudtrail log validation should be enabled to prevent tampering of log data"}, {"location": "checks/aws/cloudtrail/enable-log-validation/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/cloudtrail/enable-log-validation/#explanation", "text": "Log validation should be activated on Cloudtrail logs to prevent the tampering of the underlying data in the S3 bucket. It is feasible that a rogue actor compromising an AWS account might want to modify the log data to remove trace of their actions.", "title": "Explanation"}, {"location": "checks/aws/cloudtrail/enable-log-validation/#possible-impact", "text": "Illicit activity could be removed from the logs", "title": "Possible Impact"}, {"location": "checks/aws/cloudtrail/enable-log-validation/#suggested-resolution", "text": "Turn on log validation for Cloudtrail", "title": "Suggested Resolution"}, {"location": "checks/aws/cloudtrail/enable-log-validation/#insecure-example", "text": "The following example will fail the aws-cloudtrail-enable-log-validation check. resource \"aws_cloudtrail\" \"bad_example\" { is_multi_region_trail = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }", "title": "Insecure Example"}, {"location": "checks/aws/cloudtrail/enable-log-validation/#secure-example", "text": "The following example will pass the aws-cloudtrail-enable-log-validation check. resource \"aws_cloudtrail\" \"good_example\" { is_multi_region_trail = true enable_log_file_validation = true event_selector { read_write_type = \"All\" include_management_events = true data_resource { type = \"AWS::S3::Object\" values = [ \"${data.aws_s3_bucket.important-bucket.arn}/\" ] } } }", "title": "Secure Example"}, {"location": "checks/aws/cloudtrail/enable-log-validation/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#enable_log_file_validation https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html", "title": "Links"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/", "text": "CloudWatch log groups should be encrypted using CMK Default Severity: low Explanation CloudWatch log groups are encrypted by default, however, to get the full benefit of controlling key rotation and other KMS aspects a KMS CMK should be used. Possible Impact Log data may be leaked if the logs are compromised. No auditing of who have viewed the logs. Suggested Resolution Enable CMK encryption of CloudWatch Log Groups Insecure Example The following example will fail the aws-cloudwatch-log-group-customer-key check. resource \"aws_cloudwatch_log_group\" \"bad_example\" { name = \"bad_example\" } Secure Example The following example will pass the aws-cloudwatch-log-group-customer-key check. resource \"aws_cloudwatch_log_group\" \"good_example\" { name = \"good_example\" kms_key_id = aws_kms_key.log_key.arn } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group#kms_key_id https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/encrypt-log-data-kms.html", "title": "log-group-customer-key"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/#cloudwatch-log-groups-should-be-encrypted-using-cmk", "text": "", "title": "CloudWatch log groups should be encrypted using CMK"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/#explanation", "text": "CloudWatch log groups are encrypted by default, however, to get the full benefit of controlling key rotation and other KMS aspects a KMS CMK should be used.", "title": "Explanation"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/#possible-impact", "text": "Log data may be leaked if the logs are compromised. No auditing of who have viewed the logs.", "title": "Possible Impact"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/#suggested-resolution", "text": "Enable CMK encryption of CloudWatch Log Groups", "title": "Suggested Resolution"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/#insecure-example", "text": "The following example will fail the aws-cloudwatch-log-group-customer-key check. resource \"aws_cloudwatch_log_group\" \"bad_example\" { name = \"bad_example\" }", "title": "Insecure Example"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/#secure-example", "text": "The following example will pass the aws-cloudwatch-log-group-customer-key check. resource \"aws_cloudwatch_log_group\" \"good_example\" { name = \"good_example\" kms_key_id = aws_kms_key.log_key.arn }", "title": "Secure Example"}, {"location": "checks/aws/cloudwatch/log-group-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group#kms_key_id https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/encrypt-log-data-kms.html", "title": "Links"}, {"location": "checks/aws/codebuild/enable-encryption/", "text": "CodeBuild Project artifacts encryption should not be disabled Default Severity: high Explanation All artifacts produced by your CodeBuild project pipeline should always be encrypted Possible Impact CodeBuild project artifacts are unencrypted Suggested Resolution Enable encryption for CodeBuild project artifacts Insecure Example The following example will fail the aws-codebuild-enable-encryption check. resource \"aws_codebuild_project\" \"bad_example\" { // other config artifacts { // other artifacts config encryption_disabled = true } } resource \"aws_codebuild_project\" \"bad_example\" { // other config including primary artifacts secondary_artifacts { // other artifacts config encryption_disabled = false } secondary_artifacts { // other artifacts config encryption_disabled = true } } Secure Example The following example will pass the aws-codebuild-enable-encryption check. resource \"aws_codebuild_project\" \"good_example\" { // other config artifacts { // other artifacts config encryption_disabled = false } } resource \"aws_codebuild_project\" \"good_example\" { // other config artifacts { // other artifacts config } } resource \"aws_codebuild_project\" \"codebuild\" { // other config secondary_artifacts { // other artifacts config encryption_disabled = false } secondary_artifacts { // other artifacts config } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codebuild_project#encryption_disabled https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-codebuild-project-artifacts.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html", "title": "enable-encryption"}, {"location": "checks/aws/codebuild/enable-encryption/#codebuild-project-artifacts-encryption-should-not-be-disabled", "text": "", "title": "CodeBuild Project artifacts encryption should not be disabled"}, {"location": "checks/aws/codebuild/enable-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/codebuild/enable-encryption/#explanation", "text": "All artifacts produced by your CodeBuild project pipeline should always be encrypted", "title": "Explanation"}, {"location": "checks/aws/codebuild/enable-encryption/#possible-impact", "text": "CodeBuild project artifacts are unencrypted", "title": "Possible Impact"}, {"location": "checks/aws/codebuild/enable-encryption/#suggested-resolution", "text": "Enable encryption for CodeBuild project artifacts", "title": "Suggested Resolution"}, {"location": "checks/aws/codebuild/enable-encryption/#insecure-example", "text": "The following example will fail the aws-codebuild-enable-encryption check. resource \"aws_codebuild_project\" \"bad_example\" { // other config artifacts { // other artifacts config encryption_disabled = true } } resource \"aws_codebuild_project\" \"bad_example\" { // other config including primary artifacts secondary_artifacts { // other artifacts config encryption_disabled = false } secondary_artifacts { // other artifacts config encryption_disabled = true } }", "title": "Insecure Example"}, {"location": "checks/aws/codebuild/enable-encryption/#secure-example", "text": "The following example will pass the aws-codebuild-enable-encryption check. resource \"aws_codebuild_project\" \"good_example\" { // other config artifacts { // other artifacts config encryption_disabled = false } } resource \"aws_codebuild_project\" \"good_example\" { // other config artifacts { // other artifacts config } } resource \"aws_codebuild_project\" \"codebuild\" { // other config secondary_artifacts { // other artifacts config encryption_disabled = false } secondary_artifacts { // other artifacts config } }", "title": "Secure Example"}, {"location": "checks/aws/codebuild/enable-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codebuild_project#encryption_disabled https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-codebuild-project-artifacts.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html", "title": "Links"}, {"location": "checks/aws/config/aggregate-all-regions/", "text": "Config configuration aggregator should be using all regions for source Default Severity: high Explanation The configuration aggregator should be configured with all_regions for the source. This will help limit the risk of any unmonitored configuration in regions that are thought to be unused. Possible Impact Sources that aren't covered by the aggregator are not include in the configuration Suggested Resolution Set the aggregator to cover all regions Insecure Example The following example will fail the aws-config-aggregate-all-regions check. resource \"aws_config_configuration_aggregator\" \"bad_example\" { name = \"example\" account_aggregation_source { account_ids = [ \"123456789012\" ] regions = [ \"us-west-2\", \"eu-west-1\" ] } } Secure Example The following example will pass the aws-config-aggregate-all-regions check. resource \"aws_config_configuration_aggregator\" \"good_example\" { name = \"example\" account_aggregation_source { account_ids = [ \"123456789012\" ] all_regions = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_configuration_aggregator#all_regions https://docs.aws.amazon.com/config/latest/developerguide/aggregate-data.html", "title": "aggregate-all-regions"}, {"location": "checks/aws/config/aggregate-all-regions/#config-configuration-aggregator-should-be-using-all-regions-for-source", "text": "", "title": "Config configuration aggregator should be using all regions for source"}, {"location": "checks/aws/config/aggregate-all-regions/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/config/aggregate-all-regions/#explanation", "text": "The configuration aggregator should be configured with all_regions for the source. This will help limit the risk of any unmonitored configuration in regions that are thought to be unused.", "title": "Explanation"}, {"location": "checks/aws/config/aggregate-all-regions/#possible-impact", "text": "Sources that aren't covered by the aggregator are not include in the configuration", "title": "Possible Impact"}, {"location": "checks/aws/config/aggregate-all-regions/#suggested-resolution", "text": "Set the aggregator to cover all regions", "title": "Suggested Resolution"}, {"location": "checks/aws/config/aggregate-all-regions/#insecure-example", "text": "The following example will fail the aws-config-aggregate-all-regions check. resource \"aws_config_configuration_aggregator\" \"bad_example\" { name = \"example\" account_aggregation_source { account_ids = [ \"123456789012\" ] regions = [ \"us-west-2\", \"eu-west-1\" ] } }", "title": "Insecure Example"}, {"location": "checks/aws/config/aggregate-all-regions/#secure-example", "text": "The following example will pass the aws-config-aggregate-all-regions check. resource \"aws_config_configuration_aggregator\" \"good_example\" { name = \"example\" account_aggregation_source { account_ids = [ \"123456789012\" ] all_regions = true } }", "title": "Secure Example"}, {"location": "checks/aws/config/aggregate-all-regions/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/config_configuration_aggregator#all_regions https://docs.aws.amazon.com/config/latest/developerguide/aggregate-data.html", "title": "Links"}, {"location": "checks/aws/documentdb/enable-log-export/", "text": "DocumentDB logs export should be enabled Default Severity: medium Explanation Document DB does not have auditing by default. To ensure that you are able to accurately audit the usage of your DocumentDB cluster you should enable export logs. Possible Impact Limited visibility of audit trail for changes to the DocumentDB Suggested Resolution Enable export logs Insecure Example The following example will fail the aws-documentdb-enable-log-export check. resource \"aws_docdb_cluster\" \"bad_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true enabled_cloudwatch_logs_exports = \"something\" } Secure Example The following example will pass the aws-documentdb-enable-log-export check. resource \"aws_docdb_cluster\" \"good_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true enabled_cloudwatch_logs_exports = \"audit\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#enabled_cloudwatch_logs_exports https://docs.aws.amazon.com/documentdb/latest/developerguide/event-auditing.html", "title": "enable-log-export"}, {"location": "checks/aws/documentdb/enable-log-export/#documentdb-logs-export-should-be-enabled", "text": "", "title": "DocumentDB logs export should be enabled"}, {"location": "checks/aws/documentdb/enable-log-export/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/documentdb/enable-log-export/#explanation", "text": "Document DB does not have auditing by default. To ensure that you are able to accurately audit the usage of your DocumentDB cluster you should enable export logs.", "title": "Explanation"}, {"location": "checks/aws/documentdb/enable-log-export/#possible-impact", "text": "Limited visibility of audit trail for changes to the DocumentDB", "title": "Possible Impact"}, {"location": "checks/aws/documentdb/enable-log-export/#suggested-resolution", "text": "Enable export logs", "title": "Suggested Resolution"}, {"location": "checks/aws/documentdb/enable-log-export/#insecure-example", "text": "The following example will fail the aws-documentdb-enable-log-export check. resource \"aws_docdb_cluster\" \"bad_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true enabled_cloudwatch_logs_exports = \"something\" }", "title": "Insecure Example"}, {"location": "checks/aws/documentdb/enable-log-export/#secure-example", "text": "The following example will pass the aws-documentdb-enable-log-export check. resource \"aws_docdb_cluster\" \"good_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true enabled_cloudwatch_logs_exports = \"audit\" }", "title": "Secure Example"}, {"location": "checks/aws/documentdb/enable-log-export/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#enabled_cloudwatch_logs_exports https://docs.aws.amazon.com/documentdb/latest/developerguide/event-auditing.html", "title": "Links"}, {"location": "checks/aws/documentdb/enable-storage-encryption/", "text": "DocumentDB storage must be encrypted Default Severity: high Explanation Encryption of the underlying storage used by DocumentDB ensures that if their is compromise of the disks, the data is still protected. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable storage encryption Insecure Example The following example will fail the aws-documentdb-enable-storage-encryption check. resource \"aws_docdb_cluster\" \"bad_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true storage_encrypted = false } Secure Example The following example will pass the aws-documentdb-enable-storage-encryption check. resource \"aws_docdb_cluster\" \"good_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true storage_encrypted = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#storage_encrypted https://docs.aws.amazon.com/documentdb/latest/developerguide/encryption-at-rest.html", "title": "enable-storage-encryption"}, {"location": "checks/aws/documentdb/enable-storage-encryption/#documentdb-storage-must-be-encrypted", "text": "", "title": "DocumentDB storage must be encrypted"}, {"location": "checks/aws/documentdb/enable-storage-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/documentdb/enable-storage-encryption/#explanation", "text": "Encryption of the underlying storage used by DocumentDB ensures that if their is compromise of the disks, the data is still protected.", "title": "Explanation"}, {"location": "checks/aws/documentdb/enable-storage-encryption/#possible-impact", "text": "Unencrypted sensitive data is vulnerable to compromise.", "title": "Possible Impact"}, {"location": "checks/aws/documentdb/enable-storage-encryption/#suggested-resolution", "text": "Enable storage encryption", "title": "Suggested Resolution"}, {"location": "checks/aws/documentdb/enable-storage-encryption/#insecure-example", "text": "The following example will fail the aws-documentdb-enable-storage-encryption check. resource \"aws_docdb_cluster\" \"bad_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true storage_encrypted = false }", "title": "Insecure Example"}, {"location": "checks/aws/documentdb/enable-storage-encryption/#secure-example", "text": "The following example will pass the aws-documentdb-enable-storage-encryption check. resource \"aws_docdb_cluster\" \"good_example\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true storage_encrypted = true }", "title": "Secure Example"}, {"location": "checks/aws/documentdb/enable-storage-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#storage_encrypted https://docs.aws.amazon.com/documentdb/latest/developerguide/encryption-at-rest.html", "title": "Links"}, {"location": "checks/aws/documentdb/encryption-customer-key/", "text": "DocumentDB encryption should use Customer Managed Keys Default Severity: low Explanation Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable encryption using customer managed keys Insecure Example The following example will fail the aws-documentdb-encryption-customer-key check. resource \"aws_docdb_cluster\" \"docdb\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true } Secure Example The following example will pass the aws-documentdb-encryption-customer-key check. resource \"aws_kms_key\" \"docdb_encryption\" { enable_key_rotation = true } resource \"aws_docdb_cluster\" \"docdb\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true kms_key_id = aws_kms_key.docdb_encryption.arn } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#kms_key_id https://docs.aws.amazon.com/documentdb/latest/developerguide/security.encryption.ssl.public-key.html", "title": "encryption-customer-key"}, {"location": "checks/aws/documentdb/encryption-customer-key/#documentdb-encryption-should-use-customer-managed-keys", "text": "", "title": "DocumentDB encryption should use Customer Managed Keys"}, {"location": "checks/aws/documentdb/encryption-customer-key/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/documentdb/encryption-customer-key/#explanation", "text": "Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys.", "title": "Explanation"}, {"location": "checks/aws/documentdb/encryption-customer-key/#possible-impact", "text": "Using AWS managed keys does not allow for fine grained control", "title": "Possible Impact"}, {"location": "checks/aws/documentdb/encryption-customer-key/#suggested-resolution", "text": "Enable encryption using customer managed keys", "title": "Suggested Resolution"}, {"location": "checks/aws/documentdb/encryption-customer-key/#insecure-example", "text": "The following example will fail the aws-documentdb-encryption-customer-key check. resource \"aws_docdb_cluster\" \"docdb\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true }", "title": "Insecure Example"}, {"location": "checks/aws/documentdb/encryption-customer-key/#secure-example", "text": "The following example will pass the aws-documentdb-encryption-customer-key check. resource \"aws_kms_key\" \"docdb_encryption\" { enable_key_rotation = true } resource \"aws_docdb_cluster\" \"docdb\" { cluster_identifier = \"my-docdb-cluster\" engine = \"docdb\" master_username = \"foo\" master_password = \"mustbeeightchars\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true kms_key_id = aws_kms_key.docdb_encryption.arn }", "title": "Secure Example"}, {"location": "checks/aws/documentdb/encryption-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster#kms_key_id https://docs.aws.amazon.com/documentdb/latest/developerguide/security.encryption.ssl.public-key.html", "title": "Links"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/", "text": "DAX Cluster should always encrypt data at rest Default Severity: high Explanation Amazon DynamoDB Accelerator (DAX) encryption at rest provides an additional layer of data protection by helping secure your data from unauthorized access to the underlying storage. Possible Impact Data can be freely read if compromised Suggested Resolution Enable encryption at rest for DAX Cluster Insecure Example The following example will fail the aws-dynamodb-enable-at-rest-encryption check. resource \"aws_dax_cluster\" \"bad_example\" { // no server side encryption at all } resource \"aws_dax_cluster\" \"bad_example\" { // other DAX config server_side_encryption { // empty server side encryption config } } resource \"aws_dax_cluster\" \"bad_example\" { // other DAX config server_side_encryption { enabled = false // disabled server side encryption } } Secure Example The following example will pass the aws-dynamodb-enable-at-rest-encryption check. resource \"aws_dax_cluster\" \"good_example\" { // other DAX config server_side_encryption { enabled = true // enabled server side encryption } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dax_cluster#server_side_encryption https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAXEncryptionAtRest.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dax-cluster.html", "title": "enable-at-rest-encryption"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/#dax-cluster-should-always-encrypt-data-at-rest", "text": "", "title": "DAX Cluster should always encrypt data at rest"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/#explanation", "text": "Amazon DynamoDB Accelerator (DAX) encryption at rest provides an additional layer of data protection by helping secure your data from unauthorized access to the underlying storage.", "title": "Explanation"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/#possible-impact", "text": "Data can be freely read if compromised", "title": "Possible Impact"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/#suggested-resolution", "text": "Enable encryption at rest for DAX Cluster", "title": "Suggested Resolution"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/#insecure-example", "text": "The following example will fail the aws-dynamodb-enable-at-rest-encryption check. resource \"aws_dax_cluster\" \"bad_example\" { // no server side encryption at all } resource \"aws_dax_cluster\" \"bad_example\" { // other DAX config server_side_encryption { // empty server side encryption config } } resource \"aws_dax_cluster\" \"bad_example\" { // other DAX config server_side_encryption { enabled = false // disabled server side encryption } }", "title": "Insecure Example"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/#secure-example", "text": "The following example will pass the aws-dynamodb-enable-at-rest-encryption check. resource \"aws_dax_cluster\" \"good_example\" { // other DAX config server_side_encryption { enabled = true // enabled server side encryption } }", "title": "Secure Example"}, {"location": "checks/aws/dynamodb/enable-at-rest-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dax_cluster#server_side_encryption https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAXEncryptionAtRest.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dax-cluster.html", "title": "Links"}, {"location": "checks/aws/dynamodb/enable-recovery/", "text": "Point in time recovery should be enabled to protect DynamoDB table Default Severity: medium Explanation DynamoDB tables should be protected against accidentally or malicious write/delete actions by ensuring that there is adequate protection. By enabling point-in-time-recovery you can restore to a known point in the event of loss of data. Possible Impact Accidental or malicious writes and deletes can't be rolled back Suggested Resolution Enable point in time recovery Insecure Example The following example will fail the aws-dynamodb-enable-recovery check. resource \"aws_dynamodb_table\" \"bad_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } } Secure Example The following example will pass the aws-dynamodb-enable-recovery check. resource \"aws_dynamodb_table\" \"good_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } point_in_time_recovery { enabled = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#point_in_time_recovery https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/PointInTimeRecovery.html", "title": "enable-recovery"}, {"location": "checks/aws/dynamodb/enable-recovery/#point-in-time-recovery-should-be-enabled-to-protect-dynamodb-table", "text": "", "title": "Point in time recovery should be enabled to protect DynamoDB table"}, {"location": "checks/aws/dynamodb/enable-recovery/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/dynamodb/enable-recovery/#explanation", "text": "DynamoDB tables should be protected against accidentally or malicious write/delete actions by ensuring that there is adequate protection. By enabling point-in-time-recovery you can restore to a known point in the event of loss of data.", "title": "Explanation"}, {"location": "checks/aws/dynamodb/enable-recovery/#possible-impact", "text": "Accidental or malicious writes and deletes can't be rolled back", "title": "Possible Impact"}, {"location": "checks/aws/dynamodb/enable-recovery/#suggested-resolution", "text": "Enable point in time recovery", "title": "Suggested Resolution"}, {"location": "checks/aws/dynamodb/enable-recovery/#insecure-example", "text": "The following example will fail the aws-dynamodb-enable-recovery check. resource \"aws_dynamodb_table\" \"bad_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } }", "title": "Insecure Example"}, {"location": "checks/aws/dynamodb/enable-recovery/#secure-example", "text": "The following example will pass the aws-dynamodb-enable-recovery check. resource \"aws_dynamodb_table\" \"good_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } point_in_time_recovery { enabled = true } }", "title": "Secure Example"}, {"location": "checks/aws/dynamodb/enable-recovery/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#point_in_time_recovery https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/PointInTimeRecovery.html", "title": "Links"}, {"location": "checks/aws/dynamodb/table-customer-key/", "text": "DynamoDB tables should use at rest encryption with a Customer Managed Key Default Severity: low Explanation DynamoDB tables are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable server side encryption with a customer managed key Insecure Example The following example will fail the aws-dynamodb-table-customer-key check. resource \"aws_dynamodb_table\" \"bad_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } replica { region_name = \"us-east-2\" } replica { region_name = \"us-west-2\" } } Secure Example The following example will pass the aws-dynamodb-table-customer-key check. resource \"aws_kms_key\" \"dynamo_db_kms\" { enable_key_rotation = true } resource \"aws_dynamodb_table\" \"good_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } replica { region_name = \"us-east-2\" } replica { region_name = \"us-west-2\" } server_side_encryption { enabled = true kms_key_arn = aws_kms_key.dynamo_db_kms.key_id } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#server_side_encryption https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/EncryptionAtRest.html", "title": "table-customer-key"}, {"location": "checks/aws/dynamodb/table-customer-key/#dynamodb-tables-should-use-at-rest-encryption-with-a-customer-managed-key", "text": "", "title": "DynamoDB tables should use at rest encryption with a Customer Managed Key"}, {"location": "checks/aws/dynamodb/table-customer-key/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/dynamodb/table-customer-key/#explanation", "text": "DynamoDB tables are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key.", "title": "Explanation"}, {"location": "checks/aws/dynamodb/table-customer-key/#possible-impact", "text": "Using AWS managed keys does not allow for fine grained control", "title": "Possible Impact"}, {"location": "checks/aws/dynamodb/table-customer-key/#suggested-resolution", "text": "Enable server side encryption with a customer managed key", "title": "Suggested Resolution"}, {"location": "checks/aws/dynamodb/table-customer-key/#insecure-example", "text": "The following example will fail the aws-dynamodb-table-customer-key check. resource \"aws_dynamodb_table\" \"bad_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } replica { region_name = \"us-east-2\" } replica { region_name = \"us-west-2\" } }", "title": "Insecure Example"}, {"location": "checks/aws/dynamodb/table-customer-key/#secure-example", "text": "The following example will pass the aws-dynamodb-table-customer-key check. resource \"aws_kms_key\" \"dynamo_db_kms\" { enable_key_rotation = true } resource \"aws_dynamodb_table\" \"good_example\" { name = \"example\" hash_key = \"TestTableHashKey\" billing_mode = \"PAY_PER_REQUEST\" stream_enabled = true stream_view_type = \"NEW_AND_OLD_IMAGES\" attribute { name = \"TestTableHashKey\" type = \"S\" } replica { region_name = \"us-east-2\" } replica { region_name = \"us-west-2\" } server_side_encryption { enabled = true kms_key_arn = aws_kms_key.dynamo_db_kms.key_id } }", "title": "Secure Example"}, {"location": "checks/aws/dynamodb/table-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/dynamodb_table#server_side_encryption https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/EncryptionAtRest.html", "title": "Links"}, {"location": "checks/aws/ebs/enable-volume-encryption/", "text": "EBS volumes must be encrypted Default Severity: high Explanation By enabling encryption on EBS volumes you protect the volume, the disk I/O and any derived snapshots from compromise if intercepted. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable encryption of EBS volumes Insecure Example The following example will fail the aws-ebs-enable-volume-encryption check. resource \"aws_ebs_volume\" \"bad_example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } encrypted = false } Secure Example The following example will pass the aws-ebs-enable-volume-encryption check. resource \"aws_ebs_volume\" \"good_example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } encrypted = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#encrypted https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html", "title": "enable-volume-encryption"}, {"location": "checks/aws/ebs/enable-volume-encryption/#ebs-volumes-must-be-encrypted", "text": "", "title": "EBS volumes must be encrypted"}, {"location": "checks/aws/ebs/enable-volume-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/ebs/enable-volume-encryption/#explanation", "text": "By enabling encryption on EBS volumes you protect the volume, the disk I/O and any derived snapshots from compromise if intercepted.", "title": "Explanation"}, {"location": "checks/aws/ebs/enable-volume-encryption/#possible-impact", "text": "Unencrypted sensitive data is vulnerable to compromise.", "title": "Possible Impact"}, {"location": "checks/aws/ebs/enable-volume-encryption/#suggested-resolution", "text": "Enable encryption of EBS volumes", "title": "Suggested Resolution"}, {"location": "checks/aws/ebs/enable-volume-encryption/#insecure-example", "text": "The following example will fail the aws-ebs-enable-volume-encryption check. resource \"aws_ebs_volume\" \"bad_example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } encrypted = false }", "title": "Insecure Example"}, {"location": "checks/aws/ebs/enable-volume-encryption/#secure-example", "text": "The following example will pass the aws-ebs-enable-volume-encryption check. resource \"aws_ebs_volume\" \"good_example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } encrypted = true }", "title": "Secure Example"}, {"location": "checks/aws/ebs/enable-volume-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#encrypted https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html", "title": "Links"}, {"location": "checks/aws/ebs/encryption-customer-key/", "text": "EBS volume encryption should use Customer Managed Keys Default Severity: low Explanation Encryption using AWS keys provides protection for your EBS volume. To increase control of the encryption and manage factors like rotation use customer managed keys. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable encryption using customer managed keys Insecure Example The following example will fail the aws-ebs-encryption-customer-key check. resource \"aws_ebs_volume\" \"example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } } Secure Example The following example will pass the aws-ebs-encryption-customer-key check. resource \"aws_kms_key\" \"ebs_encryption\" { enable_key_rotation = true } resource \"aws_ebs_volume\" \"example\" { availability_zone = \"us-west-2a\" size = 40 kms_key_id = aws_kms_key.ebs_encryption.arn tags = { Name = \"HelloWorld\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#kms_key_id https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html", "title": "encryption-customer-key"}, {"location": "checks/aws/ebs/encryption-customer-key/#ebs-volume-encryption-should-use-customer-managed-keys", "text": "", "title": "EBS volume encryption should use Customer Managed Keys"}, {"location": "checks/aws/ebs/encryption-customer-key/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/ebs/encryption-customer-key/#explanation", "text": "Encryption using AWS keys provides protection for your EBS volume. To increase control of the encryption and manage factors like rotation use customer managed keys.", "title": "Explanation"}, {"location": "checks/aws/ebs/encryption-customer-key/#possible-impact", "text": "Using AWS managed keys does not allow for fine grained control", "title": "Possible Impact"}, {"location": "checks/aws/ebs/encryption-customer-key/#suggested-resolution", "text": "Enable encryption using customer managed keys", "title": "Suggested Resolution"}, {"location": "checks/aws/ebs/encryption-customer-key/#insecure-example", "text": "The following example will fail the aws-ebs-encryption-customer-key check. resource \"aws_ebs_volume\" \"example\" { availability_zone = \"us-west-2a\" size = 40 tags = { Name = \"HelloWorld\" } }", "title": "Insecure Example"}, {"location": "checks/aws/ebs/encryption-customer-key/#secure-example", "text": "The following example will pass the aws-ebs-encryption-customer-key check. resource \"aws_kms_key\" \"ebs_encryption\" { enable_key_rotation = true } resource \"aws_ebs_volume\" \"example\" { availability_zone = \"us-west-2a\" size = 40 kms_key_id = aws_kms_key.ebs_encryption.arn tags = { Name = \"HelloWorld\" } }", "title": "Secure Example"}, {"location": "checks/aws/ebs/encryption-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume#kms_key_id https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html", "title": "Links"}, {"location": "checks/aws/ec2/enforce-http-token-imds/", "text": "aws_instance should activate session tokens for Instance Metadata Service. Default Severity: high Explanation IMDS v2 (Instance Metadata Service) introduced session authentication tokens which improve security when talking to IMDS. By default aws_instance resource sets IMDS session auth tokens to be optional. To fully protect IMDS you need to enable session tokens by using metadata_options block and its http_tokens variable set to required . Possible Impact Instance metadata service can be interacted with freely Suggested Resolution Enable HTTP token requirement for IMDS Insecure Example The following example will fail the aws-ec2-enforce-http-token-imds check. resource \"aws_instance\" \"bad_example\" { ami = \"ami-005e54dee72cc1d00\" instance_type = \"t2.micro\" } Secure Example The following example will pass the aws-ec2-enforce-http-token-imds check. resource \"aws_instance\" \"good_example\" { ami = \"ami-005e54dee72cc1d00\" instance_type = \"t2.micro\" metadata_options { http_tokens = \"required\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#metadata-options https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service", "title": "enforce-http-token-imds"}, {"location": "checks/aws/ec2/enforce-http-token-imds/#aws_instance-should-activate-session-tokens-for-instance-metadata-service", "text": "", "title": "aws_instance should activate session tokens for Instance Metadata Service."}, {"location": "checks/aws/ec2/enforce-http-token-imds/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/ec2/enforce-http-token-imds/#explanation", "text": "IMDS v2 (Instance Metadata Service) introduced session authentication tokens which improve security when talking to IMDS. By default aws_instance resource sets IMDS session auth tokens to be optional. To fully protect IMDS you need to enable session tokens by using metadata_options block and its http_tokens variable set to required .", "title": "Explanation"}, {"location": "checks/aws/ec2/enforce-http-token-imds/#possible-impact", "text": "Instance metadata service can be interacted with freely", "title": "Possible Impact"}, {"location": "checks/aws/ec2/enforce-http-token-imds/#suggested-resolution", "text": "Enable HTTP token requirement for IMDS", "title": "Suggested Resolution"}, {"location": "checks/aws/ec2/enforce-http-token-imds/#insecure-example", "text": "The following example will fail the aws-ec2-enforce-http-token-imds check. resource \"aws_instance\" \"bad_example\" { ami = \"ami-005e54dee72cc1d00\" instance_type = \"t2.micro\" }", "title": "Insecure Example"}, {"location": "checks/aws/ec2/enforce-http-token-imds/#secure-example", "text": "The following example will pass the aws-ec2-enforce-http-token-imds check. resource \"aws_instance\" \"good_example\" { ami = \"ami-005e54dee72cc1d00\" instance_type = \"t2.micro\" metadata_options { http_tokens = \"required\" } }", "title": "Secure Example"}, {"location": "checks/aws/ec2/enforce-http-token-imds/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#metadata-options https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service", "title": "Links"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/", "text": "User data for EC2 instances must not contain sensitive AWS keys Default Severity: critical Explanation EC2 instance data is used to pass start up information into the EC2 instance. This userdata must not contain access key credentials. Instead use an IAM Instance Profile assigned to the instance to grant access to other AWS Services. Possible Impact User data is visible through the AWS Management console Suggested Resolution Remove sensitive data from the EC2 instance user-data Insecure Example The following example will fail the aws-ec2-no-secrets-in-user-data check. resource \"aws_instance\" \"bad_example\" { ami = \"ami-12345667\" instance_type = \"t2.small\" user_data = << EOF export AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE export AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY export AWS_DEFAULT_REGION=us-west-2 EOF } export AWS_ACCESS_KEY_ID = AKIAIOSFODNN 7 EXAMPLE export AWS_SECRET_ACCESS_KEY = wJalrXUtnFEMI/K 7 MDENG/bPxRfiCYEXAMPLEKEY export AWS_DEFAULT_REGION = us-west- 2 EOF } Secure Example The following example will pass the aws-ec2-no-secrets-in-user-data check. resource \"aws_iam_instance_profile\" \"good_example\" { // ... } resource \"aws_instance\" \"good_example\" { ami = \"ami-12345667\" instance_type = \"t2.small\" iam_instance_profile = aws_iam_instance_profile.good_profile.arn user_data = << EOF export GREETING=hello EOF } export GREETING = hello EOF } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#user_data https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-add-user-data.html", "title": "no-secrets-in-user-data"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/#user-data-for-ec2-instances-must-not-contain-sensitive-aws-keys", "text": "", "title": "User data for EC2 instances must not contain sensitive AWS keys"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/#explanation", "text": "EC2 instance data is used to pass start up information into the EC2 instance. This userdata must not contain access key credentials. Instead use an IAM Instance Profile assigned to the instance to grant access to other AWS Services.", "title": "Explanation"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/#possible-impact", "text": "User data is visible through the AWS Management console", "title": "Possible Impact"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/#suggested-resolution", "text": "Remove sensitive data from the EC2 instance user-data", "title": "Suggested Resolution"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/#insecure-example", "text": "The following example will fail the aws-ec2-no-secrets-in-user-data check. resource \"aws_instance\" \"bad_example\" { ami = \"ami-12345667\" instance_type = \"t2.small\" user_data = << EOF export AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE export AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY export AWS_DEFAULT_REGION=us-west-2 EOF } export AWS_ACCESS_KEY_ID = AKIAIOSFODNN 7 EXAMPLE export AWS_SECRET_ACCESS_KEY = wJalrXUtnFEMI/K 7 MDENG/bPxRfiCYEXAMPLEKEY export AWS_DEFAULT_REGION = us-west- 2 EOF }", "title": "Insecure Example"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/#secure-example", "text": "The following example will pass the aws-ec2-no-secrets-in-user-data check. resource \"aws_iam_instance_profile\" \"good_example\" { // ... } resource \"aws_instance\" \"good_example\" { ami = \"ami-12345667\" instance_type = \"t2.small\" iam_instance_profile = aws_iam_instance_profile.good_profile.arn user_data = << EOF export GREETING=hello EOF } export GREETING = hello EOF }", "title": "Secure Example"}, {"location": "checks/aws/ec2/no-secrets-in-user-data/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance#user_data https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-add-user-data.html", "title": "Links"}, {"location": "checks/aws/ecr/enable-image-scans/", "text": "ECR repository has image scans disabled. Default Severity: high Explanation Repository image scans should be enabled to ensure vulnerable software can be discovered and remediated as soon as possible. Possible Impact The ability to scan images is not being used and vulnerabilities will not be highlighted Suggested Resolution Enable ECR image scanning Insecure Example The following example will fail the aws-ecr-enable-image-scans check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = false } } Secure Example The following example will pass the aws-ecr-enable-image-scans check. resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#image_scanning_configuration https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html", "title": "enable-image-scans"}, {"location": "checks/aws/ecr/enable-image-scans/#ecr-repository-has-image-scans-disabled", "text": "", "title": "ECR repository has image scans disabled."}, {"location": "checks/aws/ecr/enable-image-scans/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/ecr/enable-image-scans/#explanation", "text": "Repository image scans should be enabled to ensure vulnerable software can be discovered and remediated as soon as possible.", "title": "Explanation"}, {"location": "checks/aws/ecr/enable-image-scans/#possible-impact", "text": "The ability to scan images is not being used and vulnerabilities will not be highlighted", "title": "Possible Impact"}, {"location": "checks/aws/ecr/enable-image-scans/#suggested-resolution", "text": "Enable ECR image scanning", "title": "Suggested Resolution"}, {"location": "checks/aws/ecr/enable-image-scans/#insecure-example", "text": "The following example will fail the aws-ecr-enable-image-scans check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = false } }", "title": "Insecure Example"}, {"location": "checks/aws/ecr/enable-image-scans/#secure-example", "text": "The following example will pass the aws-ecr-enable-image-scans check. resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } }", "title": "Secure Example"}, {"location": "checks/aws/ecr/enable-image-scans/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#image_scanning_configuration https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html", "title": "Links"}, {"location": "checks/aws/ecr/enforce-immutable-repository/", "text": "ECR images tags shouldn't be mutable. Default Severity: high Explanation ECR images should be set to IMMUTABLE to prevent code injection through image mutation. This can be done by setting image_tab_mutability to IMMUTABLE Possible Impact Image tags could be overwritten with compromised images Suggested Resolution Only use immutable images in ECR Insecure Example The following example will fail the aws-ecr-enforce-immutable-repository check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } } Secure Example The following example will pass the aws-ecr-enforce-immutable-repository check. resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"IMMUTABLE\" image_scanning_configuration { scan_on_push = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository https://sysdig.com/blog/toctou-tag-mutability/", "title": "enforce-immutable-repository"}, {"location": "checks/aws/ecr/enforce-immutable-repository/#ecr-images-tags-shouldnt-be-mutable", "text": "", "title": "ECR images tags shouldn't be mutable."}, {"location": "checks/aws/ecr/enforce-immutable-repository/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/ecr/enforce-immutable-repository/#explanation", "text": "ECR images should be set to IMMUTABLE to prevent code injection through image mutation. This can be done by setting image_tab_mutability to IMMUTABLE", "title": "Explanation"}, {"location": "checks/aws/ecr/enforce-immutable-repository/#possible-impact", "text": "Image tags could be overwritten with compromised images", "title": "Possible Impact"}, {"location": "checks/aws/ecr/enforce-immutable-repository/#suggested-resolution", "text": "Only use immutable images in ECR", "title": "Suggested Resolution"}, {"location": "checks/aws/ecr/enforce-immutable-repository/#insecure-example", "text": "The following example will fail the aws-ecr-enforce-immutable-repository check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } }", "title": "Insecure Example"}, {"location": "checks/aws/ecr/enforce-immutable-repository/#secure-example", "text": "The following example will pass the aws-ecr-enforce-immutable-repository check. resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"IMMUTABLE\" image_scanning_configuration { scan_on_push = true } }", "title": "Secure Example"}, {"location": "checks/aws/ecr/enforce-immutable-repository/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository https://sysdig.com/blog/toctou-tag-mutability/", "title": "Links"}, {"location": "checks/aws/ecr/no-public-access/", "text": "ECR repository policy must block public access Default Severity: high Explanation Allowing public access to the ECR repository risks leaking sensitive of abusable information Possible Impact Risk of potential data leakage of sensitive artifacts Suggested Resolution Do not allow public access in the policy Insecure Example The following example will fail the aws-ecr-no-public-access check. resource \"aws_ecr_repository\" \"foo\" { name = \"bar\" } resource \"aws_ecr_repository_policy\" \"foopolicy\" { repository = aws_ecr_repository.foo.name policy = << EOF { \"Version\": \"2008-10-17\", \"Statement\": [ { \"Sid\": \"new policy\", \"Effect\": \"Allow\", \"Principal\": \"*\", \"Action\": [ \"ecr:GetDownloadUrlForLayer\", \"ecr:BatchGetImage\", \"ecr:BatchCheckLayerAvailability\", \"ecr:PutImage\", \"ecr:InitiateLayerUpload\", \"ecr:UploadLayerPart\", \"ecr:CompleteLayerUpload\", \"ecr:DescribeRepositories\", \"ecr:GetRepositoryPolicy\", \"ecr:ListImages\", \"ecr:DeleteRepository\", \"ecr:BatchDeleteImage\", \"ecr:SetRepositoryPolicy\", \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF } { \"Version\" : \"2008-10-17\" , \"Statement\" : [ { \"Sid\" : \"new policy\" , \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : [ \"ecr:GetDownloadUrlForLayer\" , \"ecr:BatchGetImage\" , \"ecr:BatchCheckLayerAvailability\" , \"ecr:PutImage\" , \"ecr:InitiateLayerUpload\" , \"ecr:UploadLayerPart\" , \"ecr:CompleteLayerUpload\" , \"ecr:DescribeRepositories\" , \"ecr:GetRepositoryPolicy\" , \"ecr:ListImages\" , \"ecr:DeleteRepository\" , \"ecr:BatchDeleteImage\" , \"ecr:SetRepositoryPolicy\" , \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF } Secure Example The following example will pass the aws-ecr-no-public-access check. resource \"aws_ecr_repository\" \"foo\" { name = \"bar\" } resource \"aws_ecr_repository_policy\" \"foopolicy\" { repository = aws_ecr_repository.foo.name policy = << EOF { \"Version\": \"2008-10-17\", \"Statement\": [ { \"Sid\": \"new policy\", \"Effect\": \"Allow\", \"Principal\": \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\", \"Action\": [ \"ecr:GetDownloadUrlForLayer\", \"ecr:BatchGetImage\", \"ecr:BatchCheckLayerAvailability\", \"ecr:PutImage\", \"ecr:InitiateLayerUpload\", \"ecr:UploadLayerPart\", \"ecr:CompleteLayerUpload\", \"ecr:DescribeRepositories\", \"ecr:GetRepositoryPolicy\", \"ecr:ListImages\", \"ecr:DeleteRepository\", \"ecr:BatchDeleteImage\", \"ecr:SetRepositoryPolicy\", \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF } { \"Version\" : \"2008-10-17\" , \"Statement\" : [ { \"Sid\" : \"new policy\" , \"Effect\" : \"Allow\" , \"Principal\" : \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" , \"Action\" : [ \"ecr:GetDownloadUrlForLayer\" , \"ecr:BatchGetImage\" , \"ecr:BatchCheckLayerAvailability\" , \"ecr:PutImage\" , \"ecr:InitiateLayerUpload\" , \"ecr:UploadLayerPart\" , \"ecr:CompleteLayerUpload\" , \"ecr:DescribeRepositories\" , \"ecr:GetRepositoryPolicy\" , \"ecr:ListImages\" , \"ecr:DeleteRepository\" , \"ecr:BatchDeleteImage\" , \"ecr:SetRepositoryPolicy\" , \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository_policy#policy https://docs.aws.amazon.com/AmazonECR/latest/public/public-repository-policies.html", "title": "no-public-access"}, {"location": "checks/aws/ecr/no-public-access/#ecr-repository-policy-must-block-public-access", "text": "", "title": "ECR repository policy must block public access"}, {"location": "checks/aws/ecr/no-public-access/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/ecr/no-public-access/#explanation", "text": "Allowing public access to the ECR repository risks leaking sensitive of abusable information", "title": "Explanation"}, {"location": "checks/aws/ecr/no-public-access/#possible-impact", "text": "Risk of potential data leakage of sensitive artifacts", "title": "Possible Impact"}, {"location": "checks/aws/ecr/no-public-access/#suggested-resolution", "text": "Do not allow public access in the policy", "title": "Suggested Resolution"}, {"location": "checks/aws/ecr/no-public-access/#insecure-example", "text": "The following example will fail the aws-ecr-no-public-access check. resource \"aws_ecr_repository\" \"foo\" { name = \"bar\" } resource \"aws_ecr_repository_policy\" \"foopolicy\" { repository = aws_ecr_repository.foo.name policy = << EOF { \"Version\": \"2008-10-17\", \"Statement\": [ { \"Sid\": \"new policy\", \"Effect\": \"Allow\", \"Principal\": \"*\", \"Action\": [ \"ecr:GetDownloadUrlForLayer\", \"ecr:BatchGetImage\", \"ecr:BatchCheckLayerAvailability\", \"ecr:PutImage\", \"ecr:InitiateLayerUpload\", \"ecr:UploadLayerPart\", \"ecr:CompleteLayerUpload\", \"ecr:DescribeRepositories\", \"ecr:GetRepositoryPolicy\", \"ecr:ListImages\", \"ecr:DeleteRepository\", \"ecr:BatchDeleteImage\", \"ecr:SetRepositoryPolicy\", \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF } { \"Version\" : \"2008-10-17\" , \"Statement\" : [ { \"Sid\" : \"new policy\" , \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : [ \"ecr:GetDownloadUrlForLayer\" , \"ecr:BatchGetImage\" , \"ecr:BatchCheckLayerAvailability\" , \"ecr:PutImage\" , \"ecr:InitiateLayerUpload\" , \"ecr:UploadLayerPart\" , \"ecr:CompleteLayerUpload\" , \"ecr:DescribeRepositories\" , \"ecr:GetRepositoryPolicy\" , \"ecr:ListImages\" , \"ecr:DeleteRepository\" , \"ecr:BatchDeleteImage\" , \"ecr:SetRepositoryPolicy\" , \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF }", "title": "Insecure Example"}, {"location": "checks/aws/ecr/no-public-access/#secure-example", "text": "The following example will pass the aws-ecr-no-public-access check. resource \"aws_ecr_repository\" \"foo\" { name = \"bar\" } resource \"aws_ecr_repository_policy\" \"foopolicy\" { repository = aws_ecr_repository.foo.name policy = << EOF { \"Version\": \"2008-10-17\", \"Statement\": [ { \"Sid\": \"new policy\", \"Effect\": \"Allow\", \"Principal\": \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\", \"Action\": [ \"ecr:GetDownloadUrlForLayer\", \"ecr:BatchGetImage\", \"ecr:BatchCheckLayerAvailability\", \"ecr:PutImage\", \"ecr:InitiateLayerUpload\", \"ecr:UploadLayerPart\", \"ecr:CompleteLayerUpload\", \"ecr:DescribeRepositories\", \"ecr:GetRepositoryPolicy\", \"ecr:ListImages\", \"ecr:DeleteRepository\", \"ecr:BatchDeleteImage\", \"ecr:SetRepositoryPolicy\", \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF } { \"Version\" : \"2008-10-17\" , \"Statement\" : [ { \"Sid\" : \"new policy\" , \"Effect\" : \"Allow\" , \"Principal\" : \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" , \"Action\" : [ \"ecr:GetDownloadUrlForLayer\" , \"ecr:BatchGetImage\" , \"ecr:BatchCheckLayerAvailability\" , \"ecr:PutImage\" , \"ecr:InitiateLayerUpload\" , \"ecr:UploadLayerPart\" , \"ecr:CompleteLayerUpload\" , \"ecr:DescribeRepositories\" , \"ecr:GetRepositoryPolicy\" , \"ecr:ListImages\" , \"ecr:DeleteRepository\" , \"ecr:BatchDeleteImage\" , \"ecr:SetRepositoryPolicy\" , \"ecr:DeleteRepositoryPolicy\" ] } ] } EOF }", "title": "Secure Example"}, {"location": "checks/aws/ecr/no-public-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository_policy#policy https://docs.aws.amazon.com/AmazonECR/latest/public/public-repository-policies.html", "title": "Links"}, {"location": "checks/aws/ecr/repository-customer-key/", "text": "ECR Repository should use customer managed keys to allow more control Default Severity: low Explanation Images in the ECR repository are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Use customer managed keys Insecure Example The following example will fail the aws-ecr-repository-customer-key check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } } Secure Example The following example will pass the aws-ecr-repository-customer-key check. resource \"aws_kms_key\" \"ecr_kms\" { enable_key_rotation = true } resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } encryption_configuration { encryption_type = \"KMS\" kms_key = aws_kms_key.ecr_kms.key_id } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#encryption_configuration https://docs.aws.amazon.com/AmazonECR/latest/userguide/encryption-at-rest.html", "title": "repository-customer-key"}, {"location": "checks/aws/ecr/repository-customer-key/#ecr-repository-should-use-customer-managed-keys-to-allow-more-control", "text": "", "title": "ECR Repository should use customer managed keys to allow more control"}, {"location": "checks/aws/ecr/repository-customer-key/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/ecr/repository-customer-key/#explanation", "text": "Images in the ECR repository are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key.", "title": "Explanation"}, {"location": "checks/aws/ecr/repository-customer-key/#possible-impact", "text": "Using AWS managed keys does not allow for fine grained control", "title": "Possible Impact"}, {"location": "checks/aws/ecr/repository-customer-key/#suggested-resolution", "text": "Use customer managed keys", "title": "Suggested Resolution"}, {"location": "checks/aws/ecr/repository-customer-key/#insecure-example", "text": "The following example will fail the aws-ecr-repository-customer-key check. resource \"aws_ecr_repository\" \"bad_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } }", "title": "Insecure Example"}, {"location": "checks/aws/ecr/repository-customer-key/#secure-example", "text": "The following example will pass the aws-ecr-repository-customer-key check. resource \"aws_kms_key\" \"ecr_kms\" { enable_key_rotation = true } resource \"aws_ecr_repository\" \"good_example\" { name = \"bar\" image_tag_mutability = \"MUTABLE\" image_scanning_configuration { scan_on_push = true } encryption_configuration { encryption_type = \"KMS\" kms_key = aws_kms_key.ecr_kms.key_id } }", "title": "Secure Example"}, {"location": "checks/aws/ecr/repository-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_repository#encryption_configuration https://docs.aws.amazon.com/AmazonECR/latest/userguide/encryption-at-rest.html", "title": "Links"}, {"location": "checks/aws/ecs/enable-container-insight/", "text": "ECS clusters should have container insights enabled Default Severity: low Explanation Cloudwatch Container Insights provide more metrics and logs for container based applications and micro services. Possible Impact Not all metrics and logs may be gathered for containers when Container Insights isn't enabled Suggested Resolution Enable Container Insights Insecure Example The following example will fail the aws-ecs-enable-container-insight check. resource \"aws_ecs_cluster\" \"bad_example\" { name = \"services-cluster\" } Secure Example The following example will pass the aws-ecs-enable-container-insight check. resource \"aws_ecs_cluster\" \"good_example\" { name = \"services-cluster\" setting { name = \"containerInsights\" value = \"enabled\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_cluster#setting https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html", "title": "enable-container-insight"}, {"location": "checks/aws/ecs/enable-container-insight/#ecs-clusters-should-have-container-insights-enabled", "text": "", "title": "ECS clusters should have container insights enabled"}, {"location": "checks/aws/ecs/enable-container-insight/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/ecs/enable-container-insight/#explanation", "text": "Cloudwatch Container Insights provide more metrics and logs for container based applications and micro services.", "title": "Explanation"}, {"location": "checks/aws/ecs/enable-container-insight/#possible-impact", "text": "Not all metrics and logs may be gathered for containers when Container Insights isn't enabled", "title": "Possible Impact"}, {"location": "checks/aws/ecs/enable-container-insight/#suggested-resolution", "text": "Enable Container Insights", "title": "Suggested Resolution"}, {"location": "checks/aws/ecs/enable-container-insight/#insecure-example", "text": "The following example will fail the aws-ecs-enable-container-insight check. resource \"aws_ecs_cluster\" \"bad_example\" { name = \"services-cluster\" }", "title": "Insecure Example"}, {"location": "checks/aws/ecs/enable-container-insight/#secure-example", "text": "The following example will pass the aws-ecs-enable-container-insight check. resource \"aws_ecs_cluster\" \"good_example\" { name = \"services-cluster\" setting { name = \"containerInsights\" value = \"enabled\" } }", "title": "Secure Example"}, {"location": "checks/aws/ecs/enable-container-insight/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_cluster#setting https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html", "title": "Links"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/", "text": "ECS Task Definitions with EFS volumes should use in-transit encryption Default Severity: high Explanation ECS task definitions that have volumes using EFS configuration should explicitly enable in transit encryption to prevent the risk of data loss due to interception. Possible Impact Intercepted traffic to and from EFS may lead to data loss Suggested Resolution Enable in transit encryption when using efs Insecure Example The following example will fail the aws-ecs-enable-in-transit-encryption check. resource \"aws_ecs_task_definition\" \"bad_example\" { family = \"service\" container_definitions = file ( \"task-definitions/service.json\" ) volume { name = \"service-storage\" efs_volume_configuration { file_system_id = aws_efs_file_system.fs.id root_directory = \"/opt/data\" authorization_config { access_point_id = aws_efs_access_point.test.id iam = \"ENABLED\" } } } } Secure Example The following example will pass the aws-ecs-enable-in-transit-encryption check. resource \"aws_ecs_task_definition\" \"good_example\" { family = \"service\" container_definitions = file ( \"task-definitions/service.json\" ) volume { name = \"service-storage\" efs_volume_configuration { file_system_id = aws_efs_file_system.fs.id root_directory = \"/opt/data\" transit_encryption = \"ENABLED\" transit_encryption_port = 2999 authorization_config { access_point_id = aws_efs_access_point.test.id iam = \"ENABLED\" } } } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition#transit_encryption https://docs.aws.amazon.com/AmazonECS/latest/userguide/efs-volumes.html https://docs.aws.amazon.com/efs/latest/ug/encryption-in-transit.html", "title": "enable-in-transit-encryption"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/#ecs-task-definitions-with-efs-volumes-should-use-in-transit-encryption", "text": "", "title": "ECS Task Definitions with EFS volumes should use in-transit encryption"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/#explanation", "text": "ECS task definitions that have volumes using EFS configuration should explicitly enable in transit encryption to prevent the risk of data loss due to interception.", "title": "Explanation"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/#possible-impact", "text": "Intercepted traffic to and from EFS may lead to data loss", "title": "Possible Impact"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/#suggested-resolution", "text": "Enable in transit encryption when using efs", "title": "Suggested Resolution"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/#insecure-example", "text": "The following example will fail the aws-ecs-enable-in-transit-encryption check. resource \"aws_ecs_task_definition\" \"bad_example\" { family = \"service\" container_definitions = file ( \"task-definitions/service.json\" ) volume { name = \"service-storage\" efs_volume_configuration { file_system_id = aws_efs_file_system.fs.id root_directory = \"/opt/data\" authorization_config { access_point_id = aws_efs_access_point.test.id iam = \"ENABLED\" } } } }", "title": "Insecure Example"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/#secure-example", "text": "The following example will pass the aws-ecs-enable-in-transit-encryption check. resource \"aws_ecs_task_definition\" \"good_example\" { family = \"service\" container_definitions = file ( \"task-definitions/service.json\" ) volume { name = \"service-storage\" efs_volume_configuration { file_system_id = aws_efs_file_system.fs.id root_directory = \"/opt/data\" transit_encryption = \"ENABLED\" transit_encryption_port = 2999 authorization_config { access_point_id = aws_efs_access_point.test.id iam = \"ENABLED\" } } } }", "title": "Secure Example"}, {"location": "checks/aws/ecs/enable-in-transit-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition#transit_encryption https://docs.aws.amazon.com/AmazonECS/latest/userguide/efs-volumes.html https://docs.aws.amazon.com/efs/latest/ug/encryption-in-transit.html", "title": "Links"}, {"location": "checks/aws/ecs/no-plaintext-secrets/", "text": "Task definition defines sensitive environment variable(s). Default Severity: critical Explanation You should not make secrets available to a user in plaintext in any scenario. Secrets can instead be pulled from a secure secret storage system by the service requiring them. Possible Impact Sensitive data could be exposed in the AWS Management Console Suggested Resolution Use secrets for the task definition Insecure Example The following example will fail the aws-ecs-no-plaintext-secrets check. resource \"aws_ecs_task_definition\" \"bad_example\" { container_definitions = << EOF [ { \"name\": \"my_service\", \"essential\": true, \"memory\": 256, \"environment\": [ { \"name\": \"ENVIRONMENT\", \"value\": \"development\" }, { \"name\": \"DATABASE_PASSWORD\", \"value\": \"oh no D:\"} ] } ] EOF } [ { \"name\" : \"my_service\" , \"essential\" : true , \"memory\" : 256 , \"environment\" : [ { \"name\" : \"ENVIRONMENT\", \"value\": \"development\" }, { \"name\" : \"DATABASE_PASSWORD\", \"value\": \"oh no D:\" } ] } ] EOF } Secure Example The following example will pass the aws-ecs-no-plaintext-secrets check. resource \"aws_ecs_task_definition\" \"good_example\" { container_definitions = << EOF [ { \"name\": \"my_service\", \"essential\": true, \"memory\": 256, \"environment\": [ { \"name\": \"ENVIRONMENT\", \"value\": \"development\" } ] } ] EOF } [ { \"name\" : \"my_service\" , \"essential\" : true , \"memory\" : 256 , \"environment\" : [ { \"name\" : \"ENVIRONMENT\", \"value\": \"development\" } ] } ] EOF } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-ps-secretsmanager.html https://www.vaultproject.io/", "title": "no-plaintext-secrets"}, {"location": "checks/aws/ecs/no-plaintext-secrets/#task-definition-defines-sensitive-environment-variables", "text": "", "title": "Task definition defines sensitive environment variable(s)."}, {"location": "checks/aws/ecs/no-plaintext-secrets/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/ecs/no-plaintext-secrets/#explanation", "text": "You should not make secrets available to a user in plaintext in any scenario. Secrets can instead be pulled from a secure secret storage system by the service requiring them.", "title": "Explanation"}, {"location": "checks/aws/ecs/no-plaintext-secrets/#possible-impact", "text": "Sensitive data could be exposed in the AWS Management Console", "title": "Possible Impact"}, {"location": "checks/aws/ecs/no-plaintext-secrets/#suggested-resolution", "text": "Use secrets for the task definition", "title": "Suggested Resolution"}, {"location": "checks/aws/ecs/no-plaintext-secrets/#insecure-example", "text": "The following example will fail the aws-ecs-no-plaintext-secrets check. resource \"aws_ecs_task_definition\" \"bad_example\" { container_definitions = << EOF [ { \"name\": \"my_service\", \"essential\": true, \"memory\": 256, \"environment\": [ { \"name\": \"ENVIRONMENT\", \"value\": \"development\" }, { \"name\": \"DATABASE_PASSWORD\", \"value\": \"oh no D:\"} ] } ] EOF } [ { \"name\" : \"my_service\" , \"essential\" : true , \"memory\" : 256 , \"environment\" : [ { \"name\" : \"ENVIRONMENT\", \"value\": \"development\" }, { \"name\" : \"DATABASE_PASSWORD\", \"value\": \"oh no D:\" } ] } ] EOF }", "title": "Insecure Example"}, {"location": "checks/aws/ecs/no-plaintext-secrets/#secure-example", "text": "The following example will pass the aws-ecs-no-plaintext-secrets check. resource \"aws_ecs_task_definition\" \"good_example\" { container_definitions = << EOF [ { \"name\": \"my_service\", \"essential\": true, \"memory\": 256, \"environment\": [ { \"name\": \"ENVIRONMENT\", \"value\": \"development\" } ] } ] EOF } [ { \"name\" : \"my_service\" , \"essential\" : true , \"memory\" : 256 , \"environment\" : [ { \"name\" : \"ENVIRONMENT\", \"value\": \"development\" } ] } ] EOF }", "title": "Secure Example"}, {"location": "checks/aws/ecs/no-plaintext-secrets/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-ps-secretsmanager.html https://www.vaultproject.io/", "title": "Links"}, {"location": "checks/aws/efs/enable-at-rest-encryption/", "text": "EFS Encryption has not been enabled Default Severity: high Explanation If your organization is subject to corporate or regulatory policies that require encryption of data and metadata at rest, we recommend creating a file system that is encrypted at rest, and mounting your file system using encryption of data in transit. Possible Impact Data can be read from the EFS if compromised Suggested Resolution Enable encryption for EFS Insecure Example The following example will fail the aws-efs-enable-at-rest-encryption check. resource \"aws_efs_file_system\" \"bad_example\" { name = \"bar\" encrypted = false kms_key_id = \"\" } Secure Example The following example will pass the aws-efs-enable-at-rest-encryption check. resource \"aws_efs_file_system\" \"good_example\" { name = \"bar\" encrypted = true kms_key_id = \"my_kms_key\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/efs_file_system https://docs.aws.amazon.com/efs/latest/ug/encryption.html", "title": "enable-at-rest-encryption"}, {"location": "checks/aws/efs/enable-at-rest-encryption/#efs-encryption-has-not-been-enabled", "text": "", "title": "EFS Encryption has not been enabled"}, {"location": "checks/aws/efs/enable-at-rest-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/efs/enable-at-rest-encryption/#explanation", "text": "If your organization is subject to corporate or regulatory policies that require encryption of data and metadata at rest, we recommend creating a file system that is encrypted at rest, and mounting your file system using encryption of data in transit.", "title": "Explanation"}, {"location": "checks/aws/efs/enable-at-rest-encryption/#possible-impact", "text": "Data can be read from the EFS if compromised", "title": "Possible Impact"}, {"location": "checks/aws/efs/enable-at-rest-encryption/#suggested-resolution", "text": "Enable encryption for EFS", "title": "Suggested Resolution"}, {"location": "checks/aws/efs/enable-at-rest-encryption/#insecure-example", "text": "The following example will fail the aws-efs-enable-at-rest-encryption check. resource \"aws_efs_file_system\" \"bad_example\" { name = \"bar\" encrypted = false kms_key_id = \"\" }", "title": "Insecure Example"}, {"location": "checks/aws/efs/enable-at-rest-encryption/#secure-example", "text": "The following example will pass the aws-efs-enable-at-rest-encryption check. resource \"aws_efs_file_system\" \"good_example\" { name = \"bar\" encrypted = true kms_key_id = \"my_kms_key\" }", "title": "Secure Example"}, {"location": "checks/aws/efs/enable-at-rest-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/efs_file_system https://docs.aws.amazon.com/efs/latest/ug/encryption.html", "title": "Links"}, {"location": "checks/aws/eks/enable-control-plane-logging/", "text": "EKS Clusters should have cluster control plane logging turned on Default Severity: medium Explanation By default cluster control plane logging is not turned on. Logging is available for audit, api, authenticator, controllerManager and scheduler. All logging should be turned on for cluster control plane. Possible Impact Logging provides valuable information about access and usage Suggested Resolution Enable logging for the EKS control plane Insecure Example The following example will fail the aws-eks-enable-control-plane-logging check. resource \"aws_eks_cluster\" \"bad_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Secure Example The following example will pass the aws-eks-enable-control-plane-logging check. resource \"aws_eks_cluster\" \"good_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } enabled_cluster_log_types = [ \"api\", \"authenticator\", \"audit\", \"scheduler\", \"controllerManager\" ] name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#enabled_cluster_log_types https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html", "title": "enable-control-plane-logging"}, {"location": "checks/aws/eks/enable-control-plane-logging/#eks-clusters-should-have-cluster-control-plane-logging-turned-on", "text": "", "title": "EKS Clusters should have cluster control plane logging turned on"}, {"location": "checks/aws/eks/enable-control-plane-logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/eks/enable-control-plane-logging/#explanation", "text": "By default cluster control plane logging is not turned on. Logging is available for audit, api, authenticator, controllerManager and scheduler. All logging should be turned on for cluster control plane.", "title": "Explanation"}, {"location": "checks/aws/eks/enable-control-plane-logging/#possible-impact", "text": "Logging provides valuable information about access and usage", "title": "Possible Impact"}, {"location": "checks/aws/eks/enable-control-plane-logging/#suggested-resolution", "text": "Enable logging for the EKS control plane", "title": "Suggested Resolution"}, {"location": "checks/aws/eks/enable-control-plane-logging/#insecure-example", "text": "The following example will fail the aws-eks-enable-control-plane-logging check. resource \"aws_eks_cluster\" \"bad_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }", "title": "Insecure Example"}, {"location": "checks/aws/eks/enable-control-plane-logging/#secure-example", "text": "The following example will pass the aws-eks-enable-control-plane-logging check. resource \"aws_eks_cluster\" \"good_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } enabled_cluster_log_types = [ \"api\", \"authenticator\", \"audit\", \"scheduler\", \"controllerManager\" ] name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }", "title": "Secure Example"}, {"location": "checks/aws/eks/enable-control-plane-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#enabled_cluster_log_types https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html", "title": "Links"}, {"location": "checks/aws/eks/encrypt-secrets/", "text": "EKS should have the encryption of secrets enabled Default Severity: high Explanation EKS cluster resources should have the encryption_config block set with protection of the secrets resource. Possible Impact EKS secrets could be read if compromised Suggested Resolution Enable encryption of EKS secrets Insecure Example The following example will fail the aws-eks-encrypt-secrets check. resource \"aws_eks_cluster\" \"bad_example\" { name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Secure Example The following example will pass the aws-eks-encrypt-secrets check. resource \"aws_eks_cluster\" \"good_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#encryption_config https://aws.amazon.com/about-aws/whats-new/2020/03/amazon-eks-adds-envelope-encryption-for-secrets-with-aws-kms/", "title": "encrypt-secrets"}, {"location": "checks/aws/eks/encrypt-secrets/#eks-should-have-the-encryption-of-secrets-enabled", "text": "", "title": "EKS should have the encryption of secrets enabled"}, {"location": "checks/aws/eks/encrypt-secrets/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/eks/encrypt-secrets/#explanation", "text": "EKS cluster resources should have the encryption_config block set with protection of the secrets resource.", "title": "Explanation"}, {"location": "checks/aws/eks/encrypt-secrets/#possible-impact", "text": "EKS secrets could be read if compromised", "title": "Possible Impact"}, {"location": "checks/aws/eks/encrypt-secrets/#suggested-resolution", "text": "Enable encryption of EKS secrets", "title": "Suggested Resolution"}, {"location": "checks/aws/eks/encrypt-secrets/#insecure-example", "text": "The following example will fail the aws-eks-encrypt-secrets check. resource \"aws_eks_cluster\" \"bad_example\" { name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }", "title": "Insecure Example"}, {"location": "checks/aws/eks/encrypt-secrets/#secure-example", "text": "The following example will pass the aws-eks-encrypt-secrets check. resource \"aws_eks_cluster\" \"good_example\" { encryption_config { resources = [ \"secrets\" ] provider { key_arn = var.kms_arn } } name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }", "title": "Secure Example"}, {"location": "checks/aws/eks/encrypt-secrets/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#encryption_config https://aws.amazon.com/about-aws/whats-new/2020/03/amazon-eks-adds-envelope-encryption-for-secrets-with-aws-kms/", "title": "Links"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/", "text": "EKS cluster should not have open CIDR range for public access Default Severity: critical Explanation EKS Clusters have public access cidrs set to 0.0.0.0/0 by default which is wide open to the internet. This should be explicitly set to a more specific private CIDR range Possible Impact EKS can be accessed from the internet Suggested Resolution Don't enable public access to EKS Clusters Insecure Example The following example will fail the aws-eks-no-public-cluster-access-to-cidr check. resource \"aws_eks_cluster\" \"bad_example\" { // other config name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true } } Secure Example The following example will pass the aws-eks-no-public-cluster-access-to-cidr check. resource \"aws_eks_cluster\" \"good_example\" { // other config name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true public_access_cidrs = [ \"10.2.0.0/8\" ] } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#vpc_config https://docs.aws.amazon.com/eks/latest/userguide/create-public-private-vpc.html", "title": "no-public-cluster-access-to-cidr"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/#eks-cluster-should-not-have-open-cidr-range-for-public-access", "text": "", "title": "EKS cluster should not have open CIDR range for public access"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/#explanation", "text": "EKS Clusters have public access cidrs set to 0.0.0.0/0 by default which is wide open to the internet. This should be explicitly set to a more specific private CIDR range", "title": "Explanation"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/#possible-impact", "text": "EKS can be accessed from the internet", "title": "Possible Impact"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/#suggested-resolution", "text": "Don't enable public access to EKS Clusters", "title": "Suggested Resolution"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/#insecure-example", "text": "The following example will fail the aws-eks-no-public-cluster-access-to-cidr check. resource \"aws_eks_cluster\" \"bad_example\" { // other config name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true } }", "title": "Insecure Example"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/#secure-example", "text": "The following example will pass the aws-eks-no-public-cluster-access-to-cidr check. resource \"aws_eks_cluster\" \"good_example\" { // other config name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true public_access_cidrs = [ \"10.2.0.0/8\" ] } }", "title": "Secure Example"}, {"location": "checks/aws/eks/no-public-cluster-access-to-cidr/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#vpc_config https://docs.aws.amazon.com/eks/latest/userguide/create-public-private-vpc.html", "title": "Links"}, {"location": "checks/aws/eks/no-public-cluster-access/", "text": "EKS Clusters should have the public access disabled Default Severity: critical Explanation EKS clusters are available publicly by default, this should be explicitly disabled in the vpc_config of the EKS cluster resource. Possible Impact EKS can be access from the internet Suggested Resolution Don't enable public access to EKS Clusters Insecure Example The following example will fail the aws-eks-no-public-cluster-access check. resource \"aws_eks_cluster\" \"bad_example\" { // other config name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true public_access_cidrs = [ \"0.0.0.0/0\" ] } } Secure Example The following example will pass the aws-eks-no-public-cluster-access check. resource \"aws_eks_cluster\" \"good_example\" { // other config name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#endpoint_public_access https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html", "title": "no-public-cluster-access"}, {"location": "checks/aws/eks/no-public-cluster-access/#eks-clusters-should-have-the-public-access-disabled", "text": "", "title": "EKS Clusters should have the public access disabled"}, {"location": "checks/aws/eks/no-public-cluster-access/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/eks/no-public-cluster-access/#explanation", "text": "EKS clusters are available publicly by default, this should be explicitly disabled in the vpc_config of the EKS cluster resource.", "title": "Explanation"}, {"location": "checks/aws/eks/no-public-cluster-access/#possible-impact", "text": "EKS can be access from the internet", "title": "Possible Impact"}, {"location": "checks/aws/eks/no-public-cluster-access/#suggested-resolution", "text": "Don't enable public access to EKS Clusters", "title": "Suggested Resolution"}, {"location": "checks/aws/eks/no-public-cluster-access/#insecure-example", "text": "The following example will fail the aws-eks-no-public-cluster-access check. resource \"aws_eks_cluster\" \"bad_example\" { // other config name = \"bad_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = true public_access_cidrs = [ \"0.0.0.0/0\" ] } }", "title": "Insecure Example"}, {"location": "checks/aws/eks/no-public-cluster-access/#secure-example", "text": "The following example will pass the aws-eks-no-public-cluster-access check. resource \"aws_eks_cluster\" \"good_example\" { // other config name = \"good_example_cluster\" role_arn = var.cluster_arn vpc_config { endpoint_public_access = false } }", "title": "Secure Example"}, {"location": "checks/aws/eks/no-public-cluster-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster#endpoint_public_access https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html", "title": "Links"}, {"location": "checks/aws/elastic-search/enable-domain-encryption/", "text": "Elasticsearch domain isn't encrypted at rest. Default Severity: high Explanation You should ensure your Elasticsearch data is encrypted at rest to help prevent sensitive information from being read by unauthorised users. Possible Impact Data will be readable if compromised Suggested Resolution Enable ElasticSearch domain encryption Insecure Example The following example will fail the aws-elastic-search-enable-domain-encryption check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" encrypt_at_rest { enabled = false } } Secure Example The following example will pass the aws-elastic-search-enable-domain-encryption check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" encrypt_at_rest { enabled = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#encrypt_at_rest https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html", "title": "Elasticsearch domain isn't encrypted at rest."}, {"location": "checks/aws/elastic-search/enable-domain-encryption/#elasticsearch-domain-isnt-encrypted-at-rest", "text": "", "title": "Elasticsearch domain isn't encrypted at rest."}, {"location": "checks/aws/elastic-search/enable-domain-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/elastic-search/enable-domain-encryption/#explanation", "text": "You should ensure your Elasticsearch data is encrypted at rest to help prevent sensitive information from being read by unauthorised users.", "title": "Explanation"}, {"location": "checks/aws/elastic-search/enable-domain-encryption/#possible-impact", "text": "Data will be readable if compromised", "title": "Possible Impact"}, {"location": "checks/aws/elastic-search/enable-domain-encryption/#suggested-resolution", "text": "Enable ElasticSearch domain encryption", "title": "Suggested Resolution"}, {"location": "checks/aws/elastic-search/enable-domain-encryption/#insecure-example", "text": "The following example will fail the aws-elastic-search-enable-domain-encryption check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" encrypt_at_rest { enabled = false } }", "title": "Insecure Example"}, {"location": "checks/aws/elastic-search/enable-domain-encryption/#secure-example", "text": "The following example will pass the aws-elastic-search-enable-domain-encryption check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" encrypt_at_rest { enabled = true } }", "title": "Secure Example"}, {"location": "checks/aws/elastic-search/enable-domain-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#encrypt_at_rest https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html", "title": "Links"}, {"location": "checks/aws/elastic-search/enable-domain-logging/", "text": "Domain logging should be enabled for Elastic Search domains Default Severity: medium Explanation Amazon ES exposes four Elasticsearch logs through Amazon CloudWatch Logs: error logs, search slow logs, index slow logs, and audit logs. Search slow logs, index slow logs, and error logs are useful for troubleshooting performance and stability issues. Audit logs track user activity for compliance purposes. All the logs are disabled by default. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for ElasticSearch domains Insecure Example The following example will fail the aws-elastic-search-enable-domain-logging check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" } Secure Example The following example will pass the aws-elastic-search-enable-domain-logging check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"AUDIT_LOGS\" enabled = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#log_type https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createdomain-configure-slow-logs.html", "title": "enable-domain-logging"}, {"location": "checks/aws/elastic-search/enable-domain-logging/#domain-logging-should-be-enabled-for-elastic-search-domains", "text": "", "title": "Domain logging should be enabled for Elastic Search domains"}, {"location": "checks/aws/elastic-search/enable-domain-logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/elastic-search/enable-domain-logging/#explanation", "text": "Amazon ES exposes four Elasticsearch logs through Amazon CloudWatch Logs: error logs, search slow logs, index slow logs, and audit logs. Search slow logs, index slow logs, and error logs are useful for troubleshooting performance and stability issues. Audit logs track user activity for compliance purposes. All the logs are disabled by default.", "title": "Explanation"}, {"location": "checks/aws/elastic-search/enable-domain-logging/#possible-impact", "text": "Logging provides vital information about access and usage", "title": "Possible Impact"}, {"location": "checks/aws/elastic-search/enable-domain-logging/#suggested-resolution", "text": "Enable logging for ElasticSearch domains", "title": "Suggested Resolution"}, {"location": "checks/aws/elastic-search/enable-domain-logging/#insecure-example", "text": "The following example will fail the aws-elastic-search-enable-domain-logging check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" }", "title": "Insecure Example"}, {"location": "checks/aws/elastic-search/enable-domain-logging/#secure-example", "text": "The following example will pass the aws-elastic-search-enable-domain-logging check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"example\" elasticsearch_version = \"1.5\" log_publishing_options { cloudwatch_log_group_arn = aws_cloudwatch_log_group.example.arn log_type = \"AUDIT_LOGS\" enabled = true } }", "title": "Secure Example"}, {"location": "checks/aws/elastic-search/enable-domain-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#log_type https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createdomain-configure-slow-logs.html", "title": "Links"}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/", "text": "Elasticsearch domain uses plaintext traffic for node to node communication. Default Severity: high Explanation Traffic flowing between Elasticsearch nodes should be encrypted to ensure sensitive data is kept private. Possible Impact In transit data between nodes could be read if intercepted Suggested Resolution Enable encrypted node to node communication Insecure Example The following example will fail the aws-elastic-search-enable-in-transit-encryption check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" node_to_node_encryption { enabled = false } } Secure Example The following example will pass the aws-elastic-search-enable-in-transit-encryption check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" node_to_node_encryption { enabled = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#encrypt_at_rest https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html", "title": "enable-in-transit-encryption"}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/#elasticsearch-domain-uses-plaintext-traffic-for-node-to-node-communication", "text": "", "title": "Elasticsearch domain uses plaintext traffic for node to node communication."}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/#explanation", "text": "Traffic flowing between Elasticsearch nodes should be encrypted to ensure sensitive data is kept private.", "title": "Explanation"}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/#possible-impact", "text": "In transit data between nodes could be read if intercepted", "title": "Possible Impact"}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/#suggested-resolution", "text": "Enable encrypted node to node communication", "title": "Suggested Resolution"}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/#insecure-example", "text": "The following example will fail the aws-elastic-search-enable-in-transit-encryption check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" node_to_node_encryption { enabled = false } }", "title": "Insecure Example"}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/#secure-example", "text": "The following example will pass the aws-elastic-search-enable-in-transit-encryption check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" node_to_node_encryption { enabled = true } }", "title": "Secure Example"}, {"location": "checks/aws/elastic-search/enable-in-transit-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#encrypt_at_rest https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html", "title": "Links"}, {"location": "checks/aws/elastic-search/enforce-https/", "text": "Elasticsearch doesn't enforce HTTPS traffic. Default Severity: critical Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact HTTP traffic can be intercepted and the contents read Suggested Resolution Enforce the use of HTTPS for ElasticSearch Insecure Example The following example will fail the aws-elastic-search-enforce-https check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = false } } Secure Example The following example will pass the aws-elastic-search-enforce-https check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#enforce_https https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html", "title": "enforce-https"}, {"location": "checks/aws/elastic-search/enforce-https/#elasticsearch-doesnt-enforce-https-traffic", "text": "", "title": "Elasticsearch doesn't enforce HTTPS traffic."}, {"location": "checks/aws/elastic-search/enforce-https/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/elastic-search/enforce-https/#explanation", "text": "Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.", "title": "Explanation"}, {"location": "checks/aws/elastic-search/enforce-https/#possible-impact", "text": "HTTP traffic can be intercepted and the contents read", "title": "Possible Impact"}, {"location": "checks/aws/elastic-search/enforce-https/#suggested-resolution", "text": "Enforce the use of HTTPS for ElasticSearch", "title": "Suggested Resolution"}, {"location": "checks/aws/elastic-search/enforce-https/#insecure-example", "text": "The following example will fail the aws-elastic-search-enforce-https check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = false } }", "title": "Insecure Example"}, {"location": "checks/aws/elastic-search/enforce-https/#secure-example", "text": "The following example will pass the aws-elastic-search-enforce-https check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true } }", "title": "Secure Example"}, {"location": "checks/aws/elastic-search/enforce-https/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#enforce_https https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html", "title": "Links"}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/", "text": "Elasticsearch domain endpoint is using outdated TLS policy. Default Severity: high Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the aws-elastic-search-use-secure-tls-policy check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true tls_security_policy = \"Policy-Min-TLS-1-0-2019-07\" } } Secure Example The following example will pass the aws-elastic-search-use-secure-tls-policy check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true tls_security_policy = \"Policy-Min-TLS-1-2-2019-07\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#tls_security_policy https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html", "title": "use-secure-tls-policy"}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/#elasticsearch-domain-endpoint-is-using-outdated-tls-policy", "text": "", "title": "Elasticsearch domain endpoint is using outdated TLS policy."}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/#explanation", "text": "You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.", "title": "Explanation"}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/#possible-impact", "text": "Outdated SSL policies increase exposure to known vulnerabilities", "title": "Possible Impact"}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/#suggested-resolution", "text": "Use the most modern TLS/SSL policies available", "title": "Suggested Resolution"}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/#insecure-example", "text": "The following example will fail the aws-elastic-search-use-secure-tls-policy check. resource \"aws_elasticsearch_domain\" \"bad_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true tls_security_policy = \"Policy-Min-TLS-1-0-2019-07\" } }", "title": "Insecure Example"}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/#secure-example", "text": "The following example will pass the aws-elastic-search-use-secure-tls-policy check. resource \"aws_elasticsearch_domain\" \"good_example\" { domain_name = \"domain-foo\" domain_endpoint_options { enforce_https = true tls_security_policy = \"Policy-Min-TLS-1-2-2019-07\" } }", "title": "Secure Example"}, {"location": "checks/aws/elastic-search/use-secure-tls-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain#tls_security_policy https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html", "title": "Links"}, {"location": "checks/aws/elasticache/add-description-for-security-group/", "text": "Missing description for security group/security group rule. Default Severity: low Explanation Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups and rules Insecure Example The following example will fail the aws-elasticache-add-description-for-security-group check. resource \"aws_security_group\" \"bar\" { name = \"security-group\" } resource \"aws_elasticache_security_group\" \"bad_example\" { name = \"elasticache-security-group\" security_group_names = [ aws_security_group.bar.name ] description = \"\" } Secure Example The following example will pass the aws-elasticache-add-description-for-security-group check. resource \"aws_security_group\" \"bar\" { name = \"security-group\" } resource \"aws_elasticache_security_group\" \"good_example\" { name = \"elasticache-security-group\" security_group_names = [ aws_security_group.bar.name ] description = \"something\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_security_group#description https://docs.aws.amazon.com/AmazonElastiCache/latest/mem-ug/SecurityGroups.Creating.html", "title": "add-description-for-security-group"}, {"location": "checks/aws/elasticache/add-description-for-security-group/#missing-description-for-security-groupsecurity-group-rule", "text": "", "title": "Missing description for security group/security group rule."}, {"location": "checks/aws/elasticache/add-description-for-security-group/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/elasticache/add-description-for-security-group/#explanation", "text": "Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.", "title": "Explanation"}, {"location": "checks/aws/elasticache/add-description-for-security-group/#possible-impact", "text": "Descriptions provide context for the firewall rule reasons", "title": "Possible Impact"}, {"location": "checks/aws/elasticache/add-description-for-security-group/#suggested-resolution", "text": "Add descriptions for all security groups and rules", "title": "Suggested Resolution"}, {"location": "checks/aws/elasticache/add-description-for-security-group/#insecure-example", "text": "The following example will fail the aws-elasticache-add-description-for-security-group check. resource \"aws_security_group\" \"bar\" { name = \"security-group\" } resource \"aws_elasticache_security_group\" \"bad_example\" { name = \"elasticache-security-group\" security_group_names = [ aws_security_group.bar.name ] description = \"\" }", "title": "Insecure Example"}, {"location": "checks/aws/elasticache/add-description-for-security-group/#secure-example", "text": "The following example will pass the aws-elasticache-add-description-for-security-group check. resource \"aws_security_group\" \"bar\" { name = \"security-group\" } resource \"aws_elasticache_security_group\" \"good_example\" { name = \"elasticache-security-group\" security_group_names = [ aws_security_group.bar.name ] description = \"something\" }", "title": "Secure Example"}, {"location": "checks/aws/elasticache/add-description-for-security-group/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_security_group#description https://docs.aws.amazon.com/AmazonElastiCache/latest/mem-ug/SecurityGroups.Creating.html", "title": "Links"}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/", "text": "Elasticache Replication Group stores unencrypted data at-rest. Default Severity: high Explanation Data stored within an Elasticache replication node should be encrypted to ensure sensitive data is kept private. Possible Impact At-rest data in the Replication Group could be compromised if accessed. Suggested Resolution Enable at-rest encryption for replication group Insecure Example The following example will fail the aws-elasticache-enable-at-rest-encryption check. resource \"aws_elasticache_replication_group\" \"bad_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" at_rest_encryption_enabled = false } Secure Example The following example will pass the aws-elasticache-enable-at-rest-encryption check. resource \"aws_elasticache_replication_group\" \"good_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" at_rest_encryption_enabled = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_replication_group#at_rest_encryption_enabled https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/at-rest-encryption.html", "title": "Elasticache Replication Group stores unencrypted data at-rest."}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/#elasticache-replication-group-stores-unencrypted-data-at-rest", "text": "", "title": "Elasticache Replication Group stores unencrypted data at-rest."}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/#explanation", "text": "Data stored within an Elasticache replication node should be encrypted to ensure sensitive data is kept private.", "title": "Explanation"}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/#possible-impact", "text": "At-rest data in the Replication Group could be compromised if accessed.", "title": "Possible Impact"}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/#suggested-resolution", "text": "Enable at-rest encryption for replication group", "title": "Suggested Resolution"}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/#insecure-example", "text": "The following example will fail the aws-elasticache-enable-at-rest-encryption check. resource \"aws_elasticache_replication_group\" \"bad_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" at_rest_encryption_enabled = false }", "title": "Insecure Example"}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/#secure-example", "text": "The following example will pass the aws-elasticache-enable-at-rest-encryption check. resource \"aws_elasticache_replication_group\" \"good_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" at_rest_encryption_enabled = true }", "title": "Secure Example"}, {"location": "checks/aws/elasticache/enable-at-rest-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_replication_group#at_rest_encryption_enabled https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/at-rest-encryption.html", "title": "Links"}, {"location": "checks/aws/elasticache/enable-backup-retention/", "text": "Redis cluster should have backup retention turned on Default Severity: medium Explanation Redis clusters should have a snapshot retention time to ensure that they are backed up and can be restored if required. Possible Impact Without backups of the redis cluster recovery is made difficult Suggested Resolution Configure snapshot retention for redis cluster Insecure Example The following example will fail the aws-elasticache-enable-backup-retention check. resource \"aws_elasticache_cluster\" \"bad_example\" { cluster_id = \"cluster-example\" engine = \"redis\" node_type = \"cache.m4.large\" num_cache_nodes = 1 parameter_group_name = \"default.redis3.2\" engine_version = \"3.2.10\" port = 6379 } Secure Example The following example will pass the aws-elasticache-enable-backup-retention check. resource \"aws_elasticache_cluster\" \"good_example\" { cluster_id = \"cluster-example\" engine = \"redis\" node_type = \"cache.m4.large\" num_cache_nodes = 1 parameter_group_name = \"default.redis3.2\" engine_version = \"3.2.10\" port = 6379 snapshot_retention_limit = 5 } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_cluster#snapshot_retention_limit https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/backups-automatic.html", "title": "enable-backup-retention"}, {"location": "checks/aws/elasticache/enable-backup-retention/#redis-cluster-should-have-backup-retention-turned-on", "text": "", "title": "Redis cluster should have backup retention turned on"}, {"location": "checks/aws/elasticache/enable-backup-retention/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/elasticache/enable-backup-retention/#explanation", "text": "Redis clusters should have a snapshot retention time to ensure that they are backed up and can be restored if required.", "title": "Explanation"}, {"location": "checks/aws/elasticache/enable-backup-retention/#possible-impact", "text": "Without backups of the redis cluster recovery is made difficult", "title": "Possible Impact"}, {"location": "checks/aws/elasticache/enable-backup-retention/#suggested-resolution", "text": "Configure snapshot retention for redis cluster", "title": "Suggested Resolution"}, {"location": "checks/aws/elasticache/enable-backup-retention/#insecure-example", "text": "The following example will fail the aws-elasticache-enable-backup-retention check. resource \"aws_elasticache_cluster\" \"bad_example\" { cluster_id = \"cluster-example\" engine = \"redis\" node_type = \"cache.m4.large\" num_cache_nodes = 1 parameter_group_name = \"default.redis3.2\" engine_version = \"3.2.10\" port = 6379 }", "title": "Insecure Example"}, {"location": "checks/aws/elasticache/enable-backup-retention/#secure-example", "text": "The following example will pass the aws-elasticache-enable-backup-retention check. resource \"aws_elasticache_cluster\" \"good_example\" { cluster_id = \"cluster-example\" engine = \"redis\" node_type = \"cache.m4.large\" num_cache_nodes = 1 parameter_group_name = \"default.redis3.2\" engine_version = \"3.2.10\" port = 6379 snapshot_retention_limit = 5 }", "title": "Secure Example"}, {"location": "checks/aws/elasticache/enable-backup-retention/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_cluster#snapshot_retention_limit https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/backups-automatic.html", "title": "Links"}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/", "text": "Elasticache Replication Group uses unencrypted traffic. Default Severity: high Explanation Traffic flowing between Elasticache replication nodes should be encrypted to ensure sensitive data is kept private. Possible Impact In transit data in the Replication Group could be read if intercepted Suggested Resolution Enable in transit encryption for replication group Insecure Example The following example will fail the aws-elasticache-enable-in-transit-encryption check. resource \"aws_elasticache_replication_group\" \"bad_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" transit_encryption_enabled = false } Secure Example The following example will pass the aws-elasticache-enable-in-transit-encryption check. resource \"aws_elasticache_replication_group\" \"good_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" transit_encryption_enabled = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_replication_group#transit_encryption_enabled https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/in-transit-encryption.html", "title": "enable-in-transit-encryption"}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/#elasticache-replication-group-uses-unencrypted-traffic", "text": "", "title": "Elasticache Replication Group uses unencrypted traffic."}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/#explanation", "text": "Traffic flowing between Elasticache replication nodes should be encrypted to ensure sensitive data is kept private.", "title": "Explanation"}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/#possible-impact", "text": "In transit data in the Replication Group could be read if intercepted", "title": "Possible Impact"}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/#suggested-resolution", "text": "Enable in transit encryption for replication group", "title": "Suggested Resolution"}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/#insecure-example", "text": "The following example will fail the aws-elasticache-enable-in-transit-encryption check. resource \"aws_elasticache_replication_group\" \"bad_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" transit_encryption_enabled = false }", "title": "Insecure Example"}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/#secure-example", "text": "The following example will pass the aws-elasticache-enable-in-transit-encryption check. resource \"aws_elasticache_replication_group\" \"good_example\" { replication_group_id = \"foo\" replication_group_description = \"my foo cluster\" transit_encryption_enabled = true }", "title": "Secure Example"}, {"location": "checks/aws/elasticache/enable-in-transit-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_replication_group#transit_encryption_enabled https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/in-transit-encryption.html", "title": "Links"}, {"location": "checks/aws/elb/alb-not-public/", "text": "Load balancer is exposed to the internet. Default Severity: high Explanation There are many scenarios in which you would want to expose a load balancer to the wider internet, but this check exists as a warning to prevent accidental exposure of internal assets. You should ensure that this resource should be exposed publicly. Possible Impact The load balancer is exposed on the internet Suggested Resolution Switch to an internal load balancer or add a tfsec ignore Insecure Example The following example will fail the aws-elb-alb-not-public check. resource \"aws_alb\" \"bad_example\" { internal = false } Secure Example The following example will pass the aws-elb-alb-not-public check. resource \"aws_alb\" \"good_example\" { internal = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb", "title": "Load balancer is exposed to the internet."}, {"location": "checks/aws/elb/alb-not-public/#load-balancer-is-exposed-to-the-internet", "text": "", "title": "Load balancer is exposed to the internet."}, {"location": "checks/aws/elb/alb-not-public/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/elb/alb-not-public/#explanation", "text": "There are many scenarios in which you would want to expose a load balancer to the wider internet, but this check exists as a warning to prevent accidental exposure of internal assets. You should ensure that this resource should be exposed publicly.", "title": "Explanation"}, {"location": "checks/aws/elb/alb-not-public/#possible-impact", "text": "The load balancer is exposed on the internet", "title": "Possible Impact"}, {"location": "checks/aws/elb/alb-not-public/#suggested-resolution", "text": "Switch to an internal load balancer or add a tfsec ignore", "title": "Suggested Resolution"}, {"location": "checks/aws/elb/alb-not-public/#insecure-example", "text": "The following example will fail the aws-elb-alb-not-public check. resource \"aws_alb\" \"bad_example\" { internal = false }", "title": "Insecure Example"}, {"location": "checks/aws/elb/alb-not-public/#secure-example", "text": "The following example will pass the aws-elb-alb-not-public check. resource \"aws_alb\" \"good_example\" { internal = true }", "title": "Secure Example"}, {"location": "checks/aws/elb/alb-not-public/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb", "title": "Links"}, {"location": "checks/aws/elb/drop-invalid-headers/", "text": "Load balancers should drop invalid headers Default Severity: high Explanation Passing unknown or invalid headers through to the target poses a potential risk of compromise. By setting drop_invalid_header_fields to true, anything that doe not conform to well known, defined headers will be removed by the load balancer. Possible Impact Invalid headers being passed through to the target of the load balance may exploit vulnerabilities Suggested Resolution Set drop_invalid_header_fields to true Insecure Example The following example will fail the aws-elb-drop-invalid-headers check. resource \"aws_alb\" \"bad_example\" { name = \"bad_alb\" internal = false load_balancer_type = \"application\" access_logs { bucket = aws_s3_bucket.lb_logs.bucket prefix = \"test-lb\" enabled = true } drop_invalid_header_fields = false } Secure Example The following example will pass the aws-elb-drop-invalid-headers check. resource \"aws_alb\" \"good_example\" { name = \"good_alb\" internal = false load_balancer_type = \"application\" access_logs { bucket = aws_s3_bucket.lb_logs.bucket prefix = \"test-lb\" enabled = true } drop_invalid_header_fields = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb#drop_invalid_header_fields https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html", "title": "drop-invalid-headers"}, {"location": "checks/aws/elb/drop-invalid-headers/#load-balancers-should-drop-invalid-headers", "text": "", "title": "Load balancers should drop invalid headers"}, {"location": "checks/aws/elb/drop-invalid-headers/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/elb/drop-invalid-headers/#explanation", "text": "Passing unknown or invalid headers through to the target poses a potential risk of compromise. By setting drop_invalid_header_fields to true, anything that doe not conform to well known, defined headers will be removed by the load balancer.", "title": "Explanation"}, {"location": "checks/aws/elb/drop-invalid-headers/#possible-impact", "text": "Invalid headers being passed through to the target of the load balance may exploit vulnerabilities", "title": "Possible Impact"}, {"location": "checks/aws/elb/drop-invalid-headers/#suggested-resolution", "text": "Set drop_invalid_header_fields to true", "title": "Suggested Resolution"}, {"location": "checks/aws/elb/drop-invalid-headers/#insecure-example", "text": "The following example will fail the aws-elb-drop-invalid-headers check. resource \"aws_alb\" \"bad_example\" { name = \"bad_alb\" internal = false load_balancer_type = \"application\" access_logs { bucket = aws_s3_bucket.lb_logs.bucket prefix = \"test-lb\" enabled = true } drop_invalid_header_fields = false }", "title": "Insecure Example"}, {"location": "checks/aws/elb/drop-invalid-headers/#secure-example", "text": "The following example will pass the aws-elb-drop-invalid-headers check. resource \"aws_alb\" \"good_example\" { name = \"good_alb\" internal = false load_balancer_type = \"application\" access_logs { bucket = aws_s3_bucket.lb_logs.bucket prefix = \"test-lb\" enabled = true } drop_invalid_header_fields = true }", "title": "Secure Example"}, {"location": "checks/aws/elb/drop-invalid-headers/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb#drop_invalid_header_fields https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html", "title": "Links"}, {"location": "checks/aws/elb/http-not-used/", "text": "Use of plain HTTP. Default Severity: critical Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact Your traffic is not protected Suggested Resolution Switch to HTTPS to benefit from TLS security features Insecure Example The following example will fail the aws-elb-http-not-used check. resource \"aws_alb_listener\" \"bad_example\" { protocol = \"HTTP\" } Secure Example The following example will pass the aws-elb-http-not-used check. resource \"aws_alb_listener\" \"good_example\" { protocol = \"HTTPS\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener https://www.cloudflare.com/en-gb/learning/ssl/why-is-http-not-secure/", "title": "Use of plain HTTP."}, {"location": "checks/aws/elb/http-not-used/#use-of-plain-http", "text": "", "title": "Use of plain HTTP."}, {"location": "checks/aws/elb/http-not-used/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/elb/http-not-used/#explanation", "text": "Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.", "title": "Explanation"}, {"location": "checks/aws/elb/http-not-used/#possible-impact", "text": "Your traffic is not protected", "title": "Possible Impact"}, {"location": "checks/aws/elb/http-not-used/#suggested-resolution", "text": "Switch to HTTPS to benefit from TLS security features", "title": "Suggested Resolution"}, {"location": "checks/aws/elb/http-not-used/#insecure-example", "text": "The following example will fail the aws-elb-http-not-used check. resource \"aws_alb_listener\" \"bad_example\" { protocol = \"HTTP\" }", "title": "Insecure Example"}, {"location": "checks/aws/elb/http-not-used/#secure-example", "text": "The following example will pass the aws-elb-http-not-used check. resource \"aws_alb_listener\" \"good_example\" { protocol = \"HTTPS\" }", "title": "Secure Example"}, {"location": "checks/aws/elb/http-not-used/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener https://www.cloudflare.com/en-gb/learning/ssl/why-is-http-not-secure/", "title": "Links"}, {"location": "checks/aws/elb/use-secure-tls-policy/", "text": "An outdated SSL policy is in use by a load balancer. Default Severity: critical Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact The SSL policy is outdated and has known vulnerabilities Suggested Resolution Use a more recent TLS/SSL policy for the load balancer Insecure Example The following example will fail the aws-elb-use-secure-tls-policy check. resource \"aws_alb_listener\" \"bad_example\" { ssl_policy = \"ELBSecurityPolicy-TLS-1-1-2017-01\" protocol = \"HTTPS\" } Secure Example The following example will pass the aws-elb-use-secure-tls-policy check. resource \"aws_alb_listener\" \"good_example\" { ssl_policy = \"ELBSecurityPolicy-TLS-1-2-2017-01\" protocol = \"HTTPS\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener", "title": "An outdated SSL policy is in use by a load balancer."}, {"location": "checks/aws/elb/use-secure-tls-policy/#an-outdated-ssl-policy-is-in-use-by-a-load-balancer", "text": "", "title": "An outdated SSL policy is in use by a load balancer."}, {"location": "checks/aws/elb/use-secure-tls-policy/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/elb/use-secure-tls-policy/#explanation", "text": "You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.", "title": "Explanation"}, {"location": "checks/aws/elb/use-secure-tls-policy/#possible-impact", "text": "The SSL policy is outdated and has known vulnerabilities", "title": "Possible Impact"}, {"location": "checks/aws/elb/use-secure-tls-policy/#suggested-resolution", "text": "Use a more recent TLS/SSL policy for the load balancer", "title": "Suggested Resolution"}, {"location": "checks/aws/elb/use-secure-tls-policy/#insecure-example", "text": "The following example will fail the aws-elb-use-secure-tls-policy check. resource \"aws_alb_listener\" \"bad_example\" { ssl_policy = \"ELBSecurityPolicy-TLS-1-1-2017-01\" protocol = \"HTTPS\" }", "title": "Insecure Example"}, {"location": "checks/aws/elb/use-secure-tls-policy/#secure-example", "text": "The following example will pass the aws-elb-use-secure-tls-policy check. resource \"aws_alb_listener\" \"good_example\" { ssl_policy = \"ELBSecurityPolicy-TLS-1-2-2017-01\" protocol = \"HTTPS\" }", "title": "Secure Example"}, {"location": "checks/aws/elb/use-secure-tls-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener", "title": "Links"}, {"location": "checks/aws/iam/enforce-mfa/", "text": "IAM Groups should have MFA enforcement activated. Default Severity: medium Explanation IAM user accounts should be protected with multi factor authentication to add safe guards to password compromise. Possible Impact User accounts are more vulnerable to compromise without multi factor authentication activated Suggested Resolution Use terraform-module/enforce-mfa/aws to ensure that MFA is enforced Insecure Example The following example will fail the aws-iam-enforce-mfa check. data aws_caller_identity current {} resource aws_iam_group developers { name = \"developers\" } Secure Example The following example will pass the aws-iam-enforce-mfa check. resource \"aws_iam_group\" \"support\" { name = \"support\" } resource aws_iam_group_policy mfa { group = aws_iam_group.support.name policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"\", \"Effect\": \"Allow\", \"Action\": \"ec2:*\", \"Resource\": \"*\", \"Condition\": { \"Bool\": { \"aws:MultiFactorAuthPresent\": [\"true\"] } } } ] } EOF } Links https://registry.terraform.io/modules/terraform-module/enforce-mfa/aws/latest https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "IAM Groups should have MFA enforcement activated."}, {"location": "checks/aws/iam/enforce-mfa/#iam-groups-should-have-mfa-enforcement-activated", "text": "", "title": "IAM Groups should have MFA enforcement activated."}, {"location": "checks/aws/iam/enforce-mfa/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/iam/enforce-mfa/#explanation", "text": "IAM user accounts should be protected with multi factor authentication to add safe guards to password compromise.", "title": "Explanation"}, {"location": "checks/aws/iam/enforce-mfa/#possible-impact", "text": "User accounts are more vulnerable to compromise without multi factor authentication activated", "title": "Possible Impact"}, {"location": "checks/aws/iam/enforce-mfa/#suggested-resolution", "text": "Use terraform-module/enforce-mfa/aws to ensure that MFA is enforced", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/enforce-mfa/#insecure-example", "text": "The following example will fail the aws-iam-enforce-mfa check. data aws_caller_identity current {} resource aws_iam_group developers { name = \"developers\" }", "title": "Insecure Example"}, {"location": "checks/aws/iam/enforce-mfa/#secure-example", "text": "The following example will pass the aws-iam-enforce-mfa check. resource \"aws_iam_group\" \"support\" { name = \"support\" } resource aws_iam_group_policy mfa { group = aws_iam_group.support.name policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Sid\": \"\", \"Effect\": \"Allow\", \"Action\": \"ec2:*\", \"Resource\": \"*\", \"Condition\": { \"Bool\": { \"aws:MultiFactorAuthPresent\": [\"true\"] } } } ] } EOF }", "title": "Secure Example"}, {"location": "checks/aws/iam/enforce-mfa/#links", "text": "https://registry.terraform.io/modules/terraform-module/enforce-mfa/aws/latest https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "Links"}, {"location": "checks/aws/iam/no-password-reuse/", "text": "IAM Password policy should prevent password reuse. Default Severity: medium Explanation IAM account password policies should prevent the reuse of passwords. The account password policy should be set to prevent using any of the last five used passwords. Possible Impact Password reuse increase the risk of compromised passwords being abused Suggested Resolution Prevent password reuse in the policy Insecure Example The following example will fail the aws-iam-no-password-reuse check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... password_reuse_prevention = 1 # ... } Secure Example The following example will pass the aws-iam-no-password-reuse check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... password_reuse_prevention = 5 # ... } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "no-password-reuse"}, {"location": "checks/aws/iam/no-password-reuse/#iam-password-policy-should-prevent-password-reuse", "text": "", "title": "IAM Password policy should prevent password reuse."}, {"location": "checks/aws/iam/no-password-reuse/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/iam/no-password-reuse/#explanation", "text": "IAM account password policies should prevent the reuse of passwords. The account password policy should be set to prevent using any of the last five used passwords.", "title": "Explanation"}, {"location": "checks/aws/iam/no-password-reuse/#possible-impact", "text": "Password reuse increase the risk of compromised passwords being abused", "title": "Possible Impact"}, {"location": "checks/aws/iam/no-password-reuse/#suggested-resolution", "text": "Prevent password reuse in the policy", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/no-password-reuse/#insecure-example", "text": "The following example will fail the aws-iam-no-password-reuse check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... password_reuse_prevention = 1 # ... }", "title": "Insecure Example"}, {"location": "checks/aws/iam/no-password-reuse/#secure-example", "text": "The following example will pass the aws-iam-no-password-reuse check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... password_reuse_prevention = 5 # ... }", "title": "Secure Example"}, {"location": "checks/aws/iam/no-password-reuse/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "Links"}, {"location": "checks/aws/iam/no-policy-wildcards/", "text": "IAM policy should avoid use of wildcards and instead apply the principle of least privilege Default Severity: high Explanation You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals. Possible Impact Overly permissive policies may grant access to sensitive resources Suggested Resolution Specify the exact permissions required, and to which resources they should apply instead of using wildcards. Insecure Example The following example will fail the aws-iam-no-policy-wildcards check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.s3_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"s3.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"s3_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"s3:*\" ] resources = [ \"*\" ] } } Secure Example The following example will pass the aws-iam-no-policy-wildcards check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.s3_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"s3.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"s3_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"s3:GetObject\" ] resources = [ aws_s3_bucket.example.arn ] } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html", "title": "no-policy-wildcards"}, {"location": "checks/aws/iam/no-policy-wildcards/#iam-policy-should-avoid-use-of-wildcards-and-instead-apply-the-principle-of-least-privilege", "text": "", "title": "IAM policy should avoid use of wildcards and instead apply the principle of least privilege"}, {"location": "checks/aws/iam/no-policy-wildcards/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/iam/no-policy-wildcards/#explanation", "text": "You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals.", "title": "Explanation"}, {"location": "checks/aws/iam/no-policy-wildcards/#possible-impact", "text": "Overly permissive policies may grant access to sensitive resources", "title": "Possible Impact"}, {"location": "checks/aws/iam/no-policy-wildcards/#suggested-resolution", "text": "Specify the exact permissions required, and to which resources they should apply instead of using wildcards.", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/no-policy-wildcards/#insecure-example", "text": "The following example will fail the aws-iam-no-policy-wildcards check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.s3_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"s3.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"s3_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"s3:*\" ] resources = [ \"*\" ] } }", "title": "Insecure Example"}, {"location": "checks/aws/iam/no-policy-wildcards/#secure-example", "text": "The following example will pass the aws-iam-no-policy-wildcards check. resource \"aws_iam_role_policy\" \"test_policy\" { name = \"test_policy\" role = aws_iam_role.test_role.id policy = data.aws_iam_policy_document.s3_policy.json } resource \"aws_iam_role\" \"test_role\" { name = \"test_role\" assume_role_policy = jsonencode ({ Version = \"2012-10-17\" Statement = [ { Action = \"sts:AssumeRole\" Effect = \"Allow\" Sid = \"\" Principal = { Service = \"s3.amazonaws.com\" } }, ] }) } data \"aws_iam_policy_document\" \"s3_policy\" { statement { principals { type = \"AWS\" identifiers = [ \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\" ] } actions = [ \"s3:GetObject\" ] resources = [ aws_s3_bucket.example.arn ] } }", "title": "Secure Example"}, {"location": "checks/aws/iam/no-policy-wildcards/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html", "title": "Links"}, {"location": "checks/aws/iam/require-lowercase-in-passwords/", "text": "IAM Password policy should have requirement for at least one lowercase character. Default Severity: medium Explanation IAM account password policies should ensure that passwords content including at least one lowercase character. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-require-lowercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_lowercase_characters not set # ... } Secure Example The following example will pass the aws-iam-require-lowercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_lowercase_characters = true # ... } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "require-lowercase-in-passwords"}, {"location": "checks/aws/iam/require-lowercase-in-passwords/#iam-password-policy-should-have-requirement-for-at-least-one-lowercase-character", "text": "", "title": "IAM Password policy should have requirement for at least one lowercase character."}, {"location": "checks/aws/iam/require-lowercase-in-passwords/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/iam/require-lowercase-in-passwords/#explanation", "text": "IAM account password policies should ensure that passwords content including at least one lowercase character.", "title": "Explanation"}, {"location": "checks/aws/iam/require-lowercase-in-passwords/#possible-impact", "text": "Short, simple passwords are easier to compromise", "title": "Possible Impact"}, {"location": "checks/aws/iam/require-lowercase-in-passwords/#suggested-resolution", "text": "Enforce longer, more complex passwords in the policy", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/require-lowercase-in-passwords/#insecure-example", "text": "The following example will fail the aws-iam-require-lowercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_lowercase_characters not set # ... }", "title": "Insecure Example"}, {"location": "checks/aws/iam/require-lowercase-in-passwords/#secure-example", "text": "The following example will pass the aws-iam-require-lowercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_lowercase_characters = true # ... }", "title": "Secure Example"}, {"location": "checks/aws/iam/require-lowercase-in-passwords/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "Links"}, {"location": "checks/aws/iam/require-numbers-in-passwords/", "text": "IAM Password policy should have requirement for at least one number in the password. Default Severity: medium Explanation IAM account password policies should ensure that passwords content including at least one number. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-require-numbers-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_numbers not set # ... } Secure Example The following example will pass the aws-iam-require-numbers-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_numbers = true # ... } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "require-numbers-in-passwords"}, {"location": "checks/aws/iam/require-numbers-in-passwords/#iam-password-policy-should-have-requirement-for-at-least-one-number-in-the-password", "text": "", "title": "IAM Password policy should have requirement for at least one number in the password."}, {"location": "checks/aws/iam/require-numbers-in-passwords/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/iam/require-numbers-in-passwords/#explanation", "text": "IAM account password policies should ensure that passwords content including at least one number.", "title": "Explanation"}, {"location": "checks/aws/iam/require-numbers-in-passwords/#possible-impact", "text": "Short, simple passwords are easier to compromise", "title": "Possible Impact"}, {"location": "checks/aws/iam/require-numbers-in-passwords/#suggested-resolution", "text": "Enforce longer, more complex passwords in the policy", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/require-numbers-in-passwords/#insecure-example", "text": "The following example will fail the aws-iam-require-numbers-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_numbers not set # ... }", "title": "Insecure Example"}, {"location": "checks/aws/iam/require-numbers-in-passwords/#secure-example", "text": "The following example will pass the aws-iam-require-numbers-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_numbers = true # ... }", "title": "Secure Example"}, {"location": "checks/aws/iam/require-numbers-in-passwords/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "Links"}, {"location": "checks/aws/iam/require-symbols-in-passwords/", "text": "IAM Password policy should have requirement for at least one symbol in the password. Default Severity: medium Explanation IAM account password policies should ensure that passwords content including a symbol. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-require-symbols-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_symbols not set # ... } Secure Example The following example will pass the aws-iam-require-symbols-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_symbols = true # ... } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "require-symbols-in-passwords"}, {"location": "checks/aws/iam/require-symbols-in-passwords/#iam-password-policy-should-have-requirement-for-at-least-one-symbol-in-the-password", "text": "", "title": "IAM Password policy should have requirement for at least one symbol in the password."}, {"location": "checks/aws/iam/require-symbols-in-passwords/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/iam/require-symbols-in-passwords/#explanation", "text": "IAM account password policies should ensure that passwords content including a symbol.", "title": "Explanation"}, {"location": "checks/aws/iam/require-symbols-in-passwords/#possible-impact", "text": "Short, simple passwords are easier to compromise", "title": "Possible Impact"}, {"location": "checks/aws/iam/require-symbols-in-passwords/#suggested-resolution", "text": "Enforce longer, more complex passwords in the policy", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/require-symbols-in-passwords/#insecure-example", "text": "The following example will fail the aws-iam-require-symbols-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_symbols not set # ... }", "title": "Insecure Example"}, {"location": "checks/aws/iam/require-symbols-in-passwords/#secure-example", "text": "The following example will pass the aws-iam-require-symbols-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_symbols = true # ... }", "title": "Secure Example"}, {"location": "checks/aws/iam/require-symbols-in-passwords/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "Links"}, {"location": "checks/aws/iam/require-uppercase-in-passwords/", "text": "IAM Password policy should have requirement for at least one uppercase character. Default Severity: medium Explanation , IAM account password policies should ensure that passwords content including at least one uppercase character. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-require-uppercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_uppercase_characters not set # ... } Secure Example The following example will pass the aws-iam-require-uppercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_uppercase_characters = true # ... } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "require-uppercase-in-passwords"}, {"location": "checks/aws/iam/require-uppercase-in-passwords/#iam-password-policy-should-have-requirement-for-at-least-one-uppercase-character", "text": "", "title": "IAM Password policy should have requirement for at least one uppercase character."}, {"location": "checks/aws/iam/require-uppercase-in-passwords/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/iam/require-uppercase-in-passwords/#explanation", "text": ", IAM account password policies should ensure that passwords content including at least one uppercase character.", "title": "Explanation"}, {"location": "checks/aws/iam/require-uppercase-in-passwords/#possible-impact", "text": "Short, simple passwords are easier to compromise", "title": "Possible Impact"}, {"location": "checks/aws/iam/require-uppercase-in-passwords/#suggested-resolution", "text": "Enforce longer, more complex passwords in the policy", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/require-uppercase-in-passwords/#insecure-example", "text": "The following example will fail the aws-iam-require-uppercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # require_uppercase_characters not set # ... }", "title": "Insecure Example"}, {"location": "checks/aws/iam/require-uppercase-in-passwords/#secure-example", "text": "The following example will pass the aws-iam-require-uppercase-in-passwords check. resource \"aws_iam_account_password_policy\" \"good_example\" { # ... require_uppercase_characters = true # ... }", "title": "Secure Example"}, {"location": "checks/aws/iam/require-uppercase-in-passwords/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "Links"}, {"location": "checks/aws/iam/set-max-password-age/", "text": "IAM Password policy should have expiry less than or equal to 90 days. Default Severity: medium Explanation IAM account password policies should have a maximum age specified. The account password policy should be set to expire passwords after 90 days or less. Possible Impact Long life password increase the likelihood of a password eventually being compromised Suggested Resolution Limit the password duration with an expiry in the policy Insecure Example The following example will fail the aws-iam-set-max-password-age check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # max_password_age not set # ... } Secure Example The following example will pass the aws-iam-set-max-password-age check. resource \"aws_iam_account_password_policy\" \"good_example\" { max_password_age = 90 } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "set-max-password-age"}, {"location": "checks/aws/iam/set-max-password-age/#iam-password-policy-should-have-expiry-less-than-or-equal-to-90-days", "text": "", "title": "IAM Password policy should have expiry less than or equal to 90 days."}, {"location": "checks/aws/iam/set-max-password-age/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/iam/set-max-password-age/#explanation", "text": "IAM account password policies should have a maximum age specified. The account password policy should be set to expire passwords after 90 days or less.", "title": "Explanation"}, {"location": "checks/aws/iam/set-max-password-age/#possible-impact", "text": "Long life password increase the likelihood of a password eventually being compromised", "title": "Possible Impact"}, {"location": "checks/aws/iam/set-max-password-age/#suggested-resolution", "text": "Limit the password duration with an expiry in the policy", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/set-max-password-age/#insecure-example", "text": "The following example will fail the aws-iam-set-max-password-age check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # max_password_age not set # ... }", "title": "Insecure Example"}, {"location": "checks/aws/iam/set-max-password-age/#secure-example", "text": "The following example will pass the aws-iam-set-max-password-age check. resource \"aws_iam_account_password_policy\" \"good_example\" { max_password_age = 90 }", "title": "Secure Example"}, {"location": "checks/aws/iam/set-max-password-age/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "Links"}, {"location": "checks/aws/iam/set-minimum-password-length/", "text": "IAM Password policy should have minimum password length of 14 or more characters. Default Severity: medium Explanation IAM account password policies should ensure that passwords have a minimum length. The account password policy should be set to enforce minimum password length of at least 14 characters. Possible Impact Short, simple passwords are easier to compromise Suggested Resolution Enforce longer, more complex passwords in the policy Insecure Example The following example will fail the aws-iam-set-minimum-password-length check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # minimum_password_length not set # ... } Secure Example The following example will pass the aws-iam-set-minimum-password-length check. resource \"aws_iam_account_password_policy\" \"good_example\" { minimum_password_length = 14 } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "set-minimum-password-length"}, {"location": "checks/aws/iam/set-minimum-password-length/#iam-password-policy-should-have-minimum-password-length-of-14-or-more-characters", "text": "", "title": "IAM Password policy should have minimum password length of 14 or more characters."}, {"location": "checks/aws/iam/set-minimum-password-length/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/iam/set-minimum-password-length/#explanation", "text": "IAM account password policies should ensure that passwords have a minimum length. The account password policy should be set to enforce minimum password length of at least 14 characters.", "title": "Explanation"}, {"location": "checks/aws/iam/set-minimum-password-length/#possible-impact", "text": "Short, simple passwords are easier to compromise", "title": "Possible Impact"}, {"location": "checks/aws/iam/set-minimum-password-length/#suggested-resolution", "text": "Enforce longer, more complex passwords in the policy", "title": "Suggested Resolution"}, {"location": "checks/aws/iam/set-minimum-password-length/#insecure-example", "text": "The following example will fail the aws-iam-set-minimum-password-length check. resource \"aws_iam_account_password_policy\" \"bad_example\" { # ... # minimum_password_length not set # ... }", "title": "Insecure Example"}, {"location": "checks/aws/iam/set-minimum-password-length/#secure-example", "text": "The following example will pass the aws-iam-set-minimum-password-length check. resource \"aws_iam_account_password_policy\" \"good_example\" { minimum_password_length = 14 }", "title": "Secure Example"}, {"location": "checks/aws/iam/set-minimum-password-length/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_account_password_policy https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_passwords_account-policy.html#password-policy-details", "title": "Links"}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/", "text": "Kinesis stream is unencrypted. Default Severity: high Explanation Kinesis streams should be encrypted to ensure sensitive data is kept private. Additionally, non-default KMS keys should be used so granularity of access control can be ensured. Possible Impact Intercepted data can be read in transit Suggested Resolution Enable in transit encryption Insecure Example The following example will fail the aws-kinesis-enable-in-transit-encryption check. resource \"aws_kinesis_stream\" \"bad_example\" { encryption_type = \"NONE\" } Secure Example The following example will pass the aws-kinesis-enable-in-transit-encryption check. resource \"aws_kinesis_stream\" \"good_example\" { encryption_type = \"KMS\" kms_key_id = \"my/special/key\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kinesis_stream#encryption_type https://docs.aws.amazon.com/streams/latest/dev/server-side-encryption.html", "title": "enable-in-transit-encryption"}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/#kinesis-stream-is-unencrypted", "text": "", "title": "Kinesis stream is unencrypted."}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/#explanation", "text": "Kinesis streams should be encrypted to ensure sensitive data is kept private. Additionally, non-default KMS keys should be used so granularity of access control can be ensured.", "title": "Explanation"}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/#possible-impact", "text": "Intercepted data can be read in transit", "title": "Possible Impact"}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/#suggested-resolution", "text": "Enable in transit encryption", "title": "Suggested Resolution"}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/#insecure-example", "text": "The following example will fail the aws-kinesis-enable-in-transit-encryption check. resource \"aws_kinesis_stream\" \"bad_example\" { encryption_type = \"NONE\" }", "title": "Insecure Example"}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/#secure-example", "text": "The following example will pass the aws-kinesis-enable-in-transit-encryption check. resource \"aws_kinesis_stream\" \"good_example\" { encryption_type = \"KMS\" kms_key_id = \"my/special/key\" }", "title": "Secure Example"}, {"location": "checks/aws/kinesis/enable-in-transit-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kinesis_stream#encryption_type https://docs.aws.amazon.com/streams/latest/dev/server-side-encryption.html", "title": "Links"}, {"location": "checks/aws/kms/auto-rotate-keys/", "text": "A KMS key is not configured to auto-rotate. Default Severity: medium Explanation You should configure your KMS keys to auto rotate to maintain security and defend against compromise. Possible Impact Long life KMS keys increase the attack surface when compromised Suggested Resolution Configure KMS key to auto rotate Insecure Example The following example will fail the aws-kms-auto-rotate-keys check. resource \"aws_kms_key\" \"bad_example\" { enable_key_rotation = false } Secure Example The following example will pass the aws-kms-auto-rotate-keys check. resource \"aws_kms_key\" \"good_example\" { enable_key_rotation = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key#enable_key_rotation https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html", "title": "auto-rotate-keys"}, {"location": "checks/aws/kms/auto-rotate-keys/#a-kms-key-is-not-configured-to-auto-rotate", "text": "", "title": "A KMS key is not configured to auto-rotate."}, {"location": "checks/aws/kms/auto-rotate-keys/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/kms/auto-rotate-keys/#explanation", "text": "You should configure your KMS keys to auto rotate to maintain security and defend against compromise.", "title": "Explanation"}, {"location": "checks/aws/kms/auto-rotate-keys/#possible-impact", "text": "Long life KMS keys increase the attack surface when compromised", "title": "Possible Impact"}, {"location": "checks/aws/kms/auto-rotate-keys/#suggested-resolution", "text": "Configure KMS key to auto rotate", "title": "Suggested Resolution"}, {"location": "checks/aws/kms/auto-rotate-keys/#insecure-example", "text": "The following example will fail the aws-kms-auto-rotate-keys check. resource \"aws_kms_key\" \"bad_example\" { enable_key_rotation = false }", "title": "Insecure Example"}, {"location": "checks/aws/kms/auto-rotate-keys/#secure-example", "text": "The following example will pass the aws-kms-auto-rotate-keys check. resource \"aws_kms_key\" \"good_example\" { enable_key_rotation = true }", "title": "Secure Example"}, {"location": "checks/aws/kms/auto-rotate-keys/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key#enable_key_rotation https://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html", "title": "Links"}, {"location": "checks/aws/lambda/enable-tracing/", "text": "Lambda functions should have X-Ray tracing enabled Default Severity: low Explanation X-Ray tracing enables end-to-end debugging and analysis of all function activity. This will allow for identifying bottlenecks, slow downs and timeouts. Possible Impact WIthout full tracing enabled it is difficult to trace the flow of logs Suggested Resolution Enable tracing Insecure Example The following example will fail the aws-lambda-enable-tracing check. resource \"aws_iam_role\" \"iam_for_lambda\" { name = \"iam_for_lambda\" assume_role_policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": \"sts:AssumeRole\", \"Principal\": { \"Service\": \"lambda.amazonaws.com\" }, \"Effect\": \"Allow\", \"Sid\": \"\" } ] } EOF } resource \"aws_lambda_function\" \"bad_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256(\"lambda_function_payload.zip\") runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"Passthrough\" } } { \"Version\" : \"2012-10-17\" , \"Statement\" : [ { \"Action\" : \"sts:AssumeRole\" , \"Principal\" : { \"Service\" : \"lambda.amazonaws.com\" }, \"Effect\" : \"Allow\" , \"Sid\" : \"\" } ] } EOF } resource \"aws_lambda_function\" \"bad_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256 ( \"lambda_function_payload.zip\" ) runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"Passthrough\" } } Secure Example The following example will pass the aws-lambda-enable-tracing check. resource \"aws_iam_role\" \"iam_for_lambda\" { name = \"iam_for_lambda\" assume_role_policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": \"sts:AssumeRole\", \"Principal\": { \"Service\": \"lambda.amazonaws.com\" }, \"Effect\": \"Allow\", \"Sid\": \"\" } ] } EOF } resource \"aws_lambda_function\" \"good_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256(\"lambda_function_payload.zip\") runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"Active\" } } { \"Version\" : \"2012-10-17\" , \"Statement\" : [ { \"Action\" : \"sts:AssumeRole\" , \"Principal\" : { \"Service\" : \"lambda.amazonaws.com\" }, \"Effect\" : \"Allow\" , \"Sid\" : \"\" } ] } EOF } resource \"aws_lambda_function\" \"good_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256 ( \"lambda_function_payload.zip\" ) runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"Active\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_function#mode https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html", "title": "enable-tracing"}, {"location": "checks/aws/lambda/enable-tracing/#lambda-functions-should-have-x-ray-tracing-enabled", "text": "", "title": "Lambda functions should have X-Ray tracing enabled"}, {"location": "checks/aws/lambda/enable-tracing/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/lambda/enable-tracing/#explanation", "text": "X-Ray tracing enables end-to-end debugging and analysis of all function activity. This will allow for identifying bottlenecks, slow downs and timeouts.", "title": "Explanation"}, {"location": "checks/aws/lambda/enable-tracing/#possible-impact", "text": "WIthout full tracing enabled it is difficult to trace the flow of logs", "title": "Possible Impact"}, {"location": "checks/aws/lambda/enable-tracing/#suggested-resolution", "text": "Enable tracing", "title": "Suggested Resolution"}, {"location": "checks/aws/lambda/enable-tracing/#insecure-example", "text": "The following example will fail the aws-lambda-enable-tracing check. resource \"aws_iam_role\" \"iam_for_lambda\" { name = \"iam_for_lambda\" assume_role_policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": \"sts:AssumeRole\", \"Principal\": { \"Service\": \"lambda.amazonaws.com\" }, \"Effect\": \"Allow\", \"Sid\": \"\" } ] } EOF } resource \"aws_lambda_function\" \"bad_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256(\"lambda_function_payload.zip\") runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"Passthrough\" } } { \"Version\" : \"2012-10-17\" , \"Statement\" : [ { \"Action\" : \"sts:AssumeRole\" , \"Principal\" : { \"Service\" : \"lambda.amazonaws.com\" }, \"Effect\" : \"Allow\" , \"Sid\" : \"\" } ] } EOF } resource \"aws_lambda_function\" \"bad_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256 ( \"lambda_function_payload.zip\" ) runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"Passthrough\" } }", "title": "Insecure Example"}, {"location": "checks/aws/lambda/enable-tracing/#secure-example", "text": "The following example will pass the aws-lambda-enable-tracing check. resource \"aws_iam_role\" \"iam_for_lambda\" { name = \"iam_for_lambda\" assume_role_policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": \"sts:AssumeRole\", \"Principal\": { \"Service\": \"lambda.amazonaws.com\" }, \"Effect\": \"Allow\", \"Sid\": \"\" } ] } EOF } resource \"aws_lambda_function\" \"good_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256(\"lambda_function_payload.zip\") runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"Active\" } } { \"Version\" : \"2012-10-17\" , \"Statement\" : [ { \"Action\" : \"sts:AssumeRole\" , \"Principal\" : { \"Service\" : \"lambda.amazonaws.com\" }, \"Effect\" : \"Allow\" , \"Sid\" : \"\" } ] } EOF } resource \"aws_lambda_function\" \"good_example\" { filename = \"lambda_function_payload.zip\" function_name = \"lambda_function_name\" role = aws_iam_role.iam_for_lambda.arn handler = \"exports.test\" # The filebase64sha256() function is available in Terraform 0.11.12 and later # For Terraform 0.11.11 and earlier, use the base64sha256() function and the file() function: # source_code_hash = \"${base64sha256(file(\"lambda_function_payload.zip\"))}\" source_code_hash = filebase64sha256 ( \"lambda_function_payload.zip\" ) runtime = \"nodejs12.x\" environment { variables = { foo = \"bar\" } } tracing_config { mode = \"Active\" } }", "title": "Secure Example"}, {"location": "checks/aws/lambda/enable-tracing/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_function#mode https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html", "title": "Links"}, {"location": "checks/aws/lambda/restrict-source-arn/", "text": "Ensure that lambda function permission has a source arn specified Default Severity: critical Explanation When the principal is an AWS service, the ARN of the specific resource within that service to grant permission to. Without this, any resource from principal will be granted permission \u2013 even if that resource is from another account. For S3, this should be the ARN of the S3 Bucket. For CloudWatch Events, this should be the ARN of the CloudWatch Events Rule. For API Gateway, this should be the ARN of the API Possible Impact Not providing the source ARN allows any resource from principal, even from other accounts Suggested Resolution Always provide a source arn for Lambda permissions Insecure Example The following example will fail the aws-lambda-restrict-source-arn check. resource \"aws_lambda_permission\" \"bad_example\" { statement_id = \"AllowExecutionFromSNS\" action = \"lambda:InvokeFunction\" function_name = aws_lambda_function.func.function_name principal = \"sns.amazonaws.com\" } Secure Example The following example will pass the aws-lambda-restrict-source-arn check. resource \"aws_lambda_permission\" \"good_example\" { statement_id = \"AllowExecutionFromSNS\" action = \"lambda:InvokeFunction\" function_name = aws_lambda_function.func.function_name principal = \"sns.amazonaws.com\" source_arn = aws_sns_topic.default.arn } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_permission https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html", "title": "restrict-source-arn"}, {"location": "checks/aws/lambda/restrict-source-arn/#ensure-that-lambda-function-permission-has-a-source-arn-specified", "text": "", "title": "Ensure that lambda function permission has a source arn specified"}, {"location": "checks/aws/lambda/restrict-source-arn/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/lambda/restrict-source-arn/#explanation", "text": "When the principal is an AWS service, the ARN of the specific resource within that service to grant permission to. Without this, any resource from principal will be granted permission \u2013 even if that resource is from another account. For S3, this should be the ARN of the S3 Bucket. For CloudWatch Events, this should be the ARN of the CloudWatch Events Rule. For API Gateway, this should be the ARN of the API", "title": "Explanation"}, {"location": "checks/aws/lambda/restrict-source-arn/#possible-impact", "text": "Not providing the source ARN allows any resource from principal, even from other accounts", "title": "Possible Impact"}, {"location": "checks/aws/lambda/restrict-source-arn/#suggested-resolution", "text": "Always provide a source arn for Lambda permissions", "title": "Suggested Resolution"}, {"location": "checks/aws/lambda/restrict-source-arn/#insecure-example", "text": "The following example will fail the aws-lambda-restrict-source-arn check. resource \"aws_lambda_permission\" \"bad_example\" { statement_id = \"AllowExecutionFromSNS\" action = \"lambda:InvokeFunction\" function_name = aws_lambda_function.func.function_name principal = \"sns.amazonaws.com\" }", "title": "Insecure Example"}, {"location": "checks/aws/lambda/restrict-source-arn/#secure-example", "text": "The following example will pass the aws-lambda-restrict-source-arn check. resource \"aws_lambda_permission\" \"good_example\" { statement_id = \"AllowExecutionFromSNS\" action = \"lambda:InvokeFunction\" function_name = aws_lambda_function.func.function_name principal = \"sns.amazonaws.com\" source_arn = aws_sns_topic.default.arn }", "title": "Secure Example"}, {"location": "checks/aws/lambda/restrict-source-arn/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_permission https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html", "title": "Links"}, {"location": "checks/aws/mq/enable-audit-logging/", "text": "MQ Broker should have audit logging enabled Default Severity: medium Explanation Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation Possible Impact Without audit logging it is difficult to trace activity in the MQ broker Suggested Resolution Enable audit logging Insecure Example The following example will fail the aws-mq-enable-audit-logging check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { audit = false } } Secure Example The following example will pass the aws-mq-enable-audit-logging check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { audit = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#audit https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html", "title": "enable-audit-logging"}, {"location": "checks/aws/mq/enable-audit-logging/#mq-broker-should-have-audit-logging-enabled", "text": "", "title": "MQ Broker should have audit logging enabled"}, {"location": "checks/aws/mq/enable-audit-logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/mq/enable-audit-logging/#explanation", "text": "Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation", "title": "Explanation"}, {"location": "checks/aws/mq/enable-audit-logging/#possible-impact", "text": "Without audit logging it is difficult to trace activity in the MQ broker", "title": "Possible Impact"}, {"location": "checks/aws/mq/enable-audit-logging/#suggested-resolution", "text": "Enable audit logging", "title": "Suggested Resolution"}, {"location": "checks/aws/mq/enable-audit-logging/#insecure-example", "text": "The following example will fail the aws-mq-enable-audit-logging check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { audit = false } }", "title": "Insecure Example"}, {"location": "checks/aws/mq/enable-audit-logging/#secure-example", "text": "The following example will pass the aws-mq-enable-audit-logging check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { audit = true } }", "title": "Secure Example"}, {"location": "checks/aws/mq/enable-audit-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#audit https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html", "title": "Links"}, {"location": "checks/aws/mq/enable-general-logging/", "text": "MQ Broker should have general logging enabled Default Severity: low Explanation Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation Possible Impact Without logging it is difficult to trace issues Suggested Resolution Enable general logging Insecure Example The following example will fail the aws-mq-enable-general-logging check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { general = false } } Secure Example The following example will pass the aws-mq-enable-general-logging check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { general = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#general https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html", "title": "enable-general-logging"}, {"location": "checks/aws/mq/enable-general-logging/#mq-broker-should-have-general-logging-enabled", "text": "", "title": "MQ Broker should have general logging enabled"}, {"location": "checks/aws/mq/enable-general-logging/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/mq/enable-general-logging/#explanation", "text": "Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation", "title": "Explanation"}, {"location": "checks/aws/mq/enable-general-logging/#possible-impact", "text": "Without logging it is difficult to trace issues", "title": "Possible Impact"}, {"location": "checks/aws/mq/enable-general-logging/#suggested-resolution", "text": "Enable general logging", "title": "Suggested Resolution"}, {"location": "checks/aws/mq/enable-general-logging/#insecure-example", "text": "The following example will fail the aws-mq-enable-general-logging check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { general = false } }", "title": "Insecure Example"}, {"location": "checks/aws/mq/enable-general-logging/#secure-example", "text": "The following example will pass the aws-mq-enable-general-logging check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } logs { general = true } }", "title": "Secure Example"}, {"location": "checks/aws/mq/enable-general-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#general https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html", "title": "Links"}, {"location": "checks/aws/mq/no-public-access/", "text": "Ensure MQ Broker is not publicly exposed Default Severity: high Explanation Public access of the MQ broker should be disabled and only allow routes to applications that require access. Possible Impact Publicly accessible MQ Broker may be vulnerable to compromise Suggested Resolution Disable public access when not required Insecure Example The following example will fail the aws-mq-no-public-access check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } publicly_accessible = true } Secure Example The following example will pass the aws-mq-no-public-access check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } publicly_accessible = false } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#publicly_accessible https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/using-amazon-mq-securely.html#prefer-brokers-without-public-accessibility", "title": "no-public-access"}, {"location": "checks/aws/mq/no-public-access/#ensure-mq-broker-is-not-publicly-exposed", "text": "", "title": "Ensure MQ Broker is not publicly exposed"}, {"location": "checks/aws/mq/no-public-access/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/mq/no-public-access/#explanation", "text": "Public access of the MQ broker should be disabled and only allow routes to applications that require access.", "title": "Explanation"}, {"location": "checks/aws/mq/no-public-access/#possible-impact", "text": "Publicly accessible MQ Broker may be vulnerable to compromise", "title": "Possible Impact"}, {"location": "checks/aws/mq/no-public-access/#suggested-resolution", "text": "Disable public access when not required", "title": "Suggested Resolution"}, {"location": "checks/aws/mq/no-public-access/#insecure-example", "text": "The following example will fail the aws-mq-no-public-access check. resource \"aws_mq_broker\" \"bad_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } publicly_accessible = true }", "title": "Insecure Example"}, {"location": "checks/aws/mq/no-public-access/#secure-example", "text": "The following example will pass the aws-mq-no-public-access check. resource \"aws_mq_broker\" \"good_example\" { broker_name = \"example\" configuration { id = aws_mq_configuration.test.id revision = aws_mq_configuration.test.latest_revision } engine_type = \"ActiveMQ\" engine_version = \"5.15.0\" host_instance_type = \"mq.t2.micro\" security_groups = [ aws_security_group.test.id ] user { username = \"ExampleUser\" password = \"MindTheGap\" } publicly_accessible = false }", "title": "Secure Example"}, {"location": "checks/aws/mq/no-public-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker#publicly_accessible https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/using-amazon-mq-securely.html#prefer-brokers-without-public-accessibility", "title": "Links"}, {"location": "checks/aws/msk/enable-in-transit-encryption/", "text": "A MSK cluster allows unencrypted data in transit. Default Severity: high Explanation Encryption should be forced for Kafka clusters, including for communication between nodes. This ensure sensitive data is kept private. Possible Impact Intercepted data can be read in transit Suggested Resolution Enable in transit encryption Insecure Example The following example will fail the aws-msk-enable-in-transit-encryption check. resource \"aws_msk_cluster\" \"bad_example\" { encryption_info { encryption_in_transit { client_broker = \"TLS_PLAINTEXT\" in_cluster = true } } } Secure Example The following example will pass the aws-msk-enable-in-transit-encryption check. resource \"aws_msk_cluster\" \"good_example\" { encryption_info { encryption_in_transit { client_broker = \"TLS\" in_cluster = true } } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster#encryption_info-argument-reference https://docs.aws.amazon.com/msk/latest/developerguide/msk-encryption.html", "title": "enable-in-transit-encryption"}, {"location": "checks/aws/msk/enable-in-transit-encryption/#a-msk-cluster-allows-unencrypted-data-in-transit", "text": "", "title": "A MSK cluster allows unencrypted data in transit."}, {"location": "checks/aws/msk/enable-in-transit-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/msk/enable-in-transit-encryption/#explanation", "text": "Encryption should be forced for Kafka clusters, including for communication between nodes. This ensure sensitive data is kept private.", "title": "Explanation"}, {"location": "checks/aws/msk/enable-in-transit-encryption/#possible-impact", "text": "Intercepted data can be read in transit", "title": "Possible Impact"}, {"location": "checks/aws/msk/enable-in-transit-encryption/#suggested-resolution", "text": "Enable in transit encryption", "title": "Suggested Resolution"}, {"location": "checks/aws/msk/enable-in-transit-encryption/#insecure-example", "text": "The following example will fail the aws-msk-enable-in-transit-encryption check. resource \"aws_msk_cluster\" \"bad_example\" { encryption_info { encryption_in_transit { client_broker = \"TLS_PLAINTEXT\" in_cluster = true } } }", "title": "Insecure Example"}, {"location": "checks/aws/msk/enable-in-transit-encryption/#secure-example", "text": "The following example will pass the aws-msk-enable-in-transit-encryption check. resource \"aws_msk_cluster\" \"good_example\" { encryption_info { encryption_in_transit { client_broker = \"TLS\" in_cluster = true } } }", "title": "Secure Example"}, {"location": "checks/aws/msk/enable-in-transit-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster#encryption_info-argument-reference https://docs.aws.amazon.com/msk/latest/developerguide/msk-encryption.html", "title": "Links"}, {"location": "checks/aws/msk/enable-logging/", "text": "Ensure MSK Cluster logging is enabled Default Severity: medium Explanation Managed streaming for Kafka can log to Cloud Watch, Kinesis Firehose and S3, at least one of these locations should be logged to Possible Impact Without logging it is difficult to trace issues Suggested Resolution Enable logging Insecure Example The following example will fail the aws-msk-enable-logging check. resource \"aws_msk_cluster\" \"example\" { cluster_name = \"example\" kafka_version = \"2.4.1\" number_of_broker_nodes = 3 broker_node_group_info { instance_type = \"kafka.m5.large\" ebs_volume_size = 1000 client_subnets = [ aws_subnet.subnet_az1.id , aws_subnet.subnet_az2.id , aws_subnet.subnet_az3.id , ] security_groups = [ aws_security_group.sg.id ] } tags = { foo = \"bar\" } } Secure Example The following example will pass the aws-msk-enable-logging check. resource \"aws_msk_cluster\" \"example\" { cluster_name = \"example\" kafka_version = \"2.4.1\" number_of_broker_nodes = 3 broker_node_group_info { instance_type = \"kafka.m5.large\" ebs_volume_size = 1000 client_subnets = [ aws_subnet.subnet_az1.id , aws_subnet.subnet_az2.id , aws_subnet.subnet_az3.id , ] security_groups = [ aws_security_group.sg.id ] } logging_info { broker_logs { firehose { enabled = false delivery_stream = aws_kinesis_firehose_delivery_stream.test_stream.name } s3 { enabled = true bucket = aws_s3_bucket.bucket.id prefix = \"logs/msk-\" } } } tags = { foo = \"bar\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster# https://docs.aws.amazon.com/msk/latest/developerguide/msk-logging.html", "title": "enable-logging"}, {"location": "checks/aws/msk/enable-logging/#ensure-msk-cluster-logging-is-enabled", "text": "", "title": "Ensure MSK Cluster logging is enabled"}, {"location": "checks/aws/msk/enable-logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/msk/enable-logging/#explanation", "text": "Managed streaming for Kafka can log to Cloud Watch, Kinesis Firehose and S3, at least one of these locations should be logged to", "title": "Explanation"}, {"location": "checks/aws/msk/enable-logging/#possible-impact", "text": "Without logging it is difficult to trace issues", "title": "Possible Impact"}, {"location": "checks/aws/msk/enable-logging/#suggested-resolution", "text": "Enable logging", "title": "Suggested Resolution"}, {"location": "checks/aws/msk/enable-logging/#insecure-example", "text": "The following example will fail the aws-msk-enable-logging check. resource \"aws_msk_cluster\" \"example\" { cluster_name = \"example\" kafka_version = \"2.4.1\" number_of_broker_nodes = 3 broker_node_group_info { instance_type = \"kafka.m5.large\" ebs_volume_size = 1000 client_subnets = [ aws_subnet.subnet_az1.id , aws_subnet.subnet_az2.id , aws_subnet.subnet_az3.id , ] security_groups = [ aws_security_group.sg.id ] } tags = { foo = \"bar\" } }", "title": "Insecure Example"}, {"location": "checks/aws/msk/enable-logging/#secure-example", "text": "The following example will pass the aws-msk-enable-logging check. resource \"aws_msk_cluster\" \"example\" { cluster_name = \"example\" kafka_version = \"2.4.1\" number_of_broker_nodes = 3 broker_node_group_info { instance_type = \"kafka.m5.large\" ebs_volume_size = 1000 client_subnets = [ aws_subnet.subnet_az1.id , aws_subnet.subnet_az2.id , aws_subnet.subnet_az3.id , ] security_groups = [ aws_security_group.sg.id ] } logging_info { broker_logs { firehose { enabled = false delivery_stream = aws_kinesis_firehose_delivery_stream.test_stream.name } s3 { enabled = true bucket = aws_s3_bucket.bucket.id prefix = \"logs/msk-\" } } } tags = { foo = \"bar\" } }", "title": "Secure Example"}, {"location": "checks/aws/msk/enable-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster# https://docs.aws.amazon.com/msk/latest/developerguide/msk-logging.html", "title": "Links"}, {"location": "checks/aws/neptune/enable-log-export/", "text": "Neptune logs export should be enabled Default Severity: medium Explanation Neptune does not have auditing by default. To ensure that you are able to accurately audit the usage of your Neptune instance you should enable export logs. Possible Impact Limited visibility of audit trail for changes to Neptune Suggested Resolution Enable export logs Insecure Example The following example will fail the aws-neptune-enable-log-export check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true enable_cloudwatch_logs_exports = [] } Secure Example The following example will pass the aws-neptune-enable-log-export check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true enable_cloudwatch_logs_exports = [ \"audit\" ] } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#enable_cloudwatch_logs_exports https://docs.aws.amazon.com/neptune/latest/userguide/auditing.html", "title": "enable-log-export"}, {"location": "checks/aws/neptune/enable-log-export/#neptune-logs-export-should-be-enabled", "text": "", "title": "Neptune logs export should be enabled"}, {"location": "checks/aws/neptune/enable-log-export/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/neptune/enable-log-export/#explanation", "text": "Neptune does not have auditing by default. To ensure that you are able to accurately audit the usage of your Neptune instance you should enable export logs.", "title": "Explanation"}, {"location": "checks/aws/neptune/enable-log-export/#possible-impact", "text": "Limited visibility of audit trail for changes to Neptune", "title": "Possible Impact"}, {"location": "checks/aws/neptune/enable-log-export/#suggested-resolution", "text": "Enable export logs", "title": "Suggested Resolution"}, {"location": "checks/aws/neptune/enable-log-export/#insecure-example", "text": "The following example will fail the aws-neptune-enable-log-export check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true enable_cloudwatch_logs_exports = [] }", "title": "Insecure Example"}, {"location": "checks/aws/neptune/enable-log-export/#secure-example", "text": "The following example will pass the aws-neptune-enable-log-export check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true enable_cloudwatch_logs_exports = [ \"audit\" ] }", "title": "Secure Example"}, {"location": "checks/aws/neptune/enable-log-export/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#enable_cloudwatch_logs_exports https://docs.aws.amazon.com/neptune/latest/userguide/auditing.html", "title": "Links"}, {"location": "checks/aws/neptune/enable-storage-encryption/", "text": "Neptune storage must be encrypted at rest Default Severity: high Explanation Encryption of Neptune storage ensures that if their is compromise of the disks, the data is still protected. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable encryption of Neptune storage Insecure Example The following example will fail the aws-neptune-enable-storage-encryption check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = false } Secure Example The following example will pass the aws-neptune-enable-storage-encryption check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#storage_encrypted https://docs.aws.amazon.com/neptune/latest/userguide/encrypt.html", "title": "enable-storage-encryption"}, {"location": "checks/aws/neptune/enable-storage-encryption/#neptune-storage-must-be-encrypted-at-rest", "text": "", "title": "Neptune storage must be encrypted at rest"}, {"location": "checks/aws/neptune/enable-storage-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/neptune/enable-storage-encryption/#explanation", "text": "Encryption of Neptune storage ensures that if their is compromise of the disks, the data is still protected.", "title": "Explanation"}, {"location": "checks/aws/neptune/enable-storage-encryption/#possible-impact", "text": "Unencrypted sensitive data is vulnerable to compromise.", "title": "Possible Impact"}, {"location": "checks/aws/neptune/enable-storage-encryption/#suggested-resolution", "text": "Enable encryption of Neptune storage", "title": "Suggested Resolution"}, {"location": "checks/aws/neptune/enable-storage-encryption/#insecure-example", "text": "The following example will fail the aws-neptune-enable-storage-encryption check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = false }", "title": "Insecure Example"}, {"location": "checks/aws/neptune/enable-storage-encryption/#secure-example", "text": "The following example will pass the aws-neptune-enable-storage-encryption check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = true }", "title": "Secure Example"}, {"location": "checks/aws/neptune/enable-storage-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#storage_encrypted https://docs.aws.amazon.com/neptune/latest/userguide/encrypt.html", "title": "Links"}, {"location": "checks/aws/neptune/encryption-customer-key/", "text": "Neptune encryption should use Customer Managed Keys Default Severity: high Explanation Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable encryption using customer managed keys Insecure Example The following example will fail the aws-neptune-encryption-customer-key check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = false } Secure Example The following example will pass the aws-neptune-encryption-customer-key check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = true kms_key_arn = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#storage_encrypted https://docs.aws.amazon.com/neptune/latest/userguide/encrypt.html", "title": "Neptune encryption should use Customer Managed Keys"}, {"location": "checks/aws/neptune/encryption-customer-key/#neptune-encryption-should-use-customer-managed-keys", "text": "", "title": "Neptune encryption should use Customer Managed Keys"}, {"location": "checks/aws/neptune/encryption-customer-key/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/neptune/encryption-customer-key/#explanation", "text": "Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys.", "title": "Explanation"}, {"location": "checks/aws/neptune/encryption-customer-key/#possible-impact", "text": "Using AWS managed keys does not allow for fine grained control", "title": "Possible Impact"}, {"location": "checks/aws/neptune/encryption-customer-key/#suggested-resolution", "text": "Enable encryption using customer managed keys", "title": "Suggested Resolution"}, {"location": "checks/aws/neptune/encryption-customer-key/#insecure-example", "text": "The following example will fail the aws-neptune-encryption-customer-key check. resource \"aws_neptune_cluster\" \"bad_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = false }", "title": "Insecure Example"}, {"location": "checks/aws/neptune/encryption-customer-key/#secure-example", "text": "The following example will pass the aws-neptune-encryption-customer-key check. resource \"aws_neptune_cluster\" \"good_example\" { cluster_identifier = \"neptune-cluster-demo\" engine = \"neptune\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" skip_final_snapshot = true iam_database_authentication_enabled = true apply_immediately = true storage_encrypted = true kms_key_arn = true }", "title": "Secure Example"}, {"location": "checks/aws/neptune/encryption-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/neptune_cluster#storage_encrypted https://docs.aws.amazon.com/neptune/latest/userguide/encrypt.html", "title": "Links"}, {"location": "checks/aws/rds/enable-performance-insights/", "text": "Encryption for RDS Performance Insights should be enabled. Default Severity: high Explanation When enabling Performance Insights on an RDS cluster or RDS DB Instance, and encryption key should be provided. The encryption key specified in performance_insights_kms_key_id references a KMS ARN Possible Impact Data can be read from the RDS Performance Insights if it is compromised Suggested Resolution Enable encryption for RDS clusters and instances Insecure Example The following example will fail the aws-rds-enable-performance-insights check. resource \"aws_rds_cluster_instance\" \"bad_example\" { name = \"bar\" performance_insights_enabled = true performance_insights_kms_key_id = \"\" } Secure Example The following example will pass the aws-rds-enable-performance-insights check. resource \"aws_rds_cluster_instance\" \"good_example\" { name = \"bar\" performance_insights_enabled = true performance_insights_kms_key_id = \"arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster_instance#performance_insights_kms_key_id https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#performance_insights_kms_key_id https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.htm", "title": "enable-performance-insights"}, {"location": "checks/aws/rds/enable-performance-insights/#encryption-for-rds-performance-insights-should-be-enabled", "text": "", "title": "Encryption for RDS Performance Insights should be enabled."}, {"location": "checks/aws/rds/enable-performance-insights/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/rds/enable-performance-insights/#explanation", "text": "When enabling Performance Insights on an RDS cluster or RDS DB Instance, and encryption key should be provided. The encryption key specified in performance_insights_kms_key_id references a KMS ARN", "title": "Explanation"}, {"location": "checks/aws/rds/enable-performance-insights/#possible-impact", "text": "Data can be read from the RDS Performance Insights if it is compromised", "title": "Possible Impact"}, {"location": "checks/aws/rds/enable-performance-insights/#suggested-resolution", "text": "Enable encryption for RDS clusters and instances", "title": "Suggested Resolution"}, {"location": "checks/aws/rds/enable-performance-insights/#insecure-example", "text": "The following example will fail the aws-rds-enable-performance-insights check. resource \"aws_rds_cluster_instance\" \"bad_example\" { name = \"bar\" performance_insights_enabled = true performance_insights_kms_key_id = \"\" }", "title": "Insecure Example"}, {"location": "checks/aws/rds/enable-performance-insights/#secure-example", "text": "The following example will pass the aws-rds-enable-performance-insights check. resource \"aws_rds_cluster_instance\" \"good_example\" { name = \"bar\" performance_insights_enabled = true performance_insights_kms_key_id = \"arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab\" }", "title": "Secure Example"}, {"location": "checks/aws/rds/enable-performance-insights/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster_instance#performance_insights_kms_key_id https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#performance_insights_kms_key_id https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.htm", "title": "Links"}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/", "text": "There is no encryption specified or encryption is disabled on the RDS Cluster. Default Severity: high Explanation Encryption should be enabled for an RDS Aurora cluster. When enabling encryption by setting the kms_key_id, the storage_encrypted must also be set to true. Possible Impact Data can be read from the RDS cluster if it is compromised Suggested Resolution Enable encryption for RDS clusters Insecure Example The following example will fail the aws-rds-encrypt-cluster-storage-data check. resource \"aws_rds_cluster\" \"bad_example\" { name = \"bar\" kms_key_id = \"\" } Secure Example The following example will pass the aws-rds-encrypt-cluster-storage-data check. resource \"aws_rds_cluster\" \"good_example\" { name = \"bar\" kms_key_id = \"arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab\" storage_encrypted = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html", "title": "encrypt-cluster-storage-data"}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/#there-is-no-encryption-specified-or-encryption-is-disabled-on-the-rds-cluster", "text": "", "title": "There is no encryption specified or encryption is disabled on the RDS Cluster."}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/#explanation", "text": "Encryption should be enabled for an RDS Aurora cluster. When enabling encryption by setting the kms_key_id, the storage_encrypted must also be set to true.", "title": "Explanation"}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/#possible-impact", "text": "Data can be read from the RDS cluster if it is compromised", "title": "Possible Impact"}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/#suggested-resolution", "text": "Enable encryption for RDS clusters", "title": "Suggested Resolution"}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/#insecure-example", "text": "The following example will fail the aws-rds-encrypt-cluster-storage-data check. resource \"aws_rds_cluster\" \"bad_example\" { name = \"bar\" kms_key_id = \"\" }", "title": "Insecure Example"}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/#secure-example", "text": "The following example will pass the aws-rds-encrypt-cluster-storage-data check. resource \"aws_rds_cluster\" \"good_example\" { name = \"bar\" kms_key_id = \"arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab\" storage_encrypted = true }", "title": "Secure Example"}, {"location": "checks/aws/rds/encrypt-cluster-storage-data/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html", "title": "Links"}, {"location": "checks/aws/rds/encrypt-instance-storage-data/", "text": "RDS encryption has not been enabled at a DB Instance level. Default Severity: high Explanation Encryption should be enabled for an RDS Database instances. When enabling encryption by setting the kms_key_id. Possible Impact Data can be read from RDS instances if compromised Suggested Resolution Enable encryption for RDS instances Insecure Example The following example will fail the aws-rds-encrypt-instance-storage-data check. resource \"aws_db_instance\" \"bad_example\" { } Secure Example The following example will pass the aws-rds-encrypt-instance-storage-data check. resource \"aws_db_instance\" \"good_example\" { storage_encrypted = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html", "title": "encrypt-instance-storage-data"}, {"location": "checks/aws/rds/encrypt-instance-storage-data/#rds-encryption-has-not-been-enabled-at-a-db-instance-level", "text": "", "title": "RDS encryption has not been enabled at a DB Instance level."}, {"location": "checks/aws/rds/encrypt-instance-storage-data/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/rds/encrypt-instance-storage-data/#explanation", "text": "Encryption should be enabled for an RDS Database instances. When enabling encryption by setting the kms_key_id.", "title": "Explanation"}, {"location": "checks/aws/rds/encrypt-instance-storage-data/#possible-impact", "text": "Data can be read from RDS instances if compromised", "title": "Possible Impact"}, {"location": "checks/aws/rds/encrypt-instance-storage-data/#suggested-resolution", "text": "Enable encryption for RDS instances", "title": "Suggested Resolution"}, {"location": "checks/aws/rds/encrypt-instance-storage-data/#insecure-example", "text": "The following example will fail the aws-rds-encrypt-instance-storage-data check. resource \"aws_db_instance\" \"bad_example\" { }", "title": "Insecure Example"}, {"location": "checks/aws/rds/encrypt-instance-storage-data/#secure-example", "text": "The following example will pass the aws-rds-encrypt-instance-storage-data check. resource \"aws_db_instance\" \"good_example\" { storage_encrypted = true }", "title": "Secure Example"}, {"location": "checks/aws/rds/encrypt-instance-storage-data/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html", "title": "Links"}, {"location": "checks/aws/rds/no-classic-resources/", "text": "AWS Classic resource usage. Default Severity: critical Explanation AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead. Possible Impact Classic resources are running in a shared environment with other customers Suggested Resolution Switch to VPC resources Insecure Example The following example will fail the aws-rds-no-classic-resources check. resource \"aws_db_security_group\" \"bad_example\" { # ... } Secure Example The following example will pass the aws-rds-no-classic-resources check. resource \"aws_security_group\" \"good_example\" { # ... } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_security_group https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html", "title": "no-classic-resources"}, {"location": "checks/aws/rds/no-classic-resources/#aws-classic-resource-usage", "text": "", "title": "AWS Classic resource usage."}, {"location": "checks/aws/rds/no-classic-resources/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/rds/no-classic-resources/#explanation", "text": "AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead.", "title": "Explanation"}, {"location": "checks/aws/rds/no-classic-resources/#possible-impact", "text": "Classic resources are running in a shared environment with other customers", "title": "Possible Impact"}, {"location": "checks/aws/rds/no-classic-resources/#suggested-resolution", "text": "Switch to VPC resources", "title": "Suggested Resolution"}, {"location": "checks/aws/rds/no-classic-resources/#insecure-example", "text": "The following example will fail the aws-rds-no-classic-resources check. resource \"aws_db_security_group\" \"bad_example\" { # ... }", "title": "Insecure Example"}, {"location": "checks/aws/rds/no-classic-resources/#secure-example", "text": "The following example will pass the aws-rds-no-classic-resources check. resource \"aws_security_group\" \"good_example\" { # ... }", "title": "Secure Example"}, {"location": "checks/aws/rds/no-classic-resources/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_security_group https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html", "title": "Links"}, {"location": "checks/aws/rds/no-public-db-access/", "text": "A database resource is marked as publicly accessible. Default Severity: critical Explanation Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function. Possible Impact The database instance is publicly accessible Suggested Resolution Set the database to not be publicly accessible Insecure Example The following example will fail the aws-rds-no-public-db-access check. resource \"aws_db_instance\" \"bad_example\" { publicly_accessible = true } Secure Example The following example will pass the aws-rds-no-public-db-access check. resource \"aws_db_instance\" \"good_example\" { publicly_accessible = false } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_VPC.WorkingWithRDSInstanceinaVPC.html#USER_VPC.Hiding", "title": "no-public-db-access"}, {"location": "checks/aws/rds/no-public-db-access/#a-database-resource-is-marked-as-publicly-accessible", "text": "", "title": "A database resource is marked as publicly accessible."}, {"location": "checks/aws/rds/no-public-db-access/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/rds/no-public-db-access/#explanation", "text": "Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function.", "title": "Explanation"}, {"location": "checks/aws/rds/no-public-db-access/#possible-impact", "text": "The database instance is publicly accessible", "title": "Possible Impact"}, {"location": "checks/aws/rds/no-public-db-access/#suggested-resolution", "text": "Set the database to not be publicly accessible", "title": "Suggested Resolution"}, {"location": "checks/aws/rds/no-public-db-access/#insecure-example", "text": "The following example will fail the aws-rds-no-public-db-access check. resource \"aws_db_instance\" \"bad_example\" { publicly_accessible = true }", "title": "Insecure Example"}, {"location": "checks/aws/rds/no-public-db-access/#secure-example", "text": "The following example will pass the aws-rds-no-public-db-access check. resource \"aws_db_instance\" \"good_example\" { publicly_accessible = false }", "title": "Secure Example"}, {"location": "checks/aws/rds/no-public-db-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_VPC.WorkingWithRDSInstanceinaVPC.html#USER_VPC.Hiding", "title": "Links"}, {"location": "checks/aws/rds/specify-backup-retention/", "text": "RDS Cluster and RDS instance should have backup retention longer than default 1 day Default Severity: medium Explanation RDS backup retention for clusters defaults to 1 day, this may not be enough to identify and respond to an issue. Backup retention periods should be set to a period that is a balance on cost and limiting risk. Possible Impact Potential loss of data and short opportunity for recovery Suggested Resolution Explicitly set the retention period to greater than the default Insecure Example The following example will fail the aws-rds-specify-backup-retention check. resource \"aws_db_instance\" \"bad_example\" { allocated_storage = 10 engine = \"mysql\" engine_version = \"5.7\" instance_class = \"db.t3.micro\" name = \"mydb\" username = \"foo\" password = \"foobarbaz\" parameter_group_name = \"default.mysql5.7\" skip_final_snapshot = true } Secure Example The following example will pass the aws-rds-specify-backup-retention check. resource \"aws_rds_cluster\" \"good_example\" { cluster_identifier = \"aurora-cluster-demo\" engine = \"aurora-mysql\" engine_version = \"5.7.mysql_aurora.2.03.2\" availability_zones = [ \"us-west-2a\", \"us-west-2b\", \"us-west-2c\" ] database_name = \"mydb\" master_username = \"foo\" master_password = \"bar\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster#backup_retention_period https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#backup_retention_period https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html#USER_WorkingWithAutomatedBackups.BackupRetention", "title": "RDS Cluster and RDS instance should have backup retention longer than default 1 day"}, {"location": "checks/aws/rds/specify-backup-retention/#rds-cluster-and-rds-instance-should-have-backup-retention-longer-than-default-1-day", "text": "", "title": "RDS Cluster and RDS instance should have backup retention longer than default 1 day"}, {"location": "checks/aws/rds/specify-backup-retention/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/rds/specify-backup-retention/#explanation", "text": "RDS backup retention for clusters defaults to 1 day, this may not be enough to identify and respond to an issue. Backup retention periods should be set to a period that is a balance on cost and limiting risk.", "title": "Explanation"}, {"location": "checks/aws/rds/specify-backup-retention/#possible-impact", "text": "Potential loss of data and short opportunity for recovery", "title": "Possible Impact"}, {"location": "checks/aws/rds/specify-backup-retention/#suggested-resolution", "text": "Explicitly set the retention period to greater than the default", "title": "Suggested Resolution"}, {"location": "checks/aws/rds/specify-backup-retention/#insecure-example", "text": "The following example will fail the aws-rds-specify-backup-retention check. resource \"aws_db_instance\" \"bad_example\" { allocated_storage = 10 engine = \"mysql\" engine_version = \"5.7\" instance_class = \"db.t3.micro\" name = \"mydb\" username = \"foo\" password = \"foobarbaz\" parameter_group_name = \"default.mysql5.7\" skip_final_snapshot = true }", "title": "Insecure Example"}, {"location": "checks/aws/rds/specify-backup-retention/#secure-example", "text": "The following example will pass the aws-rds-specify-backup-retention check. resource \"aws_rds_cluster\" \"good_example\" { cluster_identifier = \"aurora-cluster-demo\" engine = \"aurora-mysql\" engine_version = \"5.7.mysql_aurora.2.03.2\" availability_zones = [ \"us-west-2a\", \"us-west-2b\", \"us-west-2c\" ] database_name = \"mydb\" master_username = \"foo\" master_password = \"bar\" backup_retention_period = 5 preferred_backup_window = \"07:00-09:00\" }", "title": "Secure Example"}, {"location": "checks/aws/rds/specify-backup-retention/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster#backup_retention_period https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance#backup_retention_period https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html#USER_WorkingWithAutomatedBackups.BackupRetention", "title": "Links"}, {"location": "checks/aws/redshift/encryption-customer-key/", "text": "Redshift clusters should use at rest encryption Default Severity: high Explanation Redshift clusters that contain sensitive data or are subject to regulation should be encrypted at rest to prevent data leakage should the infrastructure be compromised. Possible Impact Data may be leaked if infrastructure is compromised Suggested Resolution Enable encryption using CMK Insecure Example The following example will fail the aws-redshift-encryption-customer-key check. resource \"aws_redshift_cluster\" \"bad_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" } Secure Example The following example will pass the aws-redshift-encryption-customer-key check. resource \"aws_kms_key\" \"redshift\" { enable_key_rotation = true } resource \"aws_redshift_cluster\" \"good_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" encrypted = true kms_key_id = aws_kms_key.redshift.key_id } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#encrypted https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html", "title": "encryption-customer-key"}, {"location": "checks/aws/redshift/encryption-customer-key/#redshift-clusters-should-use-at-rest-encryption", "text": "", "title": "Redshift clusters should use at rest encryption"}, {"location": "checks/aws/redshift/encryption-customer-key/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/redshift/encryption-customer-key/#explanation", "text": "Redshift clusters that contain sensitive data or are subject to regulation should be encrypted at rest to prevent data leakage should the infrastructure be compromised.", "title": "Explanation"}, {"location": "checks/aws/redshift/encryption-customer-key/#possible-impact", "text": "Data may be leaked if infrastructure is compromised", "title": "Possible Impact"}, {"location": "checks/aws/redshift/encryption-customer-key/#suggested-resolution", "text": "Enable encryption using CMK", "title": "Suggested Resolution"}, {"location": "checks/aws/redshift/encryption-customer-key/#insecure-example", "text": "The following example will fail the aws-redshift-encryption-customer-key check. resource \"aws_redshift_cluster\" \"bad_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" }", "title": "Insecure Example"}, {"location": "checks/aws/redshift/encryption-customer-key/#secure-example", "text": "The following example will pass the aws-redshift-encryption-customer-key check. resource \"aws_kms_key\" \"redshift\" { enable_key_rotation = true } resource \"aws_redshift_cluster\" \"good_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" encrypted = true kms_key_id = aws_kms_key.redshift.key_id }", "title": "Secure Example"}, {"location": "checks/aws/redshift/encryption-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#encrypted https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html", "title": "Links"}, {"location": "checks/aws/redshift/use-vpc/", "text": "Redshift cluster should be deployed into a specific VPC Default Severity: high Explanation Redshift clusters that are created without subnet details will be created in EC2 classic mode, meaning that they will be outside of a known VPC and running in tennant. In order to benefit from the additional security features achieved with using an owned VPC, the subnet should be set. Possible Impact Redshift cluster does not benefit from VPC security if it is deployed in EC2 classic mode Suggested Resolution Deploy Redshift cluster into a non default VPC Insecure Example The following example will fail the aws-redshift-use-vpc check. resource \"aws_redshift_cluster\" \"bad_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" } Secure Example The following example will pass the aws-redshift-use-vpc check. resource \"aws_redshift_cluster\" \"good_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" cluster_subnet_group_name = \"redshift_subnet\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#cluster_subnet_group_name https://docs.aws.amazon.com/redshift/latest/mgmt/managing-clusters-vpc.html", "title": "Redshift cluster should be deployed into a specific VPC"}, {"location": "checks/aws/redshift/use-vpc/#redshift-cluster-should-be-deployed-into-a-specific-vpc", "text": "", "title": "Redshift cluster should be deployed into a specific VPC"}, {"location": "checks/aws/redshift/use-vpc/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/redshift/use-vpc/#explanation", "text": "Redshift clusters that are created without subnet details will be created in EC2 classic mode, meaning that they will be outside of a known VPC and running in tennant. In order to benefit from the additional security features achieved with using an owned VPC, the subnet should be set.", "title": "Explanation"}, {"location": "checks/aws/redshift/use-vpc/#possible-impact", "text": "Redshift cluster does not benefit from VPC security if it is deployed in EC2 classic mode", "title": "Possible Impact"}, {"location": "checks/aws/redshift/use-vpc/#suggested-resolution", "text": "Deploy Redshift cluster into a non default VPC", "title": "Suggested Resolution"}, {"location": "checks/aws/redshift/use-vpc/#insecure-example", "text": "The following example will fail the aws-redshift-use-vpc check. resource \"aws_redshift_cluster\" \"bad_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" }", "title": "Insecure Example"}, {"location": "checks/aws/redshift/use-vpc/#secure-example", "text": "The following example will pass the aws-redshift-use-vpc check. resource \"aws_redshift_cluster\" \"good_example\" { cluster_identifier = \"tf-redshift-cluster\" database_name = \"mydb\" master_username = \"foo\" master_password = \"Mustbe8characters\" node_type = \"dc1.large\" cluster_type = \"single-node\" cluster_subnet_group_name = \"redshift_subnet\" }", "title": "Secure Example"}, {"location": "checks/aws/redshift/use-vpc/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/redshift_cluster#cluster_subnet_group_name https://docs.aws.amazon.com/redshift/latest/mgmt/managing-clusters-vpc.html", "title": "Links"}, {"location": "checks/aws/s3/block-public-acls/", "text": "S3 Access block should block public ACL Default Severity: high Explanation S3 buckets should block public ACLs on buckets and any objects they contain. By blocking, PUTs with fail if the object has any public ACL a. Possible Impact PUT calls with public ACLs specified can make objects public Suggested Resolution Enable blocking any PUT calls with a public ACL specified Insecure Example The following example will fail the aws-s3-block-public-acls check. resource \"aws_s3_bucket\" \"bad_example\" { bucket = \"mybucket\" } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.bad_example.id } Secure Example The following example will pass the aws-s3-block-public-acls check. resource \"aws_s3_bucket\" \"good_example\" { bucket = \"mybucket\" } resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.good_example.id block_public_acls = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#block_public_acls https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html", "title": "block-public-acls"}, {"location": "checks/aws/s3/block-public-acls/#s3-access-block-should-block-public-acl", "text": "", "title": "S3 Access block should block public ACL"}, {"location": "checks/aws/s3/block-public-acls/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/s3/block-public-acls/#explanation", "text": "S3 buckets should block public ACLs on buckets and any objects they contain. By blocking, PUTs with fail if the object has any public ACL a.", "title": "Explanation"}, {"location": "checks/aws/s3/block-public-acls/#possible-impact", "text": "PUT calls with public ACLs specified can make objects public", "title": "Possible Impact"}, {"location": "checks/aws/s3/block-public-acls/#suggested-resolution", "text": "Enable blocking any PUT calls with a public ACL specified", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/block-public-acls/#insecure-example", "text": "The following example will fail the aws-s3-block-public-acls check. resource \"aws_s3_bucket\" \"bad_example\" { bucket = \"mybucket\" } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.bad_example.id }", "title": "Insecure Example"}, {"location": "checks/aws/s3/block-public-acls/#secure-example", "text": "The following example will pass the aws-s3-block-public-acls check. resource \"aws_s3_bucket\" \"good_example\" { bucket = \"mybucket\" } resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.good_example.id block_public_acls = true }", "title": "Secure Example"}, {"location": "checks/aws/s3/block-public-acls/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#block_public_acls https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html", "title": "Links"}, {"location": "checks/aws/s3/block-public-policy/", "text": "S3 Access block should block public policy Default Severity: high Explanation S3 bucket policy should have block public policy to prevent users from putting a policy that enable public access. Possible Impact Users could put a policy that allows public access Suggested Resolution Prevent policies that allow public access being PUT Insecure Example The following example will fail the aws-s3-block-public-policy check. resource \"aws_s3_bucket\" \"example\" { bucket = \"mybucket\" } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id block_public_policy = false } Secure Example The following example will pass the aws-s3-block-public-policy check. resource \"aws_s3_bucket\" \"example\" { bucket = \"mybucket\" } resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id block_public_policy = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#block_public_policy https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html", "title": "block-public-policy"}, {"location": "checks/aws/s3/block-public-policy/#s3-access-block-should-block-public-policy", "text": "", "title": "S3 Access block should block public policy"}, {"location": "checks/aws/s3/block-public-policy/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/s3/block-public-policy/#explanation", "text": "S3 bucket policy should have block public policy to prevent users from putting a policy that enable public access.", "title": "Explanation"}, {"location": "checks/aws/s3/block-public-policy/#possible-impact", "text": "Users could put a policy that allows public access", "title": "Possible Impact"}, {"location": "checks/aws/s3/block-public-policy/#suggested-resolution", "text": "Prevent policies that allow public access being PUT", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/block-public-policy/#insecure-example", "text": "The following example will fail the aws-s3-block-public-policy check. resource \"aws_s3_bucket\" \"example\" { bucket = \"mybucket\" } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id block_public_policy = false }", "title": "Insecure Example"}, {"location": "checks/aws/s3/block-public-policy/#secure-example", "text": "The following example will pass the aws-s3-block-public-policy check. resource \"aws_s3_bucket\" \"example\" { bucket = \"mybucket\" } resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id block_public_policy = true }", "title": "Secure Example"}, {"location": "checks/aws/s3/block-public-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#block_public_policy https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html", "title": "Links"}, {"location": "checks/aws/s3/enable-bucket-encryption/", "text": "Unencrypted S3 bucket. Default Severity: high Explanation S3 Buckets should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific buckets. Possible Impact The bucket objects could be read if compromised Suggested Resolution Configure bucket encryption Insecure Example The following example will fail the aws-s3-enable-bucket-encryption check. resource \"aws_s3_bucket\" \"bad_example\" { bucket = \"mybucket\" } Secure Example The following example will pass the aws-s3-enable-bucket-encryption check. resource \"aws_s3_bucket\" \"good_example\" { bucket = \"mybucket\" server_side_encryption_configuration { rule { apply_server_side_encryption_by_default { kms_master_key_id = \"arn\" sse_algorithm = \"aws:kms\" } } } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#enable-default-server-side-encryption https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html", "title": "enable-bucket-encryption"}, {"location": "checks/aws/s3/enable-bucket-encryption/#unencrypted-s3-bucket", "text": "", "title": "Unencrypted S3 bucket."}, {"location": "checks/aws/s3/enable-bucket-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/s3/enable-bucket-encryption/#explanation", "text": "S3 Buckets should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific buckets.", "title": "Explanation"}, {"location": "checks/aws/s3/enable-bucket-encryption/#possible-impact", "text": "The bucket objects could be read if compromised", "title": "Possible Impact"}, {"location": "checks/aws/s3/enable-bucket-encryption/#suggested-resolution", "text": "Configure bucket encryption", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/enable-bucket-encryption/#insecure-example", "text": "The following example will fail the aws-s3-enable-bucket-encryption check. resource \"aws_s3_bucket\" \"bad_example\" { bucket = \"mybucket\" }", "title": "Insecure Example"}, {"location": "checks/aws/s3/enable-bucket-encryption/#secure-example", "text": "The following example will pass the aws-s3-enable-bucket-encryption check. resource \"aws_s3_bucket\" \"good_example\" { bucket = \"mybucket\" server_side_encryption_configuration { rule { apply_server_side_encryption_by_default { kms_master_key_id = \"arn\" sse_algorithm = \"aws:kms\" } } } }", "title": "Secure Example"}, {"location": "checks/aws/s3/enable-bucket-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#enable-default-server-side-encryption https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html", "title": "Links"}, {"location": "checks/aws/s3/enable-bucket-logging/", "text": "S3 Bucket does not have logging enabled. Default Severity: medium Explanation Buckets should have logging enabled so that access can be audited. Possible Impact There is no way to determine the access to this bucket Suggested Resolution Add a logging block to the resource to enable access logging Insecure Example The following example will fail the aws-s3-enable-bucket-logging check. resource \"aws_s3_bucket\" \"bad_example\" { } Secure Example The following example will pass the aws-s3-enable-bucket-logging check. resource \"aws_s3_bucket\" \"good_example\" { logging { target_bucket = \"target-bucket\" } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html", "title": "enable-bucket-logging"}, {"location": "checks/aws/s3/enable-bucket-logging/#s3-bucket-does-not-have-logging-enabled", "text": "", "title": "S3 Bucket does not have logging enabled."}, {"location": "checks/aws/s3/enable-bucket-logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/s3/enable-bucket-logging/#explanation", "text": "Buckets should have logging enabled so that access can be audited.", "title": "Explanation"}, {"location": "checks/aws/s3/enable-bucket-logging/#possible-impact", "text": "There is no way to determine the access to this bucket", "title": "Possible Impact"}, {"location": "checks/aws/s3/enable-bucket-logging/#suggested-resolution", "text": "Add a logging block to the resource to enable access logging", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/enable-bucket-logging/#insecure-example", "text": "The following example will fail the aws-s3-enable-bucket-logging check. resource \"aws_s3_bucket\" \"bad_example\" { }", "title": "Insecure Example"}, {"location": "checks/aws/s3/enable-bucket-logging/#secure-example", "text": "The following example will pass the aws-s3-enable-bucket-logging check. resource \"aws_s3_bucket\" \"good_example\" { logging { target_bucket = \"target-bucket\" } }", "title": "Secure Example"}, {"location": "checks/aws/s3/enable-bucket-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html", "title": "Links"}, {"location": "checks/aws/s3/enable-versioning/", "text": "S3 Data should be versioned Default Severity: medium Explanation Versioning in Amazon S3 is a means of keeping multiple variants of an object in the same bucket. You can use the S3 Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures. Possible Impact Deleted or modified data would not be recoverable Suggested Resolution Enable versioning to protect against accidental/malicious removal or modification Insecure Example The following example will fail the aws-s3-enable-versioning check. resource \"aws_s3_bucket\" \"bad_example\" { } Secure Example The following example will pass the aws-s3-enable-versioning check. resource \"aws_s3_bucket\" \"good_example\" { versioning { enabled = true } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#versioning https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html", "title": "enable-versioning"}, {"location": "checks/aws/s3/enable-versioning/#s3-data-should-be-versioned", "text": "", "title": "S3 Data should be versioned"}, {"location": "checks/aws/s3/enable-versioning/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/aws/s3/enable-versioning/#explanation", "text": "Versioning in Amazon S3 is a means of keeping multiple variants of an object in the same bucket. You can use the S3 Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures.", "title": "Explanation"}, {"location": "checks/aws/s3/enable-versioning/#possible-impact", "text": "Deleted or modified data would not be recoverable", "title": "Possible Impact"}, {"location": "checks/aws/s3/enable-versioning/#suggested-resolution", "text": "Enable versioning to protect against accidental/malicious removal or modification", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/enable-versioning/#insecure-example", "text": "The following example will fail the aws-s3-enable-versioning check. resource \"aws_s3_bucket\" \"bad_example\" { }", "title": "Insecure Example"}, {"location": "checks/aws/s3/enable-versioning/#secure-example", "text": "The following example will pass the aws-s3-enable-versioning check. resource \"aws_s3_bucket\" \"good_example\" { versioning { enabled = true } }", "title": "Secure Example"}, {"location": "checks/aws/s3/enable-versioning/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#versioning https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html", "title": "Links"}, {"location": "checks/aws/s3/ignore-public-acls/", "text": "S3 Access Block should Ignore Public Acl Default Severity: high Explanation S3 buckets should ignore public ACLs on buckets and any objects they contain. By ignoring rather than blocking, PUT calls with public ACLs will still be applied but the ACL will be ignored. Possible Impact PUT calls with public ACLs specified can make objects public Suggested Resolution Enable ignoring the application of public ACLs in PUT calls Insecure Example The following example will fail the aws-s3-ignore-public-acls check. resource \"aws_s3_bucket\" \"example\" { bucket = \"bucket\" } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id ignore_public_acls = false } Secure Example The following example will pass the aws-s3-ignore-public-acls check. resource \"aws_s3_bucket\" \"example\" { bucket = \"bucket\" } resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id ignore_public_acls = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#ignore_public_acls https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html", "title": "ignore-public-acls"}, {"location": "checks/aws/s3/ignore-public-acls/#s3-access-block-should-ignore-public-acl", "text": "", "title": "S3 Access Block should Ignore Public Acl"}, {"location": "checks/aws/s3/ignore-public-acls/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/s3/ignore-public-acls/#explanation", "text": "S3 buckets should ignore public ACLs on buckets and any objects they contain. By ignoring rather than blocking, PUT calls with public ACLs will still be applied but the ACL will be ignored.", "title": "Explanation"}, {"location": "checks/aws/s3/ignore-public-acls/#possible-impact", "text": "PUT calls with public ACLs specified can make objects public", "title": "Possible Impact"}, {"location": "checks/aws/s3/ignore-public-acls/#suggested-resolution", "text": "Enable ignoring the application of public ACLs in PUT calls", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/ignore-public-acls/#insecure-example", "text": "The following example will fail the aws-s3-ignore-public-acls check. resource \"aws_s3_bucket\" \"example\" { bucket = \"bucket\" } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id ignore_public_acls = false }", "title": "Insecure Example"}, {"location": "checks/aws/s3/ignore-public-acls/#secure-example", "text": "The following example will pass the aws-s3-ignore-public-acls check. resource \"aws_s3_bucket\" \"example\" { bucket = \"bucket\" } resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id ignore_public_acls = true }", "title": "Secure Example"}, {"location": "checks/aws/s3/ignore-public-acls/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#ignore_public_acls https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html", "title": "Links"}, {"location": "checks/aws/s3/no-public-access-with-acl/", "text": "S3 Bucket does not have logging enabled. Default Severity: high Explanation Buckets should have logging enabled so that access can be audited. Possible Impact There is no way to determine the access to this bucket Suggested Resolution Add a logging block to the resource to enable access logging Insecure Example The following example will fail the aws-s3-no-public-access-with-acl check. resource \"aws_s3_bucket\" \"bad_example\" { acl = \"public-read\" } Secure Example The following example will pass the aws-s3-no-public-access-with-acl check. resource \"aws_s3_bucket\" \"good_example\" { acl = \"private\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html", "title": "no-public-access-with-acl"}, {"location": "checks/aws/s3/no-public-access-with-acl/#s3-bucket-does-not-have-logging-enabled", "text": "", "title": "S3 Bucket does not have logging enabled."}, {"location": "checks/aws/s3/no-public-access-with-acl/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/s3/no-public-access-with-acl/#explanation", "text": "Buckets should have logging enabled so that access can be audited.", "title": "Explanation"}, {"location": "checks/aws/s3/no-public-access-with-acl/#possible-impact", "text": "There is no way to determine the access to this bucket", "title": "Possible Impact"}, {"location": "checks/aws/s3/no-public-access-with-acl/#suggested-resolution", "text": "Add a logging block to the resource to enable access logging", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/no-public-access-with-acl/#insecure-example", "text": "The following example will fail the aws-s3-no-public-access-with-acl check. resource \"aws_s3_bucket\" \"bad_example\" { acl = \"public-read\" }", "title": "Insecure Example"}, {"location": "checks/aws/s3/no-public-access-with-acl/#secure-example", "text": "The following example will pass the aws-s3-no-public-access-with-acl check. resource \"aws_s3_bucket\" \"good_example\" { acl = \"private\" }", "title": "Secure Example"}, {"location": "checks/aws/s3/no-public-access-with-acl/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html", "title": "Links"}, {"location": "checks/aws/s3/no-public-buckets/", "text": "S3 Access block should restrict public bucket to limit access Default Severity: high Explanation S3 buckets should restrict public policies for the bucket. By enabling, the restrict_public_buckets, only the bucket owner and AWS Services can access if it has a public policy. Possible Impact Public buckets can be accessed by anyone Suggested Resolution Limit the access to public buckets to only the owner or AWS Services (eg; CloudFront) Insecure Example The following example will fail the aws-s3-no-public-buckets check. resource \"aws_s3_bucket\" \"example\" { bucket = \"bucket\" } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id restrict_public_buckets = false } Secure Example The following example will pass the aws-s3-no-public-buckets check. resource \"aws_s3_bucket\" \"example\" { bucket = \"bucket\" } resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id restrict_public_buckets = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#restrict_public_buckets\u00a1 https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html", "title": "no-public-buckets"}, {"location": "checks/aws/s3/no-public-buckets/#s3-access-block-should-restrict-public-bucket-to-limit-access", "text": "", "title": "S3 Access block should restrict public bucket to limit access"}, {"location": "checks/aws/s3/no-public-buckets/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/s3/no-public-buckets/#explanation", "text": "S3 buckets should restrict public policies for the bucket. By enabling, the restrict_public_buckets, only the bucket owner and AWS Services can access if it has a public policy.", "title": "Explanation"}, {"location": "checks/aws/s3/no-public-buckets/#possible-impact", "text": "Public buckets can be accessed by anyone", "title": "Possible Impact"}, {"location": "checks/aws/s3/no-public-buckets/#suggested-resolution", "text": "Limit the access to public buckets to only the owner or AWS Services (eg; CloudFront)", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/no-public-buckets/#insecure-example", "text": "The following example will fail the aws-s3-no-public-buckets check. resource \"aws_s3_bucket\" \"example\" { bucket = \"bucket\" } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id } resource \"aws_s3_bucket_public_access_block\" \"bad_example\" { bucket = aws_s3_bucket.example.id restrict_public_buckets = false }", "title": "Insecure Example"}, {"location": "checks/aws/s3/no-public-buckets/#secure-example", "text": "The following example will pass the aws-s3-no-public-buckets check. resource \"aws_s3_bucket\" \"example\" { bucket = \"bucket\" } resource \"aws_s3_bucket_public_access_block\" \"good_example\" { bucket = aws_s3_bucket.example.id restrict_public_buckets = true }", "title": "Secure Example"}, {"location": "checks/aws/s3/no-public-buckets/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#restrict_public_buckets\u00a1 https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html", "title": "Links"}, {"location": "checks/aws/s3/specify-public-access-block/", "text": "S3 buckets should each define an aws_s3_bucket_public_access_block Default Severity: low Explanation The \"block public access\" settings in S3 override individual policies that apply to a given bucket, meaning that all public access can be controlled in one central types for that bucket. It is therefore good practice to define these settings for each bucket in order to clearly define the public access that can be allowed for it. Possible Impact Public access policies may be applied to sensitive data buckets Suggested Resolution Define a aws_s3_bucket_public_access_block for the given bucket to control public access policies Insecure Example The following example will fail the aws-s3-specify-public-access-block check. resource \"aws_s3_bucket\" \"example\" { bucket = \"example\" acl = \"private-read\" } Secure Example The following example will pass the aws-s3-specify-public-access-block check. resource \"aws_s3_bucket\" \"example\" { bucket = \"example\" acl = \"private-read\" } resource \"aws_s3_bucket_public_access_block\" \"example\" { bucket = aws_s3_bucket.example.id block_public_acls = true block_public_policy = true } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#bucket https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html", "title": "specify-public-access-block"}, {"location": "checks/aws/s3/specify-public-access-block/#s3-buckets-should-each-define-an-aws_s3_bucket_public_access_block", "text": "", "title": "S3 buckets should each define an aws_s3_bucket_public_access_block"}, {"location": "checks/aws/s3/specify-public-access-block/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/s3/specify-public-access-block/#explanation", "text": "The \"block public access\" settings in S3 override individual policies that apply to a given bucket, meaning that all public access can be controlled in one central types for that bucket. It is therefore good practice to define these settings for each bucket in order to clearly define the public access that can be allowed for it.", "title": "Explanation"}, {"location": "checks/aws/s3/specify-public-access-block/#possible-impact", "text": "Public access policies may be applied to sensitive data buckets", "title": "Possible Impact"}, {"location": "checks/aws/s3/specify-public-access-block/#suggested-resolution", "text": "Define a aws_s3_bucket_public_access_block for the given bucket to control public access policies", "title": "Suggested Resolution"}, {"location": "checks/aws/s3/specify-public-access-block/#insecure-example", "text": "The following example will fail the aws-s3-specify-public-access-block check. resource \"aws_s3_bucket\" \"example\" { bucket = \"example\" acl = \"private-read\" }", "title": "Insecure Example"}, {"location": "checks/aws/s3/specify-public-access-block/#secure-example", "text": "The following example will pass the aws-s3-specify-public-access-block check. resource \"aws_s3_bucket\" \"example\" { bucket = \"example\" acl = \"private-read\" } resource \"aws_s3_bucket_public_access_block\" \"example\" { bucket = aws_s3_bucket.example.id block_public_acls = true block_public_policy = true }", "title": "Secure Example"}, {"location": "checks/aws/s3/specify-public-access-block/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block#bucket https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html", "title": "Links"}, {"location": "checks/aws/sns/enable-topic-encryption/", "text": "Unencrypted SNS topic. Default Severity: high Explanation Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues. Possible Impact The SNS topic messages could be read if compromised Suggested Resolution Turn on SNS Topic encryption Insecure Example The following example will fail the aws-sns-enable-topic-encryption check. resource \"aws_sns_topic\" \"bad_example\" { # no key id specified } Secure Example The following example will pass the aws-sns-enable-topic-encryption check. resource \"aws_sns_topic\" \"good_example\" { kms_master_key_id = \"/blah\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic#example-with-server-side-encryption-sse https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html", "title": "enable-topic-encryption"}, {"location": "checks/aws/sns/enable-topic-encryption/#unencrypted-sns-topic", "text": "", "title": "Unencrypted SNS topic."}, {"location": "checks/aws/sns/enable-topic-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/sns/enable-topic-encryption/#explanation", "text": "Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues.", "title": "Explanation"}, {"location": "checks/aws/sns/enable-topic-encryption/#possible-impact", "text": "The SNS topic messages could be read if compromised", "title": "Possible Impact"}, {"location": "checks/aws/sns/enable-topic-encryption/#suggested-resolution", "text": "Turn on SNS Topic encryption", "title": "Suggested Resolution"}, {"location": "checks/aws/sns/enable-topic-encryption/#insecure-example", "text": "The following example will fail the aws-sns-enable-topic-encryption check. resource \"aws_sns_topic\" \"bad_example\" { # no key id specified }", "title": "Insecure Example"}, {"location": "checks/aws/sns/enable-topic-encryption/#secure-example", "text": "The following example will pass the aws-sns-enable-topic-encryption check. resource \"aws_sns_topic\" \"good_example\" { kms_master_key_id = \"/blah\" }", "title": "Secure Example"}, {"location": "checks/aws/sns/enable-topic-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic#example-with-server-side-encryption-sse https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html", "title": "Links"}, {"location": "checks/aws/sqs/enable-queue-encryption/", "text": "Unencrypted SQS queue. Default Severity: high Explanation Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues. Possible Impact The SQS queue messages could be read if compromised Suggested Resolution Turn on SQS Queue encryption Insecure Example The following example will fail the aws-sqs-enable-queue-encryption check. resource \"aws_sqs_queue\" \"bad_example\" { # no key specified } Secure Example The following example will pass the aws-sqs-enable-queue-encryption check. resource \"aws_sqs_queue\" \"good_example\" { kms_master_key_id = \"/blah\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue#server-side-encryption-sse https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html", "title": "enable-queue-encryption"}, {"location": "checks/aws/sqs/enable-queue-encryption/#unencrypted-sqs-queue", "text": "", "title": "Unencrypted SQS queue."}, {"location": "checks/aws/sqs/enable-queue-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/sqs/enable-queue-encryption/#explanation", "text": "Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues.", "title": "Explanation"}, {"location": "checks/aws/sqs/enable-queue-encryption/#possible-impact", "text": "The SQS queue messages could be read if compromised", "title": "Possible Impact"}, {"location": "checks/aws/sqs/enable-queue-encryption/#suggested-resolution", "text": "Turn on SQS Queue encryption", "title": "Suggested Resolution"}, {"location": "checks/aws/sqs/enable-queue-encryption/#insecure-example", "text": "The following example will fail the aws-sqs-enable-queue-encryption check. resource \"aws_sqs_queue\" \"bad_example\" { # no key specified }", "title": "Insecure Example"}, {"location": "checks/aws/sqs/enable-queue-encryption/#secure-example", "text": "The following example will pass the aws-sqs-enable-queue-encryption check. resource \"aws_sqs_queue\" \"good_example\" { kms_master_key_id = \"/blah\" }", "title": "Secure Example"}, {"location": "checks/aws/sqs/enable-queue-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue#server-side-encryption-sse https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html", "title": "Links"}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/", "text": "AWS SQS policy document has wildcard action statement. Default Severity: high Explanation SQS Policy actions should always be restricted to a specific set. This ensures that the queue itself cannot be modified or deleted, and prevents possible future additions to queue actions to be implicitly allowed. Possible Impact SQS policies with wildcard actions allow more that is required Suggested Resolution Keep policy scope to the minimum that is required to be effective Insecure Example The following example will fail the aws-sqs-no-wildcards-in-policy-documents check. resource \"aws_sqs_queue_policy\" \"bad_example\" { queue_url = aws_sqs_queue.q.id policy = << POLICY { \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": \"*\", \"Action\": \"*\" } ] } POLICY } { \"Statement\" : [ { \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : \"*\" } ] } POLICY } Secure Example The following example will pass the aws-sqs-no-wildcards-in-policy-documents check. resource \"aws_sqs_queue_policy\" \"good_example\" { queue_url = aws_sqs_queue.q.id policy = << POLICY { \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": \"*\", \"Action\": \"sqs:SendMessage\" } ] } POLICY } { \"Statement\" : [ { \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : \"sqs:SendMessage\" } ] } POLICY } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue_policy https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html", "title": "no-wildcards-in-policy-documents"}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/#aws-sqs-policy-document-has-wildcard-action-statement", "text": "", "title": "AWS SQS policy document has wildcard action statement."}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/#explanation", "text": "SQS Policy actions should always be restricted to a specific set. This ensures that the queue itself cannot be modified or deleted, and prevents possible future additions to queue actions to be implicitly allowed.", "title": "Explanation"}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/#possible-impact", "text": "SQS policies with wildcard actions allow more that is required", "title": "Possible Impact"}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/#suggested-resolution", "text": "Keep policy scope to the minimum that is required to be effective", "title": "Suggested Resolution"}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/#insecure-example", "text": "The following example will fail the aws-sqs-no-wildcards-in-policy-documents check. resource \"aws_sqs_queue_policy\" \"bad_example\" { queue_url = aws_sqs_queue.q.id policy = << POLICY { \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": \"*\", \"Action\": \"*\" } ] } POLICY } { \"Statement\" : [ { \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : \"*\" } ] } POLICY }", "title": "Insecure Example"}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/#secure-example", "text": "The following example will pass the aws-sqs-no-wildcards-in-policy-documents check. resource \"aws_sqs_queue_policy\" \"good_example\" { queue_url = aws_sqs_queue.q.id policy = << POLICY { \"Statement\": [ { \"Effect\": \"Allow\", \"Principal\": \"*\", \"Action\": \"sqs:SendMessage\" } ] } POLICY } { \"Statement\" : [ { \"Effect\" : \"Allow\" , \"Principal\" : \"*\" , \"Action\" : \"sqs:SendMessage\" } ] } POLICY }", "title": "Secure Example"}, {"location": "checks/aws/sqs/no-wildcards-in-policy-documents/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue_policy https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html", "title": "Links"}, {"location": "checks/aws/ssm/secret-use-customer-key/", "text": "Secrets Manager should use customer managed keys Default Severity: low Explanation Secrets Manager encrypts secrets by default using a default key created by AWS. To ensure control and granularity of secret encryption, CMK's should be used explicitly. Possible Impact Using AWS managed keys reduces the flexibility and control over the encryption key Suggested Resolution Use customer managed keys Insecure Example The following example will fail the aws-ssm-secret-use-customer-key check. resource \"aws_secretsmanager_secret\" \"bad_example\" { name = \"lambda_password\" } Secure Example The following example will pass the aws-ssm-secret-use-customer-key check. resource \"aws_kms_key\" \"secrets\" { enable_key_rotation = true } resource \"aws_secretsmanager_secret\" \"good_example\" { name = \"lambda_password\" kms_key_id = aws_kms_key.secrets.arn } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret#kms_key_id https://docs.aws.amazon.com/kms/latest/developerguide/services-secrets-manager.html#asm-encrypt", "title": "secret-use-customer-key"}, {"location": "checks/aws/ssm/secret-use-customer-key/#secrets-manager-should-use-customer-managed-keys", "text": "", "title": "Secrets Manager should use customer managed keys"}, {"location": "checks/aws/ssm/secret-use-customer-key/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/ssm/secret-use-customer-key/#explanation", "text": "Secrets Manager encrypts secrets by default using a default key created by AWS. To ensure control and granularity of secret encryption, CMK's should be used explicitly.", "title": "Explanation"}, {"location": "checks/aws/ssm/secret-use-customer-key/#possible-impact", "text": "Using AWS managed keys reduces the flexibility and control over the encryption key", "title": "Possible Impact"}, {"location": "checks/aws/ssm/secret-use-customer-key/#suggested-resolution", "text": "Use customer managed keys", "title": "Suggested Resolution"}, {"location": "checks/aws/ssm/secret-use-customer-key/#insecure-example", "text": "The following example will fail the aws-ssm-secret-use-customer-key check. resource \"aws_secretsmanager_secret\" \"bad_example\" { name = \"lambda_password\" }", "title": "Insecure Example"}, {"location": "checks/aws/ssm/secret-use-customer-key/#secure-example", "text": "The following example will pass the aws-ssm-secret-use-customer-key check. resource \"aws_kms_key\" \"secrets\" { enable_key_rotation = true } resource \"aws_secretsmanager_secret\" \"good_example\" { name = \"lambda_password\" kms_key_id = aws_kms_key.secrets.arn }", "title": "Secure Example"}, {"location": "checks/aws/ssm/secret-use-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret#kms_key_id https://docs.aws.amazon.com/kms/latest/developerguide/services-secrets-manager.html#asm-encrypt", "title": "Links"}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/", "text": "Missing description for security group rule. Default Severity: low Explanation Security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups rules Insecure Example The following example will fail the aws-vpc-add-description-to-security-group-rule check. resource \"aws_security_group\" \"bad_example\" { name = \"http\" ingress { from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Secure Example The following example will pass the aws-vpc-add-description-to-security-group-rule check. resource \"aws_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html", "title": "Missing description for security group rule."}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/#missing-description-for-security-group-rule", "text": "", "title": "Missing description for security group rule."}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/#explanation", "text": "Security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.", "title": "Explanation"}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/#possible-impact", "text": "Descriptions provide context for the firewall rule reasons", "title": "Possible Impact"}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/#suggested-resolution", "text": "Add descriptions for all security groups rules", "title": "Suggested Resolution"}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/#insecure-example", "text": "The following example will fail the aws-vpc-add-description-to-security-group-rule check. resource \"aws_security_group\" \"bad_example\" { name = \"http\" ingress { from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }", "title": "Insecure Example"}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/#secure-example", "text": "The following example will pass the aws-vpc-add-description-to-security-group-rule check. resource \"aws_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }", "title": "Secure Example"}, {"location": "checks/aws/vpc/add-description-to-security-group-rule/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html", "title": "Links"}, {"location": "checks/aws/vpc/add-description-to-security-group/", "text": "Missing description for security group. Default Severity: low Explanation Security groups should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups Insecure Example The following example will fail the aws-vpc-add-description-to-security-group check. resource \"aws_security_group\" \"bad_example\" { name = \"http\" description = \"\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Secure Example The following example will pass the aws-vpc-add-description-to-security-group check. resource \"aws_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html", "title": "add-description-to-security-group"}, {"location": "checks/aws/vpc/add-description-to-security-group/#missing-description-for-security-group", "text": "", "title": "Missing description for security group."}, {"location": "checks/aws/vpc/add-description-to-security-group/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/aws/vpc/add-description-to-security-group/#explanation", "text": "Security groups should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.", "title": "Explanation"}, {"location": "checks/aws/vpc/add-description-to-security-group/#possible-impact", "text": "Descriptions provide context for the firewall rule reasons", "title": "Possible Impact"}, {"location": "checks/aws/vpc/add-description-to-security-group/#suggested-resolution", "text": "Add descriptions for all security groups", "title": "Suggested Resolution"}, {"location": "checks/aws/vpc/add-description-to-security-group/#insecure-example", "text": "The following example will fail the aws-vpc-add-description-to-security-group check. resource \"aws_security_group\" \"bad_example\" { name = \"http\" description = \"\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }", "title": "Insecure Example"}, {"location": "checks/aws/vpc/add-description-to-security-group/#secure-example", "text": "The following example will pass the aws-vpc-add-description-to-security-group check. resource \"aws_security_group\" \"good_example\" { name = \"http\" description = \"Allow inbound HTTP traffic\" ingress { description = \"HTTP from VPC\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ aws_vpc.main.cidr_block ] } }", "title": "Secure Example"}, {"location": "checks/aws/vpc/add-description-to-security-group/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html", "title": "Links"}, {"location": "checks/aws/vpc/no-default-vpc/", "text": "AWS best practice to not use the default VPC for workflows Default Severity: high Explanation Default VPC does not have a lot of the critical security features that standard VPC comes with, new resources should not be created in the default VPC and it should not be present in the Terraform. Possible Impact The default VPC does not have critical security features applied Suggested Resolution Create a non-default vpc for resources to be created in Insecure Example The following example will fail the aws-vpc-no-default-vpc check. resource \"aws_default_vpc\" \"default\" { tags = { Name = \"Default VPC\" } } Secure Example The following example will pass the aws-vpc-no-default-vpc check. # no aws default vpc present Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_vpc https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html", "title": "no-default-vpc"}, {"location": "checks/aws/vpc/no-default-vpc/#aws-best-practice-to-not-use-the-default-vpc-for-workflows", "text": "", "title": "AWS best practice to not use the default VPC for workflows"}, {"location": "checks/aws/vpc/no-default-vpc/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/vpc/no-default-vpc/#explanation", "text": "Default VPC does not have a lot of the critical security features that standard VPC comes with, new resources should not be created in the default VPC and it should not be present in the Terraform.", "title": "Explanation"}, {"location": "checks/aws/vpc/no-default-vpc/#possible-impact", "text": "The default VPC does not have critical security features applied", "title": "Possible Impact"}, {"location": "checks/aws/vpc/no-default-vpc/#suggested-resolution", "text": "Create a non-default vpc for resources to be created in", "title": "Suggested Resolution"}, {"location": "checks/aws/vpc/no-default-vpc/#insecure-example", "text": "The following example will fail the aws-vpc-no-default-vpc check. resource \"aws_default_vpc\" \"default\" { tags = { Name = \"Default VPC\" } }", "title": "Insecure Example"}, {"location": "checks/aws/vpc/no-default-vpc/#secure-example", "text": "The following example will pass the aws-vpc-no-default-vpc check. # no aws default vpc present", "title": "Secure Example"}, {"location": "checks/aws/vpc/no-default-vpc/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_vpc https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html", "title": "Links"}, {"location": "checks/aws/vpc/no-excessive-port-access/", "text": "An ingress Network ACL rule allows ALL ports. Default Severity: critical Explanation Ensure access to specific required ports is allowed, and nothing else. Possible Impact All ports exposed for egressing data Suggested Resolution Set specific allowed ports Insecure Example The following example will fail the aws-vpc-no-excessive-port-access check. resource \"aws_network_acl_rule\" \"bad_example\" { egress = false protocol = \"all\" rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" } Secure Example The following example will pass the aws-vpc-no-excessive-port-access check. resource \"aws_network_acl_rule\" \"good_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule#to_port https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html", "title": "no-excessive-port-access"}, {"location": "checks/aws/vpc/no-excessive-port-access/#an-ingress-network-acl-rule-allows-all-ports", "text": "", "title": "An ingress Network ACL rule allows ALL ports."}, {"location": "checks/aws/vpc/no-excessive-port-access/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/vpc/no-excessive-port-access/#explanation", "text": "Ensure access to specific required ports is allowed, and nothing else.", "title": "Explanation"}, {"location": "checks/aws/vpc/no-excessive-port-access/#possible-impact", "text": "All ports exposed for egressing data", "title": "Possible Impact"}, {"location": "checks/aws/vpc/no-excessive-port-access/#suggested-resolution", "text": "Set specific allowed ports", "title": "Suggested Resolution"}, {"location": "checks/aws/vpc/no-excessive-port-access/#insecure-example", "text": "The following example will fail the aws-vpc-no-excessive-port-access check. resource \"aws_network_acl_rule\" \"bad_example\" { egress = false protocol = \"all\" rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" }", "title": "Insecure Example"}, {"location": "checks/aws/vpc/no-excessive-port-access/#secure-example", "text": "The following example will pass the aws-vpc-no-excessive-port-access check. resource \"aws_network_acl_rule\" \"good_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" }", "title": "Secure Example"}, {"location": "checks/aws/vpc/no-excessive-port-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule#to_port https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html", "title": "Links"}, {"location": "checks/aws/vpc/no-public-egress-sgr/", "text": "An egress security group rule allows traffic to /0. Default Severity: critical Explanation Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible. Possible Impact Your port is egressing data to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the aws-vpc-no-public-egress-sgr check. resource \"aws_security_group\" \"bad_example\" { egress { cidr_blocks = [ \"0.0.0.0/0\" ] } } Secure Example The following example will pass the aws-vpc-no-public-egress-sgr check. resource \"aws_security_group\" \"good_example\" { egress { cidr_blocks = [ \"1.2.3.4/32\" ] } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://docs.aws.amazon.com/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/centralized-egress-to-internet.html", "title": "no-public-egress-sgr"}, {"location": "checks/aws/vpc/no-public-egress-sgr/#an-egress-security-group-rule-allows-traffic-to-0", "text": "", "title": "An egress security group rule allows traffic to /0."}, {"location": "checks/aws/vpc/no-public-egress-sgr/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/vpc/no-public-egress-sgr/#explanation", "text": "Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible.", "title": "Explanation"}, {"location": "checks/aws/vpc/no-public-egress-sgr/#possible-impact", "text": "Your port is egressing data to the internet", "title": "Possible Impact"}, {"location": "checks/aws/vpc/no-public-egress-sgr/#suggested-resolution", "text": "Set a more restrictive cidr range", "title": "Suggested Resolution"}, {"location": "checks/aws/vpc/no-public-egress-sgr/#insecure-example", "text": "The following example will fail the aws-vpc-no-public-egress-sgr check. resource \"aws_security_group\" \"bad_example\" { egress { cidr_blocks = [ \"0.0.0.0/0\" ] } }", "title": "Insecure Example"}, {"location": "checks/aws/vpc/no-public-egress-sgr/#secure-example", "text": "The following example will pass the aws-vpc-no-public-egress-sgr check. resource \"aws_security_group\" \"good_example\" { egress { cidr_blocks = [ \"1.2.3.4/32\" ] } }", "title": "Secure Example"}, {"location": "checks/aws/vpc/no-public-egress-sgr/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group https://docs.aws.amazon.com/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/centralized-egress-to-internet.html", "title": "Links"}, {"location": "checks/aws/vpc/no-public-ingress-acl/", "text": "An ingress Network ACL rule allows specific ports from /0. Default Severity: critical Explanation Opening up ACLs to the public internet is potentially dangerous. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact The ports are exposed for ingressing data to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the aws-vpc-no-public-ingress-acl check. resource \"aws_network_acl_rule\" \"bad_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" } Secure Example The following example will pass the aws-vpc-no-public-ingress-acl check. resource \"aws_network_acl_rule\" \"good_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"10.0.0.0/16\" } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule#cidr_block https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html", "title": "An ingress Network ACL rule allows specific ports from /0."}, {"location": "checks/aws/vpc/no-public-ingress-acl/#an-ingress-network-acl-rule-allows-specific-ports-from-0", "text": "", "title": "An ingress Network ACL rule allows specific ports from /0."}, {"location": "checks/aws/vpc/no-public-ingress-acl/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/vpc/no-public-ingress-acl/#explanation", "text": "Opening up ACLs to the public internet is potentially dangerous. You should restrict access to IP addresses or ranges that explicitly require it where possible.", "title": "Explanation"}, {"location": "checks/aws/vpc/no-public-ingress-acl/#possible-impact", "text": "The ports are exposed for ingressing data to the internet", "title": "Possible Impact"}, {"location": "checks/aws/vpc/no-public-ingress-acl/#suggested-resolution", "text": "Set a more restrictive cidr range", "title": "Suggested Resolution"}, {"location": "checks/aws/vpc/no-public-ingress-acl/#insecure-example", "text": "The following example will fail the aws-vpc-no-public-ingress-acl check. resource \"aws_network_acl_rule\" \"bad_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"0.0.0.0/0\" }", "title": "Insecure Example"}, {"location": "checks/aws/vpc/no-public-ingress-acl/#secure-example", "text": "The following example will pass the aws-vpc-no-public-ingress-acl check. resource \"aws_network_acl_rule\" \"good_example\" { egress = false protocol = \"tcp\" from_port = 22 to_port = 22 rule_action = \"allow\" cidr_block = \"10.0.0.0/16\" }", "title": "Secure Example"}, {"location": "checks/aws/vpc/no-public-ingress-acl/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule#cidr_block https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html", "title": "Links"}, {"location": "checks/aws/vpc/no-public-ingress-sgr/", "text": "An ingress security group rule allows traffic from /0. Default Severity: critical Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact Your port exposed to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the aws-vpc-no-public-ingress-sgr check. resource \"aws_security_group_rule\" \"bad_example\" { type = \"ingress\" cidr_blocks = [ \"0.0.0.0/0\" ] } Secure Example The following example will pass the aws-vpc-no-public-ingress-sgr check. resource \"aws_security_group_rule\" \"good_example\" { type = \"ingress\" cidr_blocks = [ \"10.0.0.0/16\" ] } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule#cidr_blocks https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html", "title": "no-public-ingress-sgr"}, {"location": "checks/aws/vpc/no-public-ingress-sgr/#an-ingress-security-group-rule-allows-traffic-from-0", "text": "", "title": "An ingress security group rule allows traffic from /0."}, {"location": "checks/aws/vpc/no-public-ingress-sgr/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/aws/vpc/no-public-ingress-sgr/#explanation", "text": "Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.", "title": "Explanation"}, {"location": "checks/aws/vpc/no-public-ingress-sgr/#possible-impact", "text": "Your port exposed to the internet", "title": "Possible Impact"}, {"location": "checks/aws/vpc/no-public-ingress-sgr/#suggested-resolution", "text": "Set a more restrictive cidr range", "title": "Suggested Resolution"}, {"location": "checks/aws/vpc/no-public-ingress-sgr/#insecure-example", "text": "The following example will fail the aws-vpc-no-public-ingress-sgr check. resource \"aws_security_group_rule\" \"bad_example\" { type = \"ingress\" cidr_blocks = [ \"0.0.0.0/0\" ] }", "title": "Insecure Example"}, {"location": "checks/aws/vpc/no-public-ingress-sgr/#secure-example", "text": "The following example will pass the aws-vpc-no-public-ingress-sgr check. resource \"aws_security_group_rule\" \"good_example\" { type = \"ingress\" cidr_blocks = [ \"10.0.0.0/16\" ] }", "title": "Secure Example"}, {"location": "checks/aws/vpc/no-public-ingress-sgr/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule#cidr_blocks https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html", "title": "Links"}, {"location": "checks/aws/workspaces/enable-disk-encryption/", "text": "Root and user volumes on Workspaces should be encrypted Default Severity: high Explanation Workspace volumes for both user and root should be encrypted to protect the data stored on them. Possible Impact Data can be freely read if compromised Suggested Resolution Root and user volume encryption should be enabled Insecure Example The following example will fail the aws-workspaces-enable-disk-encryption check. resource \"aws_workspaces_workspace\" \"bad_example\" { directory_id = aws_workspaces_directory.test.id bundle_id = data.aws_workspaces_bundle.value_windows_10.id user_name = \"Administrator\" workspace_properties { compute_type_name = \"VALUE\" user_volume_size_gib = 10 root_volume_size_gib = 80 running_mode = \"AUTO_STOP\" running_mode_auto_stop_timeout_in_minutes = 60 } } Secure Example The following example will pass the aws-workspaces-enable-disk-encryption check. resource \"aws_workspaces_workspace\" \"good_example\" { directory_id = aws_workspaces_directory.test.id bundle_id = data.aws_workspaces_bundle.value_windows_10.id user_name = \"Administrator\" root_volume_encryption_enabled = true user_volume_encryption_enabled = true workspace_properties { compute_type_name = \"VALUE\" user_volume_size_gib = 10 root_volume_size_gib = 80 running_mode = \"AUTO_STOP\" running_mode_auto_stop_timeout_in_minutes = 60 } } Links https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/workspaces_workspace#root_volume_encryption_enabled https://docs.aws.amazon.com/workspaces/latest/adminguide/encrypt-workspaces.html", "title": "Root and user volumes on Workspaces should be encrypted"}, {"location": "checks/aws/workspaces/enable-disk-encryption/#root-and-user-volumes-on-workspaces-should-be-encrypted", "text": "", "title": "Root and user volumes on Workspaces should be encrypted"}, {"location": "checks/aws/workspaces/enable-disk-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/aws/workspaces/enable-disk-encryption/#explanation", "text": "Workspace volumes for both user and root should be encrypted to protect the data stored on them.", "title": "Explanation"}, {"location": "checks/aws/workspaces/enable-disk-encryption/#possible-impact", "text": "Data can be freely read if compromised", "title": "Possible Impact"}, {"location": "checks/aws/workspaces/enable-disk-encryption/#suggested-resolution", "text": "Root and user volume encryption should be enabled", "title": "Suggested Resolution"}, {"location": "checks/aws/workspaces/enable-disk-encryption/#insecure-example", "text": "The following example will fail the aws-workspaces-enable-disk-encryption check. resource \"aws_workspaces_workspace\" \"bad_example\" { directory_id = aws_workspaces_directory.test.id bundle_id = data.aws_workspaces_bundle.value_windows_10.id user_name = \"Administrator\" workspace_properties { compute_type_name = \"VALUE\" user_volume_size_gib = 10 root_volume_size_gib = 80 running_mode = \"AUTO_STOP\" running_mode_auto_stop_timeout_in_minutes = 60 } }", "title": "Insecure Example"}, {"location": "checks/aws/workspaces/enable-disk-encryption/#secure-example", "text": "The following example will pass the aws-workspaces-enable-disk-encryption check. resource \"aws_workspaces_workspace\" \"good_example\" { directory_id = aws_workspaces_directory.test.id bundle_id = data.aws_workspaces_bundle.value_windows_10.id user_name = \"Administrator\" root_volume_encryption_enabled = true user_volume_encryption_enabled = true workspace_properties { compute_type_name = \"VALUE\" user_volume_size_gib = 10 root_volume_size_gib = 80 running_mode = \"AUTO_STOP\" running_mode_auto_stop_timeout_in_minutes = 60 } }", "title": "Secure Example"}, {"location": "checks/aws/workspaces/enable-disk-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/workspaces_workspace#root_volume_encryption_enabled https://docs.aws.amazon.com/workspaces/latest/adminguide/encrypt-workspaces.html", "title": "Links"}, {"location": "checks/azure/appservice/account-identity-registered/", "text": "Web App has registration with AD enabled Default Severity: low Explanation Registering the identity used by an App with AD allows it to interact with other services without using username and password Possible Impact Interaction between services can't easily be achieved without username/password Suggested Resolution Register the app identity with AD Insecure Example The following example will fail the azure-appservice-account-identity-registered check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-account-identity-registered check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id identity { type = \"UserAssigned\" identity_ids = \"webapp1\" } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#identity", "title": "account-identity-registered"}, {"location": "checks/azure/appservice/account-identity-registered/#web-app-has-registration-with-ad-enabled", "text": "", "title": "Web App has registration with AD enabled"}, {"location": "checks/azure/appservice/account-identity-registered/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/appservice/account-identity-registered/#explanation", "text": "Registering the identity used by an App with AD allows it to interact with other services without using username and password", "title": "Explanation"}, {"location": "checks/azure/appservice/account-identity-registered/#possible-impact", "text": "Interaction between services can't easily be achieved without username/password", "title": "Possible Impact"}, {"location": "checks/azure/appservice/account-identity-registered/#suggested-resolution", "text": "Register the app identity with AD", "title": "Suggested Resolution"}, {"location": "checks/azure/appservice/account-identity-registered/#insecure-example", "text": "The following example will fail the azure-appservice-account-identity-registered check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }", "title": "Insecure Example"}, {"location": "checks/azure/appservice/account-identity-registered/#secure-example", "text": "The following example will pass the azure-appservice-account-identity-registered check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id identity { type = \"UserAssigned\" identity_ids = \"webapp1\" } }", "title": "Secure Example"}, {"location": "checks/azure/appservice/account-identity-registered/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#identity", "title": "Links"}, {"location": "checks/azure/appservice/authentication-enabled/", "text": "App Service authentication is activated Default Severity: medium Explanation Enabling authentication ensures that all communications in the application are authenticated. The auth_settings block needs to be filled out with the appropriate auth backend settings Possible Impact Anonymous HTTP requests will be accepted Suggested Resolution Enable authentication to prevent anonymous request being accepted Insecure Example The following example will fail the azure-appservice-authentication-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-authentication-enabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id auth_settings { enabled = true } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#enabled", "title": "authentication-enabled"}, {"location": "checks/azure/appservice/authentication-enabled/#app-service-authentication-is-activated", "text": "", "title": "App Service authentication is activated"}, {"location": "checks/azure/appservice/authentication-enabled/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/appservice/authentication-enabled/#explanation", "text": "Enabling authentication ensures that all communications in the application are authenticated. The auth_settings block needs to be filled out with the appropriate auth backend settings", "title": "Explanation"}, {"location": "checks/azure/appservice/authentication-enabled/#possible-impact", "text": "Anonymous HTTP requests will be accepted", "title": "Possible Impact"}, {"location": "checks/azure/appservice/authentication-enabled/#suggested-resolution", "text": "Enable authentication to prevent anonymous request being accepted", "title": "Suggested Resolution"}, {"location": "checks/azure/appservice/authentication-enabled/#insecure-example", "text": "The following example will fail the azure-appservice-authentication-enabled check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }", "title": "Insecure Example"}, {"location": "checks/azure/appservice/authentication-enabled/#secure-example", "text": "The following example will pass the azure-appservice-authentication-enabled check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id auth_settings { enabled = true } }", "title": "Secure Example"}, {"location": "checks/azure/appservice/authentication-enabled/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#enabled", "title": "Links"}, {"location": "checks/azure/appservice/enable-http2/", "text": "Web App uses the latest HTTP version Default Severity: low Explanation Use the latest version of HTTP to ensure you are benefiting from security fixes Possible Impact Outdated versions of HTTP has security vulnerabilities Suggested Resolution Use the latest version of HTTP Insecure Example The following example will fail the azure-appservice-enable-http2 check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-enable-http2 check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { http2_enabled = true } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#http2_enabled", "title": "enable-http2"}, {"location": "checks/azure/appservice/enable-http2/#web-app-uses-the-latest-http-version", "text": "", "title": "Web App uses the latest HTTP version"}, {"location": "checks/azure/appservice/enable-http2/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/appservice/enable-http2/#explanation", "text": "Use the latest version of HTTP to ensure you are benefiting from security fixes", "title": "Explanation"}, {"location": "checks/azure/appservice/enable-http2/#possible-impact", "text": "Outdated versions of HTTP has security vulnerabilities", "title": "Possible Impact"}, {"location": "checks/azure/appservice/enable-http2/#suggested-resolution", "text": "Use the latest version of HTTP", "title": "Suggested Resolution"}, {"location": "checks/azure/appservice/enable-http2/#insecure-example", "text": "The following example will fail the azure-appservice-enable-http2 check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }", "title": "Insecure Example"}, {"location": "checks/azure/appservice/enable-http2/#secure-example", "text": "The following example will pass the azure-appservice-enable-http2 check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { http2_enabled = true } }", "title": "Secure Example"}, {"location": "checks/azure/appservice/enable-http2/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#http2_enabled", "title": "Links"}, {"location": "checks/azure/appservice/enforce-https/", "text": "Ensure the Function App can only be accessed via HTTPS. The default is false. Default Severity: critical Explanation By default, clients can connect to function endpoints by using both HTTP or HTTPS. You should redirect HTTP to HTTPs because HTTPS uses the SSL/TLS protocol to provide a secure connection, which is both encrypted and authenticated. Possible Impact Anyone can access the Function App using HTTP. Suggested Resolution You can redirect all HTTP requests to the HTTPS port. Insecure Example The following example will fail the azure-appservice-enforce-https check. resource \"azurerm_function_app\" \"bad_example\" { name = \"test-azure-functions\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key os_type = \"linux\" } Secure Example The following example will pass the azure-appservice-enforce-https check. resource \"azurerm_function_app\" \"good_example\" { name = \"test-azure-functions\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key os_type = \"linux\" https_only = true } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#https_only https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https https://docs.microsoft.com/en-us/azure/azure-functions/security-concepts", "title": "enforce-https"}, {"location": "checks/azure/appservice/enforce-https/#ensure-the-function-app-can-only-be-accessed-via-https-the-default-is-false", "text": "", "title": "Ensure the Function App can only be accessed via HTTPS. The default is false."}, {"location": "checks/azure/appservice/enforce-https/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/appservice/enforce-https/#explanation", "text": "By default, clients can connect to function endpoints by using both HTTP or HTTPS. You should redirect HTTP to HTTPs because HTTPS uses the SSL/TLS protocol to provide a secure connection, which is both encrypted and authenticated.", "title": "Explanation"}, {"location": "checks/azure/appservice/enforce-https/#possible-impact", "text": "Anyone can access the Function App using HTTP.", "title": "Possible Impact"}, {"location": "checks/azure/appservice/enforce-https/#suggested-resolution", "text": "You can redirect all HTTP requests to the HTTPS port.", "title": "Suggested Resolution"}, {"location": "checks/azure/appservice/enforce-https/#insecure-example", "text": "The following example will fail the azure-appservice-enforce-https check. resource \"azurerm_function_app\" \"bad_example\" { name = \"test-azure-functions\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key os_type = \"linux\" }", "title": "Insecure Example"}, {"location": "checks/azure/appservice/enforce-https/#secure-example", "text": "The following example will pass the azure-appservice-enforce-https check. resource \"azurerm_function_app\" \"good_example\" { name = \"test-azure-functions\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id storage_account_name = azurerm_storage_account.example.name storage_account_access_key = azurerm_storage_account.example.primary_access_key os_type = \"linux\" https_only = true }", "title": "Secure Example"}, {"location": "checks/azure/appservice/enforce-https/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/function_app#https_only https://docs.microsoft.com/en-us/azure/app-service/configure-ssl-bindings#enforce-https https://docs.microsoft.com/en-us/azure/azure-functions/security-concepts", "title": "Links"}, {"location": "checks/azure/appservice/require-client-cert/", "text": "Web App accepts incoming client certificate Default Severity: low Explanation The TLS mutual authentication technique in enterprise environments ensures the authenticity of clients to the server. If incoming client certificates are enabled only an authenticated client with valid certificates can access the app. Possible Impact Mutual TLS is not being used Suggested Resolution Enable incoming certificates for clients Insecure Example The following example will fail the azure-appservice-require-client-cert check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Secure Example The following example will pass the azure-appservice-require-client-cert check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id client_cert_enabled = true } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#client_cert_enabled", "title": "require-client-cert"}, {"location": "checks/azure/appservice/require-client-cert/#web-app-accepts-incoming-client-certificate", "text": "", "title": "Web App accepts incoming client certificate"}, {"location": "checks/azure/appservice/require-client-cert/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/appservice/require-client-cert/#explanation", "text": "The TLS mutual authentication technique in enterprise environments ensures the authenticity of clients to the server. If incoming client certificates are enabled only an authenticated client with valid certificates can access the app.", "title": "Explanation"}, {"location": "checks/azure/appservice/require-client-cert/#possible-impact", "text": "Mutual TLS is not being used", "title": "Possible Impact"}, {"location": "checks/azure/appservice/require-client-cert/#suggested-resolution", "text": "Enable incoming certificates for clients", "title": "Suggested Resolution"}, {"location": "checks/azure/appservice/require-client-cert/#insecure-example", "text": "The following example will fail the azure-appservice-require-client-cert check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }", "title": "Insecure Example"}, {"location": "checks/azure/appservice/require-client-cert/#secure-example", "text": "The following example will pass the azure-appservice-require-client-cert check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id client_cert_enabled = true }", "title": "Secure Example"}, {"location": "checks/azure/appservice/require-client-cert/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#client_cert_enabled", "title": "Links"}, {"location": "checks/azure/appservice/use-secure-tls-policy/", "text": "Web App uses latest TLS version Default Severity: high Explanation Use a more recent TLS/SSL policy for the App Service Possible Impact The minimum TLS version for apps should be TLS1_2 Suggested Resolution The TLS version being outdated and has known vulnerabilities Insecure Example The following example will fail the azure-appservice-use-secure-tls-policy check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { min_tls_version = \"1.0\" } } Secure Example The following example will pass the azure-appservice-use-secure-tls-policy check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#min_tls_version", "title": "use-secure-tls-policy"}, {"location": "checks/azure/appservice/use-secure-tls-policy/#web-app-uses-latest-tls-version", "text": "", "title": "Web App uses latest TLS version"}, {"location": "checks/azure/appservice/use-secure-tls-policy/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/appservice/use-secure-tls-policy/#explanation", "text": "Use a more recent TLS/SSL policy for the App Service", "title": "Explanation"}, {"location": "checks/azure/appservice/use-secure-tls-policy/#possible-impact", "text": "The minimum TLS version for apps should be TLS1_2", "title": "Possible Impact"}, {"location": "checks/azure/appservice/use-secure-tls-policy/#suggested-resolution", "text": "The TLS version being outdated and has known vulnerabilities", "title": "Suggested Resolution"}, {"location": "checks/azure/appservice/use-secure-tls-policy/#insecure-example", "text": "The following example will fail the azure-appservice-use-secure-tls-policy check. resource \"azurerm_app_service\" \"bad_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id site_config { min_tls_version = \"1.0\" } }", "title": "Insecure Example"}, {"location": "checks/azure/appservice/use-secure-tls-policy/#secure-example", "text": "The following example will pass the azure-appservice-use-secure-tls-policy check. resource \"azurerm_app_service\" \"good_example\" { name = \"example-app-service\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name app_service_plan_id = azurerm_app_service_plan.example.id }", "title": "Secure Example"}, {"location": "checks/azure/appservice/use-secure-tls-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service#min_tls_version", "title": "Links"}, {"location": "checks/azure/authorization/limit-role-actions/", "text": "Roles limited to the required actions Default Severity: medium Explanation The permissions granted to a role should be kept to the minimum required to be able to do the task. Wildcard permissions must not be used. Possible Impact Open permissions for subscriptions could result in an easily compromisable account Suggested Resolution Use targeted permissions for roles Insecure Example The following example will fail the azure-authorization-limit-role-actions check. data \"azurerm_subscription\" \"primary\" { } resource \"azurerm_role_definition\" \"example\" { name = \"my-custom-role\" scope = data.azurerm_subscription.primary.id description = \"This is a custom role created via Terraform\" permissions { actions = [ \"*\" ] not_actions = [] } assignable_scopes = [ \"/\" ] } Secure Example The following example will pass the azure-authorization-limit-role-actions check. data \"azurerm_subscription\" \"primary\" { } resource \"azurerm_role_definition\" \"example\" { name = \"my-custom-role\" scope = data.azurerm_subscription.primary.id description = \"This is a custom role created via Terraform\" permissions { actions = [ \"*\" ] not_actions = [] } assignable_scopes = [ data.azurerm_subscription.primary.id , ] } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_definition#actions", "title": "limit-role-actions"}, {"location": "checks/azure/authorization/limit-role-actions/#roles-limited-to-the-required-actions", "text": "", "title": "Roles limited to the required actions"}, {"location": "checks/azure/authorization/limit-role-actions/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/authorization/limit-role-actions/#explanation", "text": "The permissions granted to a role should be kept to the minimum required to be able to do the task. Wildcard permissions must not be used.", "title": "Explanation"}, {"location": "checks/azure/authorization/limit-role-actions/#possible-impact", "text": "Open permissions for subscriptions could result in an easily compromisable account", "title": "Possible Impact"}, {"location": "checks/azure/authorization/limit-role-actions/#suggested-resolution", "text": "Use targeted permissions for roles", "title": "Suggested Resolution"}, {"location": "checks/azure/authorization/limit-role-actions/#insecure-example", "text": "The following example will fail the azure-authorization-limit-role-actions check. data \"azurerm_subscription\" \"primary\" { } resource \"azurerm_role_definition\" \"example\" { name = \"my-custom-role\" scope = data.azurerm_subscription.primary.id description = \"This is a custom role created via Terraform\" permissions { actions = [ \"*\" ] not_actions = [] } assignable_scopes = [ \"/\" ] }", "title": "Insecure Example"}, {"location": "checks/azure/authorization/limit-role-actions/#secure-example", "text": "The following example will pass the azure-authorization-limit-role-actions check. data \"azurerm_subscription\" \"primary\" { } resource \"azurerm_role_definition\" \"example\" { name = \"my-custom-role\" scope = data.azurerm_subscription.primary.id description = \"This is a custom role created via Terraform\" permissions { actions = [ \"*\" ] not_actions = [] } assignable_scopes = [ data.azurerm_subscription.primary.id , ] }", "title": "Secure Example"}, {"location": "checks/azure/authorization/limit-role-actions/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_definition#actions", "title": "Links"}, {"location": "checks/azure/compute/disable-password-authentication/", "text": "Password authentication should be disabled on Azure virtual machines Default Severity: high Explanation Access to virtual machines should be authenticated using SSH keys. Removing the option of password authentication enforces more secure methods while removing the risks inherent with passwords. Possible Impact Using password authentication is less secure that ssh keys may result in compromised servers Suggested Resolution Use ssh authentication for virtual machines Insecure Example The following example will fail the azure-compute-disable-password-authentication check. resource \"azurerm_linux_virtual_machine\" \"bad_linux_example\" { name = \"bad-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" disable_password_authentication = false } resource \"azurerm_virtual_machine\" \"bad_example\" { name = \"bad-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" os_profile { computer_name = \"hostname\" admin_username = \"testadmin\" admin_password = \"Password1234!\" } os_profile_linux_config { disable_password_authentication = false } } Secure Example The following example will pass the azure-compute-disable-password-authentication check. resource \"azurerm_linux_virtual_machine\" \"good_linux_example\" { name = \"good-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" admin_ssh_key { username = \"adminuser\" public_key = file ( \"~/.ssh/id_rsa.pub\" ) } } resource \"azurerm_virtual_machine\" \"good_example\" { name = \"good-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" os_profile_linux_config { ssh_keys = [{ key_data = file ( \"~/.ssh/id_rsa.pub\" ) path = \"~/.ssh/id_rsa.pub\" }] disable_password_authentication = true } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_virtual_machine#disable_password_authentication https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine#disable_password_authentication", "title": "disable-password-authentication"}, {"location": "checks/azure/compute/disable-password-authentication/#password-authentication-should-be-disabled-on-azure-virtual-machines", "text": "", "title": "Password authentication should be disabled on Azure virtual machines"}, {"location": "checks/azure/compute/disable-password-authentication/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/compute/disable-password-authentication/#explanation", "text": "Access to virtual machines should be authenticated using SSH keys. Removing the option of password authentication enforces more secure methods while removing the risks inherent with passwords.", "title": "Explanation"}, {"location": "checks/azure/compute/disable-password-authentication/#possible-impact", "text": "Using password authentication is less secure that ssh keys may result in compromised servers", "title": "Possible Impact"}, {"location": "checks/azure/compute/disable-password-authentication/#suggested-resolution", "text": "Use ssh authentication for virtual machines", "title": "Suggested Resolution"}, {"location": "checks/azure/compute/disable-password-authentication/#insecure-example", "text": "The following example will fail the azure-compute-disable-password-authentication check. resource \"azurerm_linux_virtual_machine\" \"bad_linux_example\" { name = \"bad-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" disable_password_authentication = false } resource \"azurerm_virtual_machine\" \"bad_example\" { name = \"bad-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" os_profile { computer_name = \"hostname\" admin_username = \"testadmin\" admin_password = \"Password1234!\" } os_profile_linux_config { disable_password_authentication = false } }", "title": "Insecure Example"}, {"location": "checks/azure/compute/disable-password-authentication/#secure-example", "text": "The following example will pass the azure-compute-disable-password-authentication check. resource \"azurerm_linux_virtual_machine\" \"good_linux_example\" { name = \"good-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" admin_password = \"somePassword\" admin_ssh_key { username = \"adminuser\" public_key = file ( \"~/.ssh/id_rsa.pub\" ) } } resource \"azurerm_virtual_machine\" \"good_example\" { name = \"good-linux-machine\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location size = \"Standard_F2\" admin_username = \"adminuser\" os_profile_linux_config { ssh_keys = [{ key_data = file ( \"~/.ssh/id_rsa.pub\" ) path = \"~/.ssh/id_rsa.pub\" }] disable_password_authentication = true } }", "title": "Secure Example"}, {"location": "checks/azure/compute/disable-password-authentication/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_virtual_machine#disable_password_authentication https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine#disable_password_authentication", "title": "Links"}, {"location": "checks/azure/compute/enable-disk-encryption/", "text": "Enable disk encryption on managed disk Default Severity: high Explanation Manage disks should be encrypted at rest. When specifying the encryption_settings block, the enabled attribute should be set to true . Possible Impact Data could be read if compromised Suggested Resolution Enable encryption on managed disks Insecure Example The following example will fail the azure-compute-enable-disk-encryption check. resource \"azurerm_managed_disk\" \"bad_example\" { encryption_settings { enabled = false } } Secure Example The following example will pass the azure-compute-enable-disk-encryption check. resource \"azurerm_managed_disk\" \"good_example\" { encryption_settings { enabled = true } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/managed_disk https://docs.microsoft.com/en-us/azure/virtual-machines/linux/disk-encryption", "title": "enable-disk-encryption"}, {"location": "checks/azure/compute/enable-disk-encryption/#enable-disk-encryption-on-managed-disk", "text": "", "title": "Enable disk encryption on managed disk"}, {"location": "checks/azure/compute/enable-disk-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/compute/enable-disk-encryption/#explanation", "text": "Manage disks should be encrypted at rest. When specifying the encryption_settings block, the enabled attribute should be set to true .", "title": "Explanation"}, {"location": "checks/azure/compute/enable-disk-encryption/#possible-impact", "text": "Data could be read if compromised", "title": "Possible Impact"}, {"location": "checks/azure/compute/enable-disk-encryption/#suggested-resolution", "text": "Enable encryption on managed disks", "title": "Suggested Resolution"}, {"location": "checks/azure/compute/enable-disk-encryption/#insecure-example", "text": "The following example will fail the azure-compute-enable-disk-encryption check. resource \"azurerm_managed_disk\" \"bad_example\" { encryption_settings { enabled = false } }", "title": "Insecure Example"}, {"location": "checks/azure/compute/enable-disk-encryption/#secure-example", "text": "The following example will pass the azure-compute-enable-disk-encryption check. resource \"azurerm_managed_disk\" \"good_example\" { encryption_settings { enabled = true } }", "title": "Secure Example"}, {"location": "checks/azure/compute/enable-disk-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/managed_disk https://docs.microsoft.com/en-us/azure/virtual-machines/linux/disk-encryption", "title": "Links"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/", "text": "Ensure that no sensitive credentials are exposed in VM custom_data Default Severity: medium Explanation When creating Azure Virtual Machines, custom_data is used to pass start up information into the EC2 instance. This custom_dat must not contain access key credentials. Possible Impact Sensitive credentials in custom_data can be leaked Suggested Resolution Don't use sensitive credentials in the VM custom_data Insecure Example The following example will fail the azure-compute-no-secrets-in-custom-data check. resource \"azurerm_virtual_machine\" \"bad_example\" { name = \"bad_example\" os_profile_linux_config { disable_password_authentication = false } os_profile { custom_data =<< EOF export DATABASE_PASSWORD=\\\"SomeSortOfPassword\\\" EOF } } export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF } } Secure Example The following example will pass the azure-compute-no-secrets-in-custom-data check. resource \"azurerm_virtual_machine\" \"good_example\" { name = \"good_example\" os_profile_linux_config { disable_password_authentication = false } os_profile { custom_data =<< EOF export GREETING=\"Hello there\" EOF } } export GREETING = \"Hello there\" EOF } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine#custom_data", "title": "no-secrets-in-custom-data"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/#ensure-that-no-sensitive-credentials-are-exposed-in-vm-custom_data", "text": "", "title": "Ensure that no sensitive credentials are exposed in VM custom_data"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/#explanation", "text": "When creating Azure Virtual Machines, custom_data is used to pass start up information into the EC2 instance. This custom_dat must not contain access key credentials.", "title": "Explanation"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/#possible-impact", "text": "Sensitive credentials in custom_data can be leaked", "title": "Possible Impact"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/#suggested-resolution", "text": "Don't use sensitive credentials in the VM custom_data", "title": "Suggested Resolution"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/#insecure-example", "text": "The following example will fail the azure-compute-no-secrets-in-custom-data check. resource \"azurerm_virtual_machine\" \"bad_example\" { name = \"bad_example\" os_profile_linux_config { disable_password_authentication = false } os_profile { custom_data =<< EOF export DATABASE_PASSWORD=\\\"SomeSortOfPassword\\\" EOF } } export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF } }", "title": "Insecure Example"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/#secure-example", "text": "The following example will pass the azure-compute-no-secrets-in-custom-data check. resource \"azurerm_virtual_machine\" \"good_example\" { name = \"good_example\" os_profile_linux_config { disable_password_authentication = false } os_profile { custom_data =<< EOF export GREETING=\"Hello there\" EOF } } export GREETING = \"Hello there\" EOF } }", "title": "Secure Example"}, {"location": "checks/azure/compute/no-secrets-in-custom-data/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/virtual_machine#custom_data", "title": "Links"}, {"location": "checks/azure/container/configured-network-policy/", "text": "Ensure AKS cluster has Network Policy configured Default Severity: high Explanation The Kubernetes object type NetworkPolicy should be defined to have opportunity allow or block traffic to pods, as in a Kubernetes cluster configured with default settings, all pods can discover and communicate with each other without any restrictions. Possible Impact No network policy is protecting the AKS cluster Suggested Resolution Configure a network policy Insecure Example The following example will fail the azure-container-configured-network-policy check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { network_profile { } } Secure Example The following example will pass the azure-container-configured-network-policy check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { network_profile { network_policy = \"calico\" } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#network_policy https://kubernetes.io/docs/concepts/services-networking/network-policies", "title": "configured-network-policy"}, {"location": "checks/azure/container/configured-network-policy/#ensure-aks-cluster-has-network-policy-configured", "text": "", "title": "Ensure AKS cluster has Network Policy configured"}, {"location": "checks/azure/container/configured-network-policy/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/container/configured-network-policy/#explanation", "text": "The Kubernetes object type NetworkPolicy should be defined to have opportunity allow or block traffic to pods, as in a Kubernetes cluster configured with default settings, all pods can discover and communicate with each other without any restrictions.", "title": "Explanation"}, {"location": "checks/azure/container/configured-network-policy/#possible-impact", "text": "No network policy is protecting the AKS cluster", "title": "Possible Impact"}, {"location": "checks/azure/container/configured-network-policy/#suggested-resolution", "text": "Configure a network policy", "title": "Suggested Resolution"}, {"location": "checks/azure/container/configured-network-policy/#insecure-example", "text": "The following example will fail the azure-container-configured-network-policy check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { network_profile { } }", "title": "Insecure Example"}, {"location": "checks/azure/container/configured-network-policy/#secure-example", "text": "The following example will pass the azure-container-configured-network-policy check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { network_profile { network_policy = \"calico\" } }", "title": "Secure Example"}, {"location": "checks/azure/container/configured-network-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#network_policy https://kubernetes.io/docs/concepts/services-networking/network-policies", "title": "Links"}, {"location": "checks/azure/container/limit-authorized-ips/", "text": "Ensure AKS has an API Server Authorized IP Ranges enabled Default Severity: critical Explanation The API server is the central way to interact with and manage a cluster. To improve cluster security and minimize attacks, the API server should only be accessible from a limited set of IP address ranges. Possible Impact Any IP can interact with the API server Suggested Resolution Limit the access to the API server to a limited IP range Insecure Example The following example will fail the azure-container-limit-authorized-ips check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { } Secure Example The following example will pass the azure-container-limit-authorized-ips check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { api_server_authorized_ip_ranges = [ \"1.2.3.4/32\" ] } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#api_server_authorized_ip_ranges https://docs.microsoft.com/en-us/azure/aks/api-server-authorized-ip-ranges", "title": "limit-authorized-ips"}, {"location": "checks/azure/container/limit-authorized-ips/#ensure-aks-has-an-api-server-authorized-ip-ranges-enabled", "text": "", "title": "Ensure AKS has an API Server Authorized IP Ranges enabled"}, {"location": "checks/azure/container/limit-authorized-ips/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/container/limit-authorized-ips/#explanation", "text": "The API server is the central way to interact with and manage a cluster. To improve cluster security and minimize attacks, the API server should only be accessible from a limited set of IP address ranges.", "title": "Explanation"}, {"location": "checks/azure/container/limit-authorized-ips/#possible-impact", "text": "Any IP can interact with the API server", "title": "Possible Impact"}, {"location": "checks/azure/container/limit-authorized-ips/#suggested-resolution", "text": "Limit the access to the API server to a limited IP range", "title": "Suggested Resolution"}, {"location": "checks/azure/container/limit-authorized-ips/#insecure-example", "text": "The following example will fail the azure-container-limit-authorized-ips check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { }", "title": "Insecure Example"}, {"location": "checks/azure/container/limit-authorized-ips/#secure-example", "text": "The following example will pass the azure-container-limit-authorized-ips check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { api_server_authorized_ip_ranges = [ \"1.2.3.4/32\" ] }", "title": "Secure Example"}, {"location": "checks/azure/container/limit-authorized-ips/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#api_server_authorized_ip_ranges https://docs.microsoft.com/en-us/azure/aks/api-server-authorized-ip-ranges", "title": "Links"}, {"location": "checks/azure/container/logging/", "text": "Ensure AKS logging to Azure Monitoring is Configured Default Severity: medium Explanation Ensure AKS logging to Azure Monitoring is configured for containers to monitor the performance of workloads. Possible Impact Logging provides valuable information about access and usage Suggested Resolution Enable logging for AKS Insecure Example The following example will fail the azure-container-logging check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { addon_profile {} } Secure Example The following example will pass the azure-container-logging check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { addon_profile { oms_agent { enabled = true } } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#oms_agent https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-onboard", "title": "logging"}, {"location": "checks/azure/container/logging/#ensure-aks-logging-to-azure-monitoring-is-configured", "text": "", "title": "Ensure AKS logging to Azure Monitoring is Configured"}, {"location": "checks/azure/container/logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/container/logging/#explanation", "text": "Ensure AKS logging to Azure Monitoring is configured for containers to monitor the performance of workloads.", "title": "Explanation"}, {"location": "checks/azure/container/logging/#possible-impact", "text": "Logging provides valuable information about access and usage", "title": "Possible Impact"}, {"location": "checks/azure/container/logging/#suggested-resolution", "text": "Enable logging for AKS", "title": "Suggested Resolution"}, {"location": "checks/azure/container/logging/#insecure-example", "text": "The following example will fail the azure-container-logging check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { addon_profile {} }", "title": "Insecure Example"}, {"location": "checks/azure/container/logging/#secure-example", "text": "The following example will pass the azure-container-logging check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { addon_profile { oms_agent { enabled = true } } }", "title": "Secure Example"}, {"location": "checks/azure/container/logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster#oms_agent https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-onboard", "title": "Links"}, {"location": "checks/azure/container/use-rbac-permissions/", "text": "Ensure RBAC is enabled on AKS clusters Default Severity: high Explanation Using Kubernetes role-based access control (RBAC), you can grant users, groups, and service accounts access to only the resources they need. Possible Impact No role based access control is in place for the AKS cluster Suggested Resolution Enable RBAC Insecure Example The following example will fail the azure-container-use-rbac-permissions check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { role_based_access_control { enabled = false } } Secure Example The following example will pass the azure-container-use-rbac-permissions check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { role_based_access_control { enabled = true } } Links https://www.terraform.io/docs/providers/azurerm/r/kubernetes_cluster.html#role_based_access_control https://docs.microsoft.com/en-us/azure/aks/concepts-identity", "title": "use-rbac-permissions"}, {"location": "checks/azure/container/use-rbac-permissions/#ensure-rbac-is-enabled-on-aks-clusters", "text": "", "title": "Ensure RBAC is enabled on AKS clusters"}, {"location": "checks/azure/container/use-rbac-permissions/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/container/use-rbac-permissions/#explanation", "text": "Using Kubernetes role-based access control (RBAC), you can grant users, groups, and service accounts access to only the resources they need.", "title": "Explanation"}, {"location": "checks/azure/container/use-rbac-permissions/#possible-impact", "text": "No role based access control is in place for the AKS cluster", "title": "Possible Impact"}, {"location": "checks/azure/container/use-rbac-permissions/#suggested-resolution", "text": "Enable RBAC", "title": "Suggested Resolution"}, {"location": "checks/azure/container/use-rbac-permissions/#insecure-example", "text": "The following example will fail the azure-container-use-rbac-permissions check. resource \"azurerm_kubernetes_cluster\" \"bad_example\" { role_based_access_control { enabled = false } }", "title": "Insecure Example"}, {"location": "checks/azure/container/use-rbac-permissions/#secure-example", "text": "The following example will pass the azure-container-use-rbac-permissions check. resource \"azurerm_kubernetes_cluster\" \"good_example\" { role_based_access_control { enabled = true } }", "title": "Secure Example"}, {"location": "checks/azure/container/use-rbac-permissions/#links", "text": "https://www.terraform.io/docs/providers/azurerm/r/kubernetes_cluster.html#role_based_access_control https://docs.microsoft.com/en-us/azure/aks/concepts-identity", "title": "Links"}, {"location": "checks/azure/database/all-threat-alerts-enabled/", "text": "No threat detections are set Default Severity: medium Explanation SQL Server can alert for security issues including SQL Injection, vulnerabilities, access anomalies and data exfiltration. Ensure none of these are disabled to benefit from the best protection Possible Impact Disabling threat alerts means you are not getting the full benefit of server security protection Suggested Resolution Use all provided threat alerts Insecure Example The following example will fail the azure-database-all-threat-alerts-enabled check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] retention_days = 20 } Secure Example The following example will pass the azure-database-all-threat-alerts-enabled check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [] retention_days = 20 } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#disabled_alerts", "title": "No threat detections are set"}, {"location": "checks/azure/database/all-threat-alerts-enabled/#no-threat-detections-are-set", "text": "", "title": "No threat detections are set"}, {"location": "checks/azure/database/all-threat-alerts-enabled/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/all-threat-alerts-enabled/#explanation", "text": "SQL Server can alert for security issues including SQL Injection, vulnerabilities, access anomalies and data exfiltration. Ensure none of these are disabled to benefit from the best protection", "title": "Explanation"}, {"location": "checks/azure/database/all-threat-alerts-enabled/#possible-impact", "text": "Disabling threat alerts means you are not getting the full benefit of server security protection", "title": "Possible Impact"}, {"location": "checks/azure/database/all-threat-alerts-enabled/#suggested-resolution", "text": "Use all provided threat alerts", "title": "Suggested Resolution"}, {"location": "checks/azure/database/all-threat-alerts-enabled/#insecure-example", "text": "The following example will fail the azure-database-all-threat-alerts-enabled check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] retention_days = 20 }", "title": "Insecure Example"}, {"location": "checks/azure/database/all-threat-alerts-enabled/#secure-example", "text": "The following example will pass the azure-database-all-threat-alerts-enabled check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [] retention_days = 20 }", "title": "Secure Example"}, {"location": "checks/azure/database/all-threat-alerts-enabled/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#disabled_alerts", "title": "Links"}, {"location": "checks/azure/database/enable-audit/", "text": "Auditing should be enabled on Azure SQL Databases Default Severity: medium Explanation Auditing helps you maintain regulatory compliance, understand database activity, and gain insight into discrepancies and anomalies that could indicate business concerns or suspected security violations. Possible Impact Auditing provides valuable information about access and usage Suggested Resolution Enable auditing on Azure SQL databases Insecure Example The following example will fail the azure-database-enable-audit check. resource \"azurerm_sql_server\" \"bad_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"mradministrator\" administrator_login_password = \"tfsecRocks\" } Secure Example The following example will pass the azure-database-enable-audit check. resource \"azurerm_sql_server\" \"good_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"mradministrator\" administrator_login_password = \"tfsecRocks\" extended_auditing_policy { storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = true retention_in_days = 6 } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/sql_server#extended_auditing_policy https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview", "title": "enable-audit"}, {"location": "checks/azure/database/enable-audit/#auditing-should-be-enabled-on-azure-sql-databases", "text": "", "title": "Auditing should be enabled on Azure SQL Databases"}, {"location": "checks/azure/database/enable-audit/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/enable-audit/#explanation", "text": "Auditing helps you maintain regulatory compliance, understand database activity, and gain insight into discrepancies and anomalies that could indicate business concerns or suspected security violations.", "title": "Explanation"}, {"location": "checks/azure/database/enable-audit/#possible-impact", "text": "Auditing provides valuable information about access and usage", "title": "Possible Impact"}, {"location": "checks/azure/database/enable-audit/#suggested-resolution", "text": "Enable auditing on Azure SQL databases", "title": "Suggested Resolution"}, {"location": "checks/azure/database/enable-audit/#insecure-example", "text": "The following example will fail the azure-database-enable-audit check. resource \"azurerm_sql_server\" \"bad_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"mradministrator\" administrator_login_password = \"tfsecRocks\" }", "title": "Insecure Example"}, {"location": "checks/azure/database/enable-audit/#secure-example", "text": "The following example will pass the azure-database-enable-audit check. resource \"azurerm_sql_server\" \"good_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"mradministrator\" administrator_login_password = \"tfsecRocks\" extended_auditing_policy { storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = true retention_in_days = 6 } }", "title": "Secure Example"}, {"location": "checks/azure/database/enable-audit/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/sql_server#extended_auditing_policy https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview", "title": "Links"}, {"location": "checks/azure/database/enable-ssl-enforcement/", "text": "SSL should be enforced on database connections where applicable Default Severity: medium Explanation SSL connections should be enforced were available to ensure secure transfer and reduce the risk of compromising data in flight. Possible Impact Insecure connections could lead to data loss and other vulnerabilities Suggested Resolution Enable SSL enforcement Insecure Example The following example will fail the azure-database-enable-ssl-enforcement check. resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" } Secure Example The following example will pass the azure-database-enable-ssl-enforcement check. resource \"azurerm_postgresql_server\" \"good_example\" { name = \"good_example\" public_network_access_enabled = false ssl_enforcement_enabled = true ssl_minimal_tls_version_enforced = \"TLS1_2\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#ssl_enforcement_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#ssl_enforcement_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mariadb_server#ssl_enforcement_enabled", "title": "enable-ssl-enforcement"}, {"location": "checks/azure/database/enable-ssl-enforcement/#ssl-should-be-enforced-on-database-connections-where-applicable", "text": "", "title": "SSL should be enforced on database connections where applicable"}, {"location": "checks/azure/database/enable-ssl-enforcement/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/enable-ssl-enforcement/#explanation", "text": "SSL connections should be enforced were available to ensure secure transfer and reduce the risk of compromising data in flight.", "title": "Explanation"}, {"location": "checks/azure/database/enable-ssl-enforcement/#possible-impact", "text": "Insecure connections could lead to data loss and other vulnerabilities", "title": "Possible Impact"}, {"location": "checks/azure/database/enable-ssl-enforcement/#suggested-resolution", "text": "Enable SSL enforcement", "title": "Suggested Resolution"}, {"location": "checks/azure/database/enable-ssl-enforcement/#insecure-example", "text": "The following example will fail the azure-database-enable-ssl-enforcement check. resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" }", "title": "Insecure Example"}, {"location": "checks/azure/database/enable-ssl-enforcement/#secure-example", "text": "The following example will pass the azure-database-enable-ssl-enforcement check. resource \"azurerm_postgresql_server\" \"good_example\" { name = \"good_example\" public_network_access_enabled = false ssl_enforcement_enabled = true ssl_minimal_tls_version_enforced = \"TLS1_2\" }", "title": "Secure Example"}, {"location": "checks/azure/database/enable-ssl-enforcement/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#ssl_enforcement_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#ssl_enforcement_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mariadb_server#ssl_enforcement_enabled", "title": "Links"}, {"location": "checks/azure/database/no-public-access/", "text": "Ensure databases are not publicly accessible Default Severity: medium Explanation Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function. Possible Impact Publicly accessible database could lead to compromised data Suggested Resolution Disable public access to database when not required Insecure Example The following example will fail the azure-database-no-public-access check. resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" } Secure Example The following example will pass the azure-database-no-public-access check. resource \"azurerm_postgresql_server\" \"good_example\" { name = \"bad_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#public_network_access_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#public_network_access_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mariadb_server#public_network_access_enabled", "title": "no-public-access"}, {"location": "checks/azure/database/no-public-access/#ensure-databases-are-not-publicly-accessible", "text": "", "title": "Ensure databases are not publicly accessible"}, {"location": "checks/azure/database/no-public-access/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/no-public-access/#explanation", "text": "Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function.", "title": "Explanation"}, {"location": "checks/azure/database/no-public-access/#possible-impact", "text": "Publicly accessible database could lead to compromised data", "title": "Possible Impact"}, {"location": "checks/azure/database/no-public-access/#suggested-resolution", "text": "Disable public access to database when not required", "title": "Suggested Resolution"}, {"location": "checks/azure/database/no-public-access/#insecure-example", "text": "The following example will fail the azure-database-no-public-access check. resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" }", "title": "Insecure Example"}, {"location": "checks/azure/database/no-public-access/#secure-example", "text": "The following example will pass the azure-database-no-public-access check. resource \"azurerm_postgresql_server\" \"good_example\" { name = \"bad_example\" public_network_access_enabled = false ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" }", "title": "Secure Example"}, {"location": "checks/azure/database/no-public-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#public_network_access_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#public_network_access_enabled https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mariadb_server#public_network_access_enabled", "title": "Links"}, {"location": "checks/azure/database/no-public-firewall-access/", "text": "Ensure database firewalls do not permit public access Default Severity: high Explanation Azure services can be allowed access through the firewall using a start and end IP address of 0.0.0.0. No other end ip address should be combined with a start of 0.0.0.0 Possible Impact Publicly accessible databases could lead to compromised data Suggested Resolution Don't use wide ip ranges for the sql firewall Insecure Example The following example will fail the azure-database-no-public-firewall-access check. resource \"azurerm_sql_firewall_rule\" \"bad_example\" { name = \"bad_rule\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"255.255.255.255\" } resource \"azurerm_postgresql_firewall_rule\" \"bad_example\" { name = \"bad_example\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"255.255.255.255\" } Secure Example The following example will pass the azure-database-no-public-firewall-access check. resource \"azurerm_sql_firewall_rule\" \"good_example\" { name = \"good_rule\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"0.0.0.0\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/sql_firewall_rule#end_ip_address https://docs.microsoft.com/en-us/rest/api/sql/2021-02-01-preview/firewall-rules/create-or-update", "title": "no-public-firewall-access"}, {"location": "checks/azure/database/no-public-firewall-access/#ensure-database-firewalls-do-not-permit-public-access", "text": "", "title": "Ensure database firewalls do not permit public access"}, {"location": "checks/azure/database/no-public-firewall-access/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/database/no-public-firewall-access/#explanation", "text": "Azure services can be allowed access through the firewall using a start and end IP address of 0.0.0.0. No other end ip address should be combined with a start of 0.0.0.0", "title": "Explanation"}, {"location": "checks/azure/database/no-public-firewall-access/#possible-impact", "text": "Publicly accessible databases could lead to compromised data", "title": "Possible Impact"}, {"location": "checks/azure/database/no-public-firewall-access/#suggested-resolution", "text": "Don't use wide ip ranges for the sql firewall", "title": "Suggested Resolution"}, {"location": "checks/azure/database/no-public-firewall-access/#insecure-example", "text": "The following example will fail the azure-database-no-public-firewall-access check. resource \"azurerm_sql_firewall_rule\" \"bad_example\" { name = \"bad_rule\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"255.255.255.255\" } resource \"azurerm_postgresql_firewall_rule\" \"bad_example\" { name = \"bad_example\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"255.255.255.255\" }", "title": "Insecure Example"}, {"location": "checks/azure/database/no-public-firewall-access/#secure-example", "text": "The following example will pass the azure-database-no-public-firewall-access check. resource \"azurerm_sql_firewall_rule\" \"good_example\" { name = \"good_rule\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name start_ip_address = \"0.0.0.0\" end_ip_address = \"0.0.0.0\" }", "title": "Secure Example"}, {"location": "checks/azure/database/no-public-firewall-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/sql_firewall_rule#end_ip_address https://docs.microsoft.com/en-us/rest/api/sql/2021-02-01-preview/firewall-rules/create-or-update", "title": "Links"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/", "text": "Ensure server parameter 'connection_throttling' is set to 'ON' for PostgreSQL Database Server Default Severity: medium Explanation Postgresql can generate logs for connection throttling to improve visibility for audit and configuration issue resolution. Possible Impact No log information to help diagnosing connection contention issues Suggested Resolution Enable connection throttling logging Insecure Example The following example will fail the azure-database-postgres-configuration-connection-throttling check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } Secure Example The following example will pass the azure-database-postgres-configuration-connection-throttling check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"connection_throttling\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging", "title": "Ensure server parameter 'connection_throttling' is set to 'ON' for PostgreSQL Database Server"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/#ensure-server-parameter-connection_throttling-is-set-to-on-for-postgresql-database-server", "text": "", "title": "Ensure server parameter 'connection_throttling' is set to 'ON' for PostgreSQL Database Server"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/#explanation", "text": "Postgresql can generate logs for connection throttling to improve visibility for audit and configuration issue resolution.", "title": "Explanation"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/#possible-impact", "text": "No log information to help diagnosing connection contention issues", "title": "Possible Impact"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/#suggested-resolution", "text": "Enable connection throttling logging", "title": "Suggested Resolution"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/#insecure-example", "text": "The following example will fail the azure-database-postgres-configuration-connection-throttling check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 }", "title": "Insecure Example"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/#secure-example", "text": "The following example will pass the azure-database-postgres-configuration-connection-throttling check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"connection_throttling\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" }", "title": "Secure Example"}, {"location": "checks/azure/database/postgres-configuration-connection-throttling/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging", "title": "Links"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/", "text": "Ensure server parameter 'log_checkpoints' is set to 'ON' for PostgreSQL Database Server Default Severity: medium Explanation Postgresql can generate logs for checkpoints to improve visibility for audit and configuration issue resolution. Possible Impact No error and query logs generated on checkpoint Suggested Resolution Enable checkpoint logging Insecure Example The following example will fail the azure-database-postgres-configuration-log-checkpoints check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } Secure Example The following example will pass the azure-database-postgres-configuration-log-checkpoints check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"log_checkpoints\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging", "title": "postgres-configuration-log-checkpoints"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/#ensure-server-parameter-log_checkpoints-is-set-to-on-for-postgresql-database-server", "text": "", "title": "Ensure server parameter 'log_checkpoints' is set to 'ON' for PostgreSQL Database Server"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/#explanation", "text": "Postgresql can generate logs for checkpoints to improve visibility for audit and configuration issue resolution.", "title": "Explanation"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/#possible-impact", "text": "No error and query logs generated on checkpoint", "title": "Possible Impact"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/#suggested-resolution", "text": "Enable checkpoint logging", "title": "Suggested Resolution"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/#insecure-example", "text": "The following example will fail the azure-database-postgres-configuration-log-checkpoints check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 }", "title": "Insecure Example"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/#secure-example", "text": "The following example will pass the azure-database-postgres-configuration-log-checkpoints check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"log_checkpoints\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" }", "title": "Secure Example"}, {"location": "checks/azure/database/postgres-configuration-log-checkpoints/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging", "title": "Links"}, {"location": "checks/azure/database/postgres-configuration-log-connections/", "text": "Ensure server parameter 'log_connections' is set to 'ON' for PostgreSQL Database Server Default Severity: medium Explanation Postgresql can generate logs for successful connections to improve visibility for audit and configuration issue resolution. Possible Impact No visibility of successful connections Suggested Resolution Enable connection logging Insecure Example The following example will fail the azure-database-postgres-configuration-log-connections check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } Secure Example The following example will pass the azure-database-postgres-configuration-log-connections check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"log_connections\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging", "title": "postgres-configuration-log-connections"}, {"location": "checks/azure/database/postgres-configuration-log-connections/#ensure-server-parameter-log_connections-is-set-to-on-for-postgresql-database-server", "text": "", "title": "Ensure server parameter 'log_connections' is set to 'ON' for PostgreSQL Database Server"}, {"location": "checks/azure/database/postgres-configuration-log-connections/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/postgres-configuration-log-connections/#explanation", "text": "Postgresql can generate logs for successful connections to improve visibility for audit and configuration issue resolution.", "title": "Explanation"}, {"location": "checks/azure/database/postgres-configuration-log-connections/#possible-impact", "text": "No visibility of successful connections", "title": "Possible Impact"}, {"location": "checks/azure/database/postgres-configuration-log-connections/#suggested-resolution", "text": "Enable connection logging", "title": "Suggested Resolution"}, {"location": "checks/azure/database/postgres-configuration-log-connections/#insecure-example", "text": "The following example will fail the azure-database-postgres-configuration-log-connections check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 }", "title": "Insecure Example"}, {"location": "checks/azure/database/postgres-configuration-log-connections/#secure-example", "text": "The following example will pass the azure-database-postgres-configuration-log-connections check. resource \"azurerm_resource_group\" \"example\" { name = \"example-resources\" location = \"West Europe\" } resource \"azurerm_postgresql_server\" \"example\" { name = \"example-psqlserver\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name administrator_login = \"psqladminun\" administrator_login_password = \"H@Sh1CoR3!\" sku_name = \"GP_Gen5_4\" version = \"9.6\" storage_mb = 640000 } resource \"azurerm_postgresql_configuration\" \"example\" { name = \"log_connections\" resource_group_name = azurerm_resource_group.example.name server_name = azurerm_postgresql_server.example.name value = \"on\" }", "title": "Secure Example"}, {"location": "checks/azure/database/postgres-configuration-log-connections/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_configuration https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs#configure-logging", "title": "Links"}, {"location": "checks/azure/database/retention-period-set/", "text": "Database auditing rentention period should be longer than 90 days Default Severity: medium Explanation When Auditing is configured for a SQL database, if the retention period is not set, the retention will be unlimited. If the retention period is to be explicitly set, it should be set for no less than 90 days. Possible Impact Short logging retention could result in missing valuable historical information Suggested Resolution Set retention periods of database auditing to greater than 90 days Insecure Example The following example will fail the azure-database-retention-period-set check. resource \"azurerm_mssql_database_extended_auditing_policy\" \"bad_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false retention_in_days = 6 } Secure Example The following example will pass the azure-database-retention-period-set check. resource \"azurerm_mssql_database_extended_auditing_policy\" \"good_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false } resource \"azurerm_mssql_database_extended_auditing_policy\" \"good_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false retention_in_days = 90 } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_database_extended_auditing_policy https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server#retention_in_days https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview", "title": "retention-period-set"}, {"location": "checks/azure/database/retention-period-set/#database-auditing-rentention-period-should-be-longer-than-90-days", "text": "", "title": "Database auditing rentention period should be longer than 90 days"}, {"location": "checks/azure/database/retention-period-set/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/retention-period-set/#explanation", "text": "When Auditing is configured for a SQL database, if the retention period is not set, the retention will be unlimited. If the retention period is to be explicitly set, it should be set for no less than 90 days.", "title": "Explanation"}, {"location": "checks/azure/database/retention-period-set/#possible-impact", "text": "Short logging retention could result in missing valuable historical information", "title": "Possible Impact"}, {"location": "checks/azure/database/retention-period-set/#suggested-resolution", "text": "Set retention periods of database auditing to greater than 90 days", "title": "Suggested Resolution"}, {"location": "checks/azure/database/retention-period-set/#insecure-example", "text": "The following example will fail the azure-database-retention-period-set check. resource \"azurerm_mssql_database_extended_auditing_policy\" \"bad_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false retention_in_days = 6 }", "title": "Insecure Example"}, {"location": "checks/azure/database/retention-period-set/#secure-example", "text": "The following example will pass the azure-database-retention-period-set check. resource \"azurerm_mssql_database_extended_auditing_policy\" \"good_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false } resource \"azurerm_mssql_database_extended_auditing_policy\" \"good_example\" { database_id = azurerm_mssql_database.example.id storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key storage_account_access_key_is_secondary = false retention_in_days = 90 }", "title": "Secure Example"}, {"location": "checks/azure/database/retention-period-set/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_database_extended_auditing_policy https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server#retention_in_days https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview", "title": "Links"}, {"location": "checks/azure/database/secure-tls-policy/", "text": "Databases should have the minimum TLS set for connections Default Severity: medium Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated TLS policies increase exposure to known issues Suggested Resolution Use the most modern TLS policies available Insecure Example The following example will fail the azure-database-secure-tls-policy check. resource \"azurerm_mssql_server\" \"bad_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"missadministrator\" administrator_login_password = \"thisIsKat11\" minimum_tls_version = \"1.1\" } resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_1\" } Secure Example The following example will pass the azure-database-secure-tls-policy check. resource \"azurerm_mssql_server\" \"good_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"missadministrator\" administrator_login_password = \"thisIsKat11\" minimum_tls_version = \"1.2\" } resource \"azurerm_postgresql_server\" \"good_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server#minimum_tls_version https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#ssl_minimal_tls_version_enforced https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#ssl_minimal_tls_version_enforced", "title": "secure-tls-policy"}, {"location": "checks/azure/database/secure-tls-policy/#databases-should-have-the-minimum-tls-set-for-connections", "text": "", "title": "Databases should have the minimum TLS set for connections"}, {"location": "checks/azure/database/secure-tls-policy/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/secure-tls-policy/#explanation", "text": "You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.", "title": "Explanation"}, {"location": "checks/azure/database/secure-tls-policy/#possible-impact", "text": "Outdated TLS policies increase exposure to known issues", "title": "Possible Impact"}, {"location": "checks/azure/database/secure-tls-policy/#suggested-resolution", "text": "Use the most modern TLS policies available", "title": "Suggested Resolution"}, {"location": "checks/azure/database/secure-tls-policy/#insecure-example", "text": "The following example will fail the azure-database-secure-tls-policy check. resource \"azurerm_mssql_server\" \"bad_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"missadministrator\" administrator_login_password = \"thisIsKat11\" minimum_tls_version = \"1.1\" } resource \"azurerm_postgresql_server\" \"bad_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_1\" }", "title": "Insecure Example"}, {"location": "checks/azure/database/secure-tls-policy/#secure-example", "text": "The following example will pass the azure-database-secure-tls-policy check. resource \"azurerm_mssql_server\" \"good_example\" { name = \"mssqlserver\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location version = \"12.0\" administrator_login = \"missadministrator\" administrator_login_password = \"thisIsKat11\" minimum_tls_version = \"1.2\" } resource \"azurerm_postgresql_server\" \"good_example\" { name = \"bad_example\" public_network_access_enabled = true ssl_enforcement_enabled = false ssl_minimal_tls_version_enforced = \"TLS1_2\" }", "title": "Secure Example"}, {"location": "checks/azure/database/secure-tls-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server#minimum_tls_version https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mysql_server#ssl_minimal_tls_version_enforced https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_server#ssl_minimal_tls_version_enforced", "title": "Links"}, {"location": "checks/azure/database/threat-alert-email-set/", "text": "At least one email address is set for threat alerts Default Severity: medium Explanation SQL Server sends alerts for threat detection via email, if there are no email addresses set then mitigation will be delayed. Possible Impact Nobody will be prompty alerted in the case of a threat being detected Suggested Resolution Provide at least one email address for threat alerts Insecure Example The following example will fail the azure-database-threat-alert-email-set check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] email_addresses = [] } Secure Example The following example will pass the azure-database-threat-alert-email-set check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] email_addresses = [ \"db-security@acme.org\" ] } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#email_addresses", "title": "At least one email address is set for threat alerts"}, {"location": "checks/azure/database/threat-alert-email-set/#at-least-one-email-address-is-set-for-threat-alerts", "text": "", "title": "At least one email address is set for threat alerts"}, {"location": "checks/azure/database/threat-alert-email-set/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/database/threat-alert-email-set/#explanation", "text": "SQL Server sends alerts for threat detection via email, if there are no email addresses set then mitigation will be delayed.", "title": "Explanation"}, {"location": "checks/azure/database/threat-alert-email-set/#possible-impact", "text": "Nobody will be prompty alerted in the case of a threat being detected", "title": "Possible Impact"}, {"location": "checks/azure/database/threat-alert-email-set/#suggested-resolution", "text": "Provide at least one email address for threat alerts", "title": "Suggested Resolution"}, {"location": "checks/azure/database/threat-alert-email-set/#insecure-example", "text": "The following example will fail the azure-database-threat-alert-email-set check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] email_addresses = [] }", "title": "Insecure Example"}, {"location": "checks/azure/database/threat-alert-email-set/#secure-example", "text": "The following example will pass the azure-database-threat-alert-email-set check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ \"Sql_Injection\" , \"Data_Exfiltration\" ] email_addresses = [ \"db-security@acme.org\" ] }", "title": "Secure Example"}, {"location": "checks/azure/database/threat-alert-email-set/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#email_addresses", "title": "Links"}, {"location": "checks/azure/database/threat-alert-email-to-owner/", "text": "Security threat alerts go to subcription owners and co-administrators Default Severity: low Explanation Subscription owners should be notified when there are security alerts. By ensuring the administrators of the account have been notified they can quickly assist in any required remediation Possible Impact Administrators and subscription owners may have a delayed response Suggested Resolution Enable email to subscription owners Insecure Example The following example will fail the azure-database-threat-alert-email-to-owner check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ ] email_account_admins = false } Secure Example The following example will pass the azure-database-threat-alert-email-to-owner check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [] email_account_admins = true } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#email_account_admins", "title": "Security threat alerts go to subcription owners and co-administrators"}, {"location": "checks/azure/database/threat-alert-email-to-owner/#security-threat-alerts-go-to-subcription-owners-and-co-administrators", "text": "", "title": "Security threat alerts go to subcription owners and co-administrators"}, {"location": "checks/azure/database/threat-alert-email-to-owner/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/database/threat-alert-email-to-owner/#explanation", "text": "Subscription owners should be notified when there are security alerts. By ensuring the administrators of the account have been notified they can quickly assist in any required remediation", "title": "Explanation"}, {"location": "checks/azure/database/threat-alert-email-to-owner/#possible-impact", "text": "Administrators and subscription owners may have a delayed response", "title": "Possible Impact"}, {"location": "checks/azure/database/threat-alert-email-to-owner/#suggested-resolution", "text": "Enable email to subscription owners", "title": "Suggested Resolution"}, {"location": "checks/azure/database/threat-alert-email-to-owner/#insecure-example", "text": "The following example will fail the azure-database-threat-alert-email-to-owner check. resource \"azurerm_mssql_server_security_alert_policy\" \"bad_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [ ] email_account_admins = false }", "title": "Insecure Example"}, {"location": "checks/azure/database/threat-alert-email-to-owner/#secure-example", "text": "The following example will pass the azure-database-threat-alert-email-to-owner check. resource \"azurerm_mssql_server_security_alert_policy\" \"good_example\" { resource_group_name = azurerm_resource_group.example.name server_name = azurerm_sql_server.example.name state = \"Enabled\" storage_endpoint = azurerm_storage_account.example.primary_blob_endpoint storage_account_access_key = azurerm_storage_account.example.primary_access_key disabled_alerts = [] email_account_admins = true }", "title": "Secure Example"}, {"location": "checks/azure/database/threat-alert-email-to-owner/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_server_security_alert_policy#email_account_admins", "title": "Links"}, {"location": "checks/azure/datafactory/no-public-access/", "text": "Data Factory should have public access disabled, the default is enabled. Default Severity: critical Explanation Data Factory has public access set to true by default. Disabling public network access is applicable only to the self-hosted integration runtime, not to Azure Integration Runtime and SQL Server Integration Services (SSIS) Integration Runtime. Possible Impact Data factory is publicly accessible Suggested Resolution Set public access to disabled for Data Factory Insecure Example The following example will fail the azure-datafactory-no-public-access check. resource \"azurerm_data_factory\" \"bad_example\" { name = \"example\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name } Secure Example The following example will pass the azure-datafactory-no-public-access check. resource \"azurerm_data_factory\" \"good_example\" { name = \"example\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name public_network_enabled = false } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_factory#public_network_enabled https://docs.microsoft.com/en-us/azure/data-factory/data-movement-security-considerations#hybrid-scenarios", "title": "no-public-access"}, {"location": "checks/azure/datafactory/no-public-access/#data-factory-should-have-public-access-disabled-the-default-is-enabled", "text": "", "title": "Data Factory should have public access disabled, the default is enabled."}, {"location": "checks/azure/datafactory/no-public-access/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/datafactory/no-public-access/#explanation", "text": "Data Factory has public access set to true by default. Disabling public network access is applicable only to the self-hosted integration runtime, not to Azure Integration Runtime and SQL Server Integration Services (SSIS) Integration Runtime.", "title": "Explanation"}, {"location": "checks/azure/datafactory/no-public-access/#possible-impact", "text": "Data factory is publicly accessible", "title": "Possible Impact"}, {"location": "checks/azure/datafactory/no-public-access/#suggested-resolution", "text": "Set public access to disabled for Data Factory", "title": "Suggested Resolution"}, {"location": "checks/azure/datafactory/no-public-access/#insecure-example", "text": "The following example will fail the azure-datafactory-no-public-access check. resource \"azurerm_data_factory\" \"bad_example\" { name = \"example\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name }", "title": "Insecure Example"}, {"location": "checks/azure/datafactory/no-public-access/#secure-example", "text": "The following example will pass the azure-datafactory-no-public-access check. resource \"azurerm_data_factory\" \"good_example\" { name = \"example\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name public_network_enabled = false }", "title": "Secure Example"}, {"location": "checks/azure/datafactory/no-public-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_factory#public_network_enabled https://docs.microsoft.com/en-us/azure/data-factory/data-movement-security-considerations#hybrid-scenarios", "title": "Links"}, {"location": "checks/azure/datalake/enable-at-rest-encryption/", "text": "Unencrypted data lake storage. Default Severity: high Explanation Datalake storage encryption defaults to Enabled, it shouldn't be overridden to Disabled. Possible Impact Data could be read if compromised Suggested Resolution Enable encryption of data lake storage Insecure Example The following example will fail the azure-datalake-enable-at-rest-encryption check. resource \"azurerm_data_lake_store\" \"bad_example\" { encryption_state = \"Disabled\" } Secure Example The following example will pass the azure-datalake-enable-at-rest-encryption check. resource \"azurerm_data_lake_store\" \"good_example\" { encryption_state = \"Enabled\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_lake_store https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-security-overview", "title": "enable-at-rest-encryption"}, {"location": "checks/azure/datalake/enable-at-rest-encryption/#unencrypted-data-lake-storage", "text": "", "title": "Unencrypted data lake storage."}, {"location": "checks/azure/datalake/enable-at-rest-encryption/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/datalake/enable-at-rest-encryption/#explanation", "text": "Datalake storage encryption defaults to Enabled, it shouldn't be overridden to Disabled.", "title": "Explanation"}, {"location": "checks/azure/datalake/enable-at-rest-encryption/#possible-impact", "text": "Data could be read if compromised", "title": "Possible Impact"}, {"location": "checks/azure/datalake/enable-at-rest-encryption/#suggested-resolution", "text": "Enable encryption of data lake storage", "title": "Suggested Resolution"}, {"location": "checks/azure/datalake/enable-at-rest-encryption/#insecure-example", "text": "The following example will fail the azure-datalake-enable-at-rest-encryption check. resource \"azurerm_data_lake_store\" \"bad_example\" { encryption_state = \"Disabled\" }", "title": "Insecure Example"}, {"location": "checks/azure/datalake/enable-at-rest-encryption/#secure-example", "text": "The following example will pass the azure-datalake-enable-at-rest-encryption check. resource \"azurerm_data_lake_store\" \"good_example\" { encryption_state = \"Enabled\" }", "title": "Secure Example"}, {"location": "checks/azure/datalake/enable-at-rest-encryption/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_lake_store https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-security-overview", "title": "Links"}, {"location": "checks/azure/keyvault/content-type-for-secret/", "text": "Key vault Secret should have a content type set Default Severity: low Explanation Content Type is an optional Key Vault Secret behavior and is not enabled by default. Clients may specify the content type of a secret to assist in interpreting the secret data when it's retrieved. The maximum length of this field is 255 characters. There are no pre-defined values. The suggested usage is as a hint for interpreting the secret data. Possible Impact The secret's type is unclear without a content type Suggested Resolution Provide content type for secrets to aid interpretation on retrieval Insecure Example The following example will fail the azure-keyvault-content-type-for-secret check. resource \"azurerm_key_vault_secret\" \"bad_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id } Secure Example The following example will pass the azure-keyvault-content-type-for-secret check. resource \"azurerm_key_vault_secret\" \"good_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id content_type = \"password\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#content_type https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets", "title": "content-type-for-secret"}, {"location": "checks/azure/keyvault/content-type-for-secret/#key-vault-secret-should-have-a-content-type-set", "text": "", "title": "Key vault Secret should have a content type set"}, {"location": "checks/azure/keyvault/content-type-for-secret/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/keyvault/content-type-for-secret/#explanation", "text": "Content Type is an optional Key Vault Secret behavior and is not enabled by default. Clients may specify the content type of a secret to assist in interpreting the secret data when it's retrieved. The maximum length of this field is 255 characters. There are no pre-defined values. The suggested usage is as a hint for interpreting the secret data.", "title": "Explanation"}, {"location": "checks/azure/keyvault/content-type-for-secret/#possible-impact", "text": "The secret's type is unclear without a content type", "title": "Possible Impact"}, {"location": "checks/azure/keyvault/content-type-for-secret/#suggested-resolution", "text": "Provide content type for secrets to aid interpretation on retrieval", "title": "Suggested Resolution"}, {"location": "checks/azure/keyvault/content-type-for-secret/#insecure-example", "text": "The following example will fail the azure-keyvault-content-type-for-secret check. resource \"azurerm_key_vault_secret\" \"bad_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id }", "title": "Insecure Example"}, {"location": "checks/azure/keyvault/content-type-for-secret/#secure-example", "text": "The following example will pass the azure-keyvault-content-type-for-secret check. resource \"azurerm_key_vault_secret\" \"good_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id content_type = \"password\" }", "title": "Secure Example"}, {"location": "checks/azure/keyvault/content-type-for-secret/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#content_type https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets", "title": "Links"}, {"location": "checks/azure/keyvault/ensure-key-expiry/", "text": "Ensure that the expiration date is set on all keys Default Severity: medium Explanation Expiration Date is an optional Key Vault Key behavior and is not set by default. Set when the resource will be become inactive. Possible Impact Long life keys increase the attack surface when compromised Suggested Resolution Set an expiration date on the vault key Insecure Example The following example will fail the azure-keyvault-ensure-key-expiry check. resource \"azurerm_key_vault_key\" \"bad_example\" { name = \"generated-certificate\" key_vault_id = azurerm_key_vault.example.id key_type = \"RSA\" key_size = 2048 key_opts = [ \"decrypt\" , \"encrypt\" , \"sign\" , \"unwrapKey\" , \"verify\" , \"wrapKey\" , ] } Secure Example The following example will pass the azure-keyvault-ensure-key-expiry check. resource \"azurerm_key_vault_key\" \"good_example\" { name = \"generated-certificate\" key_vault_id = azurerm_key_vault.example.id key_type = \"RSA\" key_size = 2048 expiration_date = \"1982-12-31T00:00:00Z\" key_opts = [ \"decrypt\" , \"encrypt\" , \"sign\" , \"unwrapKey\" , \"verify\" , \"wrapKey\" , ] } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_key#expiration_date https://docs.microsoft.com/en-us/powershell/module/az.keyvault/update-azkeyvaultkey?view=azps-5.8.0#example-1--modify-a-key-to-enable-it--and-set-the-expiration-date-and-tags", "title": "ensure-key-expiry"}, {"location": "checks/azure/keyvault/ensure-key-expiry/#ensure-that-the-expiration-date-is-set-on-all-keys", "text": "", "title": "Ensure that the expiration date is set on all keys"}, {"location": "checks/azure/keyvault/ensure-key-expiry/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/keyvault/ensure-key-expiry/#explanation", "text": "Expiration Date is an optional Key Vault Key behavior and is not set by default. Set when the resource will be become inactive.", "title": "Explanation"}, {"location": "checks/azure/keyvault/ensure-key-expiry/#possible-impact", "text": "Long life keys increase the attack surface when compromised", "title": "Possible Impact"}, {"location": "checks/azure/keyvault/ensure-key-expiry/#suggested-resolution", "text": "Set an expiration date on the vault key", "title": "Suggested Resolution"}, {"location": "checks/azure/keyvault/ensure-key-expiry/#insecure-example", "text": "The following example will fail the azure-keyvault-ensure-key-expiry check. resource \"azurerm_key_vault_key\" \"bad_example\" { name = \"generated-certificate\" key_vault_id = azurerm_key_vault.example.id key_type = \"RSA\" key_size = 2048 key_opts = [ \"decrypt\" , \"encrypt\" , \"sign\" , \"unwrapKey\" , \"verify\" , \"wrapKey\" , ] }", "title": "Insecure Example"}, {"location": "checks/azure/keyvault/ensure-key-expiry/#secure-example", "text": "The following example will pass the azure-keyvault-ensure-key-expiry check. resource \"azurerm_key_vault_key\" \"good_example\" { name = \"generated-certificate\" key_vault_id = azurerm_key_vault.example.id key_type = \"RSA\" key_size = 2048 expiration_date = \"1982-12-31T00:00:00Z\" key_opts = [ \"decrypt\" , \"encrypt\" , \"sign\" , \"unwrapKey\" , \"verify\" , \"wrapKey\" , ] }", "title": "Secure Example"}, {"location": "checks/azure/keyvault/ensure-key-expiry/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_key#expiration_date https://docs.microsoft.com/en-us/powershell/module/az.keyvault/update-azkeyvaultkey?view=azps-5.8.0#example-1--modify-a-key-to-enable-it--and-set-the-expiration-date-and-tags", "title": "Links"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/", "text": "Key Vault Secret should have an expiration date set Default Severity: low Explanation Expiration Date is an optional Key Vault Secret behavior and is not set by default. Set when the resource will be become inactive. Possible Impact Long life secrets increase the opportunity for compromise Suggested Resolution Set an expiry for secrets Insecure Example The following example will fail the azure-keyvault-ensure-secret-expiry check. resource \"azurerm_key_vault_secret\" \"bad_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id } Secure Example The following example will pass the azure-keyvault-ensure-secret-expiry check. resource \"azurerm_key_vault_secret\" \"good_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id expiration_date = \"1982-12-31T00:00:00Z\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#expiration_date https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets", "title": "ensure-secret-expiry"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/#key-vault-secret-should-have-an-expiration-date-set", "text": "", "title": "Key Vault Secret should have an expiration date set"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/#explanation", "text": "Expiration Date is an optional Key Vault Secret behavior and is not set by default. Set when the resource will be become inactive.", "title": "Explanation"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/#possible-impact", "text": "Long life secrets increase the opportunity for compromise", "title": "Possible Impact"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/#suggested-resolution", "text": "Set an expiry for secrets", "title": "Suggested Resolution"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/#insecure-example", "text": "The following example will fail the azure-keyvault-ensure-secret-expiry check. resource \"azurerm_key_vault_secret\" \"bad_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id }", "title": "Insecure Example"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/#secure-example", "text": "The following example will pass the azure-keyvault-ensure-secret-expiry check. resource \"azurerm_key_vault_secret\" \"good_example\" { name = \"secret-sauce\" value = \"szechuan\" key_vault_id = azurerm_key_vault.example.id expiration_date = \"1982-12-31T00:00:00Z\" }", "title": "Secure Example"}, {"location": "checks/azure/keyvault/ensure-secret-expiry/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_secret#expiration_date https://docs.microsoft.com/en-us/azure/key-vault/secrets/about-secrets", "title": "Links"}, {"location": "checks/azure/keyvault/no-purge/", "text": "Key vault should have purge protection enabled Default Severity: medium Explanation Purge protection is an optional Key Vault behavior and is not enabled by default. Purge protection can only be enabled once soft-delete is enabled. It can be turned on via CLI or PowerShell. Possible Impact Keys could be purged from the vault without protection Suggested Resolution Enable purge protection for key vaults Insecure Example The following example will fail the azure-keyvault-no-purge check. resource \"azurerm_key_vault\" \"bad_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.bad_example.location enabled_for_disk_encryption = true purge_protection_enabled = false } Secure Example The following example will pass the azure-keyvault-no-purge check. resource \"azurerm_key_vault\" \"good_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.good_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = true } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#purge_protection_enabled https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-overview#purge-protection", "title": "no-purge"}, {"location": "checks/azure/keyvault/no-purge/#key-vault-should-have-purge-protection-enabled", "text": "", "title": "Key vault should have purge protection enabled"}, {"location": "checks/azure/keyvault/no-purge/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/keyvault/no-purge/#explanation", "text": "Purge protection is an optional Key Vault behavior and is not enabled by default. Purge protection can only be enabled once soft-delete is enabled. It can be turned on via CLI or PowerShell.", "title": "Explanation"}, {"location": "checks/azure/keyvault/no-purge/#possible-impact", "text": "Keys could be purged from the vault without protection", "title": "Possible Impact"}, {"location": "checks/azure/keyvault/no-purge/#suggested-resolution", "text": "Enable purge protection for key vaults", "title": "Suggested Resolution"}, {"location": "checks/azure/keyvault/no-purge/#insecure-example", "text": "The following example will fail the azure-keyvault-no-purge check. resource \"azurerm_key_vault\" \"bad_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.bad_example.location enabled_for_disk_encryption = true purge_protection_enabled = false }", "title": "Insecure Example"}, {"location": "checks/azure/keyvault/no-purge/#secure-example", "text": "The following example will pass the azure-keyvault-no-purge check. resource \"azurerm_key_vault\" \"good_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.good_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = true }", "title": "Secure Example"}, {"location": "checks/azure/keyvault/no-purge/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#purge_protection_enabled https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-overview#purge-protection", "title": "Links"}, {"location": "checks/azure/keyvault/specify-network-acl/", "text": "Key vault should have the network acl block specified Default Severity: critical Explanation Network ACLs allow you to reduce your exposure to risk by limiting what can access your key vault. The default action of the Network ACL should be set to deny for when IPs are not matched. Azure services can be allowed to bypass. Possible Impact Without a network ACL the key vault is freely accessible Suggested Resolution Set a network ACL for the key vault Insecure Example The following example will fail the azure-keyvault-specify-network-acl check. resource \"azurerm_key_vault\" \"bad_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.bad_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = false } Secure Example The following example will pass the azure-keyvault-specify-network-acl check. resource \"azurerm_key_vault\" \"good_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.good_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = false network_acls { bypass = \"AzureServices\" default_action = \"Deny\" } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#network_acls https://docs.microsoft.com/en-us/azure/key-vault/general/network-security", "title": "specify-network-acl"}, {"location": "checks/azure/keyvault/specify-network-acl/#key-vault-should-have-the-network-acl-block-specified", "text": "", "title": "Key vault should have the network acl block specified"}, {"location": "checks/azure/keyvault/specify-network-acl/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/keyvault/specify-network-acl/#explanation", "text": "Network ACLs allow you to reduce your exposure to risk by limiting what can access your key vault. The default action of the Network ACL should be set to deny for when IPs are not matched. Azure services can be allowed to bypass.", "title": "Explanation"}, {"location": "checks/azure/keyvault/specify-network-acl/#possible-impact", "text": "Without a network ACL the key vault is freely accessible", "title": "Possible Impact"}, {"location": "checks/azure/keyvault/specify-network-acl/#suggested-resolution", "text": "Set a network ACL for the key vault", "title": "Suggested Resolution"}, {"location": "checks/azure/keyvault/specify-network-acl/#insecure-example", "text": "The following example will fail the azure-keyvault-specify-network-acl check. resource \"azurerm_key_vault\" \"bad_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.bad_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = false }", "title": "Insecure Example"}, {"location": "checks/azure/keyvault/specify-network-acl/#secure-example", "text": "The following example will pass the azure-keyvault-specify-network-acl check. resource \"azurerm_key_vault\" \"good_example\" { name = \"examplekeyvault\" location = azurerm_resource_group.good_example.location enabled_for_disk_encryption = true soft_delete_retention_days = 7 purge_protection_enabled = false network_acls { bypass = \"AzureServices\" default_action = \"Deny\" } }", "title": "Secure Example"}, {"location": "checks/azure/keyvault/specify-network-acl/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault#network_acls https://docs.microsoft.com/en-us/azure/key-vault/general/network-security", "title": "Links"}, {"location": "checks/azure/monitor/activity-log-retention-set/", "text": "Ensure the activity retention log is set to at least a year Default Severity: medium Explanation The average time to detect a breach is up to 210 days, to ensure that all the information required for an effective investigation is available, the retention period should allow for delayed starts to investigating. Possible Impact Short life activity logs can lead to missing records when investigating a breach Suggested Resolution Set a retention period that will allow for delayed investigation Insecure Example The following example will fail the azure-monitor-activity-log-retention-set check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" retention_policy { enabled = true days = 7 } } Secure Example The following example will pass the azure-monitor-activity-log-retention-set check. resource \"azurerm_monitor_log_profile\" \"good_example\" { name = \"good_example\" retention_policy { enabled = true days = 365 } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#retention_policy https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/platform-logs-overview", "title": "activity-log-retention-set"}, {"location": "checks/azure/monitor/activity-log-retention-set/#ensure-the-activity-retention-log-is-set-to-at-least-a-year", "text": "", "title": "Ensure the activity retention log is set to at least a year"}, {"location": "checks/azure/monitor/activity-log-retention-set/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/monitor/activity-log-retention-set/#explanation", "text": "The average time to detect a breach is up to 210 days, to ensure that all the information required for an effective investigation is available, the retention period should allow for delayed starts to investigating.", "title": "Explanation"}, {"location": "checks/azure/monitor/activity-log-retention-set/#possible-impact", "text": "Short life activity logs can lead to missing records when investigating a breach", "title": "Possible Impact"}, {"location": "checks/azure/monitor/activity-log-retention-set/#suggested-resolution", "text": "Set a retention period that will allow for delayed investigation", "title": "Suggested Resolution"}, {"location": "checks/azure/monitor/activity-log-retention-set/#insecure-example", "text": "The following example will fail the azure-monitor-activity-log-retention-set check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" retention_policy { enabled = true days = 7 } }", "title": "Insecure Example"}, {"location": "checks/azure/monitor/activity-log-retention-set/#secure-example", "text": "The following example will pass the azure-monitor-activity-log-retention-set check. resource \"azurerm_monitor_log_profile\" \"good_example\" { name = \"good_example\" retention_policy { enabled = true days = 365 } }", "title": "Secure Example"}, {"location": "checks/azure/monitor/activity-log-retention-set/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#retention_policy https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/platform-logs-overview", "title": "Links"}, {"location": "checks/azure/monitor/capture-all-activities/", "text": "Ensure log profile captures all activities Default Severity: medium Explanation Log profiles should capture all categories to ensure that all events are logged Possible Impact Log profile must capture all activity to be able to ensure that all relevant information possible is available for an investigation Suggested Resolution Configure log profile to capture all activities Insecure Example The following example will fail the azure-monitor-capture-all-activities check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] retention_policy { enabled = true days = 7 } } Secure Example The following example will pass the azure-monitor-capture-all-activities check. resource \"azurerm_monitor_log_profile\" \"good_example\" { name = \"good_example\" categories = [ \"Action\" , \"Delete\" , \"Write\" , ] retention_policy { enabled = true days = 365 } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#categories https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log https://docs.microsoft.com/en-us/cli/azure/monitor/log-profiles?view=azure-cli-latest#az_monitor_log_profiles_create-required-parameters", "title": "capture-all-activities"}, {"location": "checks/azure/monitor/capture-all-activities/#ensure-log-profile-captures-all-activities", "text": "", "title": "Ensure log profile captures all activities"}, {"location": "checks/azure/monitor/capture-all-activities/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/monitor/capture-all-activities/#explanation", "text": "Log profiles should capture all categories to ensure that all events are logged", "title": "Explanation"}, {"location": "checks/azure/monitor/capture-all-activities/#possible-impact", "text": "Log profile must capture all activity to be able to ensure that all relevant information possible is available for an investigation", "title": "Possible Impact"}, {"location": "checks/azure/monitor/capture-all-activities/#suggested-resolution", "text": "Configure log profile to capture all activities", "title": "Suggested Resolution"}, {"location": "checks/azure/monitor/capture-all-activities/#insecure-example", "text": "The following example will fail the azure-monitor-capture-all-activities check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] retention_policy { enabled = true days = 7 } }", "title": "Insecure Example"}, {"location": "checks/azure/monitor/capture-all-activities/#secure-example", "text": "The following example will pass the azure-monitor-capture-all-activities check. resource \"azurerm_monitor_log_profile\" \"good_example\" { name = \"good_example\" categories = [ \"Action\" , \"Delete\" , \"Write\" , ] retention_policy { enabled = true days = 365 } }", "title": "Secure Example"}, {"location": "checks/azure/monitor/capture-all-activities/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#categories https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log https://docs.microsoft.com/en-us/cli/azure/monitor/log-profiles?view=azure-cli-latest#az_monitor_log_profiles_create-required-parameters", "title": "Links"}, {"location": "checks/azure/monitor/capture-all-regions/", "text": "Ensure activitys are captured for all locations Default Severity: medium Explanation Log profiles should capture all regions to ensure that all events are logged Possible Impact Activity may be occurring in locations that aren't being monitored Suggested Resolution Enable capture for all locations Insecure Example The following example will fail the azure-monitor-capture-all-regions check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] locations = [ \"westus\" , \"global\" , ] retention_policy { enabled = true days = 7 } } Secure Example The following example will pass the azure-monitor-capture-all-regions check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] locations = [ \"eastus\" , \"eastus2\" , \"southcentralus\" , \"westus2\" , \"westus3\" , \"australiaeast\" , \"southeastasia\" , \"northeurope\" , \"swedencentral\" , \"uksouth\" , \"westeurope\" , \"centralus\" , \"northcentralus\" , \"westus\" , \"southafricanorth\" , \"centralindia\" , \"eastasia\" , \"japaneast\" , \"jioindiawest\" , \"koreacentral\" , \"canadacentral\" , \"francecentral\" , \"germanywestcentral\" , \"norwayeast\" , \"switzerlandnorth\" , \"uaenorth\" , \"brazilsouth\" , \"centralusstage\" , \"eastusstage\" , \"eastus2stage\" , \"northcentralusstage\" , \"southcentralusstage\" , \"westusstage\" , \"westus2stage\" , \"asia\" , \"asiapacific\" , \"australia\" , \"brazil\" , \"canada\" , \"europe\" , \"global\" , \"india\" , \"japan\" , \"uk\" , \"unitedstates\" , \"eastasiastage\" , \"southeastasiastage\" , \"centraluseuap\" , \"eastus2euap\" , \"westcentralus\" , \"southafricawest\" , \"australiacentral\" , \"australiacentral2\" , \"australiasoutheast\" , \"japanwest\" , \"jioindiacentral\" , \"koreasouth\" , \"southindia\" , \"westindia\" , \"canadaeast\" , \"francesouth\" , \"germanynorth\" , \"norwaywest\" , \"swedensouth\" , \"switzerlandwest\" , \"ukwest\" , \"uaecentral\" , \"brazilsoutheast\" , ] retention_policy { enabled = true days = 7 } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#locations https://docs.microsoft.com/en-us/cli/azure/monitor/log-profiles?view=azure-cli-latest#az_monitor_log_profiles_create-required-parameters", "title": "capture-all-regions"}, {"location": "checks/azure/monitor/capture-all-regions/#ensure-activitys-are-captured-for-all-locations", "text": "", "title": "Ensure activitys are captured for all locations"}, {"location": "checks/azure/monitor/capture-all-regions/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/monitor/capture-all-regions/#explanation", "text": "Log profiles should capture all regions to ensure that all events are logged", "title": "Explanation"}, {"location": "checks/azure/monitor/capture-all-regions/#possible-impact", "text": "Activity may be occurring in locations that aren't being monitored", "title": "Possible Impact"}, {"location": "checks/azure/monitor/capture-all-regions/#suggested-resolution", "text": "Enable capture for all locations", "title": "Suggested Resolution"}, {"location": "checks/azure/monitor/capture-all-regions/#insecure-example", "text": "The following example will fail the azure-monitor-capture-all-regions check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] locations = [ \"westus\" , \"global\" , ] retention_policy { enabled = true days = 7 } }", "title": "Insecure Example"}, {"location": "checks/azure/monitor/capture-all-regions/#secure-example", "text": "The following example will pass the azure-monitor-capture-all-regions check. resource \"azurerm_monitor_log_profile\" \"bad_example\" { name = \"bad_example\" categories = [] locations = [ \"eastus\" , \"eastus2\" , \"southcentralus\" , \"westus2\" , \"westus3\" , \"australiaeast\" , \"southeastasia\" , \"northeurope\" , \"swedencentral\" , \"uksouth\" , \"westeurope\" , \"centralus\" , \"northcentralus\" , \"westus\" , \"southafricanorth\" , \"centralindia\" , \"eastasia\" , \"japaneast\" , \"jioindiawest\" , \"koreacentral\" , \"canadacentral\" , \"francecentral\" , \"germanywestcentral\" , \"norwayeast\" , \"switzerlandnorth\" , \"uaenorth\" , \"brazilsouth\" , \"centralusstage\" , \"eastusstage\" , \"eastus2stage\" , \"northcentralusstage\" , \"southcentralusstage\" , \"westusstage\" , \"westus2stage\" , \"asia\" , \"asiapacific\" , \"australia\" , \"brazil\" , \"canada\" , \"europe\" , \"global\" , \"india\" , \"japan\" , \"uk\" , \"unitedstates\" , \"eastasiastage\" , \"southeastasiastage\" , \"centraluseuap\" , \"eastus2euap\" , \"westcentralus\" , \"southafricawest\" , \"australiacentral\" , \"australiacentral2\" , \"australiasoutheast\" , \"japanwest\" , \"jioindiacentral\" , \"koreasouth\" , \"southindia\" , \"westindia\" , \"canadaeast\" , \"francesouth\" , \"germanynorth\" , \"norwaywest\" , \"swedensouth\" , \"switzerlandwest\" , \"ukwest\" , \"uaecentral\" , \"brazilsoutheast\" , ] retention_policy { enabled = true days = 7 } }", "title": "Secure Example"}, {"location": "checks/azure/monitor/capture-all-regions/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_log_profile#locations https://docs.microsoft.com/en-us/cli/azure/monitor/log-profiles?view=azure-cli-latest#az_monitor_log_profiles_create-required-parameters", "title": "Links"}, {"location": "checks/azure/network/disable-rdp-from-internet/", "text": "RDP access should not be accessible from the Internet, should be blocked on port 3389 Default Severity: critical Explanation RDP access can be configured on either the network security group or in the network security group rule. RDP access should not be permitted from the internet (*, 0.0.0.0, /0, internet, any). Consider using the Azure Bastion Service. Possible Impact Anyone from the internet can potentially RDP onto an instance Suggested Resolution Block RDP port from internet Insecure Example The following example will fail the azure-network-disable-rdp-from-internet check. resource \"azurerm_network_security_rule\" \"bad_example\" { name = \"bad_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_ranges = [ \"3389\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_ranges = [ \"3389\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } } Secure Example The following example will pass the azure-network-disable-rdp-from-internet check. resource \"azurerm_network_security_rule\" \"good_example\" { name = \"good_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_ranges = [ \"3389\" ] source_address_prefix = \"4.53.160.75\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_ranges = [ \"3389\" ] source_address_prefix = \"4.53.160.75\" destination_address_prefix = \"*\" } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/network_security_group#security_rule https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule#source_port_ranges https://docs.microsoft.com/en-us/azure/bastion/tutorial-create-host-portal", "title": "disable-rdp-from-internet"}, {"location": "checks/azure/network/disable-rdp-from-internet/#rdp-access-should-not-be-accessible-from-the-internet-should-be-blocked-on-port-3389", "text": "", "title": "RDP access should not be accessible from the Internet, should be blocked on port 3389"}, {"location": "checks/azure/network/disable-rdp-from-internet/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/network/disable-rdp-from-internet/#explanation", "text": "RDP access can be configured on either the network security group or in the network security group rule. RDP access should not be permitted from the internet (*, 0.0.0.0, /0, internet, any). Consider using the Azure Bastion Service.", "title": "Explanation"}, {"location": "checks/azure/network/disable-rdp-from-internet/#possible-impact", "text": "Anyone from the internet can potentially RDP onto an instance", "title": "Possible Impact"}, {"location": "checks/azure/network/disable-rdp-from-internet/#suggested-resolution", "text": "Block RDP port from internet", "title": "Suggested Resolution"}, {"location": "checks/azure/network/disable-rdp-from-internet/#insecure-example", "text": "The following example will fail the azure-network-disable-rdp-from-internet check. resource \"azurerm_network_security_rule\" \"bad_example\" { name = \"bad_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_ranges = [ \"3389\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_ranges = [ \"3389\" ] source_address_prefix = \"*\" destination_address_prefix = \"*\" } }", "title": "Insecure Example"}, {"location": "checks/azure/network/disable-rdp-from-internet/#secure-example", "text": "The following example will pass the azure-network-disable-rdp-from-internet check. resource \"azurerm_network_security_rule\" \"good_example\" { name = \"good_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_ranges = [ \"3389\" ] source_address_prefix = \"4.53.160.75\" destination_address_prefix = \"*\" } resource \"azurerm_network_security_group\" \"example\" { name = \"tf-appsecuritygroup\" location = azurerm_resource_group.example.location resource_group_name = azurerm_resource_group.example.name security_rule { source_port_range = \"any\" destination_port_ranges = [ \"3389\" ] source_address_prefix = \"4.53.160.75\" destination_address_prefix = \"*\" } }", "title": "Secure Example"}, {"location": "checks/azure/network/disable-rdp-from-internet/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/network_security_group#security_rule https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule#source_port_ranges https://docs.microsoft.com/en-us/azure/bastion/tutorial-create-host-portal", "title": "Links"}, {"location": "checks/azure/network/no-public-egress/", "text": "An outbound network security rule allows traffic to /0. Default Severity: critical Explanation Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets. Possible Impact The port is exposed for egress to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the azure-network-no-public-egress check. resource \"azurerm_network_security_rule\" \"bad_example\" { direction = \"Outbound\" destination_address_prefix = \"0.0.0.0/0\" access = \"Allow\" } Secure Example The following example will pass the azure-network-no-public-egress check. resource \"azurerm_network_security_rule\" \"good_example\" { direction = \"Outbound\" destination_address_prefix = \"10.0.0.0/16\" access = \"Allow\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices", "title": "no-public-egress"}, {"location": "checks/azure/network/no-public-egress/#an-outbound-network-security-rule-allows-traffic-to-0", "text": "", "title": "An outbound network security rule allows traffic to /0."}, {"location": "checks/azure/network/no-public-egress/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/network/no-public-egress/#explanation", "text": "Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets.", "title": "Explanation"}, {"location": "checks/azure/network/no-public-egress/#possible-impact", "text": "The port is exposed for egress to the internet", "title": "Possible Impact"}, {"location": "checks/azure/network/no-public-egress/#suggested-resolution", "text": "Set a more restrictive cidr range", "title": "Suggested Resolution"}, {"location": "checks/azure/network/no-public-egress/#insecure-example", "text": "The following example will fail the azure-network-no-public-egress check. resource \"azurerm_network_security_rule\" \"bad_example\" { direction = \"Outbound\" destination_address_prefix = \"0.0.0.0/0\" access = \"Allow\" }", "title": "Insecure Example"}, {"location": "checks/azure/network/no-public-egress/#secure-example", "text": "The following example will pass the azure-network-no-public-egress check. resource \"azurerm_network_security_rule\" \"good_example\" { direction = \"Outbound\" destination_address_prefix = \"10.0.0.0/16\" access = \"Allow\" }", "title": "Secure Example"}, {"location": "checks/azure/network/no-public-egress/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices", "title": "Links"}, {"location": "checks/azure/network/no-public-ingress/", "text": "An inbound network security rule allows traffic from /0. Default Severity: critical Explanation Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets. Possible Impact The port is exposed for ingress from the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the azure-network-no-public-ingress check. resource \"azurerm_network_security_rule\" \"bad_example\" { direction = \"Inbound\" source_address_prefix = \"0.0.0.0/0\" access = \"Allow\" } Secure Example The following example will pass the azure-network-no-public-ingress check. resource \"azurerm_network_security_rule\" \"good_example\" { direction = \"Inbound\" destination_address_prefix = \"10.0.0.0/16\" access = \"Allow\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices", "title": "no-public-ingress"}, {"location": "checks/azure/network/no-public-ingress/#an-inbound-network-security-rule-allows-traffic-from-0", "text": "", "title": "An inbound network security rule allows traffic from /0."}, {"location": "checks/azure/network/no-public-ingress/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/network/no-public-ingress/#explanation", "text": "Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets.", "title": "Explanation"}, {"location": "checks/azure/network/no-public-ingress/#possible-impact", "text": "The port is exposed for ingress from the internet", "title": "Possible Impact"}, {"location": "checks/azure/network/no-public-ingress/#suggested-resolution", "text": "Set a more restrictive cidr range", "title": "Suggested Resolution"}, {"location": "checks/azure/network/no-public-ingress/#insecure-example", "text": "The following example will fail the azure-network-no-public-ingress check. resource \"azurerm_network_security_rule\" \"bad_example\" { direction = \"Inbound\" source_address_prefix = \"0.0.0.0/0\" access = \"Allow\" }", "title": "Insecure Example"}, {"location": "checks/azure/network/no-public-ingress/#secure-example", "text": "The following example will pass the azure-network-no-public-ingress check. resource \"azurerm_network_security_rule\" \"good_example\" { direction = \"Inbound\" destination_address_prefix = \"10.0.0.0/16\" access = \"Allow\" }", "title": "Secure Example"}, {"location": "checks/azure/network/no-public-ingress/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices", "title": "Links"}, {"location": "checks/azure/network/retention-policy-set/", "text": "Retention policy for flow logs should be enabled and set to greater than 90 days Default Severity: low Explanation Flow logs are the source of truth for all network activity in your cloud environment. To enable analysis in security event that was detected late, you need to have the logs available. Setting an retention policy will help ensure as much information is available for review. Possible Impact Not enabling retention or having short expiry on flow logs could lead to compromise being undetected limiting time for analysis Suggested Resolution Ensure flow log retention is turned on with an expiry of >90 days Insecure Example The following example will fail the azure-network-retention-policy-set check. resource \"azurerm_network_watcher_flow_log\" \"bad_watcher\" { network_watcher_name = \"bad_watcher\" resource_group_name = \"resource-group\" network_security_group_id = azurerm_network_security_group.test.id storage_account_id = azurerm_storage_account.test.id enabled = true retention_policy { enabled = true days = 7 } } Secure Example The following example will pass the azure-network-retention-policy-set check. resource \"azurerm_network_watcher_flow_log\" \"good_watcher\" { network_watcher_name = \"good_watcher\" resource_group_name = \"resource-group\" network_security_group_id = azurerm_network_security_group.test.id storage_account_id = azurerm_storage_account.test.id enabled = true retention_policy { enabled = true days = 90 } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_watcher_flow_log#retention_policy https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview", "title": "retention-policy-set"}, {"location": "checks/azure/network/retention-policy-set/#retention-policy-for-flow-logs-should-be-enabled-and-set-to-greater-than-90-days", "text": "", "title": "Retention policy for flow logs should be enabled and set to greater than 90 days"}, {"location": "checks/azure/network/retention-policy-set/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/network/retention-policy-set/#explanation", "text": "Flow logs are the source of truth for all network activity in your cloud environment. To enable analysis in security event that was detected late, you need to have the logs available. Setting an retention policy will help ensure as much information is available for review.", "title": "Explanation"}, {"location": "checks/azure/network/retention-policy-set/#possible-impact", "text": "Not enabling retention or having short expiry on flow logs could lead to compromise being undetected limiting time for analysis", "title": "Possible Impact"}, {"location": "checks/azure/network/retention-policy-set/#suggested-resolution", "text": "Ensure flow log retention is turned on with an expiry of >90 days", "title": "Suggested Resolution"}, {"location": "checks/azure/network/retention-policy-set/#insecure-example", "text": "The following example will fail the azure-network-retention-policy-set check. resource \"azurerm_network_watcher_flow_log\" \"bad_watcher\" { network_watcher_name = \"bad_watcher\" resource_group_name = \"resource-group\" network_security_group_id = azurerm_network_security_group.test.id storage_account_id = azurerm_storage_account.test.id enabled = true retention_policy { enabled = true days = 7 } }", "title": "Insecure Example"}, {"location": "checks/azure/network/retention-policy-set/#secure-example", "text": "The following example will pass the azure-network-retention-policy-set check. resource \"azurerm_network_watcher_flow_log\" \"good_watcher\" { network_watcher_name = \"good_watcher\" resource_group_name = \"resource-group\" network_security_group_id = azurerm_network_security_group.test.id storage_account_id = azurerm_storage_account.test.id enabled = true retention_policy { enabled = true days = 90 } }", "title": "Secure Example"}, {"location": "checks/azure/network/retention-policy-set/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_watcher_flow_log#retention_policy https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview", "title": "Links"}, {"location": "checks/azure/network/ssh-blocked-from-internet/", "text": "SSH access should not be accessible from the Internet, should be blocked on port 22 Default Severity: critical Explanation SSH access can be configured on either the network security group or in the network security group rule. SSH access should not be permitted from the internet (*, 0.0.0.0, /0, internet, any) Possible Impact Its dangerous to allow SSH access from the internet Suggested Resolution Block port 22 access from the internet Insecure Example The following example will fail the azure-network-ssh-blocked-from-internet check. resource \"azurerm_network_security_rule\" \"bad_example\" { name = \"bad_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = \"22\" source_address_prefix = \"*\" destination_address_prefix = \"*\" } Secure Example The following example will pass the azure-network-ssh-blocked-from-internet check. resource \"azurerm_network_security_rule\" \"good_example\" { name = \"good_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = \"22\" source_address_prefix = \"82.102.23.23\" destination_address_prefix = \"*\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/network_security_group#security_rule https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule#source_port_ranges", "title": "ssh-blocked-from-internet"}, {"location": "checks/azure/network/ssh-blocked-from-internet/#ssh-access-should-not-be-accessible-from-the-internet-should-be-blocked-on-port-22", "text": "", "title": "SSH access should not be accessible from the Internet, should be blocked on port 22"}, {"location": "checks/azure/network/ssh-blocked-from-internet/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/network/ssh-blocked-from-internet/#explanation", "text": "SSH access can be configured on either the network security group or in the network security group rule. SSH access should not be permitted from the internet (*, 0.0.0.0, /0, internet, any)", "title": "Explanation"}, {"location": "checks/azure/network/ssh-blocked-from-internet/#possible-impact", "text": "Its dangerous to allow SSH access from the internet", "title": "Possible Impact"}, {"location": "checks/azure/network/ssh-blocked-from-internet/#suggested-resolution", "text": "Block port 22 access from the internet", "title": "Suggested Resolution"}, {"location": "checks/azure/network/ssh-blocked-from-internet/#insecure-example", "text": "The following example will fail the azure-network-ssh-blocked-from-internet check. resource \"azurerm_network_security_rule\" \"bad_example\" { name = \"bad_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = \"22\" source_address_prefix = \"*\" destination_address_prefix = \"*\" }", "title": "Insecure Example"}, {"location": "checks/azure/network/ssh-blocked-from-internet/#secure-example", "text": "The following example will pass the azure-network-ssh-blocked-from-internet check. resource \"azurerm_network_security_rule\" \"good_example\" { name = \"good_example_security_rule\" direction = \"Inbound\" access = \"Allow\" protocol = \"TCP\" source_port_range = \"*\" destination_port_range = \"22\" source_address_prefix = \"82.102.23.23\" destination_address_prefix = \"*\" }", "title": "Secure Example"}, {"location": "checks/azure/network/ssh-blocked-from-internet/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/network_security_group#security_rule https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_security_rule#source_port_ranges", "title": "Links"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/", "text": "Send notification emails for high severity alerts Default Severity: medium Explanation It is recommended that at least one valid contact is configured for the security center. Microsoft will notify the security contact directly in the event of a security incident using email and require alerting to be turned on. Possible Impact The ability to react to high severity notifications could be delayed Suggested Resolution Set alert notifications to be on Insecure Example The following example will fail the azure-security-center-alert-on-severe-notifications check. resource \"azurerm_security_center_contact\" \"bad_example\" { email = \"bad_example@example.com\" phone = \"+1-555-555-5555\" alert_notifications = false alerts_to_admins = false } Secure Example The following example will pass the azure-security-center-alert-on-severe-notifications check. resource \"azurerm_security_center_contact\" \"good_example\" { email = \"good_example@example.com\" phone = \"+1-555-555-5555\" alert_notifications = true alerts_to_admins = true } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#alert_notifications https://azure.microsoft.com/en-us/services/security-center/", "title": "alert-on-severe-notifications"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/#send-notification-emails-for-high-severity-alerts", "text": "", "title": "Send notification emails for high severity alerts"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/#explanation", "text": "It is recommended that at least one valid contact is configured for the security center. Microsoft will notify the security contact directly in the event of a security incident using email and require alerting to be turned on.", "title": "Explanation"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/#possible-impact", "text": "The ability to react to high severity notifications could be delayed", "title": "Possible Impact"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/#suggested-resolution", "text": "Set alert notifications to be on", "title": "Suggested Resolution"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/#insecure-example", "text": "The following example will fail the azure-security-center-alert-on-severe-notifications check. resource \"azurerm_security_center_contact\" \"bad_example\" { email = \"bad_example@example.com\" phone = \"+1-555-555-5555\" alert_notifications = false alerts_to_admins = false }", "title": "Insecure Example"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/#secure-example", "text": "The following example will pass the azure-security-center-alert-on-severe-notifications check. resource \"azurerm_security_center_contact\" \"good_example\" { email = \"good_example@example.com\" phone = \"+1-555-555-5555\" alert_notifications = true alerts_to_admins = true }", "title": "Secure Example"}, {"location": "checks/azure/security-center/alert-on-severe-notifications/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#alert_notifications https://azure.microsoft.com/en-us/services/security-center/", "title": "Links"}, {"location": "checks/azure/security-center/enable-standard-subscription/", "text": "Enable the standard security center subscription tier Default Severity: low Explanation To benefit from Azure Defender you should use the Standard subscription tier. Enabling Azure Defender extends the capabilities of the free mode to workloads running in private and other public clouds, providing unified security management and threat protection across your hybrid cloud workloads. Possible Impact Using free subscription does not enable Azure Defender for the resource type Suggested Resolution Enable standard subscription tier to benefit from Azure Defender Insecure Example The following example will fail the azure-security-center-enable-standard-subscription check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" } Secure Example The following example will pass the azure-security-center-enable-standard-subscription check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#tier https://docs.microsoft.com/en-us/azure/security-center/security-center-pricing", "title": "enable-standard-subscription"}, {"location": "checks/azure/security-center/enable-standard-subscription/#enable-the-standard-security-center-subscription-tier", "text": "", "title": "Enable the standard security center subscription tier"}, {"location": "checks/azure/security-center/enable-standard-subscription/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/security-center/enable-standard-subscription/#explanation", "text": "To benefit from Azure Defender you should use the Standard subscription tier. Enabling Azure Defender extends the capabilities of the free mode to workloads running in private and other public clouds, providing unified security management and threat protection across your hybrid cloud workloads.", "title": "Explanation"}, {"location": "checks/azure/security-center/enable-standard-subscription/#possible-impact", "text": "Using free subscription does not enable Azure Defender for the resource type", "title": "Possible Impact"}, {"location": "checks/azure/security-center/enable-standard-subscription/#suggested-resolution", "text": "Enable standard subscription tier to benefit from Azure Defender", "title": "Suggested Resolution"}, {"location": "checks/azure/security-center/enable-standard-subscription/#insecure-example", "text": "The following example will fail the azure-security-center-enable-standard-subscription check. resource \"azurerm_security_center_subscription_pricing\" \"bad_example\" { tier = \"Free\" resource_type = \"VirtualMachines\" }", "title": "Insecure Example"}, {"location": "checks/azure/security-center/enable-standard-subscription/#secure-example", "text": "The following example will pass the azure-security-center-enable-standard-subscription check. resource \"azurerm_security_center_subscription_pricing\" \"good_example\" { tier = \"Standard\" resource_type = \"VirtualMachines\" }", "title": "Secure Example"}, {"location": "checks/azure/security-center/enable-standard-subscription/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_subscription_pricing#tier https://docs.microsoft.com/en-us/azure/security-center/security-center-pricing", "title": "Links"}, {"location": "checks/azure/security-center/set-required-contact-details/", "text": "The required contact details should be set for security center Default Severity: low Explanation It is recommended that at least one valid contact is configured for the security center. Microsoft will notify the security contact directly in the event of a security incident and will look to use a telephone number in cases where a prompt response is required. Possible Impact Without a telephone number set, Azure support can't contact Suggested Resolution Set a telephone number for security center contact Insecure Example The following example will fail the azure-security-center-set-required-contact-details check. resource \"azurerm_security_center_contact\" \"bad_example\" { email = \"bad_contact@example.com\" phone = \"\" alert_notifications = true alerts_to_admins = true } Secure Example The following example will pass the azure-security-center-set-required-contact-details check. resource \"azurerm_security_center_contact\" \"good_example\" { email = \"good_contact@example.com\" phone = \"+1-555-555-5555\" alert_notifications = true alerts_to_admins = true } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#phone https://azure.microsoft.com/en-us/services/security-center/", "title": "set-required-contact-details"}, {"location": "checks/azure/security-center/set-required-contact-details/#the-required-contact-details-should-be-set-for-security-center", "text": "", "title": "The required contact details should be set for security center"}, {"location": "checks/azure/security-center/set-required-contact-details/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/azure/security-center/set-required-contact-details/#explanation", "text": "It is recommended that at least one valid contact is configured for the security center. Microsoft will notify the security contact directly in the event of a security incident and will look to use a telephone number in cases where a prompt response is required.", "title": "Explanation"}, {"location": "checks/azure/security-center/set-required-contact-details/#possible-impact", "text": "Without a telephone number set, Azure support can't contact", "title": "Possible Impact"}, {"location": "checks/azure/security-center/set-required-contact-details/#suggested-resolution", "text": "Set a telephone number for security center contact", "title": "Suggested Resolution"}, {"location": "checks/azure/security-center/set-required-contact-details/#insecure-example", "text": "The following example will fail the azure-security-center-set-required-contact-details check. resource \"azurerm_security_center_contact\" \"bad_example\" { email = \"bad_contact@example.com\" phone = \"\" alert_notifications = true alerts_to_admins = true }", "title": "Insecure Example"}, {"location": "checks/azure/security-center/set-required-contact-details/#secure-example", "text": "The following example will pass the azure-security-center-set-required-contact-details check. resource \"azurerm_security_center_contact\" \"good_example\" { email = \"good_contact@example.com\" phone = \"+1-555-555-5555\" alert_notifications = true alerts_to_admins = true }", "title": "Secure Example"}, {"location": "checks/azure/security-center/set-required-contact-details/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/security_center_contact#phone https://azure.microsoft.com/en-us/services/security-center/", "title": "Links"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/", "text": "Trusted Microsoft Services should have bypass access to Storage accounts Default Severity: high Explanation Some Microsoft services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Microsoft services to bypass the network rules Possible Impact Trusted Microsoft Services won't be able to access storage account unless rules set to allow Suggested Resolution Allow Trusted Microsoft Services to bypass Insecure Example The following example will fail the azure-storage-allow-microsoft-service-bypass check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" network_rules { default_action = \"Deny\" ip_rules = [ \"100.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.example.id ] bypass = [ \"Metrics\" ] } tags = { environment = \"staging\" } } resource \"azurerm_storage_account_network_rules\" \"test\" { resource_group_name = azurerm_resource_group.test.name storage_account_name = azurerm_storage_account.test.name default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] } Secure Example The following example will pass the azure-storage-allow-microsoft-service-bypass check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" network_rules { default_action = \"Deny\" ip_rules = [ \"100.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.example.id ] bypass = [ \"Metrics\", \"AzureServices\" ] } tags = { environment = \"staging\" } } resource \"azurerm_storage_account_network_rules\" \"test\" { resource_group_name = azurerm_resource_group.test.name storage_account_name = azurerm_storage_account.test.name default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\", \"AzureServices\" ] } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#bypass https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#bypass https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security#trusted-microsoft-services", "title": "allow-microsoft-service-bypass"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/#trusted-microsoft-services-should-have-bypass-access-to-storage-accounts", "text": "", "title": "Trusted Microsoft Services should have bypass access to Storage accounts"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/#explanation", "text": "Some Microsoft services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Microsoft services to bypass the network rules", "title": "Explanation"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/#possible-impact", "text": "Trusted Microsoft Services won't be able to access storage account unless rules set to allow", "title": "Possible Impact"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/#suggested-resolution", "text": "Allow Trusted Microsoft Services to bypass", "title": "Suggested Resolution"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/#insecure-example", "text": "The following example will fail the azure-storage-allow-microsoft-service-bypass check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" network_rules { default_action = \"Deny\" ip_rules = [ \"100.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.example.id ] bypass = [ \"Metrics\" ] } tags = { environment = \"staging\" } } resource \"azurerm_storage_account_network_rules\" \"test\" { resource_group_name = azurerm_resource_group.test.name storage_account_name = azurerm_storage_account.test.name default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] }", "title": "Insecure Example"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/#secure-example", "text": "The following example will pass the azure-storage-allow-microsoft-service-bypass check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"LRS\" network_rules { default_action = \"Deny\" ip_rules = [ \"100.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.example.id ] bypass = [ \"Metrics\", \"AzureServices\" ] } tags = { environment = \"staging\" } } resource \"azurerm_storage_account_network_rules\" \"test\" { resource_group_name = azurerm_resource_group.test.name storage_account_name = azurerm_storage_account.test.name default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\", \"AzureServices\" ] }", "title": "Secure Example"}, {"location": "checks/azure/storage/allow-microsoft-service-bypass/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#bypass https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#bypass https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security#trusted-microsoft-services", "title": "Links"}, {"location": "checks/azure/storage/default-action-deny/", "text": "The default action on Storage account network rules should be set to deny Default Severity: critical Explanation The default_action for network rules should come into effect when no other rules are matched. The default action should be set to Deny. Possible Impact Network rules that allow could cause data to be exposed publicly Suggested Resolution Set network rules to deny Insecure Example The following example will fail the azure-storage-default-action-deny check. resource \"azurerm_storage_account_network_rules\" \"bad_example\" { default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] } Secure Example The following example will pass the azure-storage-default-action-deny check. resource \"azurerm_storage_account_network_rules\" \"good_example\" { default_action = \"Deny\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#default_action https://docs.microsoft.com/en-us/azure/firewall/rule-processing", "title": "default-action-deny"}, {"location": "checks/azure/storage/default-action-deny/#the-default-action-on-storage-account-network-rules-should-be-set-to-deny", "text": "", "title": "The default action on Storage account network rules should be set to deny"}, {"location": "checks/azure/storage/default-action-deny/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/storage/default-action-deny/#explanation", "text": "The default_action for network rules should come into effect when no other rules are matched. The default action should be set to Deny.", "title": "Explanation"}, {"location": "checks/azure/storage/default-action-deny/#possible-impact", "text": "Network rules that allow could cause data to be exposed publicly", "title": "Possible Impact"}, {"location": "checks/azure/storage/default-action-deny/#suggested-resolution", "text": "Set network rules to deny", "title": "Suggested Resolution"}, {"location": "checks/azure/storage/default-action-deny/#insecure-example", "text": "The following example will fail the azure-storage-default-action-deny check. resource \"azurerm_storage_account_network_rules\" \"bad_example\" { default_action = \"Allow\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] }", "title": "Insecure Example"}, {"location": "checks/azure/storage/default-action-deny/#secure-example", "text": "The following example will pass the azure-storage-default-action-deny check. resource \"azurerm_storage_account_network_rules\" \"good_example\" { default_action = \"Deny\" ip_rules = [ \"127.0.0.1\" ] virtual_network_subnet_ids = [ azurerm_subnet.test.id ] bypass = [ \"Metrics\" ] }", "title": "Secure Example"}, {"location": "checks/azure/storage/default-action-deny/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account_network_rules#default_action https://docs.microsoft.com/en-us/azure/firewall/rule-processing", "title": "Links"}, {"location": "checks/azure/storage/enforce-https/", "text": "Storage accounts should be configured to only accept transfers that are over secure connections Default Severity: high Explanation You can configure your storage account to accept requests from secure connections only by setting the Secure transfer required property for the storage account. When you require secure transfer, any requests originating from an insecure connection are rejected. Microsoft recommends that you always require secure transfer for all of your storage accounts. Possible Impact Insecure transfer of data into secure accounts could be read if intercepted Suggested Resolution Only allow secure connection for transferring data into storage accounts Insecure Example The following example will fail the azure-storage-enforce-https check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" enable_https_traffic_only = false } Secure Example The following example will pass the azure-storage-enforce-https check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" enable_https_traffic_only = true } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#enable_https_traffic_only https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer", "title": "enforce-https"}, {"location": "checks/azure/storage/enforce-https/#storage-accounts-should-be-configured-to-only-accept-transfers-that-are-over-secure-connections", "text": "", "title": "Storage accounts should be configured to only accept transfers that are over secure connections"}, {"location": "checks/azure/storage/enforce-https/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/storage/enforce-https/#explanation", "text": "You can configure your storage account to accept requests from secure connections only by setting the Secure transfer required property for the storage account. When you require secure transfer, any requests originating from an insecure connection are rejected. Microsoft recommends that you always require secure transfer for all of your storage accounts.", "title": "Explanation"}, {"location": "checks/azure/storage/enforce-https/#possible-impact", "text": "Insecure transfer of data into secure accounts could be read if intercepted", "title": "Possible Impact"}, {"location": "checks/azure/storage/enforce-https/#suggested-resolution", "text": "Only allow secure connection for transferring data into storage accounts", "title": "Suggested Resolution"}, {"location": "checks/azure/storage/enforce-https/#insecure-example", "text": "The following example will fail the azure-storage-enforce-https check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" enable_https_traffic_only = false }", "title": "Insecure Example"}, {"location": "checks/azure/storage/enforce-https/#secure-example", "text": "The following example will pass the azure-storage-enforce-https check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" enable_https_traffic_only = true }", "title": "Secure Example"}, {"location": "checks/azure/storage/enforce-https/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#enable_https_traffic_only https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer", "title": "Links"}, {"location": "checks/azure/storage/no-public-access/", "text": "Storage containers in blob storage mode should not have public access Default Severity: high Explanation Storage container public access should be off. It can be configured for blobs only, containers and blobs or off entirely. The default is off, with no public access. Explicitly overriding publicAccess to anything other than off should be avoided. Possible Impact Data in the storage container could be exposed publicly Suggested Resolution Disable public access to storage containers Insecure Example The following example will fail the azure-storage-no-public-access check. resource \"azurerm_storage_container\" \"bad_example\" { name = \"terraform-container-storage\" container_access_type = \"blob\" properties = { \"publicAccess\" = \"blob\" } } Secure Example The following example will pass the azure-storage-no-public-access check. resource \"azurerm_storage_container\" \"good_example\" { name = \"terraform-container-storage\" container_access_type = \"private\" } Links https://www.terraform.io/docs/providers/azure/r/storage_container.html#properties https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-configure?tabs=portal#set-the-public-access-level-for-a-container", "title": "no-public-access"}, {"location": "checks/azure/storage/no-public-access/#storage-containers-in-blob-storage-mode-should-not-have-public-access", "text": "", "title": "Storage containers in blob storage mode should not have public access"}, {"location": "checks/azure/storage/no-public-access/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/azure/storage/no-public-access/#explanation", "text": "Storage container public access should be off. It can be configured for blobs only, containers and blobs or off entirely. The default is off, with no public access. Explicitly overriding publicAccess to anything other than off should be avoided.", "title": "Explanation"}, {"location": "checks/azure/storage/no-public-access/#possible-impact", "text": "Data in the storage container could be exposed publicly", "title": "Possible Impact"}, {"location": "checks/azure/storage/no-public-access/#suggested-resolution", "text": "Disable public access to storage containers", "title": "Suggested Resolution"}, {"location": "checks/azure/storage/no-public-access/#insecure-example", "text": "The following example will fail the azure-storage-no-public-access check. resource \"azurerm_storage_container\" \"bad_example\" { name = \"terraform-container-storage\" container_access_type = \"blob\" properties = { \"publicAccess\" = \"blob\" } }", "title": "Insecure Example"}, {"location": "checks/azure/storage/no-public-access/#secure-example", "text": "The following example will pass the azure-storage-no-public-access check. resource \"azurerm_storage_container\" \"good_example\" { name = \"terraform-container-storage\" container_access_type = \"private\" }", "title": "Secure Example"}, {"location": "checks/azure/storage/no-public-access/#links", "text": "https://www.terraform.io/docs/providers/azure/r/storage_container.html#properties https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-configure?tabs=portal#set-the-public-access-level-for-a-container", "title": "Links"}, {"location": "checks/azure/storage/queue-services-logging-enabled/", "text": "When using Queue Services for a storage account, logging should be enabled. Default Severity: medium Explanation Storage Analytics logs detailed information about successful and failed requests to a storage service. This information can be used to monitor individual requests and to diagnose issues with a storage service. Requests are logged on a best-effort basis. Possible Impact Logging provides valuable information about access and usage Suggested Resolution Enable logging for Queue Services Insecure Example The following example will fail the azure-storage-queue-services-logging-enabled check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"example\" resource_group_name = data.azurerm_resource_group.example.name location = data.azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" queue_properties { } } Secure Example The following example will pass the azure-storage-queue-services-logging-enabled check. resource \"azurerm_storage_account\" \"good_example\" { name = \"example\" resource_group_name = data.azurerm_resource_group.example.name location = data.azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" queue_properties { logging { delete = true read = true write = true version = \"1.0\" retention_policy_days = 10 } } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#logging https://docs.microsoft.com/en-us/azure/storage/common/storage-analytics-logging?tabs=dotnet", "title": "queue-services-logging-enabled"}, {"location": "checks/azure/storage/queue-services-logging-enabled/#when-using-queue-services-for-a-storage-account-logging-should-be-enabled", "text": "", "title": "When using Queue Services for a storage account, logging should be enabled."}, {"location": "checks/azure/storage/queue-services-logging-enabled/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/storage/queue-services-logging-enabled/#explanation", "text": "Storage Analytics logs detailed information about successful and failed requests to a storage service. This information can be used to monitor individual requests and to diagnose issues with a storage service. Requests are logged on a best-effort basis.", "title": "Explanation"}, {"location": "checks/azure/storage/queue-services-logging-enabled/#possible-impact", "text": "Logging provides valuable information about access and usage", "title": "Possible Impact"}, {"location": "checks/azure/storage/queue-services-logging-enabled/#suggested-resolution", "text": "Enable logging for Queue Services", "title": "Suggested Resolution"}, {"location": "checks/azure/storage/queue-services-logging-enabled/#insecure-example", "text": "The following example will fail the azure-storage-queue-services-logging-enabled check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"example\" resource_group_name = data.azurerm_resource_group.example.name location = data.azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" queue_properties { } }", "title": "Insecure Example"}, {"location": "checks/azure/storage/queue-services-logging-enabled/#secure-example", "text": "The following example will pass the azure-storage-queue-services-logging-enabled check. resource \"azurerm_storage_account\" \"good_example\" { name = \"example\" resource_group_name = data.azurerm_resource_group.example.name location = data.azurerm_resource_group.example.location account_tier = \"Standard\" account_replication_type = \"GRS\" queue_properties { logging { delete = true read = true write = true version = \"1.0\" retention_policy_days = 10 } } }", "title": "Secure Example"}, {"location": "checks/azure/storage/queue-services-logging-enabled/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#logging https://docs.microsoft.com/en-us/azure/storage/common/storage-analytics-logging?tabs=dotnet", "title": "Links"}, {"location": "checks/azure/storage/use-secure-tls-policy/", "text": "The minimum TLS version for Storage Accounts should be TLS1_2 Default Severity: critical Explanation Azure Storage currently supports three versions of the TLS protocol: 1.0, 1.1, and 1.2. Azure Storage uses TLS 1.2 on public HTTPS endpoints, but TLS 1.0 and TLS 1.1 are still supported for backward compatibility. This check will warn if the minimum TLS is not set to TLS1_2. Possible Impact The TLS version being outdated and has known vulnerabilities Suggested Resolution Use a more recent TLS/SSL policy for the load balancer Insecure Example The following example will fail the azure-storage-use-secure-tls-policy check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location } Secure Example The following example will pass the azure-storage-use-secure-tls-policy check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location min_tls_version = \"TLS1_2\" } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#min_tls_version https://docs.microsoft.com/en-us/azure/storage/common/transport-layer-security-configure-minimum-version", "title": "use-secure-tls-policy"}, {"location": "checks/azure/storage/use-secure-tls-policy/#the-minimum-tls-version-for-storage-accounts-should-be-tls1_2", "text": "", "title": "The minimum TLS version for Storage Accounts should be TLS1_2"}, {"location": "checks/azure/storage/use-secure-tls-policy/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/azure/storage/use-secure-tls-policy/#explanation", "text": "Azure Storage currently supports three versions of the TLS protocol: 1.0, 1.1, and 1.2. Azure Storage uses TLS 1.2 on public HTTPS endpoints, but TLS 1.0 and TLS 1.1 are still supported for backward compatibility. This check will warn if the minimum TLS is not set to TLS1_2.", "title": "Explanation"}, {"location": "checks/azure/storage/use-secure-tls-policy/#possible-impact", "text": "The TLS version being outdated and has known vulnerabilities", "title": "Possible Impact"}, {"location": "checks/azure/storage/use-secure-tls-policy/#suggested-resolution", "text": "Use a more recent TLS/SSL policy for the load balancer", "title": "Suggested Resolution"}, {"location": "checks/azure/storage/use-secure-tls-policy/#insecure-example", "text": "The following example will fail the azure-storage-use-secure-tls-policy check. resource \"azurerm_storage_account\" \"bad_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location }", "title": "Insecure Example"}, {"location": "checks/azure/storage/use-secure-tls-policy/#secure-example", "text": "The following example will pass the azure-storage-use-secure-tls-policy check. resource \"azurerm_storage_account\" \"good_example\" { name = \"storageaccountname\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location min_tls_version = \"TLS1_2\" }", "title": "Secure Example"}, {"location": "checks/azure/storage/use-secure-tls-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account#min_tls_version https://docs.microsoft.com/en-us/azure/storage/common/transport-layer-security-configure-minimum-version", "title": "Links"}, {"location": "checks/azure/synapse/virtual-network-enabled/", "text": "Synapse Workspace should have managed virtual network enabled, the default is disabled. Default Severity: medium Explanation Synapse Workspace does not have managed virtual network enabled by default. When you create your Azure Synapse workspace, you can choose to associate it to a Microsoft Azure Virtual Network. The Virtual Network associated with your workspace is managed by Azure Synapse. This Virtual Network is called a Managed workspace Virtual Network. Managed private endpoints are private endpoints created in a Managed Virtual Network associated with your Azure Synapse workspace. Managed private endpoints establish a private link to Azure resources. You can only use private links in a workspace that has a Managed workspace Virtual Network. Possible Impact Your Synapse workspace is not using the private endpoints Suggested Resolution Set manage virtual network to enabled Insecure Example The following example will fail the azure-synapse-virtual-network-enabled check. resource \"azurerm_synapse_workspace\" \"bad_example\" { name = \"example\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location storage_data_lake_gen2_filesystem_id = azurerm_storage_data_lake_gen2_filesystem.example.id sql_administrator_login = \"sqladminuser\" sql_administrator_login_password = \"H@Sh1CoR3!\" aad_admin { login = \"AzureAD Admin\" object_id = \"00000000-0000-0000-0000-000000000000\" tenant_id = \"00000000-0000-0000-0000-000000000000\" } tags = { Env = \"production\" } } Secure Example The following example will pass the azure-synapse-virtual-network-enabled check. resource \"azurerm_synapse_workspace\" \"good_example\" { name = \"example\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location storage_data_lake_gen2_filesystem_id = azurerm_storage_data_lake_gen2_filesystem.example.id sql_administrator_login = \"sqladminuser\" sql_administrator_login_password = \"H@Sh1CoR3!\" managed_virtual_network_enabled = true aad_admin { login = \"AzureAD Admin\" object_id = \"00000000-0000-0000-0000-000000000000\" tenant_id = \"00000000-0000-0000-0000-000000000000\" } tags = { Env = \"production\" } } Links https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/synapse_workspace#managed_virtual_network_enabled https://docs.microsoft.com/en-us/azure/synapse-analytics/security/synapse-workspace-managed-private-endpoints https://docs.microsoft.com/en-us/azure/synapse-analytics/security/synapse-workspace-managed-vnet", "title": "virtual-network-enabled"}, {"location": "checks/azure/synapse/virtual-network-enabled/#synapse-workspace-should-have-managed-virtual-network-enabled-the-default-is-disabled", "text": "", "title": "Synapse Workspace should have managed virtual network enabled, the default is disabled."}, {"location": "checks/azure/synapse/virtual-network-enabled/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/azure/synapse/virtual-network-enabled/#explanation", "text": "Synapse Workspace does not have managed virtual network enabled by default. When you create your Azure Synapse workspace, you can choose to associate it to a Microsoft Azure Virtual Network. The Virtual Network associated with your workspace is managed by Azure Synapse. This Virtual Network is called a Managed workspace Virtual Network. Managed private endpoints are private endpoints created in a Managed Virtual Network associated with your Azure Synapse workspace. Managed private endpoints establish a private link to Azure resources. You can only use private links in a workspace that has a Managed workspace Virtual Network.", "title": "Explanation"}, {"location": "checks/azure/synapse/virtual-network-enabled/#possible-impact", "text": "Your Synapse workspace is not using the private endpoints", "title": "Possible Impact"}, {"location": "checks/azure/synapse/virtual-network-enabled/#suggested-resolution", "text": "Set manage virtual network to enabled", "title": "Suggested Resolution"}, {"location": "checks/azure/synapse/virtual-network-enabled/#insecure-example", "text": "The following example will fail the azure-synapse-virtual-network-enabled check. resource \"azurerm_synapse_workspace\" \"bad_example\" { name = \"example\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location storage_data_lake_gen2_filesystem_id = azurerm_storage_data_lake_gen2_filesystem.example.id sql_administrator_login = \"sqladminuser\" sql_administrator_login_password = \"H@Sh1CoR3!\" aad_admin { login = \"AzureAD Admin\" object_id = \"00000000-0000-0000-0000-000000000000\" tenant_id = \"00000000-0000-0000-0000-000000000000\" } tags = { Env = \"production\" } }", "title": "Insecure Example"}, {"location": "checks/azure/synapse/virtual-network-enabled/#secure-example", "text": "The following example will pass the azure-synapse-virtual-network-enabled check. resource \"azurerm_synapse_workspace\" \"good_example\" { name = \"example\" resource_group_name = azurerm_resource_group.example.name location = azurerm_resource_group.example.location storage_data_lake_gen2_filesystem_id = azurerm_storage_data_lake_gen2_filesystem.example.id sql_administrator_login = \"sqladminuser\" sql_administrator_login_password = \"H@Sh1CoR3!\" managed_virtual_network_enabled = true aad_admin { login = \"AzureAD Admin\" object_id = \"00000000-0000-0000-0000-000000000000\" tenant_id = \"00000000-0000-0000-0000-000000000000\" } tags = { Env = \"production\" } }", "title": "Secure Example"}, {"location": "checks/azure/synapse/virtual-network-enabled/#links", "text": "https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/synapse_workspace#managed_virtual_network_enabled https://docs.microsoft.com/en-us/azure/synapse-analytics/security/synapse-workspace-managed-private-endpoints https://docs.microsoft.com/en-us/azure/synapse-analytics/security/synapse-workspace-managed-vnet", "title": "Links"}, {"location": "checks/cloudstack/compute/no-sensitive-info/", "text": "No sensitive data stored in user_data Default Severity: high Explanation When creating instances, user data can be used during the initial configuration. User data must not contain sensitive information Possible Impact Sensitive credentials in the user data can be leaked Suggested Resolution Don't use sensitive data in the user data section Insecure Example The following example will fail the cloudstack-compute-no-sensitive-info check. resource \"cloudstack_instance\" \"web\" { name = \"server-1\" service_offering = \"small\" network_id = \"6eb22f91-7454-4107-89f4-36afcdf33021\" template = \"CentOS 6.5\" zone = \"zone-1\" user_data = << EOF export DATABASE_PASSWORD=\\\"SomeSortOfPassword\\\" EOF } export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF } Secure Example The following example will pass the cloudstack-compute-no-sensitive-info check. resource \"cloudstack_instance\" \"web\" { name = \"server-1\" service_offering = \"small\" network_id = \"6eb22f91-7454-4107-89f4-36afcdf33021\" template = \"CentOS 6.5\" zone = \"zone-1\" user_data = << EOF export GREETING=\"Hello there\" EOF } export GREETING = \"Hello there\" EOF } Links https://registry.terraform.io/providers/hashicorp/cloudstack/latest/docs/resources/instance#", "title": "no-sensitive-info"}, {"location": "checks/cloudstack/compute/no-sensitive-info/#no-sensitive-data-stored-in-user_data", "text": "", "title": "No sensitive data stored in user_data"}, {"location": "checks/cloudstack/compute/no-sensitive-info/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/cloudstack/compute/no-sensitive-info/#explanation", "text": "When creating instances, user data can be used during the initial configuration. User data must not contain sensitive information", "title": "Explanation"}, {"location": "checks/cloudstack/compute/no-sensitive-info/#possible-impact", "text": "Sensitive credentials in the user data can be leaked", "title": "Possible Impact"}, {"location": "checks/cloudstack/compute/no-sensitive-info/#suggested-resolution", "text": "Don't use sensitive data in the user data section", "title": "Suggested Resolution"}, {"location": "checks/cloudstack/compute/no-sensitive-info/#insecure-example", "text": "The following example will fail the cloudstack-compute-no-sensitive-info check. resource \"cloudstack_instance\" \"web\" { name = \"server-1\" service_offering = \"small\" network_id = \"6eb22f91-7454-4107-89f4-36afcdf33021\" template = \"CentOS 6.5\" zone = \"zone-1\" user_data = << EOF export DATABASE_PASSWORD=\\\"SomeSortOfPassword\\\" EOF } export DATABASE_PASSWORD = \\ \"SomeSortOfPassword\\\" EOF }", "title": "Insecure Example"}, {"location": "checks/cloudstack/compute/no-sensitive-info/#secure-example", "text": "The following example will pass the cloudstack-compute-no-sensitive-info check. resource \"cloudstack_instance\" \"web\" { name = \"server-1\" service_offering = \"small\" network_id = \"6eb22f91-7454-4107-89f4-36afcdf33021\" template = \"CentOS 6.5\" zone = \"zone-1\" user_data = << EOF export GREETING=\"Hello there\" EOF } export GREETING = \"Hello there\" EOF }", "title": "Secure Example"}, {"location": "checks/cloudstack/compute/no-sensitive-info/#links", "text": "https://registry.terraform.io/providers/hashicorp/cloudstack/latest/docs/resources/instance#", "title": "Links"}, {"location": "checks/digitalocean/compute/enforce-https/", "text": "The load balancer forwarding rule is using an insecure protocol as an entrypoint Default Severity: critical Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact Your inbound traffic is not protected Suggested Resolution Switch to HTTPS to benefit from TLS security features Insecure Example The following example will fail the digitalocean-compute-enforce-https check. resource \"digitalocean_loadbalancer\" \"bad_example\" { name = \"bad_example-1\" region = \"nyc3\" forwarding_rule { entry_port = 80 entry_protocol = \"http\" target_port = 80 target_protocol = \"http\" } droplet_ids = [ digitalocean_droplet.web.id ] } Secure Example The following example will pass the digitalocean-compute-enforce-https check. resource \"digitalocean_loadbalancer\" \"bad_example\" { name = \"bad_example-1\" region = \"nyc3\" forwarding_rule { entry_port = 443 entry_protocol = \"https\" target_port = 443 target_protocol = \"https\" } droplet_ids = [ digitalocean_droplet.web.id ] } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/loadbalancer https://docs.digitalocean.com/products/networking/load-balancers/", "title": "The load balancer forwarding rule is using an insecure protocol as an entrypoint"}, {"location": "checks/digitalocean/compute/enforce-https/#the-load-balancer-forwarding-rule-is-using-an-insecure-protocol-as-an-entrypoint", "text": "", "title": "The load balancer forwarding rule is using an insecure protocol as an entrypoint"}, {"location": "checks/digitalocean/compute/enforce-https/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/digitalocean/compute/enforce-https/#explanation", "text": "Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.", "title": "Explanation"}, {"location": "checks/digitalocean/compute/enforce-https/#possible-impact", "text": "Your inbound traffic is not protected", "title": "Possible Impact"}, {"location": "checks/digitalocean/compute/enforce-https/#suggested-resolution", "text": "Switch to HTTPS to benefit from TLS security features", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/compute/enforce-https/#insecure-example", "text": "The following example will fail the digitalocean-compute-enforce-https check. resource \"digitalocean_loadbalancer\" \"bad_example\" { name = \"bad_example-1\" region = \"nyc3\" forwarding_rule { entry_port = 80 entry_protocol = \"http\" target_port = 80 target_protocol = \"http\" } droplet_ids = [ digitalocean_droplet.web.id ] }", "title": "Insecure Example"}, {"location": "checks/digitalocean/compute/enforce-https/#secure-example", "text": "The following example will pass the digitalocean-compute-enforce-https check. resource \"digitalocean_loadbalancer\" \"bad_example\" { name = \"bad_example-1\" region = \"nyc3\" forwarding_rule { entry_port = 443 entry_protocol = \"https\" target_port = 443 target_protocol = \"https\" } droplet_ids = [ digitalocean_droplet.web.id ] }", "title": "Secure Example"}, {"location": "checks/digitalocean/compute/enforce-https/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/loadbalancer https://docs.digitalocean.com/products/networking/load-balancers/", "title": "Links"}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/", "text": "Kubernetes clusters should be auto-upgraded to ensure that they always contain the latest security patches. Default Severity: critical Explanation Possible Impact Not running the latest security patches on your Kubernetes cluster can make it a target for penetration. Suggested Resolution Set maintenance policy deterministically when auto upgrades are enabled Insecure Example The following example will fail the digitalocean-compute-kubernetes-auto-upgrades-not-enabled check. resource \"digitalocean_kubernetes_cluster\" \"foo\" { name = \"foo\" region = \"nyc1\" version = \"1.20.2-do.0\" auto_upgrade = false node_pool { name = \"autoscale-worker-pool\" size = \"s-2vcpu-2gb\" auto_scale = true min_nodes = 1 max_nodes = 5 } } Secure Example The following example will pass the digitalocean-compute-kubernetes-auto-upgrades-not-enabled check. resource \"digitalocean_kubernetes_cluster\" \"foo\" { name = \"foo\" region = \"nyc1\" version = \"1.20.2-do.0\" auto_upgrade = true node_pool { name = \"autoscale-worker-pool\" size = \"s-2vcpu-2gb\" auto_scale = true min_nodes = 1 max_nodes = 5 } } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/kubernetes_cluster#auto-upgrade-example https://docs.digitalocean.com/products/kubernetes/resources/best-practices/", "title": "Kubernetes clusters should be auto-upgraded to ensure that they always contain the latest security patches."}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/#kubernetes-clusters-should-be-auto-upgraded-to-ensure-that-they-always-contain-the-latest-security-patches", "text": "", "title": "Kubernetes clusters should be auto-upgraded to ensure that they always contain the latest security patches."}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/#explanation", "text": "", "title": "Explanation"}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/#possible-impact", "text": "Not running the latest security patches on your Kubernetes cluster can make it a target for penetration.", "title": "Possible Impact"}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/#suggested-resolution", "text": "Set maintenance policy deterministically when auto upgrades are enabled", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/#insecure-example", "text": "The following example will fail the digitalocean-compute-kubernetes-auto-upgrades-not-enabled check. resource \"digitalocean_kubernetes_cluster\" \"foo\" { name = \"foo\" region = \"nyc1\" version = \"1.20.2-do.0\" auto_upgrade = false node_pool { name = \"autoscale-worker-pool\" size = \"s-2vcpu-2gb\" auto_scale = true min_nodes = 1 max_nodes = 5 } }", "title": "Insecure Example"}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/#secure-example", "text": "The following example will pass the digitalocean-compute-kubernetes-auto-upgrades-not-enabled check. resource \"digitalocean_kubernetes_cluster\" \"foo\" { name = \"foo\" region = \"nyc1\" version = \"1.20.2-do.0\" auto_upgrade = true node_pool { name = \"autoscale-worker-pool\" size = \"s-2vcpu-2gb\" auto_scale = true min_nodes = 1 max_nodes = 5 } }", "title": "Secure Example"}, {"location": "checks/digitalocean/compute/kubernetes-auto-upgrades-not-enabled/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/kubernetes_cluster#auto-upgrade-example https://docs.digitalocean.com/products/kubernetes/resources/best-practices/", "title": "Links"}, {"location": "checks/digitalocean/compute/no-public-egress/", "text": "The firewall has an outbound rule with open access Default Severity: critical Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact The port is exposed for ingress from the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the digitalocean-compute-no-public-egress check. resource \"digitalocean_firewall\" \"bad_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] outbound_rule { protocol = \"tcp\" port_range = \"22\" destination_addresses = [ \"0.0.0.0/0\", \"::/0\" ] } } Secure Example The following example will pass the digitalocean-compute-no-public-egress check. resource \"digitalocean_firewall\" \"good_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] outbound_rule { protocol = \"tcp\" port_range = \"22\" destination_addresses = [ \"192.168.1.0/24\", \"fc00::/7\" ] } } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/firewall https://docs.digitalocean.com/products/networking/firewalls/how-to/configure-rules/", "title": "no-public-egress"}, {"location": "checks/digitalocean/compute/no-public-egress/#the-firewall-has-an-outbound-rule-with-open-access", "text": "", "title": "The firewall has an outbound rule with open access"}, {"location": "checks/digitalocean/compute/no-public-egress/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/digitalocean/compute/no-public-egress/#explanation", "text": "Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.", "title": "Explanation"}, {"location": "checks/digitalocean/compute/no-public-egress/#possible-impact", "text": "The port is exposed for ingress from the internet", "title": "Possible Impact"}, {"location": "checks/digitalocean/compute/no-public-egress/#suggested-resolution", "text": "Set a more restrictive cidr range", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/compute/no-public-egress/#insecure-example", "text": "The following example will fail the digitalocean-compute-no-public-egress check. resource \"digitalocean_firewall\" \"bad_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] outbound_rule { protocol = \"tcp\" port_range = \"22\" destination_addresses = [ \"0.0.0.0/0\", \"::/0\" ] } }", "title": "Insecure Example"}, {"location": "checks/digitalocean/compute/no-public-egress/#secure-example", "text": "The following example will pass the digitalocean-compute-no-public-egress check. resource \"digitalocean_firewall\" \"good_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] outbound_rule { protocol = \"tcp\" port_range = \"22\" destination_addresses = [ \"192.168.1.0/24\", \"fc00::/7\" ] } }", "title": "Secure Example"}, {"location": "checks/digitalocean/compute/no-public-egress/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/firewall https://docs.digitalocean.com/products/networking/firewalls/how-to/configure-rules/", "title": "Links"}, {"location": "checks/digitalocean/compute/no-public-ingress/", "text": "The firewall has an inbound rule with open access Default Severity: critical Explanation Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible. Possible Impact Your port is exposed to the internet Suggested Resolution Set a more restrictive CIRDR range Insecure Example The following example will fail the digitalocean-compute-no-public-ingress check. resource \"digitalocean_firewall\" \"bad_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] inbound_rule { protocol = \"tcp\" port_range = \"22\" source_addresses = [ \"0.0.0.0/0\", \"::/0\" ] } } Secure Example The following example will pass the digitalocean-compute-no-public-ingress check. resource \"digitalocean_firewall\" \"good_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] inbound_rule { protocol = \"tcp\" port_range = \"22\" source_addresses = [ \"192.168.1.0/24\", \"fc00::/7\" ] } } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/firewall https://docs.digitalocean.com/products/networking/firewalls/how-to/configure-rules/", "title": "no-public-ingress"}, {"location": "checks/digitalocean/compute/no-public-ingress/#the-firewall-has-an-inbound-rule-with-open-access", "text": "", "title": "The firewall has an inbound rule with open access"}, {"location": "checks/digitalocean/compute/no-public-ingress/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/digitalocean/compute/no-public-ingress/#explanation", "text": "Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible.", "title": "Explanation"}, {"location": "checks/digitalocean/compute/no-public-ingress/#possible-impact", "text": "Your port is exposed to the internet", "title": "Possible Impact"}, {"location": "checks/digitalocean/compute/no-public-ingress/#suggested-resolution", "text": "Set a more restrictive CIRDR range", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/compute/no-public-ingress/#insecure-example", "text": "The following example will fail the digitalocean-compute-no-public-ingress check. resource \"digitalocean_firewall\" \"bad_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] inbound_rule { protocol = \"tcp\" port_range = \"22\" source_addresses = [ \"0.0.0.0/0\", \"::/0\" ] } }", "title": "Insecure Example"}, {"location": "checks/digitalocean/compute/no-public-ingress/#secure-example", "text": "The following example will pass the digitalocean-compute-no-public-ingress check. resource \"digitalocean_firewall\" \"good_example\" { name = \"only-22-80-and-443\" droplet_ids = [ digitalocean_droplet.web.id ] inbound_rule { protocol = \"tcp\" port_range = \"22\" source_addresses = [ \"192.168.1.0/24\", \"fc00::/7\" ] } }", "title": "Secure Example"}, {"location": "checks/digitalocean/compute/no-public-ingress/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/firewall https://docs.digitalocean.com/products/networking/firewalls/how-to/configure-rules/", "title": "Links"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/", "text": "The Kubernetes cluster does not enable surge upgrades Default Severity: medium Explanation While upgrading your cluster, workloads will temporarily be moved to new nodes. A small cost will follow, but as a bonus, you won't experience downtime. Possible Impact Upgrades may influence availability of your Kubernetes cluster Suggested Resolution Enable surge upgrades in your Kubernetes cluster Insecure Example The following example will fail the digitalocean-compute-surge-upgrades-not-enabled check. resource \"digitalocean_kubernetes_cluster\" \"surge_upgrade_bad\" { name = \"foo\" region = \"nyc1\" version = \"1.20.2-do.0\" surge_upgrade = false node_pool { name = \"worker-pool\" size = \"s-2vcpu-2gb\" node_count = 3 taint { key = \"workloadKind\" value = \"database\" effect = \"NoSchedule\" } } } Secure Example The following example will pass the digitalocean-compute-surge-upgrades-not-enabled check. resource \"digitalocean_kubernetes_cluster\" \"surge_upgrade_bad\" { name = \"foo\" region = \"nyc1\" version = \"1.20.2-do.0\" surge_upgrade = true node_pool { name = \"worker-pool\" size = \"s-2vcpu-2gb\" node_count = 3 taint { key = \"workloadKind\" value = \"database\" effect = \"NoSchedule\" } } } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/kubernetes_cluster#surge_upgrade https://docs.digitalocean.com/products/kubernetes/how-to/upgrade-cluster/#surge-upgrades", "title": "The Kubernetes cluster does not enable surge upgrades"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/#the-kubernetes-cluster-does-not-enable-surge-upgrades", "text": "", "title": "The Kubernetes cluster does not enable surge upgrades"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/#explanation", "text": "While upgrading your cluster, workloads will temporarily be moved to new nodes. A small cost will follow, but as a bonus, you won't experience downtime.", "title": "Explanation"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/#possible-impact", "text": "Upgrades may influence availability of your Kubernetes cluster", "title": "Possible Impact"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/#suggested-resolution", "text": "Enable surge upgrades in your Kubernetes cluster", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/#insecure-example", "text": "The following example will fail the digitalocean-compute-surge-upgrades-not-enabled check. resource \"digitalocean_kubernetes_cluster\" \"surge_upgrade_bad\" { name = \"foo\" region = \"nyc1\" version = \"1.20.2-do.0\" surge_upgrade = false node_pool { name = \"worker-pool\" size = \"s-2vcpu-2gb\" node_count = 3 taint { key = \"workloadKind\" value = \"database\" effect = \"NoSchedule\" } } }", "title": "Insecure Example"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/#secure-example", "text": "The following example will pass the digitalocean-compute-surge-upgrades-not-enabled check. resource \"digitalocean_kubernetes_cluster\" \"surge_upgrade_bad\" { name = \"foo\" region = \"nyc1\" version = \"1.20.2-do.0\" surge_upgrade = true node_pool { name = \"worker-pool\" size = \"s-2vcpu-2gb\" node_count = 3 taint { key = \"workloadKind\" value = \"database\" effect = \"NoSchedule\" } } }", "title": "Secure Example"}, {"location": "checks/digitalocean/compute/surge-upgrades-not-enabled/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/kubernetes_cluster#surge_upgrade https://docs.digitalocean.com/products/kubernetes/how-to/upgrade-cluster/#surge-upgrades", "title": "Links"}, {"location": "checks/digitalocean/compute/use-ssh-keys/", "text": "SSH Keys are the preferred way to connect to your droplet, no keys are supplied Default Severity: high Explanation When working with a server, you\u2019ll likely spend most of your time in a terminal session connected to your server through SSH. A more secure alternative to password-based logins, SSH keys use encryption to provide a secure way of logging into your server and are recommended for all users. Possible Impact Logging in with username and password is easier to compromise Suggested Resolution Use ssh keys for login Insecure Example The following example will fail the digitalocean-compute-use-ssh-keys check. resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" } Secure Example The following example will pass the digitalocean-compute-use-ssh-keys check. data \"digitalocean_ssh_key\" \"terraform\" { name = \"myKey\" } resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" ssh_keys = [ data.digitalocean_ssh_key.myKey.id ] } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/droplet#ssh_keys https://www.digitalocean.com/community/tutorials/understanding-the-ssh-encryption-and-connection-process", "title": "SSH Keys are the preferred way to connect to your droplet, no keys are supplied"}, {"location": "checks/digitalocean/compute/use-ssh-keys/#ssh-keys-are-the-preferred-way-to-connect-to-your-droplet-no-keys-are-supplied", "text": "", "title": "SSH Keys are the preferred way to connect to your droplet, no keys are supplied"}, {"location": "checks/digitalocean/compute/use-ssh-keys/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/digitalocean/compute/use-ssh-keys/#explanation", "text": "When working with a server, you\u2019ll likely spend most of your time in a terminal session connected to your server through SSH. A more secure alternative to password-based logins, SSH keys use encryption to provide a secure way of logging into your server and are recommended for all users.", "title": "Explanation"}, {"location": "checks/digitalocean/compute/use-ssh-keys/#possible-impact", "text": "Logging in with username and password is easier to compromise", "title": "Possible Impact"}, {"location": "checks/digitalocean/compute/use-ssh-keys/#suggested-resolution", "text": "Use ssh keys for login", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/compute/use-ssh-keys/#insecure-example", "text": "The following example will fail the digitalocean-compute-use-ssh-keys check. resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" }", "title": "Insecure Example"}, {"location": "checks/digitalocean/compute/use-ssh-keys/#secure-example", "text": "The following example will pass the digitalocean-compute-use-ssh-keys check. data \"digitalocean_ssh_key\" \"terraform\" { name = \"myKey\" } resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" ssh_keys = [ data.digitalocean_ssh_key.myKey.id ] }", "title": "Secure Example"}, {"location": "checks/digitalocean/compute/use-ssh-keys/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/droplet#ssh_keys https://www.digitalocean.com/community/tutorials/understanding-the-ssh-encryption-and-connection-process", "title": "Links"}, {"location": "checks/digitalocean/droplet/use-ssh-keys/", "text": "Default Severity: high Explanation When working with a server, you\u2019ll likely spend most of your time in a terminal session connected to your server through SSH. A more secure alternative to password-based logins, SSH keys use encryption to provide a secure way of logging into your server and are recommended for all users. Possible Impact Logging in with username and password is easier to compromise Suggested Resolution Use ssh keys for login Insecure Example The following example will fail the digitalocean-droplet-use-ssh-keys check. resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" } Secure Example The following example will pass the digitalocean-droplet-use-ssh-keys check. data \"digitalocean_ssh_key\" \"terraform\" { name = \"myKey\" } resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" ssh_keys = [ data.digitalocean_ssh_key.myKey.id ] } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/droplet#ssh_keys https://www.digitalocean.com/community/tutorials/understanding-the-ssh-encryption-and-connection-process", "title": "use-ssh-keys"}, {"location": "checks/digitalocean/droplet/use-ssh-keys/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/digitalocean/droplet/use-ssh-keys/#explanation", "text": "When working with a server, you\u2019ll likely spend most of your time in a terminal session connected to your server through SSH. A more secure alternative to password-based logins, SSH keys use encryption to provide a secure way of logging into your server and are recommended for all users.", "title": "Explanation"}, {"location": "checks/digitalocean/droplet/use-ssh-keys/#possible-impact", "text": "Logging in with username and password is easier to compromise", "title": "Possible Impact"}, {"location": "checks/digitalocean/droplet/use-ssh-keys/#suggested-resolution", "text": "Use ssh keys for login", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/droplet/use-ssh-keys/#insecure-example", "text": "The following example will fail the digitalocean-droplet-use-ssh-keys check. resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" }", "title": "Insecure Example"}, {"location": "checks/digitalocean/droplet/use-ssh-keys/#secure-example", "text": "The following example will pass the digitalocean-droplet-use-ssh-keys check. data \"digitalocean_ssh_key\" \"terraform\" { name = \"myKey\" } resource \"digitalocean_droplet\" \"good_example\" { image = \"ubuntu-18-04-x64\" name = \"web-1\" region = \"nyc2\" size = \"s-1vcpu-1gb\" ssh_keys = [ data.digitalocean_ssh_key.myKey.id ] }", "title": "Secure Example"}, {"location": "checks/digitalocean/droplet/use-ssh-keys/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/droplet#ssh_keys https://www.digitalocean.com/community/tutorials/understanding-the-ssh-encryption-and-connection-process", "title": "Links"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/", "text": "Spaces bucket or bucket object has public read acl set Default Severity: critical Explanation Space bucket and bucket object permissions should be set to deny public access unless explicitly required. Possible Impact The contents of the space can be accessed publicly Suggested Resolution Apply a more restrictive ACL Insecure Example The following example will fail the digitalocean-spaces-acl-no-public-read check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"public_space\" region = \"nyc3\" acl = \"public-read\" } resource \"digitalocean_spaces_bucket_object\" \"index\" { region = digitalocean_spaces_bucket.bad_example.region bucket = digitalocean_spaces_bucket.bad_example.name key = \"index.html\" content = \"<html><body><p>This page is empty.</p></body></html>\" content_type = \"text/html\" acl = \"public-read\" } Secure Example The following example will pass the digitalocean-spaces-acl-no-public-read check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"private_space\" region = \"nyc3\" acl = \"private\" } resource \"digitalocean_spaces_bucket_object\" \"index\" { region = digitalocean_spaces_bucket.good_example.region bucket = digitalocean_spaces_bucket.good_example.name key = \"index.html\" content = \"<html><body><p>This page is empty.</p></body></html>\" content_type = \"text/html\" } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#acl https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket_object#acl https://docs.digitalocean.com/reference/api/spaces-api/#access-control-lists-acls", "title": "acl-no-public-read"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/#spaces-bucket-or-bucket-object-has-public-read-acl-set", "text": "", "title": "Spaces bucket or bucket object has public read acl set"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/#explanation", "text": "Space bucket and bucket object permissions should be set to deny public access unless explicitly required.", "title": "Explanation"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/#possible-impact", "text": "The contents of the space can be accessed publicly", "title": "Possible Impact"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/#suggested-resolution", "text": "Apply a more restrictive ACL", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/#insecure-example", "text": "The following example will fail the digitalocean-spaces-acl-no-public-read check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"public_space\" region = \"nyc3\" acl = \"public-read\" } resource \"digitalocean_spaces_bucket_object\" \"index\" { region = digitalocean_spaces_bucket.bad_example.region bucket = digitalocean_spaces_bucket.bad_example.name key = \"index.html\" content = \"<html><body><p>This page is empty.</p></body></html>\" content_type = \"text/html\" acl = \"public-read\" }", "title": "Insecure Example"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/#secure-example", "text": "The following example will pass the digitalocean-spaces-acl-no-public-read check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"private_space\" region = \"nyc3\" acl = \"private\" } resource \"digitalocean_spaces_bucket_object\" \"index\" { region = digitalocean_spaces_bucket.good_example.region bucket = digitalocean_spaces_bucket.good_example.name key = \"index.html\" content = \"<html><body><p>This page is empty.</p></body></html>\" content_type = \"text/html\" }", "title": "Secure Example"}, {"location": "checks/digitalocean/spaces/acl-no-public-read/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#acl https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket_object#acl https://docs.digitalocean.com/reference/api/spaces-api/#access-control-lists-acls", "title": "Links"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/", "text": "Force destroy is enabled on Spaces bucket which is dangerous Default Severity: medium Explanation Enabling force destroy on a Spaces bucket means that the bucket can be deleted without the additional check that it is empty. This risks important data being accidentally deleted by a bucket removal process. Possible Impact Accidental deletion of bucket objects Suggested Resolution Don't use force destroy on bucket configuration Insecure Example The following example will fail the digitalocean-spaces-disable-force-destroy check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" force_destroy = true } Secure Example The following example will pass the digitalocean-spaces-disable-force-destroy check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"foobar\" region = \"nyc3\" } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#force_destroy", "title": "disable-force-destroy"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/#force-destroy-is-enabled-on-spaces-bucket-which-is-dangerous", "text": "", "title": "Force destroy is enabled on Spaces bucket which is dangerous"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/#explanation", "text": "Enabling force destroy on a Spaces bucket means that the bucket can be deleted without the additional check that it is empty. This risks important data being accidentally deleted by a bucket removal process.", "title": "Explanation"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/#possible-impact", "text": "Accidental deletion of bucket objects", "title": "Possible Impact"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/#suggested-resolution", "text": "Don't use force destroy on bucket configuration", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/#insecure-example", "text": "The following example will fail the digitalocean-spaces-disable-force-destroy check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" force_destroy = true }", "title": "Insecure Example"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/#secure-example", "text": "The following example will pass the digitalocean-spaces-disable-force-destroy check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"foobar\" region = \"nyc3\" }", "title": "Secure Example"}, {"location": "checks/digitalocean/spaces/disable-force-destroy/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#force_destroy", "title": "Links"}, {"location": "checks/digitalocean/spaces/versioning-enabled/", "text": "Spaces buckets should have versioning enabled Default Severity: medium Explanation Versioning is a means of keeping multiple variants of an object in the same bucket. You can use the Spaces (S3) Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures. Possible Impact Deleted or modified data would not be recoverable Suggested Resolution Enable versioning to protect against accidental or malicious removal or modification Insecure Example The following example will fail the digitalocean-spaces-versioning-enabled check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" } resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" versioning { enabled = false } } Secure Example The following example will pass the digitalocean-spaces-versioning-enabled check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"foobar\" region = \"nyc3\" versioning { enabled = true } } Links https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#versioning https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html", "title": "versioning-enabled"}, {"location": "checks/digitalocean/spaces/versioning-enabled/#spaces-buckets-should-have-versioning-enabled", "text": "", "title": "Spaces buckets should have versioning enabled"}, {"location": "checks/digitalocean/spaces/versioning-enabled/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/digitalocean/spaces/versioning-enabled/#explanation", "text": "Versioning is a means of keeping multiple variants of an object in the same bucket. You can use the Spaces (S3) Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures.", "title": "Explanation"}, {"location": "checks/digitalocean/spaces/versioning-enabled/#possible-impact", "text": "Deleted or modified data would not be recoverable", "title": "Possible Impact"}, {"location": "checks/digitalocean/spaces/versioning-enabled/#suggested-resolution", "text": "Enable versioning to protect against accidental or malicious removal or modification", "title": "Suggested Resolution"}, {"location": "checks/digitalocean/spaces/versioning-enabled/#insecure-example", "text": "The following example will fail the digitalocean-spaces-versioning-enabled check. resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" } resource \"digitalocean_spaces_bucket\" \"bad_example\" { name = \"foobar\" region = \"nyc3\" versioning { enabled = false } }", "title": "Insecure Example"}, {"location": "checks/digitalocean/spaces/versioning-enabled/#secure-example", "text": "The following example will pass the digitalocean-spaces-versioning-enabled check. resource \"digitalocean_spaces_bucket\" \"good_example\" { name = \"foobar\" region = \"nyc3\" versioning { enabled = true } }", "title": "Secure Example"}, {"location": "checks/digitalocean/spaces/versioning-enabled/#links", "text": "https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs/resources/spaces_bucket#versioning https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html", "title": "Links"}, {"location": "checks/general/secrets/no-plaintext-exposure/", "text": "Secret/sensitive data should not be exposed in plaintext. Default Severity: critical Explanation Plaintext secrets kept in source code or similar media mean sensitive data is exposed to any users/systems with access to the source code. Possible Impact Sensitive data can be leaked to unauthorised people or systems. Suggested Resolution Remove plaintext secrets and encrypt them within a secrets manager instead. Insecure Example The following example will fail the general-secrets-no-plaintext-exposure check. variable \"password\" { description = \"The root password for our VM\" type = string default = \"p4ssw0rd\" } resource \"evil_corp\" \"virtual_machine\" { root_password = var.password } Secure Example The following example will pass the general-secrets-no-plaintext-exposure check. variable \"password\" { description = \"The root password for our VM\" type = string } resource \"evil_corp\" \"virtual_machine\" { root_password = var.password } Links https://www.terraform.io/docs/state/sensitive-data.html", "title": "Secret/sensitive data should not be exposed in plaintext."}, {"location": "checks/general/secrets/no-plaintext-exposure/#secretsensitive-data-should-not-be-exposed-in-plaintext", "text": "", "title": "Secret/sensitive data should not be exposed in plaintext."}, {"location": "checks/general/secrets/no-plaintext-exposure/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/general/secrets/no-plaintext-exposure/#explanation", "text": "Plaintext secrets kept in source code or similar media mean sensitive data is exposed to any users/systems with access to the source code.", "title": "Explanation"}, {"location": "checks/general/secrets/no-plaintext-exposure/#possible-impact", "text": "Sensitive data can be leaked to unauthorised people or systems.", "title": "Possible Impact"}, {"location": "checks/general/secrets/no-plaintext-exposure/#suggested-resolution", "text": "Remove plaintext secrets and encrypt them within a secrets manager instead.", "title": "Suggested Resolution"}, {"location": "checks/general/secrets/no-plaintext-exposure/#insecure-example", "text": "The following example will fail the general-secrets-no-plaintext-exposure check. variable \"password\" { description = \"The root password for our VM\" type = string default = \"p4ssw0rd\" } resource \"evil_corp\" \"virtual_machine\" { root_password = var.password }", "title": "Insecure Example"}, {"location": "checks/general/secrets/no-plaintext-exposure/#secure-example", "text": "The following example will pass the general-secrets-no-plaintext-exposure check. variable \"password\" { description = \"The root password for our VM\" type = string } resource \"evil_corp\" \"virtual_machine\" { root_password = var.password }", "title": "Secure Example"}, {"location": "checks/general/secrets/no-plaintext-exposure/#links", "text": "https://www.terraform.io/docs/state/sensitive-data.html", "title": "Links"}, {"location": "checks/github/actions/no-plain-text-action-secrets/", "text": "Ensure plaintext value is not used for GitHub Action Environment Secret. Default Severity: high Explanation For the purposes of security, the contents of the plaintext_value field have been marked as sensitive to Terraform, but this does not hide it from state files. State should be treated as sensitive always. Possible Impact Unencrypted sensitive plaintext value can be easily accessible in code. Suggested Resolution Do not store plaintext values in your code but rather populate the encrypted_value using fields from a resource, data source or variable. Insecure Example The following example will fail the github-actions-no-plain-text-action-secrets check. resource \"github_actions_environment_secret\" \"bad_example\" { repository = \"my repository name\" environment = \"my environment\" secret_name = \"my secret name\" plaintext_value = \"sensitive secret string\" } Secure Example The following example will pass the github-actions-no-plain-text-action-secrets check. resource \"github_actions_environment_secret\" \"good_example\" { repository = \"my repository name\" environment = \"my environment\" secret_name = \"my secret name\" encrypted_value = var.some_encrypted_secret_string } Links https://registry.terraform.io/providers/integrations/github/latest/docs/resources/actions_environment_secret https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions https://registry.terraform.io/providers/integrations/github/latest/docs/resources/actions_environment_secret https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions", "title": "Ensure plaintext value is not used for GitHub Action Environment Secret."}, {"location": "checks/github/actions/no-plain-text-action-secrets/#ensure-plaintext-value-is-not-used-for-github-action-environment-secret", "text": "", "title": "Ensure plaintext value is not used for GitHub Action Environment Secret."}, {"location": "checks/github/actions/no-plain-text-action-secrets/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/github/actions/no-plain-text-action-secrets/#explanation", "text": "For the purposes of security, the contents of the plaintext_value field have been marked as sensitive to Terraform, but this does not hide it from state files. State should be treated as sensitive always.", "title": "Explanation"}, {"location": "checks/github/actions/no-plain-text-action-secrets/#possible-impact", "text": "Unencrypted sensitive plaintext value can be easily accessible in code.", "title": "Possible Impact"}, {"location": "checks/github/actions/no-plain-text-action-secrets/#suggested-resolution", "text": "Do not store plaintext values in your code but rather populate the encrypted_value using fields from a resource, data source or variable.", "title": "Suggested Resolution"}, {"location": "checks/github/actions/no-plain-text-action-secrets/#insecure-example", "text": "The following example will fail the github-actions-no-plain-text-action-secrets check. resource \"github_actions_environment_secret\" \"bad_example\" { repository = \"my repository name\" environment = \"my environment\" secret_name = \"my secret name\" plaintext_value = \"sensitive secret string\" }", "title": "Insecure Example"}, {"location": "checks/github/actions/no-plain-text-action-secrets/#secure-example", "text": "The following example will pass the github-actions-no-plain-text-action-secrets check. resource \"github_actions_environment_secret\" \"good_example\" { repository = \"my repository name\" environment = \"my environment\" secret_name = \"my secret name\" encrypted_value = var.some_encrypted_secret_string }", "title": "Secure Example"}, {"location": "checks/github/actions/no-plain-text-action-secrets/#links", "text": "https://registry.terraform.io/providers/integrations/github/latest/docs/resources/actions_environment_secret https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions https://registry.terraform.io/providers/integrations/github/latest/docs/resources/actions_environment_secret https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions", "title": "Links"}, {"location": "checks/github/repositories/private/", "text": "Github repository shouldn't be public. Default Severity: critical Explanation Github repository should be set to be private. You can do this by either setting private attribute to 'true' or visibility attribute to 'internal' or 'private'. Possible Impact Anyone can read the contents of the GitHub repository and leak IP Suggested Resolution Make sensitive or commercially important repositories private Insecure Example The following example will fail the github-repositories-private check. resource \"github_repository\" \"bad_example\" { name = \"example\" description = \"My awesome codebase\" visibility = \"public\" template { owner = \"github\" repository = \"terraform-module-template\" } } Secure Example The following example will pass the github-repositories-private check. resource \"github_repository\" \"good_example\" { name = \"example\" description = \"My awesome codebase\" visibility = \"private\" template { owner = \"github\" repository = \"terraform-module-template\" } } Links https://registry.terraform.io/providers/integrations/github/latest/docs/resources/repository https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-visibility https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-visibility#about-internal-repositories", "title": "private"}, {"location": "checks/github/repositories/private/#github-repository-shouldnt-be-public", "text": "", "title": "Github repository shouldn't be public."}, {"location": "checks/github/repositories/private/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/github/repositories/private/#explanation", "text": "Github repository should be set to be private. You can do this by either setting private attribute to 'true' or visibility attribute to 'internal' or 'private'.", "title": "Explanation"}, {"location": "checks/github/repositories/private/#possible-impact", "text": "Anyone can read the contents of the GitHub repository and leak IP", "title": "Possible Impact"}, {"location": "checks/github/repositories/private/#suggested-resolution", "text": "Make sensitive or commercially important repositories private", "title": "Suggested Resolution"}, {"location": "checks/github/repositories/private/#insecure-example", "text": "The following example will fail the github-repositories-private check. resource \"github_repository\" \"bad_example\" { name = \"example\" description = \"My awesome codebase\" visibility = \"public\" template { owner = \"github\" repository = \"terraform-module-template\" } }", "title": "Insecure Example"}, {"location": "checks/github/repositories/private/#secure-example", "text": "The following example will pass the github-repositories-private check. resource \"github_repository\" \"good_example\" { name = \"example\" description = \"My awesome codebase\" visibility = \"private\" template { owner = \"github\" repository = \"terraform-module-template\" } }", "title": "Secure Example"}, {"location": "checks/github/repositories/private/#links", "text": "https://registry.terraform.io/providers/integrations/github/latest/docs/resources/repository https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-visibility https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-repository-visibility#about-internal-repositories", "title": "Links"}, {"location": "checks/google/bigquery/no-public-access/", "text": "BigQuery datasets should only be accessible within the organisation Default Severity: critical Explanation Using 'allAuthenticatedUsers' provides any GCP user - even those outside of your organisation - access to your BigQuery dataset. Possible Impact Exposure of sensitive data to the public iniernet Suggested Resolution Configure access permissions with higher granularity Insecure Example The following example will fail the google-bigquery-no-public-access check. resource \"google_bigquery_dataset\" \"bad_example\" { dataset_id = \"example_dataset\" friendly_name = \"test\" description = \"This is a test description\" location = \"EU\" default_table_expiration_ms = 3600000 labels = { env = \"default\" } access { role = \"OWNER\" special_group = \"allAuthenticatedUsers\" } access { role = \"READER\" domain = \"hashicorp.com\" } } Secure Example The following example will pass the google-bigquery-no-public-access check. resource \"google_bigquery_dataset\" \"good_example\" { dataset_id = \"example_dataset\" friendly_name = \"test\" description = \"This is a test description\" location = \"EU\" default_table_expiration_ms = 3600000 labels = { env = \"default\" } access { role = \"OWNER\" user_by_email = google_service_account.bqowner.email } access { role = \"READER\" domain = \"hashicorp.com\" } } resource \"google_service_account\" \"bqowner\" { account_id = \"bqowner\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#special_group", "title": "no-public-access"}, {"location": "checks/google/bigquery/no-public-access/#bigquery-datasets-should-only-be-accessible-within-the-organisation", "text": "", "title": "BigQuery datasets should only be accessible within the organisation"}, {"location": "checks/google/bigquery/no-public-access/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/google/bigquery/no-public-access/#explanation", "text": "Using 'allAuthenticatedUsers' provides any GCP user - even those outside of your organisation - access to your BigQuery dataset.", "title": "Explanation"}, {"location": "checks/google/bigquery/no-public-access/#possible-impact", "text": "Exposure of sensitive data to the public iniernet", "title": "Possible Impact"}, {"location": "checks/google/bigquery/no-public-access/#suggested-resolution", "text": "Configure access permissions with higher granularity", "title": "Suggested Resolution"}, {"location": "checks/google/bigquery/no-public-access/#insecure-example", "text": "The following example will fail the google-bigquery-no-public-access check. resource \"google_bigquery_dataset\" \"bad_example\" { dataset_id = \"example_dataset\" friendly_name = \"test\" description = \"This is a test description\" location = \"EU\" default_table_expiration_ms = 3600000 labels = { env = \"default\" } access { role = \"OWNER\" special_group = \"allAuthenticatedUsers\" } access { role = \"READER\" domain = \"hashicorp.com\" } }", "title": "Insecure Example"}, {"location": "checks/google/bigquery/no-public-access/#secure-example", "text": "The following example will pass the google-bigquery-no-public-access check. resource \"google_bigquery_dataset\" \"good_example\" { dataset_id = \"example_dataset\" friendly_name = \"test\" description = \"This is a test description\" location = \"EU\" default_table_expiration_ms = 3600000 labels = { env = \"default\" } access { role = \"OWNER\" user_by_email = google_service_account.bqowner.email } access { role = \"READER\" domain = \"hashicorp.com\" } } resource \"google_service_account\" \"bqowner\" { account_id = \"bqowner\" }", "title": "Secure Example"}, {"location": "checks/google/bigquery/no-public-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/bigquery_dataset#special_group", "title": "Links"}, {"location": "checks/google/compute/disk-encryption-customer-key/", "text": "Disks should be encrypted with customer managed encryption keys Default Severity: low Explanation Using unmanaged keys makes rotation and general management difficult. Possible Impact Using unmanaged keys does not allow for proper key management. Suggested Resolution Use managed keys to encrypt disks. Insecure Example The following example will fail the google-compute-disk-encryption-customer-key check. resource \"google_compute_disk\" \"bad_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 } Secure Example The following example will pass the google-compute-disk-encryption-customer-key check. resource \"google_compute_disk\" \"good_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 disk_encryption_key { kms_key_self_link = \"something\" } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#kms_key_self_link", "title": "disk-encryption-customer-key"}, {"location": "checks/google/compute/disk-encryption-customer-key/#disks-should-be-encrypted-with-customer-managed-encryption-keys", "text": "", "title": "Disks should be encrypted with customer managed encryption keys"}, {"location": "checks/google/compute/disk-encryption-customer-key/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/compute/disk-encryption-customer-key/#explanation", "text": "Using unmanaged keys makes rotation and general management difficult.", "title": "Explanation"}, {"location": "checks/google/compute/disk-encryption-customer-key/#possible-impact", "text": "Using unmanaged keys does not allow for proper key management.", "title": "Possible Impact"}, {"location": "checks/google/compute/disk-encryption-customer-key/#suggested-resolution", "text": "Use managed keys to encrypt disks.", "title": "Suggested Resolution"}, {"location": "checks/google/compute/disk-encryption-customer-key/#insecure-example", "text": "The following example will fail the google-compute-disk-encryption-customer-key check. resource \"google_compute_disk\" \"bad_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 }", "title": "Insecure Example"}, {"location": "checks/google/compute/disk-encryption-customer-key/#secure-example", "text": "The following example will pass the google-compute-disk-encryption-customer-key check. resource \"google_compute_disk\" \"good_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 disk_encryption_key { kms_key_self_link = \"something\" } }", "title": "Secure Example"}, {"location": "checks/google/compute/disk-encryption-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#kms_key_self_link", "title": "Links"}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/", "text": "The encryption key used to encrypt a compute disk has been specified in plaintext. Default Severity: critical Explanation Sensitive values such as raw encryption keys should not be included in your Terraform code, and should be stored securely by a secrets manager. Possible Impact The encryption key should be considered compromised as it is not stored securely. Suggested Resolution Reference a managed key rather than include the key in raw format. Insecure Example The following example will fail the google-compute-disk-encryption-no-plaintext-key check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { raw_key = \"b2ggbm8gdGhpcyBpcyBiYWQ=\" } } Secure Example The following example will pass the google-compute-disk-encryption-no-plaintext-key check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { kms_key_self_link = google_kms_crypto_key.my_crypto_key.id } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#kms_key_self_link https://cloud.google.com/compute/docs/disks/customer-supplied-encryption", "title": "The encryption key used to encrypt a compute disk has been specified in plaintext."}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/#the-encryption-key-used-to-encrypt-a-compute-disk-has-been-specified-in-plaintext", "text": "", "title": "The encryption key used to encrypt a compute disk has been specified in plaintext."}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/#explanation", "text": "Sensitive values such as raw encryption keys should not be included in your Terraform code, and should be stored securely by a secrets manager.", "title": "Explanation"}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/#possible-impact", "text": "The encryption key should be considered compromised as it is not stored securely.", "title": "Possible Impact"}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/#suggested-resolution", "text": "Reference a managed key rather than include the key in raw format.", "title": "Suggested Resolution"}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/#insecure-example", "text": "The following example will fail the google-compute-disk-encryption-no-plaintext-key check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { raw_key = \"b2ggbm8gdGhpcyBpcyBiYWQ=\" } }", "title": "Insecure Example"}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/#secure-example", "text": "The following example will pass the google-compute-disk-encryption-no-plaintext-key check. resource \"google_compute_disk\" \"good_example\" { disk_encryption_key { kms_key_self_link = google_kms_crypto_key.my_crypto_key.id } }", "title": "Secure Example"}, {"location": "checks/google/compute/disk-encryption-no-plaintext-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#kms_key_self_link https://cloud.google.com/compute/docs/disks/customer-supplied-encryption", "title": "Links"}, {"location": "checks/google/compute/enable-shielded-vm-im/", "text": "Instances should have Shielded VM integrity monitoring enabled Default Severity: medium Explanation Integrity monitoring helps you understand and make decisions about the state of your VM instances. Possible Impact No visibility of VM instance boot state. Suggested Resolution Enable Shielded VM Integrity Monitoring Insecure Example The following example will fail the google-compute-enable-shielded-vm-im check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_integrity_monitoring = false } } Secure Example The following example will pass the google-compute-enable-shielded-vm-im check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_integrity_monitoring = true } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#enable_vtpm https://cloud.google.com/security/shielded-cloud/shielded-vm#integrity-monitoring", "title": "Instances should have Shielded VM integrity monitoring enabled"}, {"location": "checks/google/compute/enable-shielded-vm-im/#instances-should-have-shielded-vm-integrity-monitoring-enabled", "text": "", "title": "Instances should have Shielded VM integrity monitoring enabled"}, {"location": "checks/google/compute/enable-shielded-vm-im/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/compute/enable-shielded-vm-im/#explanation", "text": "Integrity monitoring helps you understand and make decisions about the state of your VM instances.", "title": "Explanation"}, {"location": "checks/google/compute/enable-shielded-vm-im/#possible-impact", "text": "No visibility of VM instance boot state.", "title": "Possible Impact"}, {"location": "checks/google/compute/enable-shielded-vm-im/#suggested-resolution", "text": "Enable Shielded VM Integrity Monitoring", "title": "Suggested Resolution"}, {"location": "checks/google/compute/enable-shielded-vm-im/#insecure-example", "text": "The following example will fail the google-compute-enable-shielded-vm-im check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_integrity_monitoring = false } }", "title": "Insecure Example"}, {"location": "checks/google/compute/enable-shielded-vm-im/#secure-example", "text": "The following example will pass the google-compute-enable-shielded-vm-im check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_integrity_monitoring = true } }", "title": "Secure Example"}, {"location": "checks/google/compute/enable-shielded-vm-im/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#enable_vtpm https://cloud.google.com/security/shielded-cloud/shielded-vm#integrity-monitoring", "title": "Links"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/", "text": "Instances should have Shielded VM VTPM enabled Default Severity: medium Explanation The virtual TPM provides numerous security measures to your VM. Possible Impact Unable to prevent unwanted system state modification Suggested Resolution Enable Shielded VM VTPM Insecure Example The following example will fail the google-compute-enable-shielded-vm-vtpm check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_vtpm = false } } Secure Example The following example will pass the google-compute-enable-shielded-vm-vtpm check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_vtpm = true } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#enable_vtpm https://cloud.google.com/blog/products/identity-security/virtual-trusted-platform-module-for-shielded-vms-security-in-plaintext", "title": "Instances should have Shielded VM VTPM enabled"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/#instances-should-have-shielded-vm-vtpm-enabled", "text": "", "title": "Instances should have Shielded VM VTPM enabled"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/#explanation", "text": "The virtual TPM provides numerous security measures to your VM.", "title": "Explanation"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/#possible-impact", "text": "Unable to prevent unwanted system state modification", "title": "Possible Impact"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/#suggested-resolution", "text": "Enable Shielded VM VTPM", "title": "Suggested Resolution"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/#insecure-example", "text": "The following example will fail the google-compute-enable-shielded-vm-vtpm check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_vtpm = false } }", "title": "Insecure Example"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/#secure-example", "text": "The following example will pass the google-compute-enable-shielded-vm-vtpm check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } shielded_instance_config { enable_vtpm = true } }", "title": "Secure Example"}, {"location": "checks/google/compute/enable-shielded-vm-vtpm/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#enable_vtpm https://cloud.google.com/blog/products/identity-security/virtual-trusted-platform-module-for-shielded-vms-security-in-plaintext", "title": "Links"}, {"location": "checks/google/compute/enable-vpc-flow-logs/", "text": "VPC flow logs should be enabled for all subnetworks Default Severity: low Explanation VPC flow logs record information about all traffic, which is a vital tool in reviewing anomalous traffic. Possible Impact Limited auditing capability and awareness Suggested Resolution Enable VPC flow logs Insecure Example The following example will fail the google-compute-enable-vpc-flow-logs check. resource \"google_compute_subnetwork\" \"bad_example\" { name = \"test-subnetwork\" ip_cidr_range = \"10.2.0.0/16\" region = \"us-central1\" network = google_compute_network.custom-test.id secondary_ip_range { range_name = \"tf-test-secondary-range-update1\" ip_cidr_range = \"192.168.10.0/24\" } } resource \"google_compute_network\" \"custom-test\" { name = \"test-network\" auto_create_subnetworks = false } Secure Example The following example will pass the google-compute-enable-vpc-flow-logs check. resource \"google_compute_subnetwork\" \"good_example\" { name = \"test-subnetwork\" ip_cidr_range = \"10.2.0.0/16\" region = \"us-central1\" network = google_compute_network.custom-test.id secondary_ip_range { range_name = \"tf-test-secondary-range-update1\" ip_cidr_range = \"192.168.10.0/24\" } log_config { aggregation_interval = \"INTERVAL_10_MIN\" flow_sampling = 0.5 metadata = \"INCLUDE_ALL_METADATA\" } } resource \"google_compute_network\" \"custom-test\" { name = \"test-network\" auto_create_subnetworks = false } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork#enable_flow_logs", "title": "enable-vpc-flow-logs"}, {"location": "checks/google/compute/enable-vpc-flow-logs/#vpc-flow-logs-should-be-enabled-for-all-subnetworks", "text": "", "title": "VPC flow logs should be enabled for all subnetworks"}, {"location": "checks/google/compute/enable-vpc-flow-logs/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/compute/enable-vpc-flow-logs/#explanation", "text": "VPC flow logs record information about all traffic, which is a vital tool in reviewing anomalous traffic.", "title": "Explanation"}, {"location": "checks/google/compute/enable-vpc-flow-logs/#possible-impact", "text": "Limited auditing capability and awareness", "title": "Possible Impact"}, {"location": "checks/google/compute/enable-vpc-flow-logs/#suggested-resolution", "text": "Enable VPC flow logs", "title": "Suggested Resolution"}, {"location": "checks/google/compute/enable-vpc-flow-logs/#insecure-example", "text": "The following example will fail the google-compute-enable-vpc-flow-logs check. resource \"google_compute_subnetwork\" \"bad_example\" { name = \"test-subnetwork\" ip_cidr_range = \"10.2.0.0/16\" region = \"us-central1\" network = google_compute_network.custom-test.id secondary_ip_range { range_name = \"tf-test-secondary-range-update1\" ip_cidr_range = \"192.168.10.0/24\" } } resource \"google_compute_network\" \"custom-test\" { name = \"test-network\" auto_create_subnetworks = false }", "title": "Insecure Example"}, {"location": "checks/google/compute/enable-vpc-flow-logs/#secure-example", "text": "The following example will pass the google-compute-enable-vpc-flow-logs check. resource \"google_compute_subnetwork\" \"good_example\" { name = \"test-subnetwork\" ip_cidr_range = \"10.2.0.0/16\" region = \"us-central1\" network = google_compute_network.custom-test.id secondary_ip_range { range_name = \"tf-test-secondary-range-update1\" ip_cidr_range = \"192.168.10.0/24\" } log_config { aggregation_interval = \"INTERVAL_10_MIN\" flow_sampling = 0.5 metadata = \"INCLUDE_ALL_METADATA\" } } resource \"google_compute_network\" \"custom-test\" { name = \"test-network\" auto_create_subnetworks = false }", "title": "Secure Example"}, {"location": "checks/google/compute/enable-vpc-flow-logs/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork#enable_flow_logs", "title": "Links"}, {"location": "checks/google/compute/no-default-service-account/", "text": "Instances should not use the default service account Default Severity: critical Explanation The default service account has full project access. Instances should instead be assigned the minimal access they need. Possible Impact Instance has full access to the project Suggested Resolution Remove use of default service account Insecure Example The following example will fail the google-compute-no-default-service-account check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = \"1234567890-compute@developer.gserviceaccount.com\" scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-no-default-service-account check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#", "title": "no-default-service-account"}, {"location": "checks/google/compute/no-default-service-account/#instances-should-not-use-the-default-service-account", "text": "", "title": "Instances should not use the default service account"}, {"location": "checks/google/compute/no-default-service-account/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/google/compute/no-default-service-account/#explanation", "text": "The default service account has full project access. Instances should instead be assigned the minimal access they need.", "title": "Explanation"}, {"location": "checks/google/compute/no-default-service-account/#possible-impact", "text": "Instance has full access to the project", "title": "Possible Impact"}, {"location": "checks/google/compute/no-default-service-account/#suggested-resolution", "text": "Remove use of default service account", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-default-service-account/#insecure-example", "text": "The following example will fail the google-compute-no-default-service-account check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = \"1234567890-compute@developer.gserviceaccount.com\" scopes = [ \"cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-default-service-account/#secure-example", "text": "The following example will pass the google-compute-no-default-service-account check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/compute/no-default-service-account/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#", "title": "Links"}, {"location": "checks/google/compute/no-ip-forwarding/", "text": "Instances should not have IP forwarding enabled Default Severity: high Explanation Disabling IP forwarding ensures the instance can only receive packets addressed to the instance and can only send packets with a source address of the instance. Possible Impact Instance can send/receive packets without the explicit instance address Suggested Resolution Disable IP forwarding Insecure Example The following example will fail the google-compute-no-ip-forwarding check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } can_ip_forward = true } Secure Example The following example will pass the google-compute-no-ip-forwarding check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } can_ip_forward = false } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#can_ip_forward", "title": "no-ip-forwarding"}, {"location": "checks/google/compute/no-ip-forwarding/#instances-should-not-have-ip-forwarding-enabled", "text": "", "title": "Instances should not have IP forwarding enabled"}, {"location": "checks/google/compute/no-ip-forwarding/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/compute/no-ip-forwarding/#explanation", "text": "Disabling IP forwarding ensures the instance can only receive packets addressed to the instance and can only send packets with a source address of the instance.", "title": "Explanation"}, {"location": "checks/google/compute/no-ip-forwarding/#possible-impact", "text": "Instance can send/receive packets without the explicit instance address", "title": "Possible Impact"}, {"location": "checks/google/compute/no-ip-forwarding/#suggested-resolution", "text": "Disable IP forwarding", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-ip-forwarding/#insecure-example", "text": "The following example will fail the google-compute-no-ip-forwarding check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } can_ip_forward = true }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-ip-forwarding/#secure-example", "text": "The following example will pass the google-compute-no-ip-forwarding check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } can_ip_forward = false }", "title": "Secure Example"}, {"location": "checks/google/compute/no-ip-forwarding/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#can_ip_forward", "title": "Links"}, {"location": "checks/google/compute/no-oslogin-override/", "text": "Instances should not override the project setting for OS Login Default Severity: medium Explanation OS Login automatically revokes the relevant SSH keys when an IAM user has their access revoked. Possible Impact Access via SSH key cannot be revoked automatically when an IAM user is removed. Suggested Resolution Enable OS Login at project level and remove instance-level overrides Insecure Example The following example will fail the google-compute-no-oslogin-override check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } metadata = { enable-oslogin = false } } Secure Example The following example will pass the google-compute-no-oslogin-override check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } metadata = { } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#", "title": "no-oslogin-override"}, {"location": "checks/google/compute/no-oslogin-override/#instances-should-not-override-the-project-setting-for-os-login", "text": "", "title": "Instances should not override the project setting for OS Login"}, {"location": "checks/google/compute/no-oslogin-override/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/compute/no-oslogin-override/#explanation", "text": "OS Login automatically revokes the relevant SSH keys when an IAM user has their access revoked.", "title": "Explanation"}, {"location": "checks/google/compute/no-oslogin-override/#possible-impact", "text": "Access via SSH key cannot be revoked automatically when an IAM user is removed.", "title": "Possible Impact"}, {"location": "checks/google/compute/no-oslogin-override/#suggested-resolution", "text": "Enable OS Login at project level and remove instance-level overrides", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-oslogin-override/#insecure-example", "text": "The following example will fail the google-compute-no-oslogin-override check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } metadata = { enable-oslogin = false } }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-oslogin-override/#secure-example", "text": "The following example will pass the google-compute-no-oslogin-override check. resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } metadata = { } }", "title": "Secure Example"}, {"location": "checks/google/compute/no-oslogin-override/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#", "title": "Links"}, {"location": "checks/google/compute/no-plaintext-vm-disk-keys/", "text": "Default Severity: high Explanation Providing your encryption key in plaintext format means anyone with access to the source code also has access to the key. Possible Impact Compromise of encryption keys Suggested Resolution Use managed keys or provide the raw key via a secrets manager Insecure Example The following example will fail the google-compute-no-plaintext-vm-disk-keys check. resource \"google_compute_disk\" \"bad_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 disk_encryption_key { raw_key = \"something\" } } Secure Example The following example will pass the google-compute-no-plaintext-vm-disk-keys check. resource \"google_compute_disk\" \"good_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#raw_key", "title": "no-plaintext-vm-disk-keys"}, {"location": "checks/google/compute/no-plaintext-vm-disk-keys/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/compute/no-plaintext-vm-disk-keys/#explanation", "text": "Providing your encryption key in plaintext format means anyone with access to the source code also has access to the key.", "title": "Explanation"}, {"location": "checks/google/compute/no-plaintext-vm-disk-keys/#possible-impact", "text": "Compromise of encryption keys", "title": "Possible Impact"}, {"location": "checks/google/compute/no-plaintext-vm-disk-keys/#suggested-resolution", "text": "Use managed keys or provide the raw key via a secrets manager", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-plaintext-vm-disk-keys/#insecure-example", "text": "The following example will fail the google-compute-no-plaintext-vm-disk-keys check. resource \"google_compute_disk\" \"bad_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 disk_encryption_key { raw_key = \"something\" } }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-plaintext-vm-disk-keys/#secure-example", "text": "The following example will pass the google-compute-no-plaintext-vm-disk-keys check. resource \"google_compute_disk\" \"good_example\" { name = \"test-disk\" type = \"pd-ssd\" zone = \"us-central1-a\" image = \"debian-9-stretch-v20200805\" labels = { environment = \"dev\" } physical_block_size_bytes = 4096 }", "title": "Secure Example"}, {"location": "checks/google/compute/no-plaintext-vm-disk-keys/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_disk#raw_key", "title": "Links"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/", "text": "Disable project-wide SSH keys for all instances Default Severity: medium Explanation Use of project-wide SSH keys means that a compromise of any one of these key pairs can result in all instances being compromised. It is recommended to use instance-level keys. Possible Impact Compromise of a single key pair compromises all instances Suggested Resolution Disable project-wide SSH keys Insecure Example The following example will fail the google-compute-no-project-wide-ssh-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { block-project-ssh-keys = false } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-no-project-wide-ssh-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { block-project-ssh-keys = true } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#", "title": "no-project-wide-ssh-keys"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/#disable-project-wide-ssh-keys-for-all-instances", "text": "", "title": "Disable project-wide SSH keys for all instances"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/#explanation", "text": "Use of project-wide SSH keys means that a compromise of any one of these key pairs can result in all instances being compromised. It is recommended to use instance-level keys.", "title": "Explanation"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/#possible-impact", "text": "Compromise of a single key pair compromises all instances", "title": "Possible Impact"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/#suggested-resolution", "text": "Disable project-wide SSH keys", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/#insecure-example", "text": "The following example will fail the google-compute-no-project-wide-ssh-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { block-project-ssh-keys = false } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/#secure-example", "text": "The following example will pass the google-compute-no-project-wide-ssh-keys check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { block-project-ssh-keys = true } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/compute/no-project-wide-ssh-keys/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#", "title": "Links"}, {"location": "checks/google/compute/no-public-egress/", "text": "An outbound firewall rule allows traffic to /0. Default Severity: critical Explanation Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets and avoid using the /0 subnet. Possible Impact The port is exposed for egress to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the google-compute-no-public-egress check. resource \"google_compute_firewall\" \"bad_example\" { direction = \"EGRESS\" allow { protocol = \"icmp\" } destination_ranges = [ \"0.0.0.0/0\" ] } Secure Example The following example will pass the google-compute-no-public-egress check. resource \"google_compute_firewall\" \"good_example\" { direction = \"EGRESS\" allow { protocol = \"icmp\" } destination_ranges = [ \"1.2.3.4/32\" ] } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_firewall https://cloud.google.com/vpc/docs/using-firewalls", "title": "no-public-egress"}, {"location": "checks/google/compute/no-public-egress/#an-outbound-firewall-rule-allows-traffic-to-0", "text": "", "title": "An outbound firewall rule allows traffic to /0."}, {"location": "checks/google/compute/no-public-egress/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/google/compute/no-public-egress/#explanation", "text": "Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets and avoid using the /0 subnet.", "title": "Explanation"}, {"location": "checks/google/compute/no-public-egress/#possible-impact", "text": "The port is exposed for egress to the internet", "title": "Possible Impact"}, {"location": "checks/google/compute/no-public-egress/#suggested-resolution", "text": "Set a more restrictive cidr range", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-public-egress/#insecure-example", "text": "The following example will fail the google-compute-no-public-egress check. resource \"google_compute_firewall\" \"bad_example\" { direction = \"EGRESS\" allow { protocol = \"icmp\" } destination_ranges = [ \"0.0.0.0/0\" ] }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-public-egress/#secure-example", "text": "The following example will pass the google-compute-no-public-egress check. resource \"google_compute_firewall\" \"good_example\" { direction = \"EGRESS\" allow { protocol = \"icmp\" } destination_ranges = [ \"1.2.3.4/32\" ] }", "title": "Secure Example"}, {"location": "checks/google/compute/no-public-egress/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_firewall https://cloud.google.com/vpc/docs/using-firewalls", "title": "Links"}, {"location": "checks/google/compute/no-public-ingress/", "text": "An inbound firewall rule allows traffic from /0. Default Severity: critical Explanation Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets and avoid using the /0 subnet. Possible Impact The port is exposed for ingress from the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the google-compute-no-public-ingress check. resource \"google_compute_firewall\" \"bad_example\" { source_ranges = [ \"0.0.0.0/0\" ] allow { protocol = \"icmp\" } } Secure Example The following example will pass the google-compute-no-public-ingress check. resource \"google_compute_firewall\" \"good_example\" { source_ranges = [ \"1.2.3.4/32\" ] allow { protocol = \"icmp\" } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_firewall#source_ranges https://www.terraform.io/docs/providers/google/r/compute_firewall.html https://cloud.google.com/vpc/docs/using-firewalls", "title": "no-public-ingress"}, {"location": "checks/google/compute/no-public-ingress/#an-inbound-firewall-rule-allows-traffic-from-0", "text": "", "title": "An inbound firewall rule allows traffic from /0."}, {"location": "checks/google/compute/no-public-ingress/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/google/compute/no-public-ingress/#explanation", "text": "Network security rules should not use very broad subnets. Where possible, segments should be broken into smaller subnets and avoid using the /0 subnet.", "title": "Explanation"}, {"location": "checks/google/compute/no-public-ingress/#possible-impact", "text": "The port is exposed for ingress from the internet", "title": "Possible Impact"}, {"location": "checks/google/compute/no-public-ingress/#suggested-resolution", "text": "Set a more restrictive cidr range", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-public-ingress/#insecure-example", "text": "The following example will fail the google-compute-no-public-ingress check. resource \"google_compute_firewall\" \"bad_example\" { source_ranges = [ \"0.0.0.0/0\" ] allow { protocol = \"icmp\" } }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-public-ingress/#secure-example", "text": "The following example will pass the google-compute-no-public-ingress check. resource \"google_compute_firewall\" \"good_example\" { source_ranges = [ \"1.2.3.4/32\" ] allow { protocol = \"icmp\" } }", "title": "Secure Example"}, {"location": "checks/google/compute/no-public-ingress/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_firewall#source_ranges https://www.terraform.io/docs/providers/google/r/compute_firewall.html https://cloud.google.com/vpc/docs/using-firewalls", "title": "Links"}, {"location": "checks/google/compute/no-public-ip/", "text": "Instances should not have public IP addresses Default Severity: high Explanation Instances should not be publicly exposed to the internet Possible Impact Direct exposure of an instance to the public internet Suggested Resolution Remove public IP Insecure Example The following example will fail the google-compute-no-public-ip check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } } Secure Example The following example will pass the google-compute-no-public-ip check. resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#access_config https://cloud.google.com/compute/docs/ip-addresses#externaladdresses", "title": "no-public-ip"}, {"location": "checks/google/compute/no-public-ip/#instances-should-not-have-public-ip-addresses", "text": "", "title": "Instances should not have public IP addresses"}, {"location": "checks/google/compute/no-public-ip/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/compute/no-public-ip/#explanation", "text": "Instances should not be publicly exposed to the internet", "title": "Explanation"}, {"location": "checks/google/compute/no-public-ip/#possible-impact", "text": "Direct exposure of an instance to the public internet", "title": "Possible Impact"}, {"location": "checks/google/compute/no-public-ip/#suggested-resolution", "text": "Remove public IP", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-public-ip/#insecure-example", "text": "The following example will fail the google-compute-no-public-ip check. resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-public-ip/#secure-example", "text": "The following example will pass the google-compute-no-public-ip check. resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" } }", "title": "Secure Example"}, {"location": "checks/google/compute/no-public-ip/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#access_config https://cloud.google.com/compute/docs/ip-addresses#externaladdresses", "title": "Links"}, {"location": "checks/google/compute/no-serial-port/", "text": "Disable serial port connectivity for all instances Default Severity: medium Explanation When serial port access is enabled, the access is not governed by network security rules meaning the port can be exposed publicly. Possible Impact Unrestricted network access to the serial console of the instance Suggested Resolution Disable serial port access Insecure Example The following example will fail the google-compute-no-serial-port check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { serial-port-enable = true } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-no-serial-port check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { serial-port-enable = false } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#", "title": "no-serial-port"}, {"location": "checks/google/compute/no-serial-port/#disable-serial-port-connectivity-for-all-instances", "text": "", "title": "Disable serial port connectivity for all instances"}, {"location": "checks/google/compute/no-serial-port/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/compute/no-serial-port/#explanation", "text": "When serial port access is enabled, the access is not governed by network security rules meaning the port can be exposed publicly.", "title": "Explanation"}, {"location": "checks/google/compute/no-serial-port/#possible-impact", "text": "Unrestricted network access to the serial console of the instance", "title": "Possible Impact"}, {"location": "checks/google/compute/no-serial-port/#suggested-resolution", "text": "Disable serial port access", "title": "Suggested Resolution"}, {"location": "checks/google/compute/no-serial-port/#insecure-example", "text": "The following example will fail the google-compute-no-serial-port check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { serial-port-enable = true } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/compute/no-serial-port/#secure-example", "text": "The following example will pass the google-compute-no-serial-port check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"default\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { serial-port-enable = false } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/compute/no-serial-port/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#", "title": "Links"}, {"location": "checks/google/compute/project-level-oslogin/", "text": "OS Login should be enabled at project level Default Severity: medium Explanation OS Login automatically revokes the relevant SSH keys when an IAM user has their access revoked. Possible Impact Access via SSH key cannot be revoked automatically when an IAM user is removed. Suggested Resolution Enable OS Login at project level Insecure Example The following example will fail the google-compute-project-level-oslogin check. resource \"google_compute_project_metadata\" \"default\" { metadata = { enable-oslogin = false } } Secure Example The following example will pass the google-compute-project-level-oslogin check. resource \"google_compute_project_metadata\" \"default\" { metadata = { enable-oslogin = true } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_project_metadata#", "title": "project-level-oslogin"}, {"location": "checks/google/compute/project-level-oslogin/#os-login-should-be-enabled-at-project-level", "text": "", "title": "OS Login should be enabled at project level"}, {"location": "checks/google/compute/project-level-oslogin/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/compute/project-level-oslogin/#explanation", "text": "OS Login automatically revokes the relevant SSH keys when an IAM user has their access revoked.", "title": "Explanation"}, {"location": "checks/google/compute/project-level-oslogin/#possible-impact", "text": "Access via SSH key cannot be revoked automatically when an IAM user is removed.", "title": "Possible Impact"}, {"location": "checks/google/compute/project-level-oslogin/#suggested-resolution", "text": "Enable OS Login at project level", "title": "Suggested Resolution"}, {"location": "checks/google/compute/project-level-oslogin/#insecure-example", "text": "The following example will fail the google-compute-project-level-oslogin check. resource \"google_compute_project_metadata\" \"default\" { metadata = { enable-oslogin = false } }", "title": "Insecure Example"}, {"location": "checks/google/compute/project-level-oslogin/#secure-example", "text": "The following example will pass the google-compute-project-level-oslogin check. resource \"google_compute_project_metadata\" \"default\" { metadata = { enable-oslogin = true } }", "title": "Secure Example"}, {"location": "checks/google/compute/project-level-oslogin/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_project_metadata#", "title": "Links"}, {"location": "checks/google/compute/use-secure-tls-policy/", "text": "SSL policies should enforce secure versions of TLS Default Severity: critical Explanation TLS versions prior to 1.2 are outdated and insecure. You should use 1.2 as aminimum version. Possible Impact Data in transit is not sufficiently secured Suggested Resolution Enforce a minimum TLS version of 1.2 Insecure Example The following example will fail the google-compute-use-secure-tls-policy check. resource \"google_compute_ssl_policy\" \"bad_example\" { name = \"production-ssl-policy\" profile = \"MODERN\" min_tls_version = \"TLS_1_1\" } Secure Example The following example will pass the google-compute-use-secure-tls-policy check. resource \"google_compute_ssl_policy\" \"good_example\" { name = \"production-ssl-policy\" profile = \"MODERN\" min_tls_version = \"TLS_1_2\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_ssl_policy#min_tls_version", "title": "use-secure-tls-policy"}, {"location": "checks/google/compute/use-secure-tls-policy/#ssl-policies-should-enforce-secure-versions-of-tls", "text": "", "title": "SSL policies should enforce secure versions of TLS"}, {"location": "checks/google/compute/use-secure-tls-policy/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/google/compute/use-secure-tls-policy/#explanation", "text": "TLS versions prior to 1.2 are outdated and insecure. You should use 1.2 as aminimum version.", "title": "Explanation"}, {"location": "checks/google/compute/use-secure-tls-policy/#possible-impact", "text": "Data in transit is not sufficiently secured", "title": "Possible Impact"}, {"location": "checks/google/compute/use-secure-tls-policy/#suggested-resolution", "text": "Enforce a minimum TLS version of 1.2", "title": "Suggested Resolution"}, {"location": "checks/google/compute/use-secure-tls-policy/#insecure-example", "text": "The following example will fail the google-compute-use-secure-tls-policy check. resource \"google_compute_ssl_policy\" \"bad_example\" { name = \"production-ssl-policy\" profile = \"MODERN\" min_tls_version = \"TLS_1_1\" }", "title": "Insecure Example"}, {"location": "checks/google/compute/use-secure-tls-policy/#secure-example", "text": "The following example will pass the google-compute-use-secure-tls-policy check. resource \"google_compute_ssl_policy\" \"good_example\" { name = \"production-ssl-policy\" profile = \"MODERN\" min_tls_version = \"TLS_1_2\" }", "title": "Secure Example"}, {"location": "checks/google/compute/use-secure-tls-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_ssl_policy#min_tls_version", "title": "Links"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/", "text": "VM disks should be encrypted with Customer Supplied Encryption Keys Default Severity: low Explanation Using unmanaged keys makes rotation and general management difficult. Possible Impact Using unmanaged keys does not allow for proper management Suggested Resolution Use managed keys Insecure Example The following example will fail the google-compute-vm-disk-encryption-customer-key check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Secure Example The following example will pass the google-compute-vm-disk-encryption-customer-key check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } kms_key_self_link = \"something\" } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#kms_key_self_link", "title": "vm-disk-encryption-customer-key"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/#vm-disks-should-be-encrypted-with-customer-supplied-encryption-keys", "text": "", "title": "VM disks should be encrypted with Customer Supplied Encryption Keys"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/#explanation", "text": "Using unmanaged keys makes rotation and general management difficult.", "title": "Explanation"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/#possible-impact", "text": "Using unmanaged keys does not allow for proper management", "title": "Possible Impact"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/#suggested-resolution", "text": "Use managed keys", "title": "Suggested Resolution"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/#insecure-example", "text": "The following example will fail the google-compute-vm-disk-encryption-customer-key check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"bad_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/#secure-example", "text": "The following example will pass the google-compute-vm-disk-encryption-customer-key check. resource \"google_service_account\" \"default\" { account_id = \"service_account_id\" display_name = \"Service Account\" } resource \"google_compute_instance\" \"good_example\" { name = \"test\" machine_type = \"e2-medium\" zone = \"us-central1-a\" tags = [ \"foo\", \"bar\" ] boot_disk { initialize_params { image = \"debian-cloud/debian-9\" } kms_key_self_link = \"something\" } // Local SSD disk scratch_disk { interface = \"SCSI\" } network_interface { network = \"default\" access_config { // Ephemeral IP } } metadata = { foo = \"bar\" } metadata_startup_script = \"echo hi > /test.txt\" service_account { # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. email = google_service_account.default.email scopes = [ \"cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/compute/vm-disk-encryption-customer-key/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_instance#kms_key_self_link", "title": "Links"}, {"location": "checks/google/dns/enable-dnssec/", "text": "Cloud DNS should use DNSSEC Default Severity: medium Explanation DNSSEC authenticates DNS responses, preventing MITM attacks and impersonation. Possible Impact Unverified DNS responses could lead to man-in-the-middle attacks Suggested Resolution Enable DNSSEC Insecure Example The following example will fail the google-dns-enable-dnssec check. resource \"google_dns_managed_zone\" \"bad_example\" { name = \"example-zone\" dns_name = \"example-${random_id.rnd.hex}.com.\" description = \"Example DNS zone\" labels = { foo = \"bar\" } dnssec_config { state = \"off\" } } resource \"random_id\" \"rnd\" { byte_length = 4 } Secure Example The following example will pass the google-dns-enable-dnssec check. resource \"google_dns_managed_zone\" \"good_example\" { name = \"example-zone\" dns_name = \"example-${random_id.rnd.hex}.com.\" description = \"Example DNS zone\" labels = { foo = \"bar\" } dnssec_config { state = \"on\" } } resource \"random_id\" \"rnd\" { byte_length = 4 } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/dns_managed_zone#state", "title": "enable-dnssec"}, {"location": "checks/google/dns/enable-dnssec/#cloud-dns-should-use-dnssec", "text": "", "title": "Cloud DNS should use DNSSEC"}, {"location": "checks/google/dns/enable-dnssec/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/dns/enable-dnssec/#explanation", "text": "DNSSEC authenticates DNS responses, preventing MITM attacks and impersonation.", "title": "Explanation"}, {"location": "checks/google/dns/enable-dnssec/#possible-impact", "text": "Unverified DNS responses could lead to man-in-the-middle attacks", "title": "Possible Impact"}, {"location": "checks/google/dns/enable-dnssec/#suggested-resolution", "text": "Enable DNSSEC", "title": "Suggested Resolution"}, {"location": "checks/google/dns/enable-dnssec/#insecure-example", "text": "The following example will fail the google-dns-enable-dnssec check. resource \"google_dns_managed_zone\" \"bad_example\" { name = \"example-zone\" dns_name = \"example-${random_id.rnd.hex}.com.\" description = \"Example DNS zone\" labels = { foo = \"bar\" } dnssec_config { state = \"off\" } } resource \"random_id\" \"rnd\" { byte_length = 4 }", "title": "Insecure Example"}, {"location": "checks/google/dns/enable-dnssec/#secure-example", "text": "The following example will pass the google-dns-enable-dnssec check. resource \"google_dns_managed_zone\" \"good_example\" { name = \"example-zone\" dns_name = \"example-${random_id.rnd.hex}.com.\" description = \"Example DNS zone\" labels = { foo = \"bar\" } dnssec_config { state = \"on\" } } resource \"random_id\" \"rnd\" { byte_length = 4 }", "title": "Secure Example"}, {"location": "checks/google/dns/enable-dnssec/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/dns_managed_zone#state", "title": "Links"}, {"location": "checks/google/dns/no-rsa-sha1/", "text": "Zone signing should not use RSA SHA1 Default Severity: medium Explanation RSA SHA1 is a weaker algorithm than SHA2-based algorithms such as RSA SHA256/512 Possible Impact Less secure encryption algorithm than others available Suggested Resolution Use RSA SHA512 Insecure Example The following example will fail the google-dns-no-rsa-sha1 check. resource \"google_dns_managed_zone\" \"foo\" { name = \"foobar\" dns_name = \"foo.bar.\" dnssec_config { state = \"on\" non_existence = \"nsec3\" } } data \"google_dns_keys\" \"foo_dns_keys\" { managed_zone = google_dns_managed_zone.foo.id zone_signing_keys { algorithm = \"rsasha1\" } } output \"foo_dns_ds_record\" { description = \"DS record of the foo subdomain.\" value = data.google_dns_keys.foo_dns_keys.key_signing_keys[0].ds_record } Secure Example The following example will pass the google-dns-no-rsa-sha1 check. resource \"google_dns_managed_zone\" \"foo\" { name = \"foobar\" dns_name = \"foo.bar.\" dnssec_config { state = \"on\" non_existence = \"nsec3\" } } data \"google_dns_keys\" \"foo_dns_keys\" { managed_zone = google_dns_managed_zone.foo.id zone_signing_keys { algorithm = \"rsasha512\" } } output \"foo_dns_ds_record\" { description = \"DS record of the foo subdomain.\" value = data.google_dns_keys.foo_dns_keys.key_signing_keys[0].ds_record } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/dns_managed_zone#algorithm", "title": "no-rsa-sha1"}, {"location": "checks/google/dns/no-rsa-sha1/#zone-signing-should-not-use-rsa-sha1", "text": "", "title": "Zone signing should not use RSA SHA1"}, {"location": "checks/google/dns/no-rsa-sha1/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/dns/no-rsa-sha1/#explanation", "text": "RSA SHA1 is a weaker algorithm than SHA2-based algorithms such as RSA SHA256/512", "title": "Explanation"}, {"location": "checks/google/dns/no-rsa-sha1/#possible-impact", "text": "Less secure encryption algorithm than others available", "title": "Possible Impact"}, {"location": "checks/google/dns/no-rsa-sha1/#suggested-resolution", "text": "Use RSA SHA512", "title": "Suggested Resolution"}, {"location": "checks/google/dns/no-rsa-sha1/#insecure-example", "text": "The following example will fail the google-dns-no-rsa-sha1 check. resource \"google_dns_managed_zone\" \"foo\" { name = \"foobar\" dns_name = \"foo.bar.\" dnssec_config { state = \"on\" non_existence = \"nsec3\" } } data \"google_dns_keys\" \"foo_dns_keys\" { managed_zone = google_dns_managed_zone.foo.id zone_signing_keys { algorithm = \"rsasha1\" } } output \"foo_dns_ds_record\" { description = \"DS record of the foo subdomain.\" value = data.google_dns_keys.foo_dns_keys.key_signing_keys[0].ds_record }", "title": "Insecure Example"}, {"location": "checks/google/dns/no-rsa-sha1/#secure-example", "text": "The following example will pass the google-dns-no-rsa-sha1 check. resource \"google_dns_managed_zone\" \"foo\" { name = \"foobar\" dns_name = \"foo.bar.\" dnssec_config { state = \"on\" non_existence = \"nsec3\" } } data \"google_dns_keys\" \"foo_dns_keys\" { managed_zone = google_dns_managed_zone.foo.id zone_signing_keys { algorithm = \"rsasha512\" } } output \"foo_dns_ds_record\" { description = \"DS record of the foo subdomain.\" value = data.google_dns_keys.foo_dns_keys.key_signing_keys[0].ds_record }", "title": "Secure Example"}, {"location": "checks/google/dns/no-rsa-sha1/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/dns_managed_zone#algorithm", "title": "Links"}, {"location": "checks/google/gke/enable-auto-repair/", "text": "Kubernetes should have 'Automatic repair' enabled Default Severity: low Explanation Automatic repair will monitor nodes and attempt repair when a node fails multiple subsequent health checks Possible Impact Failing nodes will require manual repair. Suggested Resolution Enable automatic repair Insecure Example The following example will fail the google-gke-enable-auto-repair check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_repair = false } } Secure Example The following example will pass the google-gke-enable-auto-repair check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_repair = true } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#auto_repair", "title": "enable-auto-repair"}, {"location": "checks/google/gke/enable-auto-repair/#kubernetes-should-have-automatic-repair-enabled", "text": "", "title": "Kubernetes should have 'Automatic repair' enabled"}, {"location": "checks/google/gke/enable-auto-repair/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/gke/enable-auto-repair/#explanation", "text": "Automatic repair will monitor nodes and attempt repair when a node fails multiple subsequent health checks", "title": "Explanation"}, {"location": "checks/google/gke/enable-auto-repair/#possible-impact", "text": "Failing nodes will require manual repair.", "title": "Possible Impact"}, {"location": "checks/google/gke/enable-auto-repair/#suggested-resolution", "text": "Enable automatic repair", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enable-auto-repair/#insecure-example", "text": "The following example will fail the google-gke-enable-auto-repair check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_repair = false } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enable-auto-repair/#secure-example", "text": "The following example will pass the google-gke-enable-auto-repair check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_repair = true } }", "title": "Secure Example"}, {"location": "checks/google/gke/enable-auto-repair/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#auto_repair", "title": "Links"}, {"location": "checks/google/gke/enable-auto-upgrade/", "text": "Kubernetes should have 'Automatic upgrade' enabled Default Severity: low Explanation Automatic updates keep nodes updated with the latest cluster master version. Possible Impact Nodes will need the cluster master version manually updating Suggested Resolution Enable automatic upgrades Insecure Example The following example will fail the google-gke-enable-auto-upgrade check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_upgrade = false } } Secure Example The following example will pass the google-gke-enable-auto-upgrade check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_upgrade = true } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#auto_upgrade", "title": "enable-auto-upgrade"}, {"location": "checks/google/gke/enable-auto-upgrade/#kubernetes-should-have-automatic-upgrade-enabled", "text": "", "title": "Kubernetes should have 'Automatic upgrade' enabled"}, {"location": "checks/google/gke/enable-auto-upgrade/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/gke/enable-auto-upgrade/#explanation", "text": "Automatic updates keep nodes updated with the latest cluster master version.", "title": "Explanation"}, {"location": "checks/google/gke/enable-auto-upgrade/#possible-impact", "text": "Nodes will need the cluster master version manually updating", "title": "Possible Impact"}, {"location": "checks/google/gke/enable-auto-upgrade/#suggested-resolution", "text": "Enable automatic upgrades", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enable-auto-upgrade/#insecure-example", "text": "The following example will fail the google-gke-enable-auto-upgrade check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_upgrade = false } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enable-auto-upgrade/#secure-example", "text": "The following example will pass the google-gke-enable-auto-upgrade check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } management { auto_upgrade = true } }", "title": "Secure Example"}, {"location": "checks/google/gke/enable-auto-upgrade/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#auto_upgrade", "title": "Links"}, {"location": "checks/google/gke/enable-ip-aliasing/", "text": "Clusters should have IP aliasing enabled Default Severity: low Explanation IP aliasing allows the reuse of public IPs internally, removing the need for a NAT gateway. Possible Impact Nodes need a NAT gateway to access local services Suggested Resolution Enable IP aliasing Insecure Example The following example will fail the google-gke-enable-ip-aliasing check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-ip-aliasing check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 ip_allocation_policy = {} } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#ip_allocation_policy", "title": "enable-ip-aliasing"}, {"location": "checks/google/gke/enable-ip-aliasing/#clusters-should-have-ip-aliasing-enabled", "text": "", "title": "Clusters should have IP aliasing enabled"}, {"location": "checks/google/gke/enable-ip-aliasing/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/gke/enable-ip-aliasing/#explanation", "text": "IP aliasing allows the reuse of public IPs internally, removing the need for a NAT gateway.", "title": "Explanation"}, {"location": "checks/google/gke/enable-ip-aliasing/#possible-impact", "text": "Nodes need a NAT gateway to access local services", "title": "Possible Impact"}, {"location": "checks/google/gke/enable-ip-aliasing/#suggested-resolution", "text": "Enable IP aliasing", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enable-ip-aliasing/#insecure-example", "text": "The following example will fail the google-gke-enable-ip-aliasing check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enable-ip-aliasing/#secure-example", "text": "The following example will pass the google-gke-enable-ip-aliasing check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 ip_allocation_policy = {} } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/enable-ip-aliasing/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#ip_allocation_policy", "title": "Links"}, {"location": "checks/google/gke/enable-master-networks/", "text": "Master authorized networks should be configured on GKE clusters Default Severity: high Explanation Enabling authorized networks means you can restrict master access to a fixed set of CIDR ranges Possible Impact Unrestricted network access to the master Suggested Resolution Enable master authorized networks Insecure Example The following example will fail the google-gke-enable-master-networks check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-master-networks check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"10.10.128.0/24\" display_name = \"internal\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#", "title": "enable-master-networks"}, {"location": "checks/google/gke/enable-master-networks/#master-authorized-networks-should-be-configured-on-gke-clusters", "text": "", "title": "Master authorized networks should be configured on GKE clusters"}, {"location": "checks/google/gke/enable-master-networks/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/gke/enable-master-networks/#explanation", "text": "Enabling authorized networks means you can restrict master access to a fixed set of CIDR ranges", "title": "Explanation"}, {"location": "checks/google/gke/enable-master-networks/#possible-impact", "text": "Unrestricted network access to the master", "title": "Possible Impact"}, {"location": "checks/google/gke/enable-master-networks/#suggested-resolution", "text": "Enable master authorized networks", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enable-master-networks/#insecure-example", "text": "The following example will fail the google-gke-enable-master-networks check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enable-master-networks/#secure-example", "text": "The following example will pass the google-gke-enable-master-networks check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"10.10.128.0/24\" display_name = \"internal\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/enable-master-networks/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#", "title": "Links"}, {"location": "checks/google/gke/enable-network-policy/", "text": "Network Policy should be enabled on GKE clusters Default Severity: medium Explanation Enabling a network policy allows the segregation of network traffic by namespace Possible Impact Unrestricted inter-cluster communication Suggested Resolution Enable network policy Insecure Example The following example will fail the google-gke-enable-network-policy check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 network_policy { enabled = false } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-network-policy check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 network_policy { enabled = true } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enabled", "title": "enable-network-policy"}, {"location": "checks/google/gke/enable-network-policy/#network-policy-should-be-enabled-on-gke-clusters", "text": "", "title": "Network Policy should be enabled on GKE clusters"}, {"location": "checks/google/gke/enable-network-policy/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/gke/enable-network-policy/#explanation", "text": "Enabling a network policy allows the segregation of network traffic by namespace", "title": "Explanation"}, {"location": "checks/google/gke/enable-network-policy/#possible-impact", "text": "Unrestricted inter-cluster communication", "title": "Possible Impact"}, {"location": "checks/google/gke/enable-network-policy/#suggested-resolution", "text": "Enable network policy", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enable-network-policy/#insecure-example", "text": "The following example will fail the google-gke-enable-network-policy check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 network_policy { enabled = false } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enable-network-policy/#secure-example", "text": "The following example will pass the google-gke-enable-network-policy check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 network_policy { enabled = true } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/enable-network-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enabled", "title": "Links"}, {"location": "checks/google/gke/enable-private-cluster/", "text": "Clusters should be set to private Default Severity: medium Explanation Enabling private nodes on a cluster ensures the nodes are only available internally as they will only be assigned internal addresses. Possible Impact Nodes may be exposed to the public internet Suggested Resolution Enable private cluster Insecure Example The following example will fail the google-gke-enable-private-cluster check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 private_cluster_config { enable_private_nodes = false } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-private-cluster check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 private_cluster_config { enable_private_nodes = true } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_private_nodes", "title": "enable-private-cluster"}, {"location": "checks/google/gke/enable-private-cluster/#clusters-should-be-set-to-private", "text": "", "title": "Clusters should be set to private"}, {"location": "checks/google/gke/enable-private-cluster/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/gke/enable-private-cluster/#explanation", "text": "Enabling private nodes on a cluster ensures the nodes are only available internally as they will only be assigned internal addresses.", "title": "Explanation"}, {"location": "checks/google/gke/enable-private-cluster/#possible-impact", "text": "Nodes may be exposed to the public internet", "title": "Possible Impact"}, {"location": "checks/google/gke/enable-private-cluster/#suggested-resolution", "text": "Enable private cluster", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enable-private-cluster/#insecure-example", "text": "The following example will fail the google-gke-enable-private-cluster check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 private_cluster_config { enable_private_nodes = false } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enable-private-cluster/#secure-example", "text": "The following example will pass the google-gke-enable-private-cluster check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 private_cluster_config { enable_private_nodes = true } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/enable-private-cluster/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_private_nodes", "title": "Links"}, {"location": "checks/google/gke/enable-stackdriver-logging/", "text": "Stackdriver Logging should be enabled Default Severity: low Explanation StackDriver logging provides a useful interface to all of stdout/stderr for each container and should be enabled for moitoring, debugging, etc. Possible Impact Visibility will be reduced Suggested Resolution Enable StackDriver logging Insecure Example The following example will fail the google-gke-enable-stackdriver-logging check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 logging_service = \"logging.googleapis.com\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-stackdriver-logging check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 logging_service = \"logging.googleapis.com/kubernetes\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#logging_service", "title": "enable-stackdriver-logging"}, {"location": "checks/google/gke/enable-stackdriver-logging/#stackdriver-logging-should-be-enabled", "text": "", "title": "Stackdriver Logging should be enabled"}, {"location": "checks/google/gke/enable-stackdriver-logging/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/gke/enable-stackdriver-logging/#explanation", "text": "StackDriver logging provides a useful interface to all of stdout/stderr for each container and should be enabled for moitoring, debugging, etc.", "title": "Explanation"}, {"location": "checks/google/gke/enable-stackdriver-logging/#possible-impact", "text": "Visibility will be reduced", "title": "Possible Impact"}, {"location": "checks/google/gke/enable-stackdriver-logging/#suggested-resolution", "text": "Enable StackDriver logging", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enable-stackdriver-logging/#insecure-example", "text": "The following example will fail the google-gke-enable-stackdriver-logging check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 logging_service = \"logging.googleapis.com\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enable-stackdriver-logging/#secure-example", "text": "The following example will pass the google-gke-enable-stackdriver-logging check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 logging_service = \"logging.googleapis.com/kubernetes\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/enable-stackdriver-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#logging_service", "title": "Links"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/", "text": "Stackdriver Monitoring should be enabled Default Severity: low Explanation StackDriver monitoring aggregates logs, events, and metrics from your Kubernetes environment on GKE to help you understand your application's behavior in production. Possible Impact Visibility will be reduced Suggested Resolution Enable StackDriver monitoring Insecure Example The following example will fail the google-gke-enable-stackdriver-monitoring check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 monitoring_service = \"monitoring.googleapis.com\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-enable-stackdriver-monitoring check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 monitoring_service = \"monitoring.googleapis.com/kubernetes\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#monitoring_service", "title": "enable-stackdriver-monitoring"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/#stackdriver-monitoring-should-be-enabled", "text": "", "title": "Stackdriver Monitoring should be enabled"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/#explanation", "text": "StackDriver monitoring aggregates logs, events, and metrics from your Kubernetes environment on GKE to help you understand your application's behavior in production.", "title": "Explanation"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/#possible-impact", "text": "Visibility will be reduced", "title": "Possible Impact"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/#suggested-resolution", "text": "Enable StackDriver monitoring", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/#insecure-example", "text": "The following example will fail the google-gke-enable-stackdriver-monitoring check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 monitoring_service = \"monitoring.googleapis.com\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/#secure-example", "text": "The following example will pass the google-gke-enable-stackdriver-monitoring check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 monitoring_service = \"monitoring.googleapis.com/kubernetes\" } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/enable-stackdriver-monitoring/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#monitoring_service", "title": "Links"}, {"location": "checks/google/gke/enforce-pod-security-policy/", "text": "Pod security policy enforcement not defined. Default Severity: high Explanation By default, Pods in Kubernetes can operate with capabilities beyond what they require. You should constrain the Pod's capabilities to only those required for that workload. Kubernetes offers controls for restricting your Pods to execute with only explicitly granted capabilities. Pod Security Policy allows you to set smart defaults for your Pods, and enforce controls you want to enable across your fleet. The policies you define should be specific to the needs of your application Possible Impact Pods could be operating with more permissions than required to be effective Suggested Resolution Use security policies for pods to restrict permissions to those needed to be effective Insecure Example The following example will fail the google-gke-enforce-pod-security-policy check. resource \"google_container_cluster\" \"bad_example\" { pod_security_policy_config { enabled = \"false\" } } Secure Example The following example will pass the google-gke-enforce-pod-security-policy check. resource \"google_container_cluster\" \"good_example\" { pod_security_policy_config { enabled = \"true\" } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#pod_security_policy_config https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#admission_controllers", "title": "enforce-pod-security-policy"}, {"location": "checks/google/gke/enforce-pod-security-policy/#pod-security-policy-enforcement-not-defined", "text": "", "title": "Pod security policy enforcement not defined."}, {"location": "checks/google/gke/enforce-pod-security-policy/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/gke/enforce-pod-security-policy/#explanation", "text": "By default, Pods in Kubernetes can operate with capabilities beyond what they require. You should constrain the Pod's capabilities to only those required for that workload. Kubernetes offers controls for restricting your Pods to execute with only explicitly granted capabilities. Pod Security Policy allows you to set smart defaults for your Pods, and enforce controls you want to enable across your fleet. The policies you define should be specific to the needs of your application", "title": "Explanation"}, {"location": "checks/google/gke/enforce-pod-security-policy/#possible-impact", "text": "Pods could be operating with more permissions than required to be effective", "title": "Possible Impact"}, {"location": "checks/google/gke/enforce-pod-security-policy/#suggested-resolution", "text": "Use security policies for pods to restrict permissions to those needed to be effective", "title": "Suggested Resolution"}, {"location": "checks/google/gke/enforce-pod-security-policy/#insecure-example", "text": "The following example will fail the google-gke-enforce-pod-security-policy check. resource \"google_container_cluster\" \"bad_example\" { pod_security_policy_config { enabled = \"false\" } }", "title": "Insecure Example"}, {"location": "checks/google/gke/enforce-pod-security-policy/#secure-example", "text": "The following example will pass the google-gke-enforce-pod-security-policy check. resource \"google_container_cluster\" \"good_example\" { pod_security_policy_config { enabled = \"true\" } }", "title": "Secure Example"}, {"location": "checks/google/gke/enforce-pod-security-policy/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#pod_security_policy_config https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#admission_controllers", "title": "Links"}, {"location": "checks/google/gke/metadata-endpoints-disabled/", "text": "Legacy metadata endpoints enabled. Default Severity: high Explanation The Compute Engine instance metadata server exposes legacy v0.1 and v1beta1 endpoints, which do not enforce metadata query headers. This is a feature in the v1 APIs that makes it more difficult for a potential attacker to retrieve instance metadata. Unless specifically required, we recommend you disable these legacy APIs. When setting the metadata block, the default value for disable-legacy-endpoints is set to true, they should not be explicitly enabled. Possible Impact Legacy metadata endpoints don't require metadata headers Suggested Resolution Disable legacy metadata endpoints Insecure Example The following example will fail the google-gke-metadata-endpoints-disabled check. resource \"google_container_cluster\" \"bad_example\" { metadata { disable-legacy-endpoints = false } } Secure Example The following example will pass the google-gke-metadata-endpoints-disabled check. resource \"google_container_cluster\" \"good_example\" { metadata { disable-legacy-endpoints = true } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#metadata https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#protect_node_metadata_default_for_112", "title": "metadata-endpoints-disabled"}, {"location": "checks/google/gke/metadata-endpoints-disabled/#legacy-metadata-endpoints-enabled", "text": "", "title": "Legacy metadata endpoints enabled."}, {"location": "checks/google/gke/metadata-endpoints-disabled/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/gke/metadata-endpoints-disabled/#explanation", "text": "The Compute Engine instance metadata server exposes legacy v0.1 and v1beta1 endpoints, which do not enforce metadata query headers. This is a feature in the v1 APIs that makes it more difficult for a potential attacker to retrieve instance metadata. Unless specifically required, we recommend you disable these legacy APIs. When setting the metadata block, the default value for disable-legacy-endpoints is set to true, they should not be explicitly enabled.", "title": "Explanation"}, {"location": "checks/google/gke/metadata-endpoints-disabled/#possible-impact", "text": "Legacy metadata endpoints don't require metadata headers", "title": "Possible Impact"}, {"location": "checks/google/gke/metadata-endpoints-disabled/#suggested-resolution", "text": "Disable legacy metadata endpoints", "title": "Suggested Resolution"}, {"location": "checks/google/gke/metadata-endpoints-disabled/#insecure-example", "text": "The following example will fail the google-gke-metadata-endpoints-disabled check. resource \"google_container_cluster\" \"bad_example\" { metadata { disable-legacy-endpoints = false } }", "title": "Insecure Example"}, {"location": "checks/google/gke/metadata-endpoints-disabled/#secure-example", "text": "The following example will pass the google-gke-metadata-endpoints-disabled check. resource \"google_container_cluster\" \"good_example\" { metadata { disable-legacy-endpoints = true } }", "title": "Secure Example"}, {"location": "checks/google/gke/metadata-endpoints-disabled/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#metadata https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#protect_node_metadata_default_for_112", "title": "Links"}, {"location": "checks/google/gke/no-legacy-authentication/", "text": "Legacy client authentication methods utilized. Default Severity: high Explanation It is recommended to use Service Accounts and OAuth as authentication methods for accessing the master in the container cluster. Basic authentication should be disabled by explicitly unsetting the username and password on the master_auth block. Possible Impact Username/password or certificate authentication methods are less secure Suggested Resolution Use service account or OAuth for authentication Insecure Example The following example will fail the google-gke-no-legacy-authentication check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_auth { client_certificate_config { issue_client_certificate = true } } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-no-legacy-authentication check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#master_auth https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#restrict_authn_methods", "title": "no-legacy-authentication"}, {"location": "checks/google/gke/no-legacy-authentication/#legacy-client-authentication-methods-utilized", "text": "", "title": "Legacy client authentication methods utilized."}, {"location": "checks/google/gke/no-legacy-authentication/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/gke/no-legacy-authentication/#explanation", "text": "It is recommended to use Service Accounts and OAuth as authentication methods for accessing the master in the container cluster. Basic authentication should be disabled by explicitly unsetting the username and password on the master_auth block.", "title": "Explanation"}, {"location": "checks/google/gke/no-legacy-authentication/#possible-impact", "text": "Username/password or certificate authentication methods are less secure", "title": "Possible Impact"}, {"location": "checks/google/gke/no-legacy-authentication/#suggested-resolution", "text": "Use service account or OAuth for authentication", "title": "Suggested Resolution"}, {"location": "checks/google/gke/no-legacy-authentication/#insecure-example", "text": "The following example will fail the google-gke-no-legacy-authentication check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_auth { client_certificate_config { issue_client_certificate = true } } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/no-legacy-authentication/#secure-example", "text": "The following example will pass the google-gke-no-legacy-authentication check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/no-legacy-authentication/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#master_auth https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#restrict_authn_methods", "title": "Links"}, {"location": "checks/google/gke/no-public-control-plane/", "text": "GKE Control Plane should not be publicly accessible Default Severity: high Explanation The GKE control plane is exposed to the public internet by default. Possible Impact GKE control plane exposed to public internet Suggested Resolution Use private nodes and master authorised networks to prevent exposure Insecure Example The following example will fail the google-gke-no-public-control-plane check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"0.0.0.0/0\" display_name = \"external\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-no-public-control-plane check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"10.10.128.0/24\" display_name = \"internal\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#", "title": "no-public-control-plane"}, {"location": "checks/google/gke/no-public-control-plane/#gke-control-plane-should-not-be-publicly-accessible", "text": "", "title": "GKE Control Plane should not be publicly accessible"}, {"location": "checks/google/gke/no-public-control-plane/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/gke/no-public-control-plane/#explanation", "text": "The GKE control plane is exposed to the public internet by default.", "title": "Explanation"}, {"location": "checks/google/gke/no-public-control-plane/#possible-impact", "text": "GKE control plane exposed to public internet", "title": "Possible Impact"}, {"location": "checks/google/gke/no-public-control-plane/#suggested-resolution", "text": "Use private nodes and master authorised networks to prevent exposure", "title": "Suggested Resolution"}, {"location": "checks/google/gke/no-public-control-plane/#insecure-example", "text": "The following example will fail the google-gke-no-public-control-plane check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"0.0.0.0/0\" display_name = \"external\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/no-public-control-plane/#secure-example", "text": "The following example will pass the google-gke-no-public-control-plane check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 master_authorized_networks_config = [{ cidr_blocks = [{ cidr_block = \"10.10.128.0/24\" display_name = \"internal\" }] }] } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/no-public-control-plane/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#", "title": "Links"}, {"location": "checks/google/gke/node-metadata-security/", "text": "Node metadata value disables metadata concealment. Default Severity: high Explanation If the workload_metadata_config block within node_config is included, the node_metadata attribute should be configured securely. The attribute should be set to SECURE to use metadata concealment, or GKE_METADATA_SERVER if workload identity is enabled. This ensures that the VM metadata is not unnecessarily exposed to pods. Possible Impact Metadata that isn't concealed potentially risks leakage of sensitive data Suggested Resolution Set node metadata to SECURE or GKE_METADATA_SERVER Insecure Example The following example will fail the google-gke-node-metadata-security check. resource \"google_container_node_pool\" \"bad_example\" { node_config { workload_metadata_config { node_metadata = \"EXPOSE\" } } } Secure Example The following example will pass the google-gke-node-metadata-security check. resource \"google_container_node_pool\" \"good_example\" { node_config { workload_metadata_config { node_metadata = \"SECURE\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#node_metadata https://cloud.google.com/kubernetes-engine/docs/how-to/protecting-cluster-metadata#create-concealed", "title": "node-metadata-security"}, {"location": "checks/google/gke/node-metadata-security/#node-metadata-value-disables-metadata-concealment", "text": "", "title": "Node metadata value disables metadata concealment."}, {"location": "checks/google/gke/node-metadata-security/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/gke/node-metadata-security/#explanation", "text": "If the workload_metadata_config block within node_config is included, the node_metadata attribute should be configured securely. The attribute should be set to SECURE to use metadata concealment, or GKE_METADATA_SERVER if workload identity is enabled. This ensures that the VM metadata is not unnecessarily exposed to pods.", "title": "Explanation"}, {"location": "checks/google/gke/node-metadata-security/#possible-impact", "text": "Metadata that isn't concealed potentially risks leakage of sensitive data", "title": "Possible Impact"}, {"location": "checks/google/gke/node-metadata-security/#suggested-resolution", "text": "Set node metadata to SECURE or GKE_METADATA_SERVER", "title": "Suggested Resolution"}, {"location": "checks/google/gke/node-metadata-security/#insecure-example", "text": "The following example will fail the google-gke-node-metadata-security check. resource \"google_container_node_pool\" \"bad_example\" { node_config { workload_metadata_config { node_metadata = \"EXPOSE\" } } }", "title": "Insecure Example"}, {"location": "checks/google/gke/node-metadata-security/#secure-example", "text": "The following example will pass the google-gke-node-metadata-security check. resource \"google_container_node_pool\" \"good_example\" { node_config { workload_metadata_config { node_metadata = \"SECURE\" } } }", "title": "Secure Example"}, {"location": "checks/google/gke/node-metadata-security/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#node_metadata https://cloud.google.com/kubernetes-engine/docs/how-to/protecting-cluster-metadata#create-concealed", "title": "Links"}, {"location": "checks/google/gke/node-pool-uses-cos/", "text": "Ensure Container-Optimized OS (cos) is used for Kubernetes Engine Clusters Node image Default Severity: low Explanation GKE supports several OS image types but COS is the recommended OS image to use on cluster nodes for enhanced security Possible Impact COS is the recommended OS image to use on cluster nodes Suggested Resolution Use the COS image type Insecure Example The following example will fail the google-gke-node-pool-uses-cos check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] image_type = \"something\" } } Secure Example The following example will pass the google-gke-node-pool-uses-cos check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] image_type = \"COS\" } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#image_type", "title": "node-pool-uses-cos"}, {"location": "checks/google/gke/node-pool-uses-cos/#ensure-container-optimized-os-cos-is-used-for-kubernetes-engine-clusters-node-image", "text": "", "title": "Ensure Container-Optimized OS (cos) is used for Kubernetes Engine Clusters Node image"}, {"location": "checks/google/gke/node-pool-uses-cos/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/gke/node-pool-uses-cos/#explanation", "text": "GKE supports several OS image types but COS is the recommended OS image to use on cluster nodes for enhanced security", "title": "Explanation"}, {"location": "checks/google/gke/node-pool-uses-cos/#possible-impact", "text": "COS is the recommended OS image to use on cluster nodes", "title": "Possible Impact"}, {"location": "checks/google/gke/node-pool-uses-cos/#suggested-resolution", "text": "Use the COS image type", "title": "Suggested Resolution"}, {"location": "checks/google/gke/node-pool-uses-cos/#insecure-example", "text": "The following example will fail the google-gke-node-pool-uses-cos check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"bad_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] image_type = \"something\" } }", "title": "Insecure Example"}, {"location": "checks/google/gke/node-pool-uses-cos/#secure-example", "text": "The following example will pass the google-gke-node-pool-uses-cos check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"primary\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"good_example\" { name = \"my-node-pool\" cluster = google_container_cluster.primary.id node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] image_type = \"COS\" } }", "title": "Secure Example"}, {"location": "checks/google/gke/node-pool-uses-cos/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_node_pool#image_type", "title": "Links"}, {"location": "checks/google/gke/node-shielding-enabled/", "text": "Shielded GKE nodes not enabled. Default Severity: high Explanation CIS GKE Benchmark Recommendation: 6.5.5. Ensure Shielded GKE Nodes are Enabled Shielded GKE Nodes provide strong, verifiable node identity and integrity to increase the security of GKE nodes and should be enabled on all GKE clusters. Possible Impact Node identity and integrity can't be verified without shielded GKE nodes Suggested Resolution Enable node shielding Insecure Example The following example will fail the google-gke-node-shielding-enabled check. resource \"google_container_cluster\" \"bad_example\" { enable_shielded_nodes = \"false\" } Secure Example The following example will pass the google-gke-node-shielding-enabled check. resource \"google_container_cluster\" \"good_example\" { enable_shielded_nodes = \"true\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_shielded_nodes https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#shielded_nodes", "title": "node-shielding-enabled"}, {"location": "checks/google/gke/node-shielding-enabled/#shielded-gke-nodes-not-enabled", "text": "", "title": "Shielded GKE nodes not enabled."}, {"location": "checks/google/gke/node-shielding-enabled/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/gke/node-shielding-enabled/#explanation", "text": "CIS GKE Benchmark Recommendation: 6.5.5. Ensure Shielded GKE Nodes are Enabled Shielded GKE Nodes provide strong, verifiable node identity and integrity to increase the security of GKE nodes and should be enabled on all GKE clusters.", "title": "Explanation"}, {"location": "checks/google/gke/node-shielding-enabled/#possible-impact", "text": "Node identity and integrity can't be verified without shielded GKE nodes", "title": "Possible Impact"}, {"location": "checks/google/gke/node-shielding-enabled/#suggested-resolution", "text": "Enable node shielding", "title": "Suggested Resolution"}, {"location": "checks/google/gke/node-shielding-enabled/#insecure-example", "text": "The following example will fail the google-gke-node-shielding-enabled check. resource \"google_container_cluster\" \"bad_example\" { enable_shielded_nodes = \"false\" }", "title": "Insecure Example"}, {"location": "checks/google/gke/node-shielding-enabled/#secure-example", "text": "The following example will pass the google-gke-node-shielding-enabled check. resource \"google_container_cluster\" \"good_example\" { enable_shielded_nodes = \"true\" }", "title": "Secure Example"}, {"location": "checks/google/gke/node-shielding-enabled/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_shielded_nodes https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#shielded_nodes", "title": "Links"}, {"location": "checks/google/gke/use-cluster-labels/", "text": "Clusters should be configured with Labels Default Severity: low Explanation Labels make it easier to manage assets and differentiate between clusters and environments, allowing the mapping of computational resources to the wider organisational structure. Possible Impact Asset management can be limited/more difficult Suggested Resolution Set cluster resource labels Insecure Example The following example will fail the google-gke-use-cluster-labels check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Secure Example The following example will pass the google-gke-use-cluster-labels check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 resource_labels = { \"env\" = \"staging\" } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#resource_labels", "title": "use-cluster-labels"}, {"location": "checks/google/gke/use-cluster-labels/#clusters-should-be-configured-with-labels", "text": "", "title": "Clusters should be configured with Labels"}, {"location": "checks/google/gke/use-cluster-labels/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/gke/use-cluster-labels/#explanation", "text": "Labels make it easier to manage assets and differentiate between clusters and environments, allowing the mapping of computational resources to the wider organisational structure.", "title": "Explanation"}, {"location": "checks/google/gke/use-cluster-labels/#possible-impact", "text": "Asset management can be limited/more difficult", "title": "Possible Impact"}, {"location": "checks/google/gke/use-cluster-labels/#suggested-resolution", "text": "Set cluster resource labels", "title": "Suggested Resolution"}, {"location": "checks/google/gke/use-cluster-labels/#insecure-example", "text": "The following example will fail the google-gke-use-cluster-labels check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"bad_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Insecure Example"}, {"location": "checks/google/gke/use-cluster-labels/#secure-example", "text": "The following example will pass the google-gke-use-cluster-labels check. resource \"google_service_account\" \"default\" { account_id = \"service-account-id\" display_name = \"Service Account\" } resource \"google_container_cluster\" \"good_example\" { name = \"my-gke-cluster\" location = \"us-central1\" # We can't create a cluster with no node pool defined, but we want to only use # separately managed node pools. So we create the smallest possible default # node pool and immediately delete it. remove_default_node_pool = true initial_node_count = 1 resource_labels = { \"env\" = \"staging\" } } resource \"google_container_node_pool\" \"primary_preemptible_nodes\" { name = \"my-node-pool\" location = \"us-central1\" cluster = google_container_cluster.primary.name node_count = 1 node_config { preemptible = true machine_type = \"e2-medium\" # Google recommends custom service accounts that have cloud-platform scope and permissions granted via IAM Roles. service_account = google_service_account.default.email oauth_scopes = [ \"https://www.googleapis.com/auth/cloud-platform\" ] } }", "title": "Secure Example"}, {"location": "checks/google/gke/use-cluster-labels/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#resource_labels", "title": "Links"}, {"location": "checks/google/gke/use-rbac-permissions/", "text": "Legacy ABAC permissions are enabled. Default Severity: high Explanation You should disable Attribute-Based Access Control (ABAC), and instead use Role-Based Access Control (RBAC) in GKE. RBAC has significant security advantages and is now stable in Kubernetes, so it\u2019s time to disable ABAC. Possible Impact ABAC permissions are less secure than RBAC permissions Suggested Resolution Switch to using RBAC permissions Insecure Example The following example will fail the google-gke-use-rbac-permissions check. resource \"google_container_cluster\" \"bad_example\" { enable_legacy_abac = \"true\" } Secure Example The following example will pass the google-gke-use-rbac-permissions check. resource \"google_container_cluster\" \"good_example\" { # ... # enable_legacy_abac not set # ... } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_legacy_abac https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#leave_abac_disabled_default_for_110", "title": "use-rbac-permissions"}, {"location": "checks/google/gke/use-rbac-permissions/#legacy-abac-permissions-are-enabled", "text": "", "title": "Legacy ABAC permissions are enabled."}, {"location": "checks/google/gke/use-rbac-permissions/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/gke/use-rbac-permissions/#explanation", "text": "You should disable Attribute-Based Access Control (ABAC), and instead use Role-Based Access Control (RBAC) in GKE. RBAC has significant security advantages and is now stable in Kubernetes, so it\u2019s time to disable ABAC.", "title": "Explanation"}, {"location": "checks/google/gke/use-rbac-permissions/#possible-impact", "text": "ABAC permissions are less secure than RBAC permissions", "title": "Possible Impact"}, {"location": "checks/google/gke/use-rbac-permissions/#suggested-resolution", "text": "Switch to using RBAC permissions", "title": "Suggested Resolution"}, {"location": "checks/google/gke/use-rbac-permissions/#insecure-example", "text": "The following example will fail the google-gke-use-rbac-permissions check. resource \"google_container_cluster\" \"bad_example\" { enable_legacy_abac = \"true\" }", "title": "Insecure Example"}, {"location": "checks/google/gke/use-rbac-permissions/#secure-example", "text": "The following example will pass the google-gke-use-rbac-permissions check. resource \"google_container_cluster\" \"good_example\" { # ... # enable_legacy_abac not set # ... }", "title": "Secure Example"}, {"location": "checks/google/gke/use-rbac-permissions/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#enable_legacy_abac https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#leave_abac_disabled_default_for_110", "title": "Links"}, {"location": "checks/google/gke/use-service-account/", "text": "Checks for service account defined for GKE nodes Default Severity: medium Explanation You should create and use a minimally privileged service account to run your GKE cluster instead of using the Compute Engine default service account. Possible Impact Service accounts with wide permissions can increase the risk of compromise Suggested Resolution Use limited permissions for service accounts to be effective Insecure Example The following example will fail the google-gke-use-service-account check. resource \"google_container_cluster\" \"bad_example\" { node_config { } } Secure Example The following example will pass the google-gke-use-service-account check. resource \"google_container_cluster\" \"good_example\" { node_config { service_account = \"cool-service-account@example.com\" } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#service_account https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#use_least_privilege_sa", "title": "use-service-account"}, {"location": "checks/google/gke/use-service-account/#checks-for-service-account-defined-for-gke-nodes", "text": "", "title": "Checks for service account defined for GKE nodes"}, {"location": "checks/google/gke/use-service-account/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/gke/use-service-account/#explanation", "text": "You should create and use a minimally privileged service account to run your GKE cluster instead of using the Compute Engine default service account.", "title": "Explanation"}, {"location": "checks/google/gke/use-service-account/#possible-impact", "text": "Service accounts with wide permissions can increase the risk of compromise", "title": "Possible Impact"}, {"location": "checks/google/gke/use-service-account/#suggested-resolution", "text": "Use limited permissions for service accounts to be effective", "title": "Suggested Resolution"}, {"location": "checks/google/gke/use-service-account/#insecure-example", "text": "The following example will fail the google-gke-use-service-account check. resource \"google_container_cluster\" \"bad_example\" { node_config { } }", "title": "Insecure Example"}, {"location": "checks/google/gke/use-service-account/#secure-example", "text": "The following example will pass the google-gke-use-service-account check. resource \"google_container_cluster\" \"good_example\" { node_config { service_account = \"cool-service-account@example.com\" } }", "title": "Secure Example"}, {"location": "checks/google/gke/use-service-account/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster#service_account https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#use_least_privilege_sa", "title": "Links"}, {"location": "checks/google/iam/no-default-network/", "text": "Default network should not be created at project level Default Severity: high Explanation The default network which is provided for a project contains multiple insecure firewall rules which allow ingress to the project's infrastructure. Creation of this network should therefore be disabled. Possible Impact Exposure of internal infrastructure/services to public internet Suggested Resolution Disable automatic default network creation Insecure Example The following example will fail the google-iam-no-default-network check. resource \"google_project\" \"bad_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = true } Secure Example The following example will pass the google-iam-no-default-network check. resource \"google_project\" \"good_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = false } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project#auto_create_network", "title": "Default network should not be created at project level"}, {"location": "checks/google/iam/no-default-network/#default-network-should-not-be-created-at-project-level", "text": "", "title": "Default network should not be created at project level"}, {"location": "checks/google/iam/no-default-network/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/iam/no-default-network/#explanation", "text": "The default network which is provided for a project contains multiple insecure firewall rules which allow ingress to the project's infrastructure. Creation of this network should therefore be disabled.", "title": "Explanation"}, {"location": "checks/google/iam/no-default-network/#possible-impact", "text": "Exposure of internal infrastructure/services to public internet", "title": "Possible Impact"}, {"location": "checks/google/iam/no-default-network/#suggested-resolution", "text": "Disable automatic default network creation", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-default-network/#insecure-example", "text": "The following example will fail the google-iam-no-default-network check. resource \"google_project\" \"bad_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = true }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-default-network/#secure-example", "text": "The following example will pass the google-iam-no-default-network check. resource \"google_project\" \"good_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = false }", "title": "Secure Example"}, {"location": "checks/google/iam/no-default-network/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project#auto_create_network", "title": "Links"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/", "text": "Roles should not be assigned to default service accounts Default Severity: medium Explanation Deault service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-iam-no-folder-level-default-service-account-assignment check. resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-iam-no-folder-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam", "title": "no-folder-level-default-service-account-assignment"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/#roles-should-not-be-assigned-to-default-service-accounts", "text": "", "title": "Roles should not be assigned to default service accounts"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/#explanation", "text": "Deault service accounts should not be used - consider creating specialised service accounts for individual purposes.", "title": "Explanation"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/#possible-impact", "text": "Violation of principal of least privilege", "title": "Possible Impact"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/#suggested-resolution", "text": "Use specialised service accounts for specific purposes.", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/#insecure-example", "text": "The following example will fail the google-iam-no-folder-level-default-service-account-assignment check. resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/#secure-example", "text": "The following example will pass the google-iam-no-folder-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Secure Example"}, {"location": "checks/google/iam/no-folder-level-default-service-account-assignment/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam", "title": "Links"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/", "text": "Users should not be granted service account access at the folder level Default Severity: medium Explanation Users with service account access at folder level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of folder-level, if required Insecure Example The following example will fail the google-iam-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-iam-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/nothingInParticular\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "no-folder-level-service-account-impersonation"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/#users-should-not-be-granted-service-account-access-at-the-folder-level", "text": "", "title": "Users should not be granted service account access at the folder level"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/#explanation", "text": "Users with service account access at folder level can impersonate any service account. Instead, they should be given access to particular service accounts as required.", "title": "Explanation"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/#possible-impact", "text": "Privilege escalation, impersonation of any/all services", "title": "Possible Impact"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/#suggested-resolution", "text": "Provide access at the service-level instead of folder-level, if required", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/#insecure-example", "text": "The following example will fail the google-iam-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/iam.serviceAccountUser\" }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/#secure-example", "text": "The following example will pass the google-iam-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/nothingInParticular\" }", "title": "Secure Example"}, {"location": "checks/google/iam/no-folder-level-service-account-impersonation/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Links"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/", "text": "Roles should not be assigned to default service accounts Default Severity: medium Explanation Default service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-iam-no-org-level-default-service-account-assignment check. resource \"google_organization_iam_member\" \"org-123\" { org_id = \"organization-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-iam-no-org-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_organization_iam_member\" \"org-123\" { org_id = \"org-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam", "title": "no-org-level-default-service-account-assignment"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/#roles-should-not-be-assigned-to-default-service-accounts", "text": "", "title": "Roles should not be assigned to default service accounts"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/#explanation", "text": "Default service accounts should not be used - consider creating specialised service accounts for individual purposes.", "title": "Explanation"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/#possible-impact", "text": "Violation of principal of least privilege", "title": "Possible Impact"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/#suggested-resolution", "text": "Use specialised service accounts for specific purposes.", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/#insecure-example", "text": "The following example will fail the google-iam-no-org-level-default-service-account-assignment check. resource \"google_organization_iam_member\" \"org-123\" { org_id = \"organization-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/#secure-example", "text": "The following example will pass the google-iam-no-org-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_organization_iam_member\" \"org-123\" { org_id = \"org-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Secure Example"}, {"location": "checks/google/iam/no-org-level-default-service-account-assignment/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam", "title": "Links"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/", "text": "Users should not be granted service account access at the organization level Default Severity: medium Explanation Users with service account access at organization level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of organization-level, if required Insecure Example The following example will fail the google-iam-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-iam-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/nothingInParticular\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "no-org-level-service-account-impersonation"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/#users-should-not-be-granted-service-account-access-at-the-organization-level", "text": "", "title": "Users should not be granted service account access at the organization level"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/#explanation", "text": "Users with service account access at organization level can impersonate any service account. Instead, they should be given access to particular service accounts as required.", "title": "Explanation"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/#possible-impact", "text": "Privilege escalation, impersonation of any/all services", "title": "Possible Impact"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/#suggested-resolution", "text": "Provide access at the service-level instead of organization-level, if required", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/#insecure-example", "text": "The following example will fail the google-iam-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/iam.serviceAccountUser\" }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/#secure-example", "text": "The following example will pass the google-iam-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/nothingInParticular\" }", "title": "Secure Example"}, {"location": "checks/google/iam/no-org-level-service-account-impersonation/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Links"}, {"location": "checks/google/iam/no-privileged-service-accounts/", "text": "Service accounts should not have roles assigned with excessive privileges Default Severity: high Explanation Service accounts should have a minimal set of permissions assigned in order to do their job. They should never have excessive access as if compromised, an attacker can escalate privileges and take over the entire account. Possible Impact Cloud account takeover if a resource using a service account is compromised Suggested Resolution Limit service account access to minimal required set Insecure Example The following example will fail the google-iam-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" email = \"jim@tfsec.dev\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/owner\" member = \"serviceAccount:${google_service_account.test.email}\" } Secure Example The following example will pass the google-iam-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" email = \"jim@tfsec.dev\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/logging.logWriter\" member = \"serviceAccount:${google_service_account.test.email}\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/understanding-roles", "title": "no-privileged-service-accounts"}, {"location": "checks/google/iam/no-privileged-service-accounts/#service-accounts-should-not-have-roles-assigned-with-excessive-privileges", "text": "", "title": "Service accounts should not have roles assigned with excessive privileges"}, {"location": "checks/google/iam/no-privileged-service-accounts/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/iam/no-privileged-service-accounts/#explanation", "text": "Service accounts should have a minimal set of permissions assigned in order to do their job. They should never have excessive access as if compromised, an attacker can escalate privileges and take over the entire account.", "title": "Explanation"}, {"location": "checks/google/iam/no-privileged-service-accounts/#possible-impact", "text": "Cloud account takeover if a resource using a service account is compromised", "title": "Possible Impact"}, {"location": "checks/google/iam/no-privileged-service-accounts/#suggested-resolution", "text": "Limit service account access to minimal required set", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-privileged-service-accounts/#insecure-example", "text": "The following example will fail the google-iam-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" email = \"jim@tfsec.dev\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/owner\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-privileged-service-accounts/#secure-example", "text": "The following example will pass the google-iam-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" email = \"jim@tfsec.dev\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/logging.logWriter\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Secure Example"}, {"location": "checks/google/iam/no-privileged-service-accounts/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/understanding-roles", "title": "Links"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/", "text": "Roles should not be assigned to default service accounts Default Severity: medium Explanation Default service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-iam-no-project-level-default-service-account-assignment check. resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-iam-no-project-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam", "title": "no-project-level-default-service-account-assignment"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/#roles-should-not-be-assigned-to-default-service-accounts", "text": "", "title": "Roles should not be assigned to default service accounts"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/#explanation", "text": "Default service accounts should not be used - consider creating specialised service accounts for individual purposes.", "title": "Explanation"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/#possible-impact", "text": "Violation of principal of least privilege", "title": "Possible Impact"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/#suggested-resolution", "text": "Use specialised service accounts for specific purposes.", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/#insecure-example", "text": "The following example will fail the google-iam-no-project-level-default-service-account-assignment check. resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/#secure-example", "text": "The following example will pass the google-iam-no-project-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Secure Example"}, {"location": "checks/google/iam/no-project-level-default-service-account-assignment/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam", "title": "Links"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/", "text": "Users should not be granted service account access at the project level Default Severity: medium Explanation Users with service account access at project level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of project-level, if required Insecure Example The following example will fail the google-iam-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-iam-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/nothingInParticular\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "no-project-level-service-account-impersonation"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/#users-should-not-be-granted-service-account-access-at-the-project-level", "text": "", "title": "Users should not be granted service account access at the project level"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/#explanation", "text": "Users with service account access at project level can impersonate any service account. Instead, they should be given access to particular service accounts as required.", "title": "Explanation"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/#possible-impact", "text": "Privilege escalation, impersonation of any/all services", "title": "Possible Impact"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/#suggested-resolution", "text": "Provide access at the service-level instead of project-level, if required", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/#insecure-example", "text": "The following example will fail the google-iam-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/iam.serviceAccountUser\" }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/#secure-example", "text": "The following example will pass the google-iam-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/nothingInParticular\" }", "title": "Secure Example"}, {"location": "checks/google/iam/no-project-level-service-account-impersonation/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Links"}, {"location": "checks/google/iam/no-user-granted-permissions/", "text": "IAM granted directly to user. Default Severity: medium Explanation Permissions should not be directly granted to users, you identify roles that contain the appropriate permissions, and then grant those roles to the user. Granting permissions to users quickly become unwieldy and complex to make large scale changes to remove access to a particular resource. Permissions should be granted on roles, groups, services accounts instead. Possible Impact Users shouldn't have permissions granted to them directly Suggested Resolution Roles should be granted permissions and assigned to users Insecure Example The following example will fail the google-iam-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"bad_example\" { members = [ \"user:test@example.com\" , ] } resource \"google_project_iam_member\" \"bad_example\" { member = \"user:test@example.com\" } Secure Example The following example will pass the google-iam-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"good_example\" { members = [ \"group:test@example.com\" , ] } resource \"google_storage_bucket_iam_member\" \"good_example\" { member = \"serviceAccount:test@example.com\" } Links https://www.terraform.io/docs/providers/google/d/iam_policy.html#members https://cloud.google.com/iam/docs/overview#permissions https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy", "title": "no-user-granted-permissions"}, {"location": "checks/google/iam/no-user-granted-permissions/#iam-granted-directly-to-user", "text": "", "title": "IAM granted directly to user."}, {"location": "checks/google/iam/no-user-granted-permissions/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/iam/no-user-granted-permissions/#explanation", "text": "Permissions should not be directly granted to users, you identify roles that contain the appropriate permissions, and then grant those roles to the user. Granting permissions to users quickly become unwieldy and complex to make large scale changes to remove access to a particular resource. Permissions should be granted on roles, groups, services accounts instead.", "title": "Explanation"}, {"location": "checks/google/iam/no-user-granted-permissions/#possible-impact", "text": "Users shouldn't have permissions granted to them directly", "title": "Possible Impact"}, {"location": "checks/google/iam/no-user-granted-permissions/#suggested-resolution", "text": "Roles should be granted permissions and assigned to users", "title": "Suggested Resolution"}, {"location": "checks/google/iam/no-user-granted-permissions/#insecure-example", "text": "The following example will fail the google-iam-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"bad_example\" { members = [ \"user:test@example.com\" , ] } resource \"google_project_iam_member\" \"bad_example\" { member = \"user:test@example.com\" }", "title": "Insecure Example"}, {"location": "checks/google/iam/no-user-granted-permissions/#secure-example", "text": "The following example will pass the google-iam-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"good_example\" { members = [ \"group:test@example.com\" , ] } resource \"google_storage_bucket_iam_member\" \"good_example\" { member = \"serviceAccount:test@example.com\" }", "title": "Secure Example"}, {"location": "checks/google/iam/no-user-granted-permissions/#links", "text": "https://www.terraform.io/docs/providers/google/d/iam_policy.html#members https://cloud.google.com/iam/docs/overview#permissions https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy", "title": "Links"}, {"location": "checks/google/kms/rotate-kms-keys/", "text": "KMS keys should be rotated at least every 90 days Default Severity: high Explanation Keys should be rotated on a regular basis to limit exposure if a given key should become compromised. Possible Impact Exposure is greater if the same keys are used over a long period Suggested Resolution Set key rotation period to 90 days Insecure Example The following example will fail the google-kms-rotate-kms-keys check. resource \"google_kms_key_ring\" \"keyring\" { name = \"keyring-example\" location = \"global\" } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id rotation_period = \"15552000s\" lifecycle { prevent_destroy = true } } Secure Example The following example will pass the google-kms-rotate-kms-keys check. resource \"google_kms_key_ring\" \"keyring\" { name = \"keyring-example\" location = \"global\" } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id rotation_period = \"7776000s\" lifecycle { prevent_destroy = true } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/kms_crypto_key#rotation_period", "title": "rotate-kms-keys"}, {"location": "checks/google/kms/rotate-kms-keys/#kms-keys-should-be-rotated-at-least-every-90-days", "text": "", "title": "KMS keys should be rotated at least every 90 days"}, {"location": "checks/google/kms/rotate-kms-keys/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/kms/rotate-kms-keys/#explanation", "text": "Keys should be rotated on a regular basis to limit exposure if a given key should become compromised.", "title": "Explanation"}, {"location": "checks/google/kms/rotate-kms-keys/#possible-impact", "text": "Exposure is greater if the same keys are used over a long period", "title": "Possible Impact"}, {"location": "checks/google/kms/rotate-kms-keys/#suggested-resolution", "text": "Set key rotation period to 90 days", "title": "Suggested Resolution"}, {"location": "checks/google/kms/rotate-kms-keys/#insecure-example", "text": "The following example will fail the google-kms-rotate-kms-keys check. resource \"google_kms_key_ring\" \"keyring\" { name = \"keyring-example\" location = \"global\" } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id rotation_period = \"15552000s\" lifecycle { prevent_destroy = true } }", "title": "Insecure Example"}, {"location": "checks/google/kms/rotate-kms-keys/#secure-example", "text": "The following example will pass the google-kms-rotate-kms-keys check. resource \"google_kms_key_ring\" \"keyring\" { name = \"keyring-example\" location = \"global\" } resource \"google_kms_crypto_key\" \"example-key\" { name = \"crypto-key-example\" key_ring = google_kms_key_ring.keyring.id rotation_period = \"7776000s\" lifecycle { prevent_destroy = true } }", "title": "Secure Example"}, {"location": "checks/google/kms/rotate-kms-keys/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/kms_crypto_key#rotation_period", "title": "Links"}, {"location": "checks/google/platform/no-default-network/", "text": "Default Severity: high Explanation The default network which is provided for a project contains multiple insecure firewall rules which allow ingress to the project's infrastructure. Creation of this network should therefore be disabled. Possible Impact Exposure of internal infrastructure/services to public internet Suggested Resolution Disable automatic default network creation Insecure Example The following example will fail the google-platform-no-default-network check. resource \"google_project\" \"bad_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = true } Secure Example The following example will pass the google-platform-no-default-network check. resource \"google_project\" \"good_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = false } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project#auto_create_network", "title": "Default network should not be created at project level"}, {"location": "checks/google/platform/no-default-network/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/platform/no-default-network/#explanation", "text": "The default network which is provided for a project contains multiple insecure firewall rules which allow ingress to the project's infrastructure. Creation of this network should therefore be disabled.", "title": "Explanation"}, {"location": "checks/google/platform/no-default-network/#possible-impact", "text": "Exposure of internal infrastructure/services to public internet", "title": "Possible Impact"}, {"location": "checks/google/platform/no-default-network/#suggested-resolution", "text": "Disable automatic default network creation", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-default-network/#insecure-example", "text": "The following example will fail the google-platform-no-default-network check. resource \"google_project\" \"bad_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = true }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-default-network/#secure-example", "text": "The following example will pass the google-platform-no-default-network check. resource \"google_project\" \"good_example\" { name = \"My Project\" project_id = \"your-project-id\" org_id = \"1234567\" auto_create_network = false }", "title": "Secure Example"}, {"location": "checks/google/platform/no-default-network/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project#auto_create_network", "title": "Links"}, {"location": "checks/google/platform/no-folder-level-default-service-account-assignment/", "text": "Default Severity: medium Explanation Deault service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-platform-no-folder-level-default-service-account-assignment check. resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-platform-no-folder-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam", "title": "Roles should not be assigned to default service accounts"}, {"location": "checks/google/platform/no-folder-level-default-service-account-assignment/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/platform/no-folder-level-default-service-account-assignment/#explanation", "text": "Deault service accounts should not be used - consider creating specialised service accounts for individual purposes.", "title": "Explanation"}, {"location": "checks/google/platform/no-folder-level-default-service-account-assignment/#possible-impact", "text": "Violation of principal of least privilege", "title": "Possible Impact"}, {"location": "checks/google/platform/no-folder-level-default-service-account-assignment/#suggested-resolution", "text": "Use specialised service accounts for specific purposes.", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-folder-level-default-service-account-assignment/#insecure-example", "text": "The following example will fail the google-platform-no-folder-level-default-service-account-assignment check. resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-folder-level-default-service-account-assignment/#secure-example", "text": "The following example will pass the google-platform-no-folder-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_folder_iam_member\" \"folder-123\" { folder = \"folder-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Secure Example"}, {"location": "checks/google/platform/no-folder-level-default-service-account-assignment/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam", "title": "Links"}, {"location": "checks/google/platform/no-folder-level-service-account-impersonation/", "text": "Default Severity: medium Explanation Users with service account access at folder level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of folder-level, if required Insecure Example The following example will fail the google-platform-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-platform-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/nothingInParticular\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Users should not be granted service account access at the folder level"}, {"location": "checks/google/platform/no-folder-level-service-account-impersonation/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/platform/no-folder-level-service-account-impersonation/#explanation", "text": "Users with service account access at folder level can impersonate any service account. Instead, they should be given access to particular service accounts as required.", "title": "Explanation"}, {"location": "checks/google/platform/no-folder-level-service-account-impersonation/#possible-impact", "text": "Privilege escalation, impersonation of any/all services", "title": "Possible Impact"}, {"location": "checks/google/platform/no-folder-level-service-account-impersonation/#suggested-resolution", "text": "Provide access at the service-level instead of folder-level, if required", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-folder-level-service-account-impersonation/#insecure-example", "text": "The following example will fail the google-platform-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/iam.serviceAccountUser\" }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-folder-level-service-account-impersonation/#secure-example", "text": "The following example will pass the google-platform-no-folder-level-service-account-impersonation check. resource \"google_folder_iam_binding\" \"folder-123\" { folder = \"folder-123\" role = \"roles/nothingInParticular\" }", "title": "Secure Example"}, {"location": "checks/google/platform/no-folder-level-service-account-impersonation/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_folder_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Links"}, {"location": "checks/google/platform/no-org-level-default-service-account-assignment/", "text": "Default Severity: medium Explanation Default service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-platform-no-org-level-default-service-account-assignment check. resource \"google_organization_iam_member\" \"org-123\" { org_id = \"organization-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-platform-no-org-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_organization_iam_member\" \"org-123\" { org_id = \"org-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam", "title": "Roles should not be assigned to default service accounts"}, {"location": "checks/google/platform/no-org-level-default-service-account-assignment/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/platform/no-org-level-default-service-account-assignment/#explanation", "text": "Default service accounts should not be used - consider creating specialised service accounts for individual purposes.", "title": "Explanation"}, {"location": "checks/google/platform/no-org-level-default-service-account-assignment/#possible-impact", "text": "Violation of principal of least privilege", "title": "Possible Impact"}, {"location": "checks/google/platform/no-org-level-default-service-account-assignment/#suggested-resolution", "text": "Use specialised service accounts for specific purposes.", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-org-level-default-service-account-assignment/#insecure-example", "text": "The following example will fail the google-platform-no-org-level-default-service-account-assignment check. resource \"google_organization_iam_member\" \"org-123\" { org_id = \"organization-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-org-level-default-service-account-assignment/#secure-example", "text": "The following example will pass the google-platform-no-org-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_organization_iam_member\" \"org-123\" { org_id = \"org-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Secure Example"}, {"location": "checks/google/platform/no-org-level-default-service-account-assignment/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam", "title": "Links"}, {"location": "checks/google/platform/no-org-level-service-account-impersonation/", "text": "Default Severity: medium Explanation Users with service account access at organization level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of organization-level, if required Insecure Example The following example will fail the google-platform-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-platform-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/nothingInParticular\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Users should not be granted service account access at the organization level"}, {"location": "checks/google/platform/no-org-level-service-account-impersonation/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/platform/no-org-level-service-account-impersonation/#explanation", "text": "Users with service account access at organization level can impersonate any service account. Instead, they should be given access to particular service accounts as required.", "title": "Explanation"}, {"location": "checks/google/platform/no-org-level-service-account-impersonation/#possible-impact", "text": "Privilege escalation, impersonation of any/all services", "title": "Possible Impact"}, {"location": "checks/google/platform/no-org-level-service-account-impersonation/#suggested-resolution", "text": "Provide access at the service-level instead of organization-level, if required", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-org-level-service-account-impersonation/#insecure-example", "text": "The following example will fail the google-platform-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/iam.serviceAccountUser\" }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-org-level-service-account-impersonation/#secure-example", "text": "The following example will pass the google-platform-no-org-level-service-account-impersonation check. resource \"google_organization_iam_binding\" \"organization-123\" { org_id = \"org-123\" role = \"roles/nothingInParticular\" }", "title": "Secure Example"}, {"location": "checks/google/platform/no-org-level-service-account-impersonation/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_organization_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Links"}, {"location": "checks/google/platform/no-privileged-service-accounts/", "text": "Default Severity: high Explanation Service accounts should have a minimal set of permissions assigned in order to do their job. They should never have excessive access as if compromised, an attacker can escalate privileges and take over the entire account. Possible Impact Cloud account takeover if a resource using a service account is compromised Suggested Resolution Limit service account access to minimal required set Insecure Example The following example will fail the google-platform-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/owner\" member = \"serviceAccount:${google_service_account.test.email}\" } Secure Example The following example will pass the google-platform-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/logging.logWriter\" member = \"serviceAccount:${google_service_account.test.email}\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/understanding-roles", "title": "Service accounts should not have roles assigned with excessive privileges"}, {"location": "checks/google/platform/no-privileged-service-accounts/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/platform/no-privileged-service-accounts/#explanation", "text": "Service accounts should have a minimal set of permissions assigned in order to do their job. They should never have excessive access as if compromised, an attacker can escalate privileges and take over the entire account.", "title": "Explanation"}, {"location": "checks/google/platform/no-privileged-service-accounts/#possible-impact", "text": "Cloud account takeover if a resource using a service account is compromised", "title": "Possible Impact"}, {"location": "checks/google/platform/no-privileged-service-accounts/#suggested-resolution", "text": "Limit service account access to minimal required set", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-privileged-service-accounts/#insecure-example", "text": "The following example will fail the google-platform-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/owner\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-privileged-service-accounts/#secure-example", "text": "The following example will pass the google-platform-no-privileged-service-accounts check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project\" { project = \"your-project-id\" role = \"roles/logging.logWriter\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Secure Example"}, {"location": "checks/google/platform/no-privileged-service-accounts/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/understanding-roles", "title": "Links"}, {"location": "checks/google/platform/no-project-level-default-service-account-assignment/", "text": "Default Severity: medium Explanation Default service accounts should not be used - consider creating specialised service accounts for individual purposes. Possible Impact Violation of principal of least privilege Suggested Resolution Use specialised service accounts for specific purposes. Insecure Example The following example will fail the google-platform-no-project-level-default-service-account-assignment check. resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" } Secure Example The following example will pass the google-platform-no-project-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam", "title": "Roles should not be assigned to default service accounts"}, {"location": "checks/google/platform/no-project-level-default-service-account-assignment/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/platform/no-project-level-default-service-account-assignment/#explanation", "text": "Default service accounts should not be used - consider creating specialised service accounts for individual purposes.", "title": "Explanation"}, {"location": "checks/google/platform/no-project-level-default-service-account-assignment/#possible-impact", "text": "Violation of principal of least privilege", "title": "Possible Impact"}, {"location": "checks/google/platform/no-project-level-default-service-account-assignment/#suggested-resolution", "text": "Use specialised service accounts for specific purposes.", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-project-level-default-service-account-assignment/#insecure-example", "text": "The following example will fail the google-platform-no-project-level-default-service-account-assignment check. resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"123-compute@developer.gserviceaccount.com\" }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-project-level-default-service-account-assignment/#secure-example", "text": "The following example will pass the google-platform-no-project-level-default-service-account-assignment check. resource \"google_service_account\" \"test\" { account_id = \"account123\" display_name = \"account123\" } resource \"google_project_iam_member\" \"project-123\" { project = \"project-123\" role = \"roles/whatever\" member = \"serviceAccount:${google_service_account.test.email}\" }", "title": "Secure Example"}, {"location": "checks/google/platform/no-project-level-default-service-account-assignment/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam", "title": "Links"}, {"location": "checks/google/platform/no-project-level-service-account-impersonation/", "text": "Default Severity: medium Explanation Users with service account access at project level can impersonate any service account. Instead, they should be given access to particular service accounts as required. Possible Impact Privilege escalation, impersonation of any/all services Suggested Resolution Provide access at the service-level instead of project-level, if required Insecure Example The following example will fail the google-platform-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/iam.serviceAccountUser\" } Secure Example The following example will pass the google-platform-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/nothingInParticular\" } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Users should not be granted service account access at the project level"}, {"location": "checks/google/platform/no-project-level-service-account-impersonation/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/platform/no-project-level-service-account-impersonation/#explanation", "text": "Users with service account access at project level can impersonate any service account. Instead, they should be given access to particular service accounts as required.", "title": "Explanation"}, {"location": "checks/google/platform/no-project-level-service-account-impersonation/#possible-impact", "text": "Privilege escalation, impersonation of any/all services", "title": "Possible Impact"}, {"location": "checks/google/platform/no-project-level-service-account-impersonation/#suggested-resolution", "text": "Provide access at the service-level instead of project-level, if required", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-project-level-service-account-impersonation/#insecure-example", "text": "The following example will fail the google-platform-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/iam.serviceAccountUser\" }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-project-level-service-account-impersonation/#secure-example", "text": "The following example will pass the google-platform-no-project-level-service-account-impersonation check. resource \"google_project_iam_binding\" \"project-123\" { project = \"project-123\" role = \"roles/nothingInParticular\" }", "title": "Secure Example"}, {"location": "checks/google/platform/no-project-level-service-account-impersonation/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam https://cloud.google.com/iam/docs/impersonating-service-accounts", "title": "Links"}, {"location": "checks/google/platform/no-user-granted-permissions/", "text": "Default Severity: medium Explanation Permissions should not be directly granted to users, you identify roles that contain the appropriate permissions, and then grant those roles to the user. Granting permissions to users quickly become unwieldy and complex to make large scale changes to remove access to a particular resource. Permissions should be granted on roles, groups, services accounts instead. Possible Impact Users shouldn't have permissions granted to them directly Suggested Resolution Roles should be granted permissions and assigned to users Insecure Example The following example will fail the google-platform-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"bad_example\" { members = [ \"user:test@example.com\" , ] } resource \"google_project_iam_member\" \"bad_example\" { member = \"user:test@example.com\" } Secure Example The following example will pass the google-platform-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"good_example\" { members = [ \"group:test@example.com\" , ] } resource \"google_storage_bucket_iam_member\" \"good_example\" { member = \"serviceAccount:test@example.com\" } Links https://www.terraform.io/docs/providers/google/d/iam_policy.html#members https://cloud.google.com/iam/docs/overview#permissions https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy", "title": "IAM granted directly to user."}, {"location": "checks/google/platform/no-user-granted-permissions/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/platform/no-user-granted-permissions/#explanation", "text": "Permissions should not be directly granted to users, you identify roles that contain the appropriate permissions, and then grant those roles to the user. Granting permissions to users quickly become unwieldy and complex to make large scale changes to remove access to a particular resource. Permissions should be granted on roles, groups, services accounts instead.", "title": "Explanation"}, {"location": "checks/google/platform/no-user-granted-permissions/#possible-impact", "text": "Users shouldn't have permissions granted to them directly", "title": "Possible Impact"}, {"location": "checks/google/platform/no-user-granted-permissions/#suggested-resolution", "text": "Roles should be granted permissions and assigned to users", "title": "Suggested Resolution"}, {"location": "checks/google/platform/no-user-granted-permissions/#insecure-example", "text": "The following example will fail the google-platform-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"bad_example\" { members = [ \"user:test@example.com\" , ] } resource \"google_project_iam_member\" \"bad_example\" { member = \"user:test@example.com\" }", "title": "Insecure Example"}, {"location": "checks/google/platform/no-user-granted-permissions/#secure-example", "text": "The following example will pass the google-platform-no-user-granted-permissions check. resource \"google_project_iam_binding\" \"good_example\" { members = [ \"group:test@example.com\" , ] } resource \"google_storage_bucket_iam_member\" \"good_example\" { member = \"serviceAccount:test@example.com\" }", "title": "Secure Example"}, {"location": "checks/google/platform/no-user-granted-permissions/#links", "text": "https://www.terraform.io/docs/providers/google/d/iam_policy.html#members https://cloud.google.com/iam/docs/overview#permissions https://cloud.google.com/resource-manager/reference/rest/v1/projects/setIamPolicy", "title": "Links"}, {"location": "checks/google/sql/enable-backup/", "text": "Enable automated backups to recover from data-loss Default Severity: medium Explanation Automated backups are not enabled by default. Backups are an easy way to restore data in a corruption or data-loss scenario. Possible Impact No recovery of lost or corrupted data Suggested Resolution Enable automated backups Insecure Example The following example will fail the google-sql-enable-backup check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { backup_configuration { enabled = false } } } Secure Example The following example will pass the google-sql-enable-backup check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { backup_configuration { enabled = true } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance#settings.backup_configuration.enabled=true https://cloud.google.com/sql/docs/mysql/backup-recovery/backups", "title": "enable-backup"}, {"location": "checks/google/sql/enable-backup/#enable-automated-backups-to-recover-from-data-loss", "text": "", "title": "Enable automated backups to recover from data-loss"}, {"location": "checks/google/sql/enable-backup/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/sql/enable-backup/#explanation", "text": "Automated backups are not enabled by default. Backups are an easy way to restore data in a corruption or data-loss scenario.", "title": "Explanation"}, {"location": "checks/google/sql/enable-backup/#possible-impact", "text": "No recovery of lost or corrupted data", "title": "Possible Impact"}, {"location": "checks/google/sql/enable-backup/#suggested-resolution", "text": "Enable automated backups", "title": "Suggested Resolution"}, {"location": "checks/google/sql/enable-backup/#insecure-example", "text": "The following example will fail the google-sql-enable-backup check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { backup_configuration { enabled = false } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/enable-backup/#secure-example", "text": "The following example will pass the google-sql-enable-backup check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { backup_configuration { enabled = true } } }", "title": "Secure Example"}, {"location": "checks/google/sql/enable-backup/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance#settings.backup_configuration.enabled=true https://cloud.google.com/sql/docs/mysql/backup-recovery/backups", "title": "Links"}, {"location": "checks/google/sql/enable-pg-temp-file-logging/", "text": "Temporary file logging should be enabled for all temporary files. Default Severity: medium Explanation Temporary files are not logged by default. To log all temporary files, a value of 0 should set in the log_temp_files flag - as all files greater in size than the number of bytes set in this flag will be logged. Possible Impact Use of temporary files will not be logged Suggested Resolution Enable temporary file logging for all files Insecure Example The following example will fail the google-sql-enable-pg-temp-file-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" } Secure Example The following example will pass the google-sql-enable-pg-temp-file-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_temp_files\" value = \"0\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://postgresqlco.nf/doc/en/param/log_temp_files/", "title": "enable-pg-temp-file-logging"}, {"location": "checks/google/sql/enable-pg-temp-file-logging/#temporary-file-logging-should-be-enabled-for-all-temporary-files", "text": "", "title": "Temporary file logging should be enabled for all temporary files."}, {"location": "checks/google/sql/enable-pg-temp-file-logging/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/sql/enable-pg-temp-file-logging/#explanation", "text": "Temporary files are not logged by default. To log all temporary files, a value of 0 should set in the log_temp_files flag - as all files greater in size than the number of bytes set in this flag will be logged.", "title": "Explanation"}, {"location": "checks/google/sql/enable-pg-temp-file-logging/#possible-impact", "text": "Use of temporary files will not be logged", "title": "Possible Impact"}, {"location": "checks/google/sql/enable-pg-temp-file-logging/#suggested-resolution", "text": "Enable temporary file logging for all files", "title": "Suggested Resolution"}, {"location": "checks/google/sql/enable-pg-temp-file-logging/#insecure-example", "text": "The following example will fail the google-sql-enable-pg-temp-file-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" }", "title": "Insecure Example"}, {"location": "checks/google/sql/enable-pg-temp-file-logging/#secure-example", "text": "The following example will pass the google-sql-enable-pg-temp-file-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_temp_files\" value = \"0\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/enable-pg-temp-file-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://postgresqlco.nf/doc/en/param/log_temp_files/", "title": "Links"}, {"location": "checks/google/sql/encrypt-in-transit-data/", "text": "SSL connections to a SQL database instance should be enforced. Default Severity: high Explanation In-transit data should be encrypted so that if traffic is intercepted data will not be exposed in plaintext to attackers. Possible Impact Intercepted data can be read in transit Suggested Resolution Enforce SSL for all connections Insecure Example The following example will fail the google-sql-encrypt-in-transit-data check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } require_ssl = false } } } Secure Example The following example will pass the google-sql-encrypt-in-transit-data check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } require_ssl = true } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://cloud.google.com/sql/docs/mysql/configure-ssl-instance", "title": "encrypt-in-transit-data"}, {"location": "checks/google/sql/encrypt-in-transit-data/#ssl-connections-to-a-sql-database-instance-should-be-enforced", "text": "", "title": "SSL connections to a SQL database instance should be enforced."}, {"location": "checks/google/sql/encrypt-in-transit-data/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/sql/encrypt-in-transit-data/#explanation", "text": "In-transit data should be encrypted so that if traffic is intercepted data will not be exposed in plaintext to attackers.", "title": "Explanation"}, {"location": "checks/google/sql/encrypt-in-transit-data/#possible-impact", "text": "Intercepted data can be read in transit", "title": "Possible Impact"}, {"location": "checks/google/sql/encrypt-in-transit-data/#suggested-resolution", "text": "Enforce SSL for all connections", "title": "Suggested Resolution"}, {"location": "checks/google/sql/encrypt-in-transit-data/#insecure-example", "text": "The following example will fail the google-sql-encrypt-in-transit-data check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } require_ssl = false } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/encrypt-in-transit-data/#secure-example", "text": "The following example will pass the google-sql-encrypt-in-transit-data check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } require_ssl = true } } }", "title": "Secure Example"}, {"location": "checks/google/sql/encrypt-in-transit-data/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://cloud.google.com/sql/docs/mysql/configure-ssl-instance", "title": "Links"}, {"location": "checks/google/sql/mysql-no-local-infile/", "text": "Disable local_infile setting in MySQL Default Severity: high Explanation Arbitrary files can be read from the system using LOAD_DATA unless this setting is disabled. Possible Impact Arbitrary files read by attackers when combined with a SQL injection vulnerability. Suggested Resolution Disable the local infile setting Insecure Example The following example will fail the google-sql-mysql-no-local-infile check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"MYSQL_5_6\" region = \"us-central1\" settings { database_flags { name = \"local_infile\" value = \"on\" } } } Secure Example The following example will pass the google-sql-mysql-no-local-infile check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"MYSQL_5_6\" region = \"us-central1\" settings { database_flags { name = \"local_infile\" value = \"off\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html", "title": "mysql-no-local-infile"}, {"location": "checks/google/sql/mysql-no-local-infile/#disable-local_infile-setting-in-mysql", "text": "", "title": "Disable local_infile setting in MySQL"}, {"location": "checks/google/sql/mysql-no-local-infile/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/sql/mysql-no-local-infile/#explanation", "text": "Arbitrary files can be read from the system using LOAD_DATA unless this setting is disabled.", "title": "Explanation"}, {"location": "checks/google/sql/mysql-no-local-infile/#possible-impact", "text": "Arbitrary files read by attackers when combined with a SQL injection vulnerability.", "title": "Possible Impact"}, {"location": "checks/google/sql/mysql-no-local-infile/#suggested-resolution", "text": "Disable the local infile setting", "title": "Suggested Resolution"}, {"location": "checks/google/sql/mysql-no-local-infile/#insecure-example", "text": "The following example will fail the google-sql-mysql-no-local-infile check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"MYSQL_5_6\" region = \"us-central1\" settings { database_flags { name = \"local_infile\" value = \"on\" } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/mysql-no-local-infile/#secure-example", "text": "The following example will pass the google-sql-mysql-no-local-infile check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"MYSQL_5_6\" region = \"us-central1\" settings { database_flags { name = \"local_infile\" value = \"off\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/mysql-no-local-infile/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html", "title": "Links"}, {"location": "checks/google/sql/no-contained-db-auth/", "text": "Contained database authentication should be disabled Default Severity: medium Explanation Users with ALTER permissions on users can grant access to a contained database without the knowledge of an administrator Possible Impact Access can be granted without knowledge of the database administrator Suggested Resolution Disable contained database authentication Insecure Example The following example will fail the google-sql-no-contained-db-auth check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" } Secure Example The following example will pass the google-sql-no-contained-db-auth check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" settings { database_flags { name = \"contained database authentication\" value = \"off\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/contained-database-authentication-server-configuration-option?view=sql-server-ver15", "title": "no-contained-db-auth"}, {"location": "checks/google/sql/no-contained-db-auth/#contained-database-authentication-should-be-disabled", "text": "", "title": "Contained database authentication should be disabled"}, {"location": "checks/google/sql/no-contained-db-auth/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/sql/no-contained-db-auth/#explanation", "text": "Users with ALTER permissions on users can grant access to a contained database without the knowledge of an administrator", "title": "Explanation"}, {"location": "checks/google/sql/no-contained-db-auth/#possible-impact", "text": "Access can be granted without knowledge of the database administrator", "title": "Possible Impact"}, {"location": "checks/google/sql/no-contained-db-auth/#suggested-resolution", "text": "Disable contained database authentication", "title": "Suggested Resolution"}, {"location": "checks/google/sql/no-contained-db-auth/#insecure-example", "text": "The following example will fail the google-sql-no-contained-db-auth check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" }", "title": "Insecure Example"}, {"location": "checks/google/sql/no-contained-db-auth/#secure-example", "text": "The following example will pass the google-sql-no-contained-db-auth check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" settings { database_flags { name = \"contained database authentication\" value = \"off\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/no-contained-db-auth/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/contained-database-authentication-server-configuration-option?view=sql-server-ver15", "title": "Links"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/", "text": "Cross-database ownership chaining should be disabled Default Severity: medium Explanation Cross-database ownership chaining, also known as cross-database chaining, is a security feature of SQL Server that allows users of databases access to other databases besides the one they are currently using. Possible Impact Unintended access to sensitive data Suggested Resolution Disable cross database ownership chaining Insecure Example The following example will fail the google-sql-no-cross-db-ownership-chaining check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" } Secure Example The following example will pass the google-sql-no-cross-db-ownership-chaining check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" settings { database_flags { name = \"cross db ownership chaining\" value = \"off\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option?view=sql-server-ver15", "title": "no-cross-db-ownership-chaining"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/#cross-database-ownership-chaining-should-be-disabled", "text": "", "title": "Cross-database ownership chaining should be disabled"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/#explanation", "text": "Cross-database ownership chaining, also known as cross-database chaining, is a security feature of SQL Server that allows users of databases access to other databases besides the one they are currently using.", "title": "Explanation"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/#possible-impact", "text": "Unintended access to sensitive data", "title": "Possible Impact"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/#suggested-resolution", "text": "Disable cross database ownership chaining", "title": "Suggested Resolution"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/#insecure-example", "text": "The following example will fail the google-sql-no-cross-db-ownership-chaining check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" }", "title": "Insecure Example"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/#secure-example", "text": "The following example will pass the google-sql-no-cross-db-ownership-chaining check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"SQLSERVER_2017_STANDARD\" region = \"us-central1\" settings { database_flags { name = \"cross db ownership chaining\" value = \"off\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/no-cross-db-ownership-chaining/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option?view=sql-server-ver15", "title": "Links"}, {"location": "checks/google/sql/no-public-access/", "text": "Ensure that Cloud SQL Database Instances are not publicly exposed Default Severity: high Explanation Database instances should be configured so that they are not available over the public internet, but to internal compute resources which access them. Possible Impact Public exposure of sensitive data Suggested Resolution Remove public access from database instances Insecure Example The following example will fail the google-sql-no-public-access check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } authorized_networks { value = \"0.0.0.0/0\" name = \"internet\" } } } } Secure Example The following example will pass the google-sql-no-public-access check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"10.0.0.1/24\" name = \"internal\" } } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.cloudconformity.com/knowledge-base/gcp/CloudSQL/publicly-accessible-cloud-sql-instances.html", "title": "no-public-access"}, {"location": "checks/google/sql/no-public-access/#ensure-that-cloud-sql-database-instances-are-not-publicly-exposed", "text": "", "title": "Ensure that Cloud SQL Database Instances are not publicly exposed"}, {"location": "checks/google/sql/no-public-access/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/sql/no-public-access/#explanation", "text": "Database instances should be configured so that they are not available over the public internet, but to internal compute resources which access them.", "title": "Explanation"}, {"location": "checks/google/sql/no-public-access/#possible-impact", "text": "Public exposure of sensitive data", "title": "Possible Impact"}, {"location": "checks/google/sql/no-public-access/#suggested-resolution", "text": "Remove public access from database instances", "title": "Suggested Resolution"}, {"location": "checks/google/sql/no-public-access/#insecure-example", "text": "The following example will fail the google-sql-no-public-access check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"108.12.12.0/24\" name = \"internal\" } authorized_networks { value = \"0.0.0.0/0\" name = \"internet\" } } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/no-public-access/#secure-example", "text": "The following example will pass the google-sql-no-public-access check. resource \"google_sql_database_instance\" \"postgres\" { name = \"postgres-instance-a\" database_version = \"POSTGRES_11\" settings { tier = \"db-f1-micro\" ip_configuration { ipv4_enabled = false authorized_networks { value = \"10.0.0.1/24\" name = \"internal\" } } } }", "title": "Secure Example"}, {"location": "checks/google/sql/no-public-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.cloudconformity.com/knowledge-base/gcp/CloudSQL/publicly-accessible-cloud-sql-instances.html", "title": "Links"}, {"location": "checks/google/sql/pg-log-checkpoints/", "text": "Ensure that logging of checkpoints is enabled. Default Severity: medium Explanation Logging checkpoints provides useful diagnostic data, which can identify performance issues in an application and potential DoS vectors. Possible Impact Insufficient diagnostic data. Suggested Resolution Enable checkpoints logging. Insecure Example The following example will fail the google-sql-pg-log-checkpoints check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_checkpoints\" value = \"off\" } } } Secure Example The following example will pass the google-sql-pg-log-checkpoints check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_checkpoints\" value = \"on\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-CHECKPOINTS", "title": "pg-log-checkpoints"}, {"location": "checks/google/sql/pg-log-checkpoints/#ensure-that-logging-of-checkpoints-is-enabled", "text": "", "title": "Ensure that logging of checkpoints is enabled."}, {"location": "checks/google/sql/pg-log-checkpoints/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/sql/pg-log-checkpoints/#explanation", "text": "Logging checkpoints provides useful diagnostic data, which can identify performance issues in an application and potential DoS vectors.", "title": "Explanation"}, {"location": "checks/google/sql/pg-log-checkpoints/#possible-impact", "text": "Insufficient diagnostic data.", "title": "Possible Impact"}, {"location": "checks/google/sql/pg-log-checkpoints/#suggested-resolution", "text": "Enable checkpoints logging.", "title": "Suggested Resolution"}, {"location": "checks/google/sql/pg-log-checkpoints/#insecure-example", "text": "The following example will fail the google-sql-pg-log-checkpoints check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_checkpoints\" value = \"off\" } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/pg-log-checkpoints/#secure-example", "text": "The following example will pass the google-sql-pg-log-checkpoints check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_checkpoints\" value = \"on\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/pg-log-checkpoints/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-CHECKPOINTS", "title": "Links"}, {"location": "checks/google/sql/pg-log-connections/", "text": "Ensure that logging of connections is enabled. Default Severity: medium Explanation Logging connections provides useful diagnostic data such as session length, which can identify performance issues in an application and potential DoS vectors. Possible Impact Insufficient diagnostic data. Suggested Resolution Enable connection logging. Insecure Example The following example will fail the google-sql-pg-log-connections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_connections\" value = \"off\" } } } Secure Example The following example will pass the google-sql-pg-log-connections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_connections\" value = \"on\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-CONNECTIONS", "title": "pg-log-connections"}, {"location": "checks/google/sql/pg-log-connections/#ensure-that-logging-of-connections-is-enabled", "text": "", "title": "Ensure that logging of connections is enabled."}, {"location": "checks/google/sql/pg-log-connections/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/sql/pg-log-connections/#explanation", "text": "Logging connections provides useful diagnostic data such as session length, which can identify performance issues in an application and potential DoS vectors.", "title": "Explanation"}, {"location": "checks/google/sql/pg-log-connections/#possible-impact", "text": "Insufficient diagnostic data.", "title": "Possible Impact"}, {"location": "checks/google/sql/pg-log-connections/#suggested-resolution", "text": "Enable connection logging.", "title": "Suggested Resolution"}, {"location": "checks/google/sql/pg-log-connections/#insecure-example", "text": "The following example will fail the google-sql-pg-log-connections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_connections\" value = \"off\" } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/pg-log-connections/#secure-example", "text": "The following example will pass the google-sql-pg-log-connections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_connections\" value = \"on\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/pg-log-connections/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-CONNECTIONS", "title": "Links"}, {"location": "checks/google/sql/pg-log-disconnections/", "text": "Ensure that logging of disconnections is enabled. Default Severity: medium Explanation Logging disconnections provides useful diagnostic data such as session length, which can identify performance issues in an application and potential DoS vectors. Possible Impact Insufficient diagnostic data. Suggested Resolution Enable disconnection logging. Insecure Example The following example will fail the google-sql-pg-log-disconnections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_disconnections\" value = \"off\" } } } Secure Example The following example will pass the google-sql-pg-log-disconnections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_disconnections\" value = \"on\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-DISCONNECTIONS", "title": "pg-log-disconnections"}, {"location": "checks/google/sql/pg-log-disconnections/#ensure-that-logging-of-disconnections-is-enabled", "text": "", "title": "Ensure that logging of disconnections is enabled."}, {"location": "checks/google/sql/pg-log-disconnections/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/sql/pg-log-disconnections/#explanation", "text": "Logging disconnections provides useful diagnostic data such as session length, which can identify performance issues in an application and potential DoS vectors.", "title": "Explanation"}, {"location": "checks/google/sql/pg-log-disconnections/#possible-impact", "text": "Insufficient diagnostic data.", "title": "Possible Impact"}, {"location": "checks/google/sql/pg-log-disconnections/#suggested-resolution", "text": "Enable disconnection logging.", "title": "Suggested Resolution"}, {"location": "checks/google/sql/pg-log-disconnections/#insecure-example", "text": "The following example will fail the google-sql-pg-log-disconnections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_disconnections\" value = \"off\" } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/pg-log-disconnections/#secure-example", "text": "The following example will pass the google-sql-pg-log-disconnections check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_disconnections\" value = \"on\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/pg-log-disconnections/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-DISCONNECTIONS", "title": "Links"}, {"location": "checks/google/sql/pg-log-errors/", "text": "Ensure that Postgres errors are logged Default Severity: low Explanation Setting the minimum log severity too high will cause errors not to be logged Possible Impact Loss of error logging Suggested Resolution Set the minimum log severity to at least ERROR Insecure Example The following example will fail the google-sql-pg-log-errors check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_messages\" value = \"PANIC\" } } } Secure Example The following example will pass the google-sql-pg-log-errors check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_messages\" value = \"WARNING\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://postgresqlco.nf/doc/en/param/log_min_messages/ https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-MIN-MESSAGES", "title": "pg-log-errors"}, {"location": "checks/google/sql/pg-log-errors/#ensure-that-postgres-errors-are-logged", "text": "", "title": "Ensure that Postgres errors are logged"}, {"location": "checks/google/sql/pg-log-errors/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/sql/pg-log-errors/#explanation", "text": "Setting the minimum log severity too high will cause errors not to be logged", "title": "Explanation"}, {"location": "checks/google/sql/pg-log-errors/#possible-impact", "text": "Loss of error logging", "title": "Possible Impact"}, {"location": "checks/google/sql/pg-log-errors/#suggested-resolution", "text": "Set the minimum log severity to at least ERROR", "title": "Suggested Resolution"}, {"location": "checks/google/sql/pg-log-errors/#insecure-example", "text": "The following example will fail the google-sql-pg-log-errors check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_messages\" value = \"PANIC\" } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/pg-log-errors/#secure-example", "text": "The following example will pass the google-sql-pg-log-errors check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_messages\" value = \"WARNING\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/pg-log-errors/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://postgresqlco.nf/doc/en/param/log_min_messages/ https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-MIN-MESSAGES", "title": "Links"}, {"location": "checks/google/sql/pg-log-lock-waits/", "text": "Ensure that logging of lock waits is enabled. Default Severity: medium Explanation Lock waits are often an indication of poor performance and often an indicator of a potential denial of service vulnerability, therefore occurrences should be logged for analysis. Possible Impact Issues leading to denial of service may not be identified. Suggested Resolution Enable lock wait logging. Insecure Example The following example will fail the google-sql-pg-log-lock-waits check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_lock_waits\" value = \"off\" } } } Secure Example The following example will pass the google-sql-pg-log-lock-waits check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_lock_waits\" value = \"on\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-LOCK-WAITS", "title": "pg-log-lock-waits"}, {"location": "checks/google/sql/pg-log-lock-waits/#ensure-that-logging-of-lock-waits-is-enabled", "text": "", "title": "Ensure that logging of lock waits is enabled."}, {"location": "checks/google/sql/pg-log-lock-waits/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/sql/pg-log-lock-waits/#explanation", "text": "Lock waits are often an indication of poor performance and often an indicator of a potential denial of service vulnerability, therefore occurrences should be logged for analysis.", "title": "Explanation"}, {"location": "checks/google/sql/pg-log-lock-waits/#possible-impact", "text": "Issues leading to denial of service may not be identified.", "title": "Possible Impact"}, {"location": "checks/google/sql/pg-log-lock-waits/#suggested-resolution", "text": "Enable lock wait logging.", "title": "Suggested Resolution"}, {"location": "checks/google/sql/pg-log-lock-waits/#insecure-example", "text": "The following example will fail the google-sql-pg-log-lock-waits check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_lock_waits\" value = \"off\" } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/pg-log-lock-waits/#secure-example", "text": "The following example will pass the google-sql-pg-log-lock-waits check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_lock_waits\" value = \"on\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/pg-log-lock-waits/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-LOCK-WAITS", "title": "Links"}, {"location": "checks/google/sql/pg-no-min-statement-logging/", "text": "Ensure that logging of long statements is disabled. Default Severity: low Explanation Logging of statements which could contain sensitive data is not advised, therefore this setting should preclude all statements from being logged. Possible Impact Sensitive data could be exposed in the database logs. Suggested Resolution Disable minimum duration statement logging completely Insecure Example The following example will fail the google-sql-pg-no-min-statement-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_duration_statement\" value = \"99\" } } } Secure Example The following example will pass the google-sql-pg-no-min-statement-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_duration_statement\" value = \"-1\" } } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-MIN-DURATION-STATEMENT", "title": "pg-no-min-statement-logging"}, {"location": "checks/google/sql/pg-no-min-statement-logging/#ensure-that-logging-of-long-statements-is-disabled", "text": "", "title": "Ensure that logging of long statements is disabled."}, {"location": "checks/google/sql/pg-no-min-statement-logging/#default-severity-low", "text": "", "title": "Default Severity: low"}, {"location": "checks/google/sql/pg-no-min-statement-logging/#explanation", "text": "Logging of statements which could contain sensitive data is not advised, therefore this setting should preclude all statements from being logged.", "title": "Explanation"}, {"location": "checks/google/sql/pg-no-min-statement-logging/#possible-impact", "text": "Sensitive data could be exposed in the database logs.", "title": "Possible Impact"}, {"location": "checks/google/sql/pg-no-min-statement-logging/#suggested-resolution", "text": "Disable minimum duration statement logging completely", "title": "Suggested Resolution"}, {"location": "checks/google/sql/pg-no-min-statement-logging/#insecure-example", "text": "The following example will fail the google-sql-pg-no-min-statement-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_duration_statement\" value = \"99\" } } }", "title": "Insecure Example"}, {"location": "checks/google/sql/pg-no-min-statement-logging/#secure-example", "text": "The following example will pass the google-sql-pg-no-min-statement-logging check. resource \"google_sql_database_instance\" \"db\" { name = \"db\" database_version = \"POSTGRES_12\" region = \"us-central1\" settings { database_flags { name = \"log_min_duration_statement\" value = \"-1\" } } }", "title": "Secure Example"}, {"location": "checks/google/sql/pg-no-min-statement-logging/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance https://www.postgresql.org/docs/13/runtime-config-logging.html#GUC-LOG-MIN-DURATION-STATEMENT", "title": "Links"}, {"location": "checks/google/storage/enable-ubla/", "text": "Ensure that Cloud Storage buckets have uniform bucket-level access enabled Default Severity: medium Explanation When you enable uniform bucket-level access on a bucket, Access Control Lists (ACLs) are disabled, and only bucket-level Identity and Access Management (IAM) permissions grant access to that bucket and the objects it contains. You revoke all access granted by object ACLs and the ability to administrate permissions using bucket ACLs. Possible Impact ACLs are difficult to manage and often lead to incorrect/unintended configurations. Suggested Resolution Enable uniform bucket level access to provide a uniform permissioning system. Insecure Example The following example will fail the google-storage-enable-ubla check. resource \"google_storage_bucket\" \"static-site\" { name = \"image-store.com\" location = \"EU\" force_destroy = true uniform_bucket_level_access = false website { main_page_suffix = \"index.html\" not_found_page = \"404.html\" } cors { origin = [ \"http://image-store.com\" ] method = [ \"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\" ] response_header = [ \"*\" ] max_age_seconds = 3600 } } Secure Example The following example will pass the google-storage-enable-ubla check. resource \"google_storage_bucket\" \"static-site\" { name = \"image-store.com\" location = \"EU\" force_destroy = true uniform_bucket_level_access = true website { main_page_suffix = \"index.html\" not_found_page = \"404.html\" } cors { origin = [ \"http://image-store.com\" ] method = [ \"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\" ] response_header = [ \"*\" ] max_age_seconds = 3600 } } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket#uniform_bucket_level_access https://cloud.google.com/storage/docs/uniform-bucket-level-access https://jbrojbrojbro.medium.com/you-make-the-rules-with-authentication-controls-for-cloud-storage-53c32543747b", "title": "enable-ubla"}, {"location": "checks/google/storage/enable-ubla/#ensure-that-cloud-storage-buckets-have-uniform-bucket-level-access-enabled", "text": "", "title": "Ensure that Cloud Storage buckets have uniform bucket-level access enabled"}, {"location": "checks/google/storage/enable-ubla/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/google/storage/enable-ubla/#explanation", "text": "When you enable uniform bucket-level access on a bucket, Access Control Lists (ACLs) are disabled, and only bucket-level Identity and Access Management (IAM) permissions grant access to that bucket and the objects it contains. You revoke all access granted by object ACLs and the ability to administrate permissions using bucket ACLs.", "title": "Explanation"}, {"location": "checks/google/storage/enable-ubla/#possible-impact", "text": "ACLs are difficult to manage and often lead to incorrect/unintended configurations.", "title": "Possible Impact"}, {"location": "checks/google/storage/enable-ubla/#suggested-resolution", "text": "Enable uniform bucket level access to provide a uniform permissioning system.", "title": "Suggested Resolution"}, {"location": "checks/google/storage/enable-ubla/#insecure-example", "text": "The following example will fail the google-storage-enable-ubla check. resource \"google_storage_bucket\" \"static-site\" { name = \"image-store.com\" location = \"EU\" force_destroy = true uniform_bucket_level_access = false website { main_page_suffix = \"index.html\" not_found_page = \"404.html\" } cors { origin = [ \"http://image-store.com\" ] method = [ \"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\" ] response_header = [ \"*\" ] max_age_seconds = 3600 } }", "title": "Insecure Example"}, {"location": "checks/google/storage/enable-ubla/#secure-example", "text": "The following example will pass the google-storage-enable-ubla check. resource \"google_storage_bucket\" \"static-site\" { name = \"image-store.com\" location = \"EU\" force_destroy = true uniform_bucket_level_access = true website { main_page_suffix = \"index.html\" not_found_page = \"404.html\" } cors { origin = [ \"http://image-store.com\" ] method = [ \"GET\", \"HEAD\", \"PUT\", \"POST\", \"DELETE\" ] response_header = [ \"*\" ] max_age_seconds = 3600 } }", "title": "Secure Example"}, {"location": "checks/google/storage/enable-ubla/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket#uniform_bucket_level_access https://cloud.google.com/storage/docs/uniform-bucket-level-access https://jbrojbrojbro.medium.com/you-make-the-rules-with-authentication-controls-for-cloud-storage-53c32543747b", "title": "Links"}, {"location": "checks/google/storage/no-public-access/", "text": "Ensure that Cloud Storage bucket is not anonymously or publicly accessible. Default Severity: high Explanation Using 'allUsers' or 'allAuthenticatedUsers' as members in an IAM member/binding causes data to be exposed outside of the organisation. Possible Impact Public exposure of sensitive data. Suggested Resolution Restrict public access to the bucket. Insecure Example The following example will fail the google-storage-no-public-access check. resource \"google_storage_bucket_iam_binding\" \"binding\" { bucket = google_storage_bucket.default.name role = \"roles/storage.admin\" members = [ \"allAuthenticatedUsers\" , ] } Secure Example The following example will pass the google-storage-no-public-access check. resource \"google_storage_bucket_iam_binding\" \"binding\" { bucket = google_storage_bucket.default.name role = \"roles/storage.admin\" members = [ \"user:jane@example.com\" , ] } Links https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket_iam#member/members https://jbrojbrojbro.medium.com/you-make-the-rules-with-authentication-controls-for-cloud-storage-53c32543747b", "title": "no-public-access"}, {"location": "checks/google/storage/no-public-access/#ensure-that-cloud-storage-bucket-is-not-anonymously-or-publicly-accessible", "text": "", "title": "Ensure that Cloud Storage bucket is not anonymously or publicly accessible."}, {"location": "checks/google/storage/no-public-access/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/google/storage/no-public-access/#explanation", "text": "Using 'allUsers' or 'allAuthenticatedUsers' as members in an IAM member/binding causes data to be exposed outside of the organisation.", "title": "Explanation"}, {"location": "checks/google/storage/no-public-access/#possible-impact", "text": "Public exposure of sensitive data.", "title": "Possible Impact"}, {"location": "checks/google/storage/no-public-access/#suggested-resolution", "text": "Restrict public access to the bucket.", "title": "Suggested Resolution"}, {"location": "checks/google/storage/no-public-access/#insecure-example", "text": "The following example will fail the google-storage-no-public-access check. resource \"google_storage_bucket_iam_binding\" \"binding\" { bucket = google_storage_bucket.default.name role = \"roles/storage.admin\" members = [ \"allAuthenticatedUsers\" , ] }", "title": "Insecure Example"}, {"location": "checks/google/storage/no-public-access/#secure-example", "text": "The following example will pass the google-storage-no-public-access check. resource \"google_storage_bucket_iam_binding\" \"binding\" { bucket = google_storage_bucket.default.name role = \"roles/storage.admin\" members = [ \"user:jane@example.com\" , ] }", "title": "Secure Example"}, {"location": "checks/google/storage/no-public-access/#links", "text": "https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/storage_bucket_iam#member/members https://jbrojbrojbro.medium.com/you-make-the-rules-with-authentication-controls-for-cloud-storage-53c32543747b", "title": "Links"}, {"location": "checks/kubernetes/network/no-public-egress/", "text": "Public egress should not be allowed via network policies Default Severity: high Explanation You should not expose infrastructure to the public internet except where explicitly required Possible Impact Exfiltration of data to the public internet Suggested Resolution Remove public access except where explicitly required Insecure Example The following example will fail the kubernetes-network-no-public-egress check. resource \"kubernetes_network_policy\" \"bad_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } } Secure Example The following example will pass the kubernetes-network-no-public-egress check. resource \"kubernetes_network_policy\" \"good_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } } Links https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/network_policy#spec.ingress.from.ip_block.cidr", "title": "no-public-egress"}, {"location": "checks/kubernetes/network/no-public-egress/#public-egress-should-not-be-allowed-via-network-policies", "text": "", "title": "Public egress should not be allowed via network policies"}, {"location": "checks/kubernetes/network/no-public-egress/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/kubernetes/network/no-public-egress/#explanation", "text": "You should not expose infrastructure to the public internet except where explicitly required", "title": "Explanation"}, {"location": "checks/kubernetes/network/no-public-egress/#possible-impact", "text": "Exfiltration of data to the public internet", "title": "Possible Impact"}, {"location": "checks/kubernetes/network/no-public-egress/#suggested-resolution", "text": "Remove public access except where explicitly required", "title": "Suggested Resolution"}, {"location": "checks/kubernetes/network/no-public-egress/#insecure-example", "text": "The following example will fail the kubernetes-network-no-public-egress check. resource \"kubernetes_network_policy\" \"bad_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } }", "title": "Insecure Example"}, {"location": "checks/kubernetes/network/no-public-egress/#secure-example", "text": "The following example will pass the kubernetes-network-no-public-egress check. resource \"kubernetes_network_policy\" \"good_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } }", "title": "Secure Example"}, {"location": "checks/kubernetes/network/no-public-egress/#links", "text": "https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/network_policy#spec.ingress.from.ip_block.cidr", "title": "Links"}, {"location": "checks/kubernetes/network/no-public-ingress/", "text": "Public ingress should not be allowed via network policies Default Severity: high Explanation You should not expose infrastructure to the public internet except where explicitly required Possible Impact Exposure of infrastructure to the public internet Suggested Resolution Remove public access except where explicitly required Insecure Example The following example will fail the kubernetes-network-no-public-ingress check. resource \"kubernetes_network_policy\" \"bad_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } } Secure Example The following example will pass the kubernetes-network-no-public-ingress check. resource \"kubernetes_network_policy\" \"good_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } } Links https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/network_policy#spec.ingress.from.ip_block.cidr", "title": "no-public-ingress"}, {"location": "checks/kubernetes/network/no-public-ingress/#public-ingress-should-not-be-allowed-via-network-policies", "text": "", "title": "Public ingress should not be allowed via network policies"}, {"location": "checks/kubernetes/network/no-public-ingress/#default-severity-high", "text": "", "title": "Default Severity: high"}, {"location": "checks/kubernetes/network/no-public-ingress/#explanation", "text": "You should not expose infrastructure to the public internet except where explicitly required", "title": "Explanation"}, {"location": "checks/kubernetes/network/no-public-ingress/#possible-impact", "text": "Exposure of infrastructure to the public internet", "title": "Possible Impact"}, {"location": "checks/kubernetes/network/no-public-ingress/#suggested-resolution", "text": "Remove public access except where explicitly required", "title": "Suggested Resolution"}, {"location": "checks/kubernetes/network/no-public-ingress/#insecure-example", "text": "The following example will fail the kubernetes-network-no-public-ingress check. resource \"kubernetes_network_policy\" \"bad_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } }", "title": "Insecure Example"}, {"location": "checks/kubernetes/network/no-public-ingress/#secure-example", "text": "The following example will pass the kubernetes-network-no-public-ingress check. resource \"kubernetes_network_policy\" \"good_example\" { metadata { name = \"terraform-example-network-policy\" namespace = \"default\" } spec { pod_selector { match_expressions { key = \"name\" operator = \"In\" values = [ \"webfront\", \"api\" ] } } ingress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } from { ip_block { cidr = \"10.0.0.0/16\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } egress { ports { port = \"http\" protocol = \"TCP\" } ports { port = \"8125\" protocol = \"UDP\" } to { ip_block { cidr = \"0.0.0.0/0\" except = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , ] } } } policy_types = [ \"Ingress\", \"Egress\" ] } }", "title": "Secure Example"}, {"location": "checks/kubernetes/network/no-public-ingress/#links", "text": "https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/network_policy#spec.ingress.from.ip_block.cidr", "title": "Links"}, {"location": "checks/openstack/compute/no-plaintext-password/", "text": "No plaintext password for compute instance Default Severity: medium Explanation Assigning a password to the compute instance using plaintext could lead to compromise; it would be preferable to use key-pairs as a login mechanism Possible Impact Including a plaintext password could lead to compromised instance Suggested Resolution Do not use plaintext passwords in terraform files Insecure Example The following example will fail the openstack-compute-no-plaintext-password check. resource \"openstack_compute_instance_v2\" \"bad_example\" { name = \"basic\" image_id = \"ad091b52-742f-469e-8f3c-fd81cadf0743\" flavor_id = \"3\" admin_pass = \"N0tSoS3cretP4ssw0rd\" security_groups = [ \"default\" ] user_data = \"#cloud-config\\nhostname: instance_1.example.com\\nfqdn: instance_1.example.com\" network { name = \"my_network\" } } Secure Example The following example will pass the openstack-compute-no-plaintext-password check. resource \"openstack_compute_instance_v2\" \"good_example\" { name = \"basic\" image_id = \"ad091b52-742f-469e-8f3c-fd81cadf0743\" flavor_id = \"3\" key_pair = \"my_key_pair_name\" security_groups = [ \"default\" ] user_data = \"#cloud-config\\nhostname: instance_1.example.com\\nfqdn: instance_1.example.com\" network { name = \"my_network\" } } Links https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs/resources/compute_instance_v2#admin_pass", "title": "no-plaintext-password"}, {"location": "checks/openstack/compute/no-plaintext-password/#no-plaintext-password-for-compute-instance", "text": "", "title": "No plaintext password for compute instance"}, {"location": "checks/openstack/compute/no-plaintext-password/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/openstack/compute/no-plaintext-password/#explanation", "text": "Assigning a password to the compute instance using plaintext could lead to compromise; it would be preferable to use key-pairs as a login mechanism", "title": "Explanation"}, {"location": "checks/openstack/compute/no-plaintext-password/#possible-impact", "text": "Including a plaintext password could lead to compromised instance", "title": "Possible Impact"}, {"location": "checks/openstack/compute/no-plaintext-password/#suggested-resolution", "text": "Do not use plaintext passwords in terraform files", "title": "Suggested Resolution"}, {"location": "checks/openstack/compute/no-plaintext-password/#insecure-example", "text": "The following example will fail the openstack-compute-no-plaintext-password check. resource \"openstack_compute_instance_v2\" \"bad_example\" { name = \"basic\" image_id = \"ad091b52-742f-469e-8f3c-fd81cadf0743\" flavor_id = \"3\" admin_pass = \"N0tSoS3cretP4ssw0rd\" security_groups = [ \"default\" ] user_data = \"#cloud-config\\nhostname: instance_1.example.com\\nfqdn: instance_1.example.com\" network { name = \"my_network\" } }", "title": "Insecure Example"}, {"location": "checks/openstack/compute/no-plaintext-password/#secure-example", "text": "The following example will pass the openstack-compute-no-plaintext-password check. resource \"openstack_compute_instance_v2\" \"good_example\" { name = \"basic\" image_id = \"ad091b52-742f-469e-8f3c-fd81cadf0743\" flavor_id = \"3\" key_pair = \"my_key_pair_name\" security_groups = [ \"default\" ] user_data = \"#cloud-config\\nhostname: instance_1.example.com\\nfqdn: instance_1.example.com\" network { name = \"my_network\" } }", "title": "Secure Example"}, {"location": "checks/openstack/compute/no-plaintext-password/#links", "text": "https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs/resources/compute_instance_v2#admin_pass", "title": "Links"}, {"location": "checks/openstack/compute/no-public-access/", "text": "A firewall rule allows traffic from/to the public internet Default Severity: medium Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact Exposure of infrastructure to the public internet Suggested Resolution Employ more restrictive firewall rules Insecure Example The following example will fail the openstack-compute-no-public-access check. resource \"openstack_fw_rule_v1\" \"rule_1\" { name = \"my_rule\" description = \"let anyone in\" action = \"allow\" protocol = \"tcp\" destination_port = \"22\" enabled = \"true\" } Secure Example The following example will pass the openstack-compute-no-public-access check. resource \"openstack_fw_rule_v1\" \"rule_1\" { name = \"my_rule\" description = \"don't let just anyone in\" action = \"allow\" protocol = \"tcp\" destination_ip_address = \"10.10.10.1\" source_ip_address = \"10.10.10.2\" destination_port = \"22\" enabled = \"true\" } Links https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs/resources/fw_rule_v1", "title": "A firewall rule allows traffic from/to the public internet"}, {"location": "checks/openstack/compute/no-public-access/#a-firewall-rule-allows-traffic-fromto-the-public-internet", "text": "", "title": "A firewall rule allows traffic from/to the public internet"}, {"location": "checks/openstack/compute/no-public-access/#default-severity-medium", "text": "", "title": "Default Severity: medium"}, {"location": "checks/openstack/compute/no-public-access/#explanation", "text": "Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.", "title": "Explanation"}, {"location": "checks/openstack/compute/no-public-access/#possible-impact", "text": "Exposure of infrastructure to the public internet", "title": "Possible Impact"}, {"location": "checks/openstack/compute/no-public-access/#suggested-resolution", "text": "Employ more restrictive firewall rules", "title": "Suggested Resolution"}, {"location": "checks/openstack/compute/no-public-access/#insecure-example", "text": "The following example will fail the openstack-compute-no-public-access check. resource \"openstack_fw_rule_v1\" \"rule_1\" { name = \"my_rule\" description = \"let anyone in\" action = \"allow\" protocol = \"tcp\" destination_port = \"22\" enabled = \"true\" }", "title": "Insecure Example"}, {"location": "checks/openstack/compute/no-public-access/#secure-example", "text": "The following example will pass the openstack-compute-no-public-access check. resource \"openstack_fw_rule_v1\" \"rule_1\" { name = \"my_rule\" description = \"don't let just anyone in\" action = \"allow\" protocol = \"tcp\" destination_ip_address = \"10.10.10.1\" source_ip_address = \"10.10.10.2\" destination_port = \"22\" enabled = \"true\" }", "title": "Secure Example"}, {"location": "checks/openstack/compute/no-public-access/#links", "text": "https://registry.terraform.io/providers/terraform-provider-openstack/openstack/latest/docs/resources/fw_rule_v1", "title": "Links"}, {"location": "checks/oracle/compute/no-public-ip/", "text": "Compute instance requests an IP reservation from a public pool Default Severity: critical Explanation Compute instance requests an IP reservation from a public pool The compute instance has the ability to be reached from outside, you might want to sonder the use of a non public IP. Possible Impact The compute instance has the ability to be reached from outside Suggested Resolution Reconsider the use of an public IP Insecure Example The following example will fail the oracle-compute-no-public-ip check. resource \"opc_compute_ip_address_reservation\" \"bad_example\" { name = \"my-ip-address\" ip_address_pool = \"public-ippool\" } Secure Example The following example will pass the oracle-compute-no-public-ip check. resource \"opc_compute_ip_address_reservation\" \"good_example\" { name = \"my-ip-address\" ip_address_pool = \"cloud-ippool\" } Links https://registry.terraform.io/providers/hashicorp/opc/latest/docs/resources/opc_compute_ip_address_reservation https://registry.terraform.io/providers/hashicorp/opc/latest/docs/resources/opc_compute_instance", "title": "no-public-ip"}, {"location": "checks/oracle/compute/no-public-ip/#compute-instance-requests-an-ip-reservation-from-a-public-pool", "text": "", "title": "Compute instance requests an IP reservation from a public pool"}, {"location": "checks/oracle/compute/no-public-ip/#default-severity-critical", "text": "", "title": "Default Severity: critical"}, {"location": "checks/oracle/compute/no-public-ip/#explanation", "text": "Compute instance requests an IP reservation from a public pool The compute instance has the ability to be reached from outside, you might want to sonder the use of a non public IP.", "title": "Explanation"}, {"location": "checks/oracle/compute/no-public-ip/#possible-impact", "text": "The compute instance has the ability to be reached from outside", "title": "Possible Impact"}, {"location": "checks/oracle/compute/no-public-ip/#suggested-resolution", "text": "Reconsider the use of an public IP", "title": "Suggested Resolution"}, {"location": "checks/oracle/compute/no-public-ip/#insecure-example", "text": "The following example will fail the oracle-compute-no-public-ip check. resource \"opc_compute_ip_address_reservation\" \"bad_example\" { name = \"my-ip-address\" ip_address_pool = \"public-ippool\" }", "title": "Insecure Example"}, {"location": "checks/oracle/compute/no-public-ip/#secure-example", "text": "The following example will pass the oracle-compute-no-public-ip check. resource \"opc_compute_ip_address_reservation\" \"good_example\" { name = \"my-ip-address\" ip_address_pool = \"cloud-ippool\" }", "title": "Secure Example"}, {"location": "checks/oracle/compute/no-public-ip/#links", "text": "https://registry.terraform.io/providers/hashicorp/opc/latest/docs/resources/opc_compute_ip_address_reservation https://registry.terraform.io/providers/hashicorp/opc/latest/docs/resources/opc_compute_instance", "title": "Links"}, {"location": "getting-started/credit/", "text": "Authors Liam Galvin (liamg) Owen Rumney (owenrumney) Contributors Thanks to all contributors", "title": "Credits"}, {"location": "getting-started/credit/#authors", "text": "Liam Galvin (liamg) Owen Rumney (owenrumney)", "title": "Authors"}, {"location": "getting-started/credit/#contributors", "text": "Thanks to all contributors", "title": "Contributors"}, {"location": "getting-started/installation/", "text": "Install with brew/linuxbrew brew install tfsec Install with Chocolatey choco install tfsec Install with Scoop scoop install tfsec You can also grab the binary for your system from the releases page . Alternatively, install with Go: go install github.com/aquasecurity/tfsec/cmd/tfsec@latest", "title": "Installation"}, {"location": "getting-started/quickstart/", "text": "Using as a command line tool The easiest way to run tfsec is to run it in the directory you want to scan. tfsec tfsec will traverse the directory till it finds a valid Terraform file; the directory it finds this file in will be considered to the working directory. If you want to run on a specific location, this can be passed as an argument; tfsec ./tf/prod The exit status will be non-zero if tfsec finds problems, otherwise the exit status will be zero. Use with Docker As an alternative to installing and running tfsec on your system, you may run tfsec in a Docker container. To run: docker run --rm -it -v \" $( pwd ) :/src\" aquasec/tfsec /src Using in CI tfsec can be added to any CI pipeline as a command with the exit code dictating if it breaks the build. We do provide a GitHub Action that will also upload the results to GitHub code scanning UI. Passing Arguments This page only covers the basics of what tfsec can do - much more is achievable using the arguments on the Parameters page.", "title": "Quick Start"}, {"location": "getting-started/quickstart/#using-as-a-command-line-tool", "text": "The easiest way to run tfsec is to run it in the directory you want to scan. tfsec tfsec will traverse the directory till it finds a valid Terraform file; the directory it finds this file in will be considered to the working directory. If you want to run on a specific location, this can be passed as an argument; tfsec ./tf/prod The exit status will be non-zero if tfsec finds problems, otherwise the exit status will be zero.", "title": "Using as a command line tool"}, {"location": "getting-started/quickstart/#use-with-docker", "text": "As an alternative to installing and running tfsec on your system, you may run tfsec in a Docker container. To run: docker run --rm -it -v \" $( pwd ) :/src\" aquasec/tfsec /src", "title": "Use with Docker"}, {"location": "getting-started/quickstart/#using-in-ci", "text": "tfsec can be added to any CI pipeline as a command with the exit code dictating if it breaks the build. We do provide a GitHub Action that will also upload the results to GitHub code scanning UI.", "title": "Using in CI"}, {"location": "getting-started/quickstart/#passing-arguments", "text": "This page only covers the basics of what tfsec can do - much more is achievable using the arguments on the Parameters page.", "title": "Passing Arguments"}, {"location": "getting-started/signing/", "text": "Verifying signed binaries All tfsec binaries are signed with out signing key D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE . The steps below detail how to verify the signature of the keys. Public Key The public key for signing@tfsec.dev can be downloaded here -----BEGIN PGP PUBLIC KEY BLOCK----- mQINBGCmSy4BEAC9IxH3DeV+xeORRypRZe28YYSvDvBZdfer0apm+p1kJFsXM6ns dng9PThUihEt11BMtLmlQyPMQ0TsONOjqFaqNEitzNe55MSHxTYkTrnctrF3IKS4 G35RHcHUctx9j4Cg56eRxU1cb0B/JJdh9HjZtQG9CJB0+WU/UlXOgYn/17ZScS6Q tq56SKd+lW5BfTzl+aYdzbrlWh1Ukla7DvydQmxY7XHgfKbLrGJVQdL91opJvXKr D1vxDuMpZHSm9lp6G5GXsZIA080QKcD3nSjeeRTxuABDwHD/1OS03iZQtxwjUMRw FYFlrcSVap20SXMLAtKRDpWGhAyzI+JUhZQMuRj22jcicEs7CKGXteFMFlgh3RU1 K4DfQwFT436ywuDCAuu/vAhVwZmLaUlf6YIWnGBYOjHXjas/f1z7ZTe2dHxQfNg4 xsmefH++I4qRHF+e2ggMGF2JAv8Y7T3+QDkXDiQ/kTJaFvWqoe0A5V+CmdL01giW AkCfqtRIEKuF7NSYsekY0HVGwxDGG/gKWfWw0bq+KxsVwk9/KDVBZIRdimqcuJm1 PIssx5v+V4BIkYWhKNX0rIu5bi9UAXHJJuCEdzHsiWUp+UA6MBv1FNNWdPJoEwkc BgmryUFYr7UVb0+9NkII0rYmnwHcuFO9tErqccN+Ru2f920R40J/jH3GMQARAQAB tDpUZnNlYyBTaWduaW5nIChDb2RlIHNpZ25pbmcgZm9yIHRmc2VjKSA8c2lnbmlu Z0B0ZnNlYy5kZXY+iQJOBBMBCgA4FiEE1msiKj6kwl1dGgl/w0rO+0bsOc4FAmCm Sy4CGwMFCwkIBwIGFQoJCAsCBBYCAwECHgECF4AACgkQw0rO+0bsOc6zRA/+JZUV Q4ip9qGt6mMN+bkFm67218F5J/e1EKC9lbf4yuw56Jgz1+MdENUVROdqTxxXPWqX XaS0VD4obq/0G83dVgxuMFuW8LM+Uey6adGLn4QPoxt6Y0lRlQJmsP9aicw+rcvf drV34GwUPTEwbIW1AAhTi1hS+9/EsBqzMnIzL6xBsN29bHFiqQlC0bodDwVU7uYc tgh6D8W5FKeQkUiHJlZxGpcY7TEMmhcp26tdIWAfUFBDbwqoS/NZy3ZWJ3QLu1WQ 72u7gD7tR4NoZwYiSGLZBp8Qz3g1a5RNdsN7U63bMhP8LWuvOYNe886DGAD4Olxa HkPowUJ3GVd1v7WE02Zu/72YEQB0XL2gy/QclX56gx0jXDBoyQrzdSHXYQzI3Y0Z W7T7ETxkvGsWEHkU+20KJKSTEWKVIQN7kKVT9RbMUvYBTex6oFnzDZvOBhbrWxjP 4ojHHCkhTyffWZ2LKPDueFuzGLdf/F+Di2//Yc5ylYxPF2mBDp0ptUXPOFCN/5o/ smBoDBzVU49Rnnw9qOUZ5PLs+HmPT4MMdGJKO1bD7JRA8zKtzIgNE568U5IjbOjV WXYhy9QFoQINjkiGBw0TQf7Yb8O0u0EnumXqYEPcyKgJaIhquduQllaoepJa27qR ZchuaBTiTJwaMIaz5m8MOQsVMfEgU3tDf0RbufG5Ag0EYKZLLgEQAMjL3IEmut/B k/FzcMGbvpf/dlIqnNDFsRLYexmhqfU7n5Nm0bWYhYArszBYfvYlZCXOsjmeRnSa fR85mw98ZMxR9n87NtgnNdEFnWceJ+3TkTIlcIZsGqCodWaxKW99q0w2z9MQ8Twn 4ciioKvinw9FE2YdfnPe7gY3DfvvTWurhvssUh3YLIaGMt3KcRtEVsPOnsRNLeLD R9T5CGX8H47C/kBxGIPgh6xRf5yxErU7BwiS7BgSSAXwiM3IenuqgeJe4flBggTl 7zcevsgvBrIPVemRl428fCTtBkykEobNXz/2JT/CzgCYJ27zlzdFe81ENoxR9Ieb KyA2EDw41xtjGiHkXsBdavQsikoXqt8PC7sFoIm/b2125fUmDafZ/DVDxLeSjglx izWMN1AG9CV7bEgC/f25UmiQb3V2TkM9Uo+Y5g1ZvJTM83mi2cINjQW5WTwV8fiu DFf2QTXY/4W0jtU5EvI7N3tH7laFBsXz32hnEGImsyBUApJK0s3FPdBjwEYtNSt9 Fn5JFr0+48uIgvmS+CnKp+KzQ7YRWputbJWO3JFvlzMmCKXKU/ss+PkU6admTvnH rm+2qpGWfsmvStsqpgdbivLwujVC1ZyKnv8MkT7pq0iwlyqyAGlYoTkW1JSiCzmd s2kE+hqsIr+u8sd07zjoxtvLdUnF1c81ABEBAAGJAjYEGAEKACAWIQTWayIqPqTC XV0aCX/DSs77Ruw5zgUCYKZLLgIbDAAKCRDDSs77Ruw5znn2D/9scSun7N7UcXCD 0WV4F0QNUU+cu6QeDkjFoolXQZeIBRgSpa1r9qfPzQqB03CF/E5kFQz6APpX9nZX gjCvBo2oeeSusUY3d4gkGUnhLC+rwiPaQrJFgh6pDli3A78KChADq+JzZaxcDb7m Li41jwmfqHdkC0c6LI9QstOcyV2n5u2/HX0tJLGw47w5eEsfhcI5xgw/adBjqpHM lEKTJcyJuIY++9PiNmG5algPwAa+0XrgCdLHyHXHHhoFV+5xj29iWpfPlqLLl1eT QqnbqpcOupcsFsASiM5zVGZHK6LYuDkk9Ey/TrqcAhxfyl8cXNpdRC7PanHtykvC DKa/6fXNJ3MtpQZ+Z+JjoN1PWQP3UqDYhXxizzT6TrT5N72M//bLm0hadPCt+8Wx CzlBBxuxlGEhdriYFUtQ/wN7cRR659qZARylfXI5j1mHBlPuIEoSCMkkz/Nj3Bxo iuzLVVrX0h16N7H2wclTsw2LDf2rPlTIcI5Ct41fOSyyagZhWoR05JbaY4+yfhjx FkM0ly4XGasTbjJpwbJKWtXwiLXNaCCzQJH1DBdh5O3lHIidqcdoi+iAcpgaJCXI p297ny/7PTHmTaZhdjGcBp2tAmd+J0zgsmNk3qUg5pPGKdUnCA5jjENfmTMP4ets nX5QmAEwF/nBYV3Du7TIvHtz91yL8A== =opqY -----END PGP PUBLIC KEY BLOCK----- Steps for Verification Copy the public key block into a new file, eg; /tmp/tfsec_key.txt Import the gpg key gpg --import < /tmp/tfsec_key.txt Verify that the key has been imported gpg --list-keys signing@tfsec.dev check the output is pub rsa4096 2021-05-20 [SC] D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE uid [ultimate] Tfsec Signing (Code signing for tfsec) <signing@tfsec.dev> sub rsa4096 2021-05-20 [E] Download the required binary and its associated sig file Assuming it is tfsec-linux-amd64 the verify command below should be run, passing in the sig file then the binary file gpg --verify tfsec-linux-amd64.D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE.sig tfsec-linux-amd64 This should give you a similar output to that below - the key part is that it is signed and has a Good signature gpg: Signature made Fri 09 Jul 2021 11:41:22 BST gpg: using RSA key D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE gpg: Good signature from \"Tfsec Signing (Code signing for tfsec) <signing@tfsec.dev>\" [ultimate]", "title": "Signature Verification"}, {"location": "getting-started/signing/#verifying-signed-binaries", "text": "All tfsec binaries are signed with out signing key D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE . The steps below detail how to verify the signature of the keys.", "title": "Verifying signed binaries"}, {"location": "getting-started/signing/#public-key", "text": "The public key for signing@tfsec.dev can be downloaded here -----BEGIN PGP PUBLIC KEY BLOCK----- mQINBGCmSy4BEAC9IxH3DeV+xeORRypRZe28YYSvDvBZdfer0apm+p1kJFsXM6ns dng9PThUihEt11BMtLmlQyPMQ0TsONOjqFaqNEitzNe55MSHxTYkTrnctrF3IKS4 G35RHcHUctx9j4Cg56eRxU1cb0B/JJdh9HjZtQG9CJB0+WU/UlXOgYn/17ZScS6Q tq56SKd+lW5BfTzl+aYdzbrlWh1Ukla7DvydQmxY7XHgfKbLrGJVQdL91opJvXKr D1vxDuMpZHSm9lp6G5GXsZIA080QKcD3nSjeeRTxuABDwHD/1OS03iZQtxwjUMRw FYFlrcSVap20SXMLAtKRDpWGhAyzI+JUhZQMuRj22jcicEs7CKGXteFMFlgh3RU1 K4DfQwFT436ywuDCAuu/vAhVwZmLaUlf6YIWnGBYOjHXjas/f1z7ZTe2dHxQfNg4 xsmefH++I4qRHF+e2ggMGF2JAv8Y7T3+QDkXDiQ/kTJaFvWqoe0A5V+CmdL01giW AkCfqtRIEKuF7NSYsekY0HVGwxDGG/gKWfWw0bq+KxsVwk9/KDVBZIRdimqcuJm1 PIssx5v+V4BIkYWhKNX0rIu5bi9UAXHJJuCEdzHsiWUp+UA6MBv1FNNWdPJoEwkc BgmryUFYr7UVb0+9NkII0rYmnwHcuFO9tErqccN+Ru2f920R40J/jH3GMQARAQAB tDpUZnNlYyBTaWduaW5nIChDb2RlIHNpZ25pbmcgZm9yIHRmc2VjKSA8c2lnbmlu Z0B0ZnNlYy5kZXY+iQJOBBMBCgA4FiEE1msiKj6kwl1dGgl/w0rO+0bsOc4FAmCm Sy4CGwMFCwkIBwIGFQoJCAsCBBYCAwECHgECF4AACgkQw0rO+0bsOc6zRA/+JZUV Q4ip9qGt6mMN+bkFm67218F5J/e1EKC9lbf4yuw56Jgz1+MdENUVROdqTxxXPWqX XaS0VD4obq/0G83dVgxuMFuW8LM+Uey6adGLn4QPoxt6Y0lRlQJmsP9aicw+rcvf drV34GwUPTEwbIW1AAhTi1hS+9/EsBqzMnIzL6xBsN29bHFiqQlC0bodDwVU7uYc tgh6D8W5FKeQkUiHJlZxGpcY7TEMmhcp26tdIWAfUFBDbwqoS/NZy3ZWJ3QLu1WQ 72u7gD7tR4NoZwYiSGLZBp8Qz3g1a5RNdsN7U63bMhP8LWuvOYNe886DGAD4Olxa HkPowUJ3GVd1v7WE02Zu/72YEQB0XL2gy/QclX56gx0jXDBoyQrzdSHXYQzI3Y0Z W7T7ETxkvGsWEHkU+20KJKSTEWKVIQN7kKVT9RbMUvYBTex6oFnzDZvOBhbrWxjP 4ojHHCkhTyffWZ2LKPDueFuzGLdf/F+Di2//Yc5ylYxPF2mBDp0ptUXPOFCN/5o/ smBoDBzVU49Rnnw9qOUZ5PLs+HmPT4MMdGJKO1bD7JRA8zKtzIgNE568U5IjbOjV WXYhy9QFoQINjkiGBw0TQf7Yb8O0u0EnumXqYEPcyKgJaIhquduQllaoepJa27qR ZchuaBTiTJwaMIaz5m8MOQsVMfEgU3tDf0RbufG5Ag0EYKZLLgEQAMjL3IEmut/B k/FzcMGbvpf/dlIqnNDFsRLYexmhqfU7n5Nm0bWYhYArszBYfvYlZCXOsjmeRnSa fR85mw98ZMxR9n87NtgnNdEFnWceJ+3TkTIlcIZsGqCodWaxKW99q0w2z9MQ8Twn 4ciioKvinw9FE2YdfnPe7gY3DfvvTWurhvssUh3YLIaGMt3KcRtEVsPOnsRNLeLD R9T5CGX8H47C/kBxGIPgh6xRf5yxErU7BwiS7BgSSAXwiM3IenuqgeJe4flBggTl 7zcevsgvBrIPVemRl428fCTtBkykEobNXz/2JT/CzgCYJ27zlzdFe81ENoxR9Ieb KyA2EDw41xtjGiHkXsBdavQsikoXqt8PC7sFoIm/b2125fUmDafZ/DVDxLeSjglx izWMN1AG9CV7bEgC/f25UmiQb3V2TkM9Uo+Y5g1ZvJTM83mi2cINjQW5WTwV8fiu DFf2QTXY/4W0jtU5EvI7N3tH7laFBsXz32hnEGImsyBUApJK0s3FPdBjwEYtNSt9 Fn5JFr0+48uIgvmS+CnKp+KzQ7YRWputbJWO3JFvlzMmCKXKU/ss+PkU6admTvnH rm+2qpGWfsmvStsqpgdbivLwujVC1ZyKnv8MkT7pq0iwlyqyAGlYoTkW1JSiCzmd s2kE+hqsIr+u8sd07zjoxtvLdUnF1c81ABEBAAGJAjYEGAEKACAWIQTWayIqPqTC XV0aCX/DSs77Ruw5zgUCYKZLLgIbDAAKCRDDSs77Ruw5znn2D/9scSun7N7UcXCD 0WV4F0QNUU+cu6QeDkjFoolXQZeIBRgSpa1r9qfPzQqB03CF/E5kFQz6APpX9nZX gjCvBo2oeeSusUY3d4gkGUnhLC+rwiPaQrJFgh6pDli3A78KChADq+JzZaxcDb7m Li41jwmfqHdkC0c6LI9QstOcyV2n5u2/HX0tJLGw47w5eEsfhcI5xgw/adBjqpHM lEKTJcyJuIY++9PiNmG5algPwAa+0XrgCdLHyHXHHhoFV+5xj29iWpfPlqLLl1eT QqnbqpcOupcsFsASiM5zVGZHK6LYuDkk9Ey/TrqcAhxfyl8cXNpdRC7PanHtykvC DKa/6fXNJ3MtpQZ+Z+JjoN1PWQP3UqDYhXxizzT6TrT5N72M//bLm0hadPCt+8Wx CzlBBxuxlGEhdriYFUtQ/wN7cRR659qZARylfXI5j1mHBlPuIEoSCMkkz/Nj3Bxo iuzLVVrX0h16N7H2wclTsw2LDf2rPlTIcI5Ct41fOSyyagZhWoR05JbaY4+yfhjx FkM0ly4XGasTbjJpwbJKWtXwiLXNaCCzQJH1DBdh5O3lHIidqcdoi+iAcpgaJCXI p297ny/7PTHmTaZhdjGcBp2tAmd+J0zgsmNk3qUg5pPGKdUnCA5jjENfmTMP4ets nX5QmAEwF/nBYV3Du7TIvHtz91yL8A== =opqY -----END PGP PUBLIC KEY BLOCK-----", "title": "Public Key"}, {"location": "getting-started/signing/#steps-for-verification", "text": "Copy the public key block into a new file, eg; /tmp/tfsec_key.txt Import the gpg key gpg --import < /tmp/tfsec_key.txt Verify that the key has been imported gpg --list-keys signing@tfsec.dev check the output is pub rsa4096 2021-05-20 [SC] D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE uid [ultimate] Tfsec Signing (Code signing for tfsec) <signing@tfsec.dev> sub rsa4096 2021-05-20 [E] Download the required binary and its associated sig file Assuming it is tfsec-linux-amd64 the verify command below should be run, passing in the sig file then the binary file gpg --verify tfsec-linux-amd64.D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE.sig tfsec-linux-amd64 This should give you a similar output to that below - the key part is that it is signed and has a Good signature gpg: Signature made Fri 09 Jul 2021 11:41:22 BST gpg: using RSA key D66B222A3EA4C25D5D1A097FC34ACEFB46EC39CE gpg: Good signature from \"Tfsec Signing (Code signing for tfsec) <signing@tfsec.dev>\" [ultimate]", "title": "Steps for Verification"}, {"location": "getting-started/usage/", "text": "tfsec can by run with no arguments and will act on the current folder. For a richer experience, there are many additional command line arguments that you can make use of. Argument Short Code Description --allow-checks-to-panic -p Allow panics to propagate up from rule checking --concise-output Reduce the amount of output and no metrics --config-file [path to config file] Config file to use during run --custom-check-dir [path to checks dir] Explicitly the custom checks dir location --debug Enable verbose logging, same as --verbose but for people who prefer to say debug --exclude [comma,separated,rule,ids] -e Provide comma-separated list of rule IDs to exclude from run. --exclude-path strings Path to exclude from parser, can be used multiple times --exclude-downloaded-modules Remove results for downloaded modules in .terraform folder --filter-results [comma,separated,riles,to,check] Filter results to return specific checks only (supports comma-delimited input). --force-all-dirs Don't search for tf files, include everything below provided directory. --format [default,json,csv,checkstyle,junit,sarif,gif] -f Select output format: default, json, csv, checkstyle, junit, sarif. To use multiple formats, separate with a comma and specify a base output filename with --out. A file will be written for each type. The first format will additionally be written stdout. --help -h help for tfsec --ignore-hcl-errors Stop and report an error if an HCL parse error is encountered --include-ignored Ignore comments with have no effect and all resources will be scanned --include-passed Resources that pass checks are included in the result output --migrate-ignores Migrate ignore codes to the new ID structure eg; AWS077 to aws-s3-enable-versioning --no-color Disable colored output (American style!) --no-colour Disable coloured output --out [filepath to output to] Set output file. This filename will have a format descriptor appended if multiple formats are specified with --format --run-statistics View statistics table of current findings. --soft-fail -s Runs checks but suppresses error code --sort-severity Sort the results by severity from highest to lowest --tfvars-file strings Path to .tfvars file, can be used multiple times and evaluated in order of specification --update Update to latest version --verbose Enable verbose logging --version -v Show version information and exit --workspace [terraform workspace] -w Specify a workspace for ignore limits This list can also be found by running tfsec --help", "title": "Parameters"}, {"location": "getting-started/configuration/config/", "text": "The tfsec config file can override various tfsec configurations. The tfsec config file is a file in the .tfsec folder in the root check path named config.json or config.yml and is automatically loaded if it exists. The config file can also be set with the --config-file option: tfsec --config-file tfsec.yml Syntax and Overrides Severity Overrides There are occasions where the default severity level for one of the built in checks is too severe or in some cases not strong enough. The config file can be used to specify overrides for any check identifier to replace the result output. { \"severity_overrides\" : { \"CUS002\" : \"ERROR\" , \"aws-s3-enable-versioning\" : \"LOW\" } } or in yaml --- severity_overrides : CUS002 : ERROR aws-s3-enable-versioning : HIGH Excluding checks There are moments where the list of checks you'd want to exclude becomes larger and larger. Rather than passing all the excluded checks via the command line, you can use the configuration entry exclude to list them all out. { \"exclude\" : [ \"CUS002\" , \"aws-s3-enable-versioning\" ] } or in yaml --- exclude : - CUS002 - aws-s3-enable-versioning", "title": "Config File"}, {"location": "getting-started/configuration/config/#syntax-and-overrides", "text": "", "title": "Syntax and Overrides"}, {"location": "getting-started/configuration/config/#severity-overrides", "text": "There are occasions where the default severity level for one of the built in checks is too severe or in some cases not strong enough. The config file can be used to specify overrides for any check identifier to replace the result output. { \"severity_overrides\" : { \"CUS002\" : \"ERROR\" , \"aws-s3-enable-versioning\" : \"LOW\" } } or in yaml --- severity_overrides : CUS002 : ERROR aws-s3-enable-versioning : HIGH", "title": "Severity Overrides"}, {"location": "getting-started/configuration/config/#excluding-checks", "text": "There are moments where the list of checks you'd want to exclude becomes larger and larger. Rather than passing all the excluded checks via the command line, you can use the configuration entry exclude to list them all out. { \"exclude\" : [ \"CUS002\" , \"aws-s3-enable-versioning\" ] } or in yaml --- exclude : - CUS002 - aws-s3-enable-versioning", "title": "Excluding checks"}, {"location": "getting-started/configuration/custom-checks/", "text": "What is it? tfsec comes with an ever growing number of built in checks, these cover standard AWS, Azure and GCP provider checks, plus several more. We recognise that there are checks that need performing for an organisation that don't fit with general use cases; for this, there are custom checks. Custom checks offer an accessible approach to injecting checks that satisfy your organisations compliance and security needs. For example, if you require that all EC2 instances have a CostCentre tag, that can be achieved with a custom_check . How does it work? Custom checks are defined as json files which sit in the .tfsec folder in the root check path. any file with the suffix _tfchecks.json or _tfchecks.yaml will be parsed and the checks included during the run. Overriding check directory The default location for custom checks can be overridden, this is done using the --custom-check-dir to specify another location to load the checks from instead. This is useful when global checks are to applied to the terraform under test. What does a check file look like? Check files are simply json, this ensures that checks can be put together without requiring Go knowledge or being able to build a new release of tfsec to include your custom code. Taking the previous example of a required cost centre, the check file might look something like { \"checks\" : [ { \"code\" : \"CUS001\" , \"description\" : \"Custom check to ensure the CostCentre tag is applied to EC2 instances\" , \"impact\" : \"By not having CostCentre we can't keep track of billing\" , \"resolution\" : \"Add the CostCentre tag\" , \"requiredTypes\" : [ \"resource\" ], \"requiredLabels\" : [ \"aws_instance\" ], \"severity\" : \"ERROR\" , \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"contains\" , \"value\" : \"CostCentre\" }, \"errorMessage\" : \"The required CostCentre tag was missing\" , \"relatedLinks\" : [ \"http://internal.acmecorp.com/standards/aws/tagging.html\" ] } ] } or --- checks : - code : CUS001 description : Custom check to ensure the CostCentre tag is applied to EC2 instances impact : By not having CostCentre we can't keep track of billing resolution : Add the CostCentre tag requiredTypes : - resource requiredLabels : - aws_instance severity : ERROR matchSpec : name : tags action : contains value : CostCentre errorMessage : The required CostCentre tag was missing relatedLinks : - http://internal.acmecorp.com/standards/aws/tagging.html The check contains up of the following attributes; Attribute Description code The custom code that your check will be known as description A description for the code that will be included in the output impact An optional detail about the consequences of not passing the check resolution An optional brief description of how to satisfy the check requiredTypes The block types to apply the check to - resource, data, module, variable requiredLabels The resource type - aws_ec2_instance for example. This also supports wildcards using * , e.g. aws_* severity How severe is the check matchSpec See below for the MatchSpec attributes errorMessage The error message that should be displayed in cases where the check fails relatedLinks A list of related links for the check to be displayed in cases where the check fails The MatchSpec is the what will define the check itself - this is fairly basic and is made up of the following attributes Attribute Description name The name of the attribute or block to run the check on action The check type - see below for more information value In cases where a value is required, the value to look for, text matching TFSEC_VAR_{VAR_NAME} will be replace with the variable value ignoreUndefined If the attribute is undefined, ignore and pass the check subMatch A sub MatchSpec block for nested checking - think looking for enabled value in a logging block predicateMatchSpec An array of MatchSpec blocks to be logically aggregated by either and or or actions assignVariable The name of the \"variable\" to store the value of the name attribute in, has to by uppercase and start with TFSEC_VAR_ Check Actions There are a number of CheckActions available which should allow you to quickly put together most checks. inModule The inModule check action passes if the resource block is a component of a module. For example, if you're looking to check that an aws_s3_bucket is only created using a custom module, you could use the following MatchSpec ; \"matchSpec\" : { \"action\" : \"inModule\" } matchSpec : action : inModule isPresent The isPresent check action passes if the required block or attribute is available in the checked block. For example, if you're looking to check that an acl is provided and don't care what it is, you can use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isPresent\" } matchSpec : name : acl action : isPresent notPresent Conversely, the noPresent check action passes if the specified block or attribute is not found in the checked block. For example, if you explicitly don't want an acl attribute to be present hou can use the following MatchSpec \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"notPresent\" } matchSpec : name : acl action : notPresent isEmpty The isEmpty check action passes if the named block or attribute is defined by empty. For example, to check that there are not tags you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"isEmpty\" , } matchSpec : name : acl action : isEmpty startsWith The startsWith check action passes if the checked attribute string starts with the specified value. For example, to check that acl begins with public you could use the following MatchSpec \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"startsWith\" , \"value\" : \"public\" } matchSpec : name : acl action : startsWith value : public endsWith The endsWith check action passes if the checked attribute string ends with the specified value. For example, to check that acl ends with read you could use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"endsWith\" , \"value\" : \"-read\" } matchSpec : name : acl action : endsWith value : -read contains The contains check action will change depending on the attribute or block it is applied to. If the check is against a string attribute, it will look for the MatchSpec value in the attribute. If the check is against a list, it will pass if the value item can be found in the list. If the attribute is an object or map it will pass if a key can be found that matches the MatchSpec value. For example, if you want to ensure that the CostCentre exists, you might use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"contains\" , \"value\" : \"CostCentre\" } matchSpec : name : tags action : contains value : CostCentre notContains The notContains check action will change depending on the attribute or block it is applied to. If the check is against a string attribute, it will look for the MatchSpec value in the attribute. If the check is against a list, it will pass if the value item can be found in the list. If the attribute is an object or map it will pass if a key can be found that matches the MatchSpec value. For example, you want to make sure that an action does not contain kms:* you might use the following MatchSpec : \"matchSpec\" : { \"name\" : \"action\" , \"action\" : \"notContains\" , \"value\" : \"kms:*\" } matchSpec : name : tags action : notContains value : kms:* equals The equals check action passes if the checked attribute equals specified value. The core primitive types are supported, if the subject attribute is a Boolean, the MatchSpec value will attempt to be cast to a Boolean for comparison. For example, to check that acl begins with private you could use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"equals\" , \"value\" : \"private\" } matchSpec : name : acl action : equals value : private lessThan The lessThan check action passes if the checked attribute is numerical and the value is less than the specified value. For example, if you want to ensure that the cpu_core_count is less than 8, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"lessThan\" , \"value\" : 8 } matchSpec : name : cpu_core_count action : lessThan value : 8 lessThanOrEqualTo The lessThanOrEqualTo check action passes if the checked attribute is numerical and the value is less than or equal to the specified value. For example, if you want to ensure that the cpu_core_count is less than or equal to 4, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"lessThanOrEqualTo\" , \"value\" : 4 } matchSpec : name : cpu_core_count action : lessThanOrEqualTo value : 4 greaterThan The greaterThan check action passes if the checked attribute is numerical and the value is greater than the specified value. For example, if you want to ensure that the cpu_core_count is greater than 2, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"greaterThan\" , \"value\" : 2 } matchSpec : name : cpu_core_count action : greaterThan value : 2 greaterThanOrEqualTo The greaterThanOrEqualTo check action passes if the checked attribute is numerical and the value is greater than or equal to the specified value. For example, if you want to ensure that the cpu_core_count is greater than or equal to 4, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"greaterThanOrEqualTo\" , \"value\" : 4 } matchSpec : name : cpu_core_count action : greaterThanOrEqualTo value : 4 regexMatches The regexMatches check action passes when the regex is matched to the pattern passed in the value. This is check would generally be used as a top level check to filter whether or not to apply a check. For example, this check will ensure that the source attribute of a module matches the supplied regex before continuing with the subMatches. This can be used to ensure that checks are targeted to specific modules. When tackling this specific use case of filtering module blocks by source, the requiredLabels should be set to \"*\" \"matchSpec\" : { \"name\" : \"source\" , \"action\" : \"regexMatches\" , \"value\" : \"^modules\\\\/.*public_.+bucket$\" , \"subMatch\" : { \"name\" : \"acl\" , \"action\" : \"equals\" , \"value\" : \"public-read\" } } matchSpec : name : source action : regexMatches value : \"^modules\\\\/.*public_.+bucket$\" subMatch : name : acl action : equals value : public-read isAny The isAny check action passes when the attribute value can be found in the slice passed as the check value. This check action supports strings and numbers \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isAny\" , \"value\" : [ \"private\" , \"log-delivery-write\" ] } matchSpec : name : acl action : isAny value : - private - log-delivery-write isNone The isNone check action passes when the attribute value cannot be found in the slice passed as the check value. This check action supports strings and numbers \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isNone\" , \"value\" : [ \"authenticated-read\" , \"public-read\" ] } matchSpec : name : acl action : isNone value : - authenticated-read - public-read requiresPresence The requiresPresence checks that the resource in name is also present in the Terraform code. If you wanted to ensure that aws_vpc_flowlogs is present if there is a aws_vpc , you might use the following matchSpec : \"matchSpec\" : { \"action\" : \"requiresPresence\" , \"name\" : \"aws_vpc_flowlogs\" } matchSpec : name : aws_vpc_flowlogs action : requiresPresence and The and check action passes when all the blocks provided within predicateMatchSpec evaluate to true . This action can be combined with subMatch to perform composite checks against the contents of nested blocks. Note that or and and actions can be nested as many times as needed. If you wanted to ensure that device_name and encrypted are both present in a nested ebs_block_device block, you might use the following matchSpec : \"matchSpec\" : { \"action\" : \"isPresent\" , \"name\" : \"ebs_block_device\" , \"subMatch\" : { \"action\" : \"and\" , \"predicateMatchSpec\" : [ { \"action\" : \"isPresent\" , \"name\" : \"device_name\" }, { \"action\" : \"isPresent\" , \"name\" : \"encrypted\" } ] } } matchSpec : action : isPresent name : ebs_block_device subMatch : action : and predicateMatchSpec : - action : isPresent name : device_name - action : isPresent name : encrypted or The or check action passes when at least one of the blocks provided within predicateMatchSpec evaluates to true . This action can be combined with subMatch to perform composite checks against the contents of nested blocks. Note that or and and actions can be nested as many times as needed. If you want to ensure that virtualization_type is assigned to either hvm or paravirtual , while enforcing that their implicitly linked required attributes are also present, you might use the following matchSpec : \"matchSpec\": { \"action\": \"or\", \"predicateMatchSpec\": [ { \"action\": \"and\", \"predicateMatchSpec\": [ { \"name\": \"virtualization_type\", \"action\": \"equals\", \"value\": \"hvm\" } ] }, { \"action\": \"and\", \"predicateMatchSpec\": [ { \"name\": \"virtualization_type\", \"action\": \"equals\", \"value\": \"paravirtual\" }, { \"name\": \"image_location\", \"action\": \"isPresent\" }, { \"name\": \"kernel_id\", \"action\": \"isPresent\" } ] } ] } matchSpec : action : or predicateMatchSpec : - action : and predicateMatchSpec : - name : virtualization_type action : equals value : hvm - name : sriov_net_support action : isPresent - action : and predicateMatchSpec : - name : virtualization_type action : equals value : paravirtual - name : image_location action : isPresent - name : kernel_id action : isPresent not The not check action passes when the predicateMatchSpec evaluates to false . As an example, if you want to represent that a resource should not be included inModule you might use the following matchSpec : \"matchSpec\": { \"action\": \"not\", \"predicateMatchSpec\": [ { \"action\": \"inModule\" } ] } matchSpec : action : not predicateMatchSpec : - action : inModule How do I know my JSON is valid? We have provided the tfsec-checkgen binary which will validate your check file to ensure that it is valid for use with tfsec . In the future, tfsec-checkgen will facilitate the creation of new check files with a wizard approach, for now it can be used to validate your check file. shell script ./tfsec-checkgen validate example/custom/.tfsec/custom_checks.json Are there limitations? At the moment, check MatchSpec is limited in the number of check types it can perform, these are as shown in the previous table. Custom defined checks also don't come with the comprehensive tests that the built in ones have. This will be addressed in future releases.", "title": "Custom Checks"}, {"location": "getting-started/configuration/custom-checks/#what-is-it", "text": "tfsec comes with an ever growing number of built in checks, these cover standard AWS, Azure and GCP provider checks, plus several more. We recognise that there are checks that need performing for an organisation that don't fit with general use cases; for this, there are custom checks. Custom checks offer an accessible approach to injecting checks that satisfy your organisations compliance and security needs. For example, if you require that all EC2 instances have a CostCentre tag, that can be achieved with a custom_check .", "title": "What is it?"}, {"location": "getting-started/configuration/custom-checks/#how-does-it-work", "text": "Custom checks are defined as json files which sit in the .tfsec folder in the root check path. any file with the suffix _tfchecks.json or _tfchecks.yaml will be parsed and the checks included during the run.", "title": "How does it work?"}, {"location": "getting-started/configuration/custom-checks/#overriding-check-directory", "text": "The default location for custom checks can be overridden, this is done using the --custom-check-dir to specify another location to load the checks from instead. This is useful when global checks are to applied to the terraform under test.", "title": "Overriding check directory"}, {"location": "getting-started/configuration/custom-checks/#what-does-a-check-file-look-like", "text": "Check files are simply json, this ensures that checks can be put together without requiring Go knowledge or being able to build a new release of tfsec to include your custom code. Taking the previous example of a required cost centre, the check file might look something like { \"checks\" : [ { \"code\" : \"CUS001\" , \"description\" : \"Custom check to ensure the CostCentre tag is applied to EC2 instances\" , \"impact\" : \"By not having CostCentre we can't keep track of billing\" , \"resolution\" : \"Add the CostCentre tag\" , \"requiredTypes\" : [ \"resource\" ], \"requiredLabels\" : [ \"aws_instance\" ], \"severity\" : \"ERROR\" , \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"contains\" , \"value\" : \"CostCentre\" }, \"errorMessage\" : \"The required CostCentre tag was missing\" , \"relatedLinks\" : [ \"http://internal.acmecorp.com/standards/aws/tagging.html\" ] } ] } or --- checks : - code : CUS001 description : Custom check to ensure the CostCentre tag is applied to EC2 instances impact : By not having CostCentre we can't keep track of billing resolution : Add the CostCentre tag requiredTypes : - resource requiredLabels : - aws_instance severity : ERROR matchSpec : name : tags action : contains value : CostCentre errorMessage : The required CostCentre tag was missing relatedLinks : - http://internal.acmecorp.com/standards/aws/tagging.html The check contains up of the following attributes; Attribute Description code The custom code that your check will be known as description A description for the code that will be included in the output impact An optional detail about the consequences of not passing the check resolution An optional brief description of how to satisfy the check requiredTypes The block types to apply the check to - resource, data, module, variable requiredLabels The resource type - aws_ec2_instance for example. This also supports wildcards using * , e.g. aws_* severity How severe is the check matchSpec See below for the MatchSpec attributes errorMessage The error message that should be displayed in cases where the check fails relatedLinks A list of related links for the check to be displayed in cases where the check fails The MatchSpec is the what will define the check itself - this is fairly basic and is made up of the following attributes Attribute Description name The name of the attribute or block to run the check on action The check type - see below for more information value In cases where a value is required, the value to look for, text matching TFSEC_VAR_{VAR_NAME} will be replace with the variable value ignoreUndefined If the attribute is undefined, ignore and pass the check subMatch A sub MatchSpec block for nested checking - think looking for enabled value in a logging block predicateMatchSpec An array of MatchSpec blocks to be logically aggregated by either and or or actions assignVariable The name of the \"variable\" to store the value of the name attribute in, has to by uppercase and start with TFSEC_VAR_", "title": "What does a check file look like?"}, {"location": "getting-started/configuration/custom-checks/#check-actions", "text": "There are a number of CheckActions available which should allow you to quickly put together most checks.", "title": "Check Actions"}, {"location": "getting-started/configuration/custom-checks/#inmodule", "text": "The inModule check action passes if the resource block is a component of a module. For example, if you're looking to check that an aws_s3_bucket is only created using a custom module, you could use the following MatchSpec ; \"matchSpec\" : { \"action\" : \"inModule\" } matchSpec : action : inModule", "title": "inModule"}, {"location": "getting-started/configuration/custom-checks/#ispresent", "text": "The isPresent check action passes if the required block or attribute is available in the checked block. For example, if you're looking to check that an acl is provided and don't care what it is, you can use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isPresent\" } matchSpec : name : acl action : isPresent", "title": "isPresent"}, {"location": "getting-started/configuration/custom-checks/#notpresent", "text": "Conversely, the noPresent check action passes if the specified block or attribute is not found in the checked block. For example, if you explicitly don't want an acl attribute to be present hou can use the following MatchSpec \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"notPresent\" } matchSpec : name : acl action : notPresent", "title": "notPresent"}, {"location": "getting-started/configuration/custom-checks/#isempty", "text": "The isEmpty check action passes if the named block or attribute is defined by empty. For example, to check that there are not tags you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"isEmpty\" , } matchSpec : name : acl action : isEmpty", "title": "isEmpty"}, {"location": "getting-started/configuration/custom-checks/#startswith", "text": "The startsWith check action passes if the checked attribute string starts with the specified value. For example, to check that acl begins with public you could use the following MatchSpec \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"startsWith\" , \"value\" : \"public\" } matchSpec : name : acl action : startsWith value : public", "title": "startsWith"}, {"location": "getting-started/configuration/custom-checks/#endswith", "text": "The endsWith check action passes if the checked attribute string ends with the specified value. For example, to check that acl ends with read you could use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"endsWith\" , \"value\" : \"-read\" } matchSpec : name : acl action : endsWith value : -read", "title": "endsWith"}, {"location": "getting-started/configuration/custom-checks/#contains", "text": "The contains check action will change depending on the attribute or block it is applied to. If the check is against a string attribute, it will look for the MatchSpec value in the attribute. If the check is against a list, it will pass if the value item can be found in the list. If the attribute is an object or map it will pass if a key can be found that matches the MatchSpec value. For example, if you want to ensure that the CostCentre exists, you might use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"tags\" , \"action\" : \"contains\" , \"value\" : \"CostCentre\" } matchSpec : name : tags action : contains value : CostCentre", "title": "contains"}, {"location": "getting-started/configuration/custom-checks/#notcontains", "text": "The notContains check action will change depending on the attribute or block it is applied to. If the check is against a string attribute, it will look for the MatchSpec value in the attribute. If the check is against a list, it will pass if the value item can be found in the list. If the attribute is an object or map it will pass if a key can be found that matches the MatchSpec value. For example, you want to make sure that an action does not contain kms:* you might use the following MatchSpec : \"matchSpec\" : { \"name\" : \"action\" , \"action\" : \"notContains\" , \"value\" : \"kms:*\" } matchSpec : name : tags action : notContains value : kms:*", "title": "notContains"}, {"location": "getting-started/configuration/custom-checks/#equals", "text": "The equals check action passes if the checked attribute equals specified value. The core primitive types are supported, if the subject attribute is a Boolean, the MatchSpec value will attempt to be cast to a Boolean for comparison. For example, to check that acl begins with private you could use the following MatchSpec ; \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"equals\" , \"value\" : \"private\" } matchSpec : name : acl action : equals value : private", "title": "equals"}, {"location": "getting-started/configuration/custom-checks/#lessthan", "text": "The lessThan check action passes if the checked attribute is numerical and the value is less than the specified value. For example, if you want to ensure that the cpu_core_count is less than 8, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"lessThan\" , \"value\" : 8 } matchSpec : name : cpu_core_count action : lessThan value : 8", "title": "lessThan"}, {"location": "getting-started/configuration/custom-checks/#lessthanorequalto", "text": "The lessThanOrEqualTo check action passes if the checked attribute is numerical and the value is less than or equal to the specified value. For example, if you want to ensure that the cpu_core_count is less than or equal to 4, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"lessThanOrEqualTo\" , \"value\" : 4 } matchSpec : name : cpu_core_count action : lessThanOrEqualTo value : 4", "title": "lessThanOrEqualTo"}, {"location": "getting-started/configuration/custom-checks/#greaterthan", "text": "The greaterThan check action passes if the checked attribute is numerical and the value is greater than the specified value. For example, if you want to ensure that the cpu_core_count is greater than 2, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"greaterThan\" , \"value\" : 2 } matchSpec : name : cpu_core_count action : greaterThan value : 2", "title": "greaterThan"}, {"location": "getting-started/configuration/custom-checks/#greaterthanorequalto", "text": "The greaterThanOrEqualTo check action passes if the checked attribute is numerical and the value is greater than or equal to the specified value. For example, if you want to ensure that the cpu_core_count is greater than or equal to 4, you might use the following MatchSpec \"matchSpec\" : { \"name\" : \"cpu_core_count\" , \"action\" : \"greaterThanOrEqualTo\" , \"value\" : 4 } matchSpec : name : cpu_core_count action : greaterThanOrEqualTo value : 4", "title": "greaterThanOrEqualTo"}, {"location": "getting-started/configuration/custom-checks/#regexmatches", "text": "The regexMatches check action passes when the regex is matched to the pattern passed in the value. This is check would generally be used as a top level check to filter whether or not to apply a check. For example, this check will ensure that the source attribute of a module matches the supplied regex before continuing with the subMatches. This can be used to ensure that checks are targeted to specific modules. When tackling this specific use case of filtering module blocks by source, the requiredLabels should be set to \"*\" \"matchSpec\" : { \"name\" : \"source\" , \"action\" : \"regexMatches\" , \"value\" : \"^modules\\\\/.*public_.+bucket$\" , \"subMatch\" : { \"name\" : \"acl\" , \"action\" : \"equals\" , \"value\" : \"public-read\" } } matchSpec : name : source action : regexMatches value : \"^modules\\\\/.*public_.+bucket$\" subMatch : name : acl action : equals value : public-read", "title": "regexMatches"}, {"location": "getting-started/configuration/custom-checks/#isany", "text": "The isAny check action passes when the attribute value can be found in the slice passed as the check value. This check action supports strings and numbers \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isAny\" , \"value\" : [ \"private\" , \"log-delivery-write\" ] } matchSpec : name : acl action : isAny value : - private - log-delivery-write", "title": "isAny"}, {"location": "getting-started/configuration/custom-checks/#isnone", "text": "The isNone check action passes when the attribute value cannot be found in the slice passed as the check value. This check action supports strings and numbers \"matchSpec\" : { \"name\" : \"acl\" , \"action\" : \"isNone\" , \"value\" : [ \"authenticated-read\" , \"public-read\" ] } matchSpec : name : acl action : isNone value : - authenticated-read - public-read", "title": "isNone"}, {"location": "getting-started/configuration/custom-checks/#requirespresence", "text": "The requiresPresence checks that the resource in name is also present in the Terraform code. If you wanted to ensure that aws_vpc_flowlogs is present if there is a aws_vpc , you might use the following matchSpec : \"matchSpec\" : { \"action\" : \"requiresPresence\" , \"name\" : \"aws_vpc_flowlogs\" } matchSpec : name : aws_vpc_flowlogs action : requiresPresence", "title": "requiresPresence"}, {"location": "getting-started/configuration/custom-checks/#and", "text": "The and check action passes when all the blocks provided within predicateMatchSpec evaluate to true . This action can be combined with subMatch to perform composite checks against the contents of nested blocks. Note that or and and actions can be nested as many times as needed. If you wanted to ensure that device_name and encrypted are both present in a nested ebs_block_device block, you might use the following matchSpec : \"matchSpec\" : { \"action\" : \"isPresent\" , \"name\" : \"ebs_block_device\" , \"subMatch\" : { \"action\" : \"and\" , \"predicateMatchSpec\" : [ { \"action\" : \"isPresent\" , \"name\" : \"device_name\" }, { \"action\" : \"isPresent\" , \"name\" : \"encrypted\" } ] } } matchSpec : action : isPresent name : ebs_block_device subMatch : action : and predicateMatchSpec : - action : isPresent name : device_name - action : isPresent name : encrypted", "title": "and"}, {"location": "getting-started/configuration/custom-checks/#or", "text": "The or check action passes when at least one of the blocks provided within predicateMatchSpec evaluates to true . This action can be combined with subMatch to perform composite checks against the contents of nested blocks. Note that or and and actions can be nested as many times as needed. If you want to ensure that virtualization_type is assigned to either hvm or paravirtual , while enforcing that their implicitly linked required attributes are also present, you might use the following matchSpec : \"matchSpec\": { \"action\": \"or\", \"predicateMatchSpec\": [ { \"action\": \"and\", \"predicateMatchSpec\": [ { \"name\": \"virtualization_type\", \"action\": \"equals\", \"value\": \"hvm\" } ] }, { \"action\": \"and\", \"predicateMatchSpec\": [ { \"name\": \"virtualization_type\", \"action\": \"equals\", \"value\": \"paravirtual\" }, { \"name\": \"image_location\", \"action\": \"isPresent\" }, { \"name\": \"kernel_id\", \"action\": \"isPresent\" } ] } ] } matchSpec : action : or predicateMatchSpec : - action : and predicateMatchSpec : - name : virtualization_type action : equals value : hvm - name : sriov_net_support action : isPresent - action : and predicateMatchSpec : - name : virtualization_type action : equals value : paravirtual - name : image_location action : isPresent - name : kernel_id action : isPresent", "title": "or"}, {"location": "getting-started/configuration/custom-checks/#not", "text": "The not check action passes when the predicateMatchSpec evaluates to false . As an example, if you want to represent that a resource should not be included inModule you might use the following matchSpec : \"matchSpec\": { \"action\": \"not\", \"predicateMatchSpec\": [ { \"action\": \"inModule\" } ] } matchSpec : action : not predicateMatchSpec : - action : inModule", "title": "not"}, {"location": "getting-started/configuration/custom-checks/#how-do-i-know-my-json-is-valid", "text": "We have provided the tfsec-checkgen binary which will validate your check file to ensure that it is valid for use with tfsec . In the future, tfsec-checkgen will facilitate the creation of new check files with a wizard approach, for now it can be used to validate your check file. shell script ./tfsec-checkgen validate example/custom/.tfsec/custom_checks.json", "title": "How do I know my JSON is valid?"}, {"location": "getting-started/configuration/custom-checks/#are-there-limitations", "text": "At the moment, check MatchSpec is limited in the number of check types it can perform, these are as shown in the previous table. Custom defined checks also don't come with the comprehensive tests that the built in ones have. This will be addressed in future releases.", "title": "Are there limitations?"}, {"location": "getting-started/configuration/ignores/", "text": "Ignoring Warnings You may wish to ignore some warnings. If you'd like to do so, you can simply add a comment containing tfsec:ignore:<rule> to the offending line in your templates. If the problem refers to a block of code, such as a multiline string, you can add the comment on the line above the block, by itself. For example, to ignore an open security group rule: resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" cidr_blocks = [\"0.0.0.0/0\"] #tfsec:ignore:aws-vpc-no-public-ingress-sgr } ...or... resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" #tfsec:ignore:aws-vpc-no-public-ingress-sgr cidr_blocks = [\"0.0.0.0/0\"] } If you're not sure which line to add the comment on, just check the tfsec output for the line number of the discovered problem. You can ignore multiple rules by concatenating the rules on a single line: #tfsec:ignore:aws-s3-enable-bucket-encryption tfsec:ignore:aws-s3-enable-bucket-logging resource \"aws_s3_bucket\" \"my-bucket\" { bucket = \"foobar\" acl = \"private\" } Expiration Date You can set expiration date for ignore with yyyy-mm-dd format. This is a useful feature when you want to ensure ignored issue won't be forgotten and should be revisited in the future. #tfsec:ignore:aws-s3-enable-bucket-encryption:exp:2022-01-02 Ignore like this will be active only till 2022-01-02 , after this date it will be deactivated. Workspace Ignores Ignoring checks can be scoped to a workspace level. If you add the ws: declaration to your ignore it will only be honoured for that workspace. # tfsec:ignore:AWS006:exp:2221-01-02 #tfsec:ignore:AWS018:ws:development resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" cidr_blocks = [\"0.0.0.0/0\"] } In the example above, when tfsec is run with the --workspace flag set to development, this ignore will be honoured, but otherwise will be disregarded. tfsec --workspaces development . Ignoring specific values We have recently added support for ignoring based on the value that has been provided. This is particularly relevant when using for_each and you want to allow certain values. locals { rules = { http = 80 https = 443 } } #tfsec:ignore:aws-vpc-no-public-ingress-sgr[from_port=443] resource \"aws_security_group_rule\" \"this\" { for_each = local.rules type = \"ingress\" description = \"test\" from_port = each.value to_port = each.value protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] } In the example above, the aws-vpc-no-public-ingress-sgr check will fail for 80 but when it creates the rule for 443 the check will pass. This feature is experimental - while it works successfully, please raise issues through GitHub Issues", "title": "Ignoring Checks"}, {"location": "getting-started/configuration/ignores/#ignoring-warnings", "text": "You may wish to ignore some warnings. If you'd like to do so, you can simply add a comment containing tfsec:ignore:<rule> to the offending line in your templates. If the problem refers to a block of code, such as a multiline string, you can add the comment on the line above the block, by itself. For example, to ignore an open security group rule: resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" cidr_blocks = [\"0.0.0.0/0\"] #tfsec:ignore:aws-vpc-no-public-ingress-sgr } ...or... resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" #tfsec:ignore:aws-vpc-no-public-ingress-sgr cidr_blocks = [\"0.0.0.0/0\"] } If you're not sure which line to add the comment on, just check the tfsec output for the line number of the discovered problem. You can ignore multiple rules by concatenating the rules on a single line: #tfsec:ignore:aws-s3-enable-bucket-encryption tfsec:ignore:aws-s3-enable-bucket-logging resource \"aws_s3_bucket\" \"my-bucket\" { bucket = \"foobar\" acl = \"private\" }", "title": "Ignoring Warnings"}, {"location": "getting-started/configuration/ignores/#expiration-date", "text": "You can set expiration date for ignore with yyyy-mm-dd format. This is a useful feature when you want to ensure ignored issue won't be forgotten and should be revisited in the future. #tfsec:ignore:aws-s3-enable-bucket-encryption:exp:2022-01-02 Ignore like this will be active only till 2022-01-02 , after this date it will be deactivated.", "title": "Expiration Date"}, {"location": "getting-started/configuration/ignores/#workspace-ignores", "text": "Ignoring checks can be scoped to a workspace level. If you add the ws: declaration to your ignore it will only be honoured for that workspace. # tfsec:ignore:AWS006:exp:2221-01-02 #tfsec:ignore:AWS018:ws:development resource \"aws_security_group_rule\" \"my-rule\" { type = \"ingress\" cidr_blocks = [\"0.0.0.0/0\"] } In the example above, when tfsec is run with the --workspace flag set to development, this ignore will be honoured, but otherwise will be disregarded. tfsec --workspaces development .", "title": "Workspace Ignores"}, {"location": "getting-started/configuration/ignores/#ignoring-specific-values", "text": "We have recently added support for ignoring based on the value that has been provided. This is particularly relevant when using for_each and you want to allow certain values. locals { rules = { http = 80 https = 443 } } #tfsec:ignore:aws-vpc-no-public-ingress-sgr[from_port=443] resource \"aws_security_group_rule\" \"this\" { for_each = local.rules type = \"ingress\" description = \"test\" from_port = each.value to_port = each.value protocol = \"tcp\" cidr_blocks = [\"0.0.0.0/0\"] } In the example above, the aws-vpc-no-public-ingress-sgr check will fail for 80 but when it creates the rule for 443 the check will pass. This feature is experimental - while it works successfully, please raise issues through GitHub Issues", "title": "Ignoring specific values"}, {"location": "getting-started/configuration/github-actions/github-action/", "text": "What is it? Github security alerts sit on the Security tab in your github project and detail any security issues that have been found. tfsec can enrich this information, annotating the exact areas in the code base for a given branch with the details of the failure and the severity. We have provided an action which can be used in your github repo with very little effort. Adding the action Github Actions make it easy to add functionality; to add an action, go to the Action tab to create a new workflow and choose to Set up a workflow yourself. Paste in the workflow content below (be sure to check you're using the latest version of the tfsec-sarif-action by checking here ) name : tfsec on : push : branches : - main pull_request : jobs : tfsec : name : tfsec sarif report runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : tfsec uses : tfsec/tfsec-sarif-action@main with : sarif_file : tfsec.sarif - name : Upload SARIF file uses : github/codeql-action/upload-sarif@v1 with : # Path to SARIF file relative to the root of the repository sarif_file : tfsec.sarif What is this doing? Basically, this action is starting a new ubuntu github action container and checking out the code for either the pull request or the push to master/main . Once the code has been checked out, tfsec with process everything in the local path and generate a sarif report. Finally, the sarif report will be uploaded and the Security tab updated with the identified checks. It will look something like; Anything else I should know? If you have code that is deeper in the github repo, you can use working_directory for the action; - name : tfsec uses : tfsec/tfsec-sarif-action@v0.0.3 with : working_directory : terraform/relevant sarif_file : tfsec.sarif github_token : ${{ secrets.GITHUB_TOKEN }} This will target the checks to all folders under terraform/relevant", "title": "GitHub Action"}, {"location": "getting-started/configuration/github-actions/github-action/#what-is-it", "text": "Github security alerts sit on the Security tab in your github project and detail any security issues that have been found. tfsec can enrich this information, annotating the exact areas in the code base for a given branch with the details of the failure and the severity. We have provided an action which can be used in your github repo with very little effort.", "title": "What is it?"}, {"location": "getting-started/configuration/github-actions/github-action/#adding-the-action", "text": "Github Actions make it easy to add functionality; to add an action, go to the Action tab to create a new workflow and choose to Set up a workflow yourself. Paste in the workflow content below (be sure to check you're using the latest version of the tfsec-sarif-action by checking here ) name : tfsec on : push : branches : - main pull_request : jobs : tfsec : name : tfsec sarif report runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : tfsec uses : tfsec/tfsec-sarif-action@main with : sarif_file : tfsec.sarif - name : Upload SARIF file uses : github/codeql-action/upload-sarif@v1 with : # Path to SARIF file relative to the root of the repository sarif_file : tfsec.sarif", "title": "Adding the action"}, {"location": "getting-started/configuration/github-actions/github-action/#what-is-this-doing", "text": "Basically, this action is starting a new ubuntu github action container and checking out the code for either the pull request or the push to master/main . Once the code has been checked out, tfsec with process everything in the local path and generate a sarif report. Finally, the sarif report will be uploaded and the Security tab updated with the identified checks. It will look something like;", "title": "What is this doing?"}, {"location": "getting-started/configuration/github-actions/github-action/#anything-else-i-should-know", "text": "If you have code that is deeper in the github repo, you can use working_directory for the action; - name : tfsec uses : tfsec/tfsec-sarif-action@v0.0.3 with : working_directory : terraform/relevant sarif_file : tfsec.sarif github_token : ${{ secrets.GITHUB_TOKEN }} This will target the checks to all folders under terraform/relevant", "title": "Anything else I should know?"}, {"location": "getting-started/configuration/github-actions/pr-commenter/", "text": "What is it? The PR Commenter action will process a Pull request and add comments to any areas of the change which fail the tfsec checks. Adding the action To add the action, add tfsec_pr_commenter.yml into the .github/workflows directory in the root of your Github project. The contents of tfsec_pr_commenter.yml should be; name : tfsec-pr-commenter on : pull_request : jobs : tfsec : name : tfsec PR commenter runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : tfsec uses : tfsec/tfsec-pr-commenter-action@main with : github_token : ${{ secrets.GITHUB_TOKEN }} On each pull request and subsequent commit, tfsec will run and add comments to the PR where tfsec has failed. The comment will only be added once per transgression. Example PR Comment The screenshot below demonstrates the comments that can be expected when using the action", "title": "PR Commenter"}, {"location": "getting-started/configuration/github-actions/pr-commenter/#what-is-it", "text": "The PR Commenter action will process a Pull request and add comments to any areas of the change which fail the tfsec checks.", "title": "What is it?"}, {"location": "getting-started/configuration/github-actions/pr-commenter/#adding-the-action", "text": "To add the action, add tfsec_pr_commenter.yml into the .github/workflows directory in the root of your Github project. The contents of tfsec_pr_commenter.yml should be; name : tfsec-pr-commenter on : pull_request : jobs : tfsec : name : tfsec PR commenter runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : tfsec uses : tfsec/tfsec-pr-commenter-action@main with : github_token : ${{ secrets.GITHUB_TOKEN }} On each pull request and subsequent commit, tfsec will run and add comments to the PR where tfsec has failed. The comment will only be added once per transgression.", "title": "Adding the action"}, {"location": "getting-started/configuration/github-actions/pr-commenter/#example-pr-comment", "text": "The screenshot below demonstrates the comments that can be expected when using the action", "title": "Example PR Comment"}]}